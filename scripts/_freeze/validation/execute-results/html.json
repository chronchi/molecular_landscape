{
  "hash": "d538e92a622fee08a6e03d31c7f256e2",
  "result": {
    "markdown": "# Validating the molecular landscape\n\nIn the last chapters only TCGA and METABRIC samples were used in the training\nand testing of the PCA projection. To completely validate, we use another\nbig cohort, SCANB, that was not used in the PCA fitting and testing before.\nThis way we ensure that the embedding is independent of the cohort. Moreover,\nwe use the SMC cohort [@Kan2018], whose patients are from South Korea.\nWe show how well it is embedded, and that \nis not dependent on population characteristics. \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n* The library is already synchronized with the lockfile.\n```\n:::\n:::\n\n\n\n## SCANB embedding\n\nThe embedding was already calculate before when calculating the fit and\ntests, since the datasets were organized and loaded together. We also\nknow already that all the 1044 genes are available in the SCANB cohort. \nSCANB is well mixed with all cohorts as @fig-pca-scanb shows.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA embedding colored by cohort. All samples from TCGA, METABRIC and SCANB were used.](validation_files/figure-html/fig-pca-scanb-1.png){#fig-pca-scanb width=672}\n:::\n:::\n\n\nIdeally there would be some overlap between SCANB and TCGA already in the \nfirst component. Moreover, if there isn't, the cohort should be closer\nto TCGA than to METABRIC, due to technologies and normalization procedures,\nas both of them are log FPKM. Even though SCANB was processed in a way \nto get directly FPKM values, by using cufflinks, TCGA was normalized to get\nlog FPKM as well, as discussed previously. @fig-pca-scanb-pc1 shows\nhow close SCANB is from TCGA, moreover there is already some overlap. The \nvariability in the first component is bigger for METABRIC compared to\nTCGA and SCANB. Probably this is due to the technology processing, since\nthey have genes in the same scale. @fig-pca-no-norm contrasts the different\nnormalization procedures. If genes are not scaled correctly, the PCA\nshows an inverse picture.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA embedding colored by cohort. The components used are the first and second components.](validation_files/figure-html/fig-pca-scanb-pc1-1.png){#fig-pca-scanb-pc1 width=672}\n:::\n:::\n\n\n@fig-pca-scanb-er-pam50 shows that the SCANB samples are also well mixed\nregarding the clinical factors, including the $SET_{ER/PR}$ signature.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA embedding of all samples from TCGA, SCANB and METABRIC. (A) Colored by cohort, (B) colored by ER status, (C) colored by PAM50 molecular subtype, (D) colored by the $SET_{ER/PR}$ signature and only SCANB samples.](validation_files/figure-html/fig-pca-scanb-er-pam50-1.png){#fig-pca-scanb-er-pam50 width=1536}\n:::\n:::\n\n\n\n## Missing genes\n\nGenes missing in publicly available datasets is very common. Usually this is\ndue to processing pipelines or even data quality, therefore genes are removed.\nThis should not be much of a problem, if the data is good enough, when \ncalculating the qPCR-like normalization as it was shown before. The problem\narises when multiplying the loadings obtained in the PCA with the \nnormalized expression of the sample. If several genes are missing, 0s are \nadded to the matrix and therefore the loadings for these genes cannot be \nused. Since 1000 genes were used, we investigate the loadings of genes and \ntry to calculate a fuzziness score, indicating when the embedding should\nbe trusted if genes are missing, and which genes are missing. \n\n### Fuzziness score \n\nThe idea of the fuzziness score is that we use the loadings of the missing\ngenes and calculate the cumulative sum of their absolute values. \nThe higher this value\nthe more it indicates the missing genes are important. We start by\nremoving random genes from random samples of the SCANB cohort. Each sample\nwill have a random number of genes removed from the set of 1044 genes. \nThen two scores are calculated, one for PC2 and another for PC3. We also\ncalculate the fuzziness score for the top loading genes and the \nlow loadings genes, to compare these values.\n\nWe start by comparing the scores from top loadings and low loading genes. For\nthis we remove the top 50 loadings and bottom 50 loadings, in terms of\nabsolute values. @fig-loadings-top-bottom shows the cumulative sum\nof the absolute values from the top and bottom loadings respectively. See how \nimportant the top loadings are compared to the bottom loadings. A way of\nthinking of this is that the top loadings weights are much more important\nwhen calculating the embedding.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Cumulative sum of absolute values for the top loadings and bottom loadings as a function of the number of selected genes.](validation_files/figure-html/fig-loadings-top-bottom-1.png){#fig-loadings-top-bottom width=672}\n:::\n:::\n\n\nThis was using the top loadings, so probably the fuzziness score of a sample\nwith relatively good data will be between 0 and 12 maximum, meaning that\nthey have less than 200 genes missing. When genes are missing, we hope that\nthey are in the bottom part of the loadings, so the fuzziness score\nis as small as possible. \n\nSuppose now that the genes missing in a sample are random. We will calculate\nrandom fuzziness scores based on this to have a feeling of the scores. \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Distribution of the fuzziness scores from random missing genes. Each color corresponds to a different distribution using a different number of genes.](validation_files/figure-html/fig-fuzziness-random-1.png){#fig-fuzziness-random width=672}\n:::\n:::\n\n\n@fig-fuzziness-random shows the results as a function of the number of missing\ngenes. We see that in average, if 200 genes are missing, the fuzziness\nscore is around 5. If less than a 100 genes are missing, the fuzziness\nscore is around 3. In the next section we show how this influences the\nposition where the sample is projected into the embedding.\n\nFinally, we calculate the fuzziness score as a number of top loadings \nmissing. Suppose 150 genes are missing. We will change the proportion\nof genes that are in the top loadings and in the missing list. Since\nthe cumulative sum for PC2 and PC3 are very similar, we focus only on\nPC2.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Distribution of the fuzziness scores from 150 random missing genes with different proportions of top loading genes in the list. Each color corresponds to a different distribution using a different proportion of genes.](validation_files/figure-html/fig-fuzziness-random-top-1.png){#fig-fuzziness-random-top width=672}\n:::\n:::\n\n\n@fig-fuzziness-random-top shows the fuzziness score with different proportions\nof the top loading genes. We see that they are actually very important when\ncalculating the score. The top loading genes were defined as the top 150 genes\nin the list. So when calculating the number of missing genes it is important\nto check the number of top loadings in the list. \n\n### Validating the score\n\nIn this section we calculate the embeddings with different number of genes\nmissing from a given sample and then plot the original embedding with\nthe newly one. For this\nwe use samples from TCGA. The genes are \nremoved even before the normalization procedure, as they are usually not\navailable there. We select randomly a number of top genes from PC3 and PC4\nto compose the list of missing genes. The proportion of the top loading\ngenes is varied. \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n::: {.panel-tabset}\n\n\n::: {.cell}\n\n:::\n\n\n#### TCGA-OL-A66K-01A-11R-A29R-07\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](validation_files/figure-html/fig-missing-correction-10-1.png){#fig-missing-correction-10 width=768}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n#### TCGA-GI-A2C9-01A-11R-A21T-07\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](validation_files/figure-html/fig-missing-correction-20-1.png){#fig-missing-correction-20 width=768}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n#### TCGA-3C-AALK-01A-11R-A41B-07\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](validation_files/figure-html/fig-missing-correction-50-1.png){#fig-missing-correction-50 width=768}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n#### TCGA-BH-A0BW-01A-11R-A115-07\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](validation_files/figure-html/fig-missing-correction-80-1.png){#fig-missing-correction-80 width=768}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n#### TCGA-A1-A0SI-01A-11R-A144-07\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](validation_files/figure-html/fig-missing-correction-182-1.png){#fig-missing-correction-182 width=768}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\n#### TCGA-D8-A27L-01A-11R-A16F-07\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](validation_files/figure-html/fig-missing-correction-198-1.png){#fig-missing-correction-198 width=768}\n:::\n:::\n\n\n:::\n\nWhen looking at the figures above, it seems that whenever there are \ngenes missing,\nand the more of top loadings they are, the closer they are to the origin.\nThis makes sense, since PCA is doing a simple linear combination of the loadings.\nThis should be fine to correct, since we can fit a line going through the \norigin and goes through the points above. Then the adjustment will depend\non the number of genes that are missing and are top loadings. The more \nthey are, the more adjustment we will need. \n\nFor the adjustment we only know two things, its current position and \nhow many of the top loadings are missing. Based on this information we\nshould be able to correct the samples. Given the list of genes that are missing,\nwe fit lines that would go through the genes that are missing in the TCGA\nand METABRIC samples. We then try to find the line that is closes to the point.\nAfter performing the fit and the line, we can then move the point to closer\nto the METABRIC and TCGA samples. The point should be close to the line\nand close to points that have the same proportion of top loadings \nmissing.\n\n\n::: {.cell}\n\n:::\n\n\nThese plots show how the fuzziness score might be indicative of how\ngood the embedding will be depending on the number of missing genes. The\nvideo below shows the images for 20 different patients. Notice how all of\nthem are connected to the origin as well.\n\n\n<iframe width=\"720\" height=\"480\" src=\"../plots/validation/random_loadings.mp4\" align=\"middle\" frameborder=\"0\" allowfullscreen></iframe>\n\n\n## SMC embedding\n\nBy following the same procedures as previously, normalizing and getting\nthe PC coordinates, @fig-smc-cohort shows the biplot of PC1 and PC2\nwhen coloring by cohorts. The samples seem to be well mixed already in\nthe RNA-seq samples. This is probably due to the fact that the SMC cohort\nhas TPM values. \n\n\n::: {.cell}\n\n:::\n\n\nWhen checking the total number of genes missing, there are only \n4 genes missing. \nAnd as seen before, this number is almost irrelevant, in the sense that\nthe embedding will still be robust and locations will be precise enough.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Biplot of first two PCA components from SMC, TCGA, SCANB and METABRIC. SMC is highlighted in the plot and has a bigger dot.](validation_files/figure-html/fig-smc-cohort-1.png){#fig-smc-cohort width=672}\n:::\n:::\n\n\nAs previously, @fig-pca-smc-er-pam50 shows the biplot of PC3 and PC4, \nhighlighting the well mixing of the cohorts. When coloring by ER status,\nsamples are in the right group. Molecular subtype is also correct. This\ncohort is special in the sense that there are more luminal B patients,\nas discussed in the paper. That is why there are more samples in the \nluminal B region.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA embedding of all samples from TCGA, SCANB and METABRIC including the SMC samples on top. (A) Colored by cohort, (B) colored by ER status, (C) colored by PAM50 molecular subtype.](validation_files/figure-html/fig-pca-smc-er-pam50-1.png){#fig-pca-smc-er-pam50 width=1728}\n:::\n:::\n\n\n## PDX \n\nAnother way to validate the results is to use patient derived xenografts.\nIn the Brisken lab the MIND model is used [@Sflomos2016; @Scabia2022]. \nER+ breast cancer\nsamples coming from patients are processed in a specific way and\ninjected into the mammary glands of mice. Based on that they can\nstablish themselves and proliferate. The environment should recapitulate\nwhat is seen in women as well, in the sense that estrogen (E2) levels \nare similar to those of post-menopausal women. Since these cells have\nto proliferate in order to establish and grow in the ducts, we expect\nthem to be more proliferative in terms of RNA-seq components and also\nto lie in the luminal B region of the molecular landscape. We validate\nthis now. \n\n\n::: {.cell}\n\n:::\n\n\nWhen checking the total number of genes missing, there are only \n27 genes missing. \nAnd as seen before, this number is almost irrelevant, in the sense that\nthe embedding will still be robust and locations will be precise enough.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Biplot of first two PCA components from PDX, TCGA, SCANB and METABRIC. PDX is highlighted in the plot and has bigger dot size.](validation_files/figure-html/fig-pdx-cohort-1.png){#fig-pdx-cohort width=672}\n:::\n:::\n\n\nAs previously, @fig-pca-pdx-cohort shows the biplot of PC3 and PC4, \nhighlighting the well mixing of the cohorts. As expected the samples are \noverall in the luminal B region, since these are tumor cells in a \nproliferative state.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Embedding of all samples from TCGA and METABRIC including the PDX samples on top.](validation_files/figure-html/fig-pca-pdx-cohort-1.png){#fig-pca-pdx-cohort width=768}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Embedding of only PDX control samples on top of the METABRIC, SCANB and TCGA samples](validation_files/figure-html/fig-pca-pdx-control-only-1.png){#fig-pca-pdx-control-only width=864}\n:::\n:::\n\n\nAnd we check the PDXs response to estrogen and see how much they move\naway from the untreated sample.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Comparison of position in the molecular landscape between CTRL and P4 treated samples](validation_files/figure-html/fig-pdx-p4-control-components-1.png){#fig-pdx-p4-control-components width=960}\n:::\n:::\n\n\nIt looks like some of the PDXs had a bigger shift towards the left\nwhen treated with estrogen or at least some stabilization. On the\nother hand, another set of PDXs, the last three, they didn't see\nmuch change. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![Comparison of position in the molecular landscape between CTRL, E2 and P4 treated samples](validation_files/figure-html/fig-pdx-p4-control-pathways-1.png){#fig-pdx-p4-control-pathways width=960}\n:::\n:::\n\n\nWhat we can see from these scores is that if there is an increase\nin G2M checkpoint and the control samples have scores below 0,\nthen the fourth principal component will change it is value, it \nwill go upwards and to the left in the molecular landscape,\nreflecting the biological response of the tumors to the\ngiven hormones. \n\nWe now further validate the results with the stainings performed\non those samples. We will compare the differences with the stainings and\nthe number of Ki67+ tumors cells.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Quantification of Ki67+ cells based on DAB stainings performed on the patient derived xenografts.](validation_files/figure-html/fig-quantification-pdx-ki67-1.png){#fig-quantification-pdx-ki67 width=672}\n:::\n:::\n\n\nWe see that T111 has a big increase in absolute values. T113 as well\nhas a big increase, but has a baseline level already low and it does\nnot go to higher values. Probably the reason there is not much\ndifference in the fourth component of the PDX T113 is because of the\nlow Ki67 index. \n\nBased on the data shown here we see that there is an increase in \nproliferation upon P4 treatment for T111 and T113. Moreover,\nP4 reduced estrogen signaling and also change the third component of the\nthree PDXs to a smaller value, towards a more basal like region. Overall,\nthe molecular landscape is able to capture the differences between\nthe treatments.\n\n## Normal samples\n\nWe now further validate the molecular landscape on the normal samples\nthat were sequenced using the same pipeline as the SCANB data. These\nare samples obtained from reduction mammoplasty of swiss women and were\nsent to Sweden for the tissue processing and sequecing. The hypotheses \nhere is that the samples will be embedded in the region of the normal\nlike BC samples.\n\n\n::: {.cell}\n\n:::\n\n\nWhen checking the total number of genes missing, there are only \n0 genes\nmissing, i.e., no genes were missing. This makes sense as these samples were\nprocessed in the same way as the ones from SCANB.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Biplot of first two PCA components from Normal Swiss Cohort, TCGA, SCANB and METABRIC. The normal cohort is highlighted in the plot and has bigger dot size.](validation_files/figure-html/fig-normal-cohort-1.png){#fig-normal-cohort width=672}\n:::\n:::\n\n\nAs previously, @fig-pca-normal-cohort shows the biplot of PC3 and PC4, \nhighlighting the well mixing of the cohorts. As expected the samples are \noverall in the luminal B region, since these are tumor cells in a \nproliferative state.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Embedding of all samples from TCGA, SCNAB and METABRIC including the Normal samples on top.](validation_files/figure-html/fig-pca-normal-cohort-1.png){#fig-pca-normal-cohort width=864}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Embedding of Normal Swiss cohort with the other cohorts colored by the PAM50.](validation_files/figure-html/fig-pca-normal-pam50-1.png){#fig-pca-normal-pam50 width=864}\n:::\n:::\n\n\n## Third component as a prognostic measure?\n\nWe have seen that estrogen signaling is a continuous measure across\nthe third component. The farthest to the right you are the\nhigher the ER signaling scores are also. Here we hypothesized then\nthat the third component is correlated to the prognostic nature\nof the estrogen signaling score. For this we select only samples\nwith PC3 higher than 0, as these would be the ones that are from\nluminal A and B subtypes and we use PC3 as a score in the survival analysis.\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> cohort </th>\n   <th style=\"text-align:right;\"> number_patients </th>\n   <th style=\"text-align:right;\"> nb_events </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> SCANB </td>\n   <td style=\"text-align:right;\"> 3144 </td>\n   <td style=\"text-align:right;\"> 532 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> METABRIC </td>\n   <td style=\"text-align:right;\"> 724 </td>\n   <td style=\"text-align:right;\"> 445 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SCANB High ER </td>\n   <td style=\"text-align:right;\"> 2521 </td>\n   <td style=\"text-align:right;\"> 394 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nFirst we check the correlation of PC3 with estrogen response early and \nG2M checkpoint.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](validation_files/figure-html/unnamed-chunk-40-1.png){width=1152}\n:::\n:::\n\n\nThere is indeed the correlation with the components but still a lot of \nvariability. So it will be unlikely to see such strong effects on the\nthird component.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\nThe table below shows the results for the survival analysis using all\nthe samples from SCANB and METABRIC coming from patients that received\nonly endocrine therapy and whose samples had a $PC3 > 0$. OS means\noverall survival and RFS means recurrence free survival.\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-ac858479a99a77cc1e4b\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-ac858479a99a77cc1e4b\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td><\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.157302801738819\\\" data-max=\\\"0.979641464860496\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.086659522070909\\\" data-max=\\\"0.91450978263938\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.285533209087343\\\" data-max=\\\"1.05812542680493\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"3.04035e-10\\\" data-max=\\\"0.564683081832242\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\",\"11\",\"12\"],[\"os\",\"os\",\"os\",\"rfs\",\"rfs\",\"rfs\",\"os\",\"os\",\"os\",\"rfs\",\"rfs\",\"rfs\"],[\"metabric\",\"scanb\",\"scanb_high_er\",\"metabric\",\"scanb\",\"scanb_high_er\",\"metabric\",\"scanb\",\"scanb_high_er\",\"metabric\",\"scanb\",\"scanb_high_er\"],[\"PC3\",\"PC3\",\"PC3\",\"PC3\",\"PC3\",\"PC3\",\"SET_ERPR\",\"SET_ERPR\",\"SET_ERPR\",\"SET_ERPR\",\"SET_ERPR\",\"SET_ERPR\"],[0.965196820738388,0.979641464860496,0.976765390547171,0.927679121305446,0.800976963057302,0.806505234189354,0.464246247797768,0.461668317344325,0.4283623753784,0.342276782189972,0.178592934710816,0.157302801738819],[0.905520711007731,0.91450978263938,0.901661186851583,0.853412922891882,0.705096735990688,0.699301639778882,0.318907386453501,0.337416970727172,0.298035891481685,0.217175112095403,0.104470457051515,0.0866595220709096],[1.02880573733839,1.04941184653511,1.05812542680493,1.0084081562649,0.909895142894226,0.930143239733423,0.675821845931848,0.631674319107909,0.615678614168189,0.539442086599947,0.305305798680425,0.285533209087343],[0.276663895475407,0.557896482902491,0.564683081832242,0.0778512701200417,0.000645978717930927,0.00312570384572037,6.2000729287213e-05,1.35364734788128e-06,4.63696861712346e-06,3.85220744164788e-06,3.04035068980176e-10,1.19798169297805e-09]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>type_analysis<\\/th>\\n      <th>cohort<\\/th>\\n      <th>term<\\/th>\\n      <th>HR<\\/th>\\n      <th>conf.low<\\/th>\\n      <th>conf.high<\\/th>\\n      <th>p.value<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"scrollX\":true,\"pageLength\":20,\"columnDefs\":[{\"targets\":7,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatSignif(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":4,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":5,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":6,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"className\":\"dt-right\",\"targets\":[4,5,6,7]},{\"orderable\":false,\"targets\":0}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"orderCellsTop\":true,\"lengthMenu\":[10,20,25,50,100]}},\"evals\":[\"options.columnDefs.0.render\",\"options.columnDefs.1.render\",\"options.columnDefs.2.render\",\"options.columnDefs.3.render\"],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\nWe see that in all cases the HR for PC3 is below 1, for OS the values are\n0.98 and 0.97 and the HR and for RFS from 0.80 to 0.93. What is \ninteresting to note here is that in all cases the confidence interval\nis crossing 1, as expected due to the variability of the \ncorrelation with SET ER/PR and estrogen response early. \nRemember that the hazard ratio scale is not\nlinear. Indeed it seems that the more a sample is on the right side\nof the plot the better is its outcome. Notice that the \nscale for HR is different for PC3 and SET ER/PR, since one is a positive\nscore ranging from 0 to 8 and the other is a score ranging from\n-1 to 1. If we were to rescale SET ER/PR to an interval between\n0 to 10 by multiplying by 5 and then summing 5, we would get \nhazard ratios in the range of 0.8. Moreover, estrogen signaling\nis not the only thing fully explaining the third component as\nit can be seen from @fig-pca-mol-land-pathways. In this case,\nG2M Checkpoint and PI3K signaling have also a role in the third\ncomponent.\n\nThe following figures correspond to the overall survival analysis and\nrecurrence free survival analysis from the SCANB and METABRIC.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](validation_files/figure-html/unnamed-chunk-44-1.png){width=768}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](validation_files/figure-html/unnamed-chunk-45-1.png){width=768}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Overall and recurrence free survival analysis of the principal components PC3 and PC4. The rows correspond to a different PC and cohort and if the case sub cohort.](validation_files/figure-html/fig-os-rfs-pcs-1.png){#fig-os-rfs-pcs width=960}\n:::\n:::\n\n\n## High risk patients\n\nThe Prosigna risk of recurrence score takes into account the \ntumor stage and the molecular subtype, this is the ROR-C and \nthe formula from the original paper is presented below:\n\n\n$$\nROR-C = 0.05\\times basal + 0.11 \\times HER2 - 0.23 \\times LumA + 0.09 \\times \nLumB  + 0.17 \\times Tumor size\n$$\n\n\nWe see that if a tumor sample has a high correlation to the\nluminal A subtype it will decrease the score,\nwhereas for all other cases there is an increase in the risk. We \nwant to evaluate if the position in the molecular landscape is \nsomehow correlated with the risk score, specially in the forth component\nfor luminal A patients.\n\nIn [@SCANB2022] they showed that they are able to predict the \nProsigna binary categories high or low/intermediate risk for \nthe patients based only on the RNA-seq provided by their pipeline.\nWe use these categories here to understand the molecular scores \nof the samples and also their correlation with the position and\nrisk groups.  All the following analysis are done for ER+ BC patients \n**only**.\n\nFirst we stratify the risk groups by the molecular subtype.\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-a1d3aea4b8d5913e70a0\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-a1d3aea4b8d5913e70a0\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\"],[\"basal\",\"her2\",\"lumb\",\"luma\",\"normal\",\"Total\"],[\"86%   (63)\",\"89%  (463)\",\"86% (1751)\",\"14%  (472)\",\"16%  (139)\",\"42% (2888)\"],[\"14%   (10)\",\"11%   (59)\",\"14%  (283)\",\"86% (2890)\",\"84%  (714)\",\"58% (3956)\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>pam50<\\/th>\\n      <th>High<\\/th>\\n      <th>Low/Intermediate<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"orderable\":false,\"targets\":0}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\nAs expected the majority of luminal A patients are low/intermediate\nrisk, on the other hand most of the luminal B patients are considered\nof high risk. \n\nIf we look more specifically for luminal A patients and stratify \non the tumor stage we get the following numbers.\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-1d4f5c246321d2791724\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-1d4f5c246321d2791724\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\"],[\"T1\",\"T2\",\"T3\",\"Total\"],[\"9% (222)\",\"26% (214)\",\"44%  (34)\",\"14% (470)\"],[\"91% (2214)\",\"74%  (624)\",\"56%   (44)\",\"86% (2882)\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>tumor_stage<\\/th>\\n      <th>High<\\/th>\\n      <th>Low/Intermediate<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"orderable\":false,\"targets\":0}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\nWe see that for tumor stage 1 the number of high individuals is\nlower in percentage than in tumor stage 3, as expected. We \nnow plot (@fig-luma-scanb-g2m-ts) for all these patients the G2M \nmolecular score,\nan index of proliferation, stratified by the tumor stage. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![Luminal A BC patients G2M scores stratified by tumor stage.](validation_files/figure-html/fig-luma-scanb-g2m-ts-1.png){#fig-luma-scanb-g2m-ts width=1056}\n:::\n:::\n\n\nWe see that in all three cases in average the G2M scores are \nhigher in the high risk groups than in the Low/Intermediate.\n\nWe saw previously that some of the G2M checkpoint genes have higher\nloadings for the fourth component. We now plot the PC4 components stratified\nby the risk groups for the luminal A patients (@fig-luma-scanb-pc4).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Luminal A BC patients PC4 values stratified by risk category.](validation_files/figure-html/fig-luma-scanb-pc4-1.png){#fig-luma-scanb-pc4 width=576}\n:::\n:::\n\n\nIndeed, in average the higher the PC4, the more likely it is to be\nin the High risk group. And now we compare the \nG2M Checkpoint, Estrogen response early and random 200 signature \nfor each molecular subtype separately (@fig-all-scanb-g2m-ere) of \nER+ BC patients.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![ER+ BC patients and molecular scores stratified by molecular subtype and binary risk categories.](validation_files/figure-html/fig-all-scanb-g2m-ere-1.png){#fig-all-scanb-g2m-ere width=1344}\n:::\n:::\n\n\nWe see that in this case the binary risk category has distinct distributions\nfor the G2M checkpoint for all molecular subtypes, in particular with the \nbasal like. \n",
    "supporting": [
      "validation_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\n<link href=\"site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/datatables-binding-0.22/datatables.js\"></script>\n<script src=\"site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"site_libs/dt-core-1.11.3/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/dt-core-1.11.3/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/dt-core-1.11.3/js/jquery.dataTables.min.js\"></script>\n<link href=\"site_libs/nouislider-7.0.10/jquery.nouislider.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/nouislider-7.0.10/jquery.nouislider.min.js\"></script>\n<link href=\"site_libs/selectize-0.12.0/selectize.bootstrap3.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/selectize-0.12.0/selectize.min.js\"></script>\n<link href=\"site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}