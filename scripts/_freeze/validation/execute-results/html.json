{
  "hash": "cbeedf1cdbf544bef13c80f6ec2c156c",
  "result": {
    "markdown": "# Validating the molecular landscape\n\nIn the last chapters only TCGA and METABRIC samples were used in the training\nand testing of the PCA projection. To completely validate, we use another\nbig cohort, SCANB, that was not used in the PCA fitting and testing before.\nThis way we ensure that the embedding is independent of the cohort. Moreover,\nwe use the SMC cohort [@Kan2018], whose patients are from South Korea and \nthe data is microarray. We show how well it is embedded, and that \nis not dependent on population parameters. \n\n\n::: {.cell}\n\n:::\n\n\n\n## SCANB embedding\n\nThe embedding was already calculate before when calculating the fit and\ntests, since the datasets were organized and loaded together. We also\nknow already that all the 1044 genes are available in the SCANB cohort. \nSCANB is well mixed with all cohorts as @fig-pca-scanb shows.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA embedding colored by cohort. All samples from TCGA, METABRIC and SCANB were used.](validation_files/figure-html/fig-pca-scanb-1.png){#fig-pca-scanb width=672}\n:::\n:::\n\n\nIdeally there would be some overlap between SCANB and TCGA already in the \nfirst component. Moreover, if there isn't, the cohort should be closer\nto TCGA than to METABRIC, due to technologies and normalization procedures,\nas both of them are log FPKM. Even though SCANB was processed in a way \nto get directly FPKM values, by using cufflinks, TCGA was normalized to get\nlog FPKM as well, as discussed previously. @fig-pca-scanb-pc1 shows\nhow close SCANB is from TCGA, moreover there is already some overlap. The \nvariability in the first component is bigger for METABRIC compared to\nTCGA and SCANB. Probably this is due to the technology processing, since\nthey have genes in the same scale. @fig-pca-no-norm contrasts the different\nnormalization procedures. If genes are not scaled correctly, the PCA\nshows an inverse picture.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA embedding colored by cohort. The components used are the first and second components.](validation_files/figure-html/fig-pca-scanb-pc1-1.png){#fig-pca-scanb-pc1 width=672}\n:::\n:::\n\n\n@fig-pca-scanb-er-pam50 shows that the SCANB samples are also well mixed\nregarding the clinical factors, including the $SET_{ER/PR}$ signature.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA embedding of all samples from TCGA, SCANB and METABRIC. (A) Colored by cohort, (B) colored by ER status, (C) colored by PAM50 molecular subtype, (D) colored by the $SET_{ER/PR}$ signature](validation_files/figure-html/fig-pca-scanb-er-pam50-1.png){#fig-pca-scanb-er-pam50 width=1920}\n:::\n:::\n\n\n\n## Missing genes\n\nGenes missing in publicly available datasets is very common. Usually this is\ndue to processing pipelines or even data quality, therefore genes are removed.\nThis should not be much of a problem, if the data is good enough, when \ncalculating the qPCR-like normalization as it was shown before. The problem\narises when multiplying the loadings obtained in the PCA with the \nnormalized expression of the sample. If several genes are missing, 0s are \nadded to the matrix and therefore the loadings for these genes cannot be \nused. Since 1000 genes were used, we investigate the loadings of genes and \ntry to calculate a fuzziness score, indicating when the embedding should\nbe trusted if genes are missing, and which genes are missing. \n\n### Fuzziness score \n\nThe idea of the fuzziness score is that we use the loadings of the missing\ngenes and calculate the cumulative sum of their absolute values. \nThe higher this value\nthe more it indicates the missing genes are important. We start by\nremoving random genes from random samples of the SCANB cohort. Each sample\nwill have a random number of genes removed from the set of 1044 genes. \nThen two scores are calculated, one for PC2 and another for PC3. We also\ncalculate the fuzziness score for the top loading genes and the \nlow loadings genes, to compare these values.\n\nWe start by comparing the scores from top loadings and low loading genes. For\nthis we remove the top 50 loadings and bottom 50 loadings, in terms of\nabsolute values. @fig-loadings-top-bottom shows the cumulative sum\nof the absolute values from the top and bottom loadings respectively. See how \nimportant the top loadings are compared to the bottom loadings. A way of\nthinking of this is that the top loadings weights are much more important\nwhen calculating the embedding.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Cumulative sum of absolute values for the top loadings and bottom loadings as a function of the number of selected genes.](validation_files/figure-html/fig-loadings-top-bottom-1.png){#fig-loadings-top-bottom width=672}\n:::\n:::\n\n\nThis was using the top loadings, so probably the fuzziness score of a sample\nwith relatively good data will be between 0 and 10 maximum, meaning that\nthey have less than 200 genes missing. When genes are missing, we hope that\nthey are in the bottom part of the loadings, so the fuzziness score\nis as small as possible. \n\nSuppose now that the genes missing in a sample are random. We will calculate\nrandom fuzziness scores based on this to have a feeling of the scores. \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Distribution of the fuzziness scores from random missing genes. Each color corresponds to a different distribution using a different number of genes.](validation_files/figure-html/fig-fuzziness-random-1.png){#fig-fuzziness-random width=672}\n:::\n:::\n\n\n@fig-fuzziness-random shows the results as a function of the number of missing\ngenes. We see that in average, if 200 genes are missing, the fuzziness\nscore is around 5. If less than a 100 genes are missing, the fuzziness\nscore is around 3. In the next section we show how this influences the\nposition where the sample is projected into the embedding.\n\nFinally, we calculate the fuzziness score as a number of top loadings \nmissing. Suppose 150 genes are missing. We will change the proportion\nof genes that are in the top loadings and in the missing list. Since\nthe cumulative sum for PC2 and PC3 are very similar, we focus only on\nPC2.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Distribution of the fuzziness scores from 150 random missing genes with different proportions of top loading genes in the list. Each color corresponds to a different distribution using a different proportion of genes.](validation_files/figure-html/fig-fuzziness-random-top-1.png){#fig-fuzziness-random-top width=672}\n:::\n:::\n\n\n@fig-fuzziness-random-top shows the fuzziness score with different proportions\nof the top loading genes. We see that they are actually very important when\ncalculating the score. The top loading genes were defined as the top 150 genes\nin the list. So when calculating the number of missing genes it is important\nto check the number of top loadings in the list. \n\n### Validating the score\n\nIn this section we calculate the embeddings with different number of genes\nmissing from a given sample and then calculate the euclidean distance\nin the embedding as a proxy of deviation from the true coordinate. For this\nwe use samples from SCANB, as they were not used in the training process and\nwe know the true position since all genes are available. The genes are \nremoved even before the normalization procedure, as they are usually not\navailable there. As the previous plot, we sample several list of genes\nwith different number of top genes missing from PC2.\n\n\n::: {.cell}\n\n:::\n\n\n\n## SMC embedding",
    "supporting": [
      "validation_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}