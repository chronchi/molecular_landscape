{
  "hash": "f68efbec2f5997843c99e0b524e930d4",
  "result": {
    "markdown": "# Tests and tries \n\nWe have used some numbers of genes for doing the embedding. Here we try to \nperform the embedding with all the genes (~10000 genes) and then\nwe try to regress out the components. \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n* The library is already synchronized with the lockfile.\n```\n:::\n:::\n\n\n## Embedding with more than 1000 genes\n\n\n::: {.cell}\n\n:::\n\n\nAnd now we can visualize the results.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA projections colored by different factors and organized by different components. (A) Plot of the first two components colored by cohort. (B) Plot of the first two components colored by ER status. (C) Plot of the second and third components colored by cohort. (D) Plot of the second and third components colored by ER status. (E) Plot of the second and third components colored by PAM50. (F) Plot of the second and third components colored by INTCLUST, only METABRIC has an assigned value for this variable, NAs are TCGA samples.](trying_files/figure-html/fig-pca-embeddings-1-1.png){#fig-pca-embeddings-1 width=1344}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\nAnd now we can visualize the results.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA projections colored by different factors and organized by different components. (A) Plot of the first two components colored by cohort. (B) Plot of the first two components colored by ER status. (C) Plot of the second and third components colored by cohort. (D) Plot of the second and third components colored by ER status. (E) Plot of the second and third components colored by PAM50. (F) Plot of the second and third components colored by INTCLUST, only METABRIC has an assigned value for this variable, NAs are TCGA samples.](trying_files/figure-html/fig-pca-embeddings-2-1.png){#fig-pca-embeddings-2 width=1344}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA embedding colored by cohort. The components used are the first and second components.](trying_files/figure-html/fig-pca-scanb-pc1-1.png){#fig-pca-scanb-pc1 width=672}\n:::\n:::\n\n\n@fig-pca-scanb-er-pam50-all-genes shows that the SCANB samples are also well mixed\nregarding the clinical factors, including the $SET_{ER/PR}$ signature.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA embedding of all samples from TCGA, SCANB and METABRIC. (A) Colored by cohort, (B) colored by ER status, (C) colored by PAM50 molecular subtype, (D) colored by the $SET_{ER/PR}$ signature and only SCANB samples.](trying_files/figure-html/fig-pca-scanb-er-pam50-all-genes-1.png){#fig-pca-scanb-er-pam50-all-genes width=1536}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-11-1.png){width=1152}\n:::\n:::\n\n\nLet us also check the other components in the biplots.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-12-1.png){width=1536}\n:::\n:::\n\n\nWe see that the pam50 subtypes are being separated using the components 3, 4\nand also 8. In the component 8 there is some expression that is able \nto differentiate between HER2-like from all other samples.\n\nWe now plot by cohort.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-13-1.png){width=1536}\n:::\n:::\n\n\nIn PC1, 2 and 5 there are some small differences in the differences of the \ndistributions from the datasets. We will then remove these 3 components\nup to component 10 with exception of components 3, 4 and 5.\n\n## Removing the batch effects\n\nWe now try to remove the batch effects by removing all the PCs that are not\nof interest, so we remove the first two components and the fifth as well. We\nthen calculate the scores for each cohort separately and then compare\nto what was calculated before. We can then try to calculate the scores\nusing samples coming from all cohorts.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\nIn general it looks good, the luminal B population is a bit compressed \ntowards the luminal A population though.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-17-1.png){width=576}\n:::\n:::\n\n\nThere is a very good merging of the datasets. We see mostly\ngreen points because they are the majority. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-18-1.png){width=960}\n:::\n:::\n\n\nNow we see that the first loadings has a tail in a similar fashio as the\nother loadings. \n\nWe now try to calculate the scores of the samples using these new embeddings\nonly from TCGA samples as we will compare the results later on. \n\n\n::: {.cell}\n\n:::\n\n\nAnd we can now check and compare the scores.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-20-1.png){width=960}\n:::\n:::\n\n\nWe see that for the three pathways the correlation is positive and\nstrong. The difference is that it is a bit noisy, so the correlation\nis not perfect. What is interesting to see is that at the extremes\nthe scores have less variation usually. \n\nWe now calculate the scores from SCANB and compare the results. Remember\nthat SCANB was not used for the PCA training.\n\n\n::: {.cell}\n\n:::\n\n\nAnd we can now check and compare the scores.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-22-1.png){width=960}\n:::\n:::\n\n\nThe same phenomenon happened. Samples in the endges have lower variability,\nbut samples in the middle are the ones that have high variability.\nFor example there are several samples from the regressed data\nwith SET_ERPR score close to 0.25 and negative scores.\n\nWhat happens now if we use another dataset and then use only one sample to \ncalculate the score. Let us include SCANB samples in the pipeline. For this \nwe select 50 scanb samples and 100 random samples from tcga and metabric.\nWe then combine all these samples together and calculate the GSVA scores.\n\n\n::: {.cell}\n\n:::\n\n\nWe now plot only the scores from the SCANB samples.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-24-1.png){width=960}\n:::\n:::\n\n\nSo it seems there are still dataset related problems there when calculating\nthe scores. The scores are positively correlated, but they are not quite\nthe same as only using the SCANB dataset. Moreover, for G2M checkpoint the \nscores are concentrated around -0.4 from the regressed data but \nthey are in a range going from - 0.4 to 0.1 in the unregressed data. \n\nIf we try to instead add some samples from the SCANB dataset as well \nrandomly into the mix. How well does the scores get compared to the \n\"ground truth\"? \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-26-1.png){width=960}\n:::\n:::\n\n\nIt does not work so well when including some SCANB samples together \nwith the METABRIC and TCGA samples. We are trying to achieve a\ncorrelation of almost 1 with very low variability since we want to use\nthe scores clinically. \n\nLet us check the distribution of some genes for SCANB and TCGA after\nregressing out the first two PCs.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-27-1.png){width=960}\n:::\n:::\n\n\nWe see that even though the expression profile of the samples are \noverlapping there are discrepancies. That is why when using GSVA \nit does not work so well perhaps.\n\n## Scoring strategy with regressed data\n\nWe now try to use a slightly different scoring strategy. We can think of \nour data in a log scale, so what we do now instead is to sum all of \nour genes of interest and then subtract an average of the housekeeping\ngenes expression levels.\n\nFirst we check the distribution of this average for each cohort\nseparately.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Distribution of the average of the housekeeping genes for distinct cohorts.](trying_files/figure-html/fig-hkg-regressed-1.png){#fig-hkg-regressed width=768}\n:::\n:::\n\n\nIndeed the tcga and metabric cohorts have an overlapping \ndistribution, but the SCANB does not overlap completely, it is\nactually shifted. One should still take into account that \nthe distributions are very close to 0, meaning that the \nhousekeeping genes have very close to 0 values, as expected here in this case.\nWe now calculate the score by taking this into account. \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Scores obtained from regressed data of all the four cohorts TCGA, SCANB, METABRIC and POETIC compared to the original GSVA scores.](trying_files/figure-html/fig-scores-regressed-1.png){#fig-scores-regressed width=1344}\n:::\n:::\n\n\nThe scores are actually highly correlated, specially the estrogen related \npathways. Also the correlation between the scores in general follows the \nsame trends.\n\nThe plot below is a subset of the scores above to include in the \npublication.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Scores obtained from regressed data of all the four cohorts TCGA, SCANB, METABRIC and POETIC compared to the original GSVA scores.](trying_files/figure-html/fig-scores-regressed-subset-1.png){#fig-scores-regressed-subset width=1440}\n:::\n:::\n\n\nWe now compare the distributions\nof these scores. Across the different cohorts and pathways of interest.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-34-1.png){width=1536}\n:::\n:::\n\n\nAnd with all molecular subtypes together.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-35-1.png){width=960}\n:::\n:::\n\n\nWe see that the overlap is actually pretty good in general, even for \nSCANB. The only part where there is a bigger discrepancy is for\nG2M checkpoint. We see below that by calculating the GSVA score \non the whole scanb cohort we don't have this problem.\n\nAnd as a comparison we plot with the original scores using GSVA on the \nwhole cohort individually.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-36-1.png){width=1536}\n:::\n:::\n\n\nAnd all the subtypes together for the original score:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-37-1.png){width=960}\n:::\n:::\n\n\nWe see that by doing GSVA the distributions they overlap much more than \nusing the regressed data and the simple sum of the values for those genes.\nStill for estrogen signaling it seems that the estrogen early signature\nis pretty robust.\n\n### Checking the patients from POETIC with new scores\n\nWe now use the new scores to evaluate the comparison with the neighboorhood,\njust as before in the previous chapter where we used the POETIC trial data.\n\n\n::: {.cell}\n\n:::\n\n\nPatient 63 @fig-pt63 is considered a responder. According to \nthe scores, when comparing the estrogen early signature to its average \ndistribution in the neighborhood, the score is higher.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Posterior distribution of the average scores in the neighborhood of patient 63 from POETIC trial. Each dot corresponds to a 1% quantile.](trying_files/figure-html/fig-pt63-1.png){#fig-pt63 width=960}\n:::\n:::\n\n\nPatient 236 @fig-pt236 was considered a non responder. According to \nthe scores, when comparing the estrogen early signature to its average \ndistribution in the neighborhood, the score is lower, being in the\n5% quantile.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Posterior distribution of the average scores in the neighborhood of patient 236 from POETIC trial. Each dot corresponds to a 1% quantile.](trying_files/figure-html/fig-pt236-1.png){#fig-pt236 width=960}\n:::\n:::\n\n\nWhen comparing these two patients, there is also a difference in the androgen\nresponse score, which could be a reflection of different estrogen signaling.\n\nIt reflects what we saw previously as well. \n\n### Responder vs non responder comparison of new scores\n\nWe now compare the scores for responders and non responders.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-41-1.png){width=768}\n:::\n:::\n\n\nThe higher E2F targets in average the lower the estrogen early score is\nfor non responders, whereas this correlation does not exist for responder\npatients. This difference is mostly drive by the high E2F target non responder\ntumors. \n\nNow the plot below shows the correlation for baselien Ki67% and E2F targets\nfor the score calculated in the regressed data in a single sample manner. \nWe see a positive correlation between the two scores. Moreover, it is interesting\nto see that when the tumor has low Ki67, there is still a spectrum on \nthe E2F targets score. Also there is no difference in the correlation \nbetween responders and non responders.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-42-1.png){width=768}\n:::\n:::\n\n\nAnd lastly we compare the estrogen signaling signatures between\nresponders and non-responder.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-43-1.png){width=960}\n:::\n:::\n\n\nWe see that the estrogen response early has a wider range when compared to the\nSET ER/PR score. That makes sense as this signature has over 100 genes,\nwhereas SET ER/PR has only 18. Also the responder\nwas very good in discriminating the responders and non responders.\nWhat we can conclude from this figure is that the samples\nwith very low scores are usually non responders, which reflect\ntheir position in the molecular landscape, also in general \nresponders have higher ER signaling than non responders.\n\nBelow is the figure with the GSVA scores before regressing the data, \nwe see that SET ER/PR is not able to really distinguish \ncompletely the non-responders with very low score similar\nto what was done with GSVA. Even estrogen early had\nsome differences.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-44-1.png){width=960}\n:::\n:::\n\n\nAnd below is a figure with both GSVA and regressed scores together.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Comparing scoring strategies for responders and non responders in the POETIC dataset.](trying_files/figure-html/fig-comparison-scoring-strategy-poetic-1.png){#fig-comparison-scoring-strategy-poetic width=960}\n:::\n:::\n\n\n\nBelow we show the correlation between\nthese scores for all cohorts.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-46-1.png){width=576}\n:::\n:::\n\n\nThese scores are highly correlated but in different absolute\nscales. We now check the change in Ki67 for all patients and \ncompare the scores with the original ones obtained with GSVA.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Comparison of original GSVA and regressed scores between responders and non responders compared to change in Ki67.](trying_files/figure-html/fig-comparison-og-regressed-er-1.png){#fig-comparison-og-regressed-er width=1152}\n:::\n:::\n\n\nWe see that the bigger the change the higher the score is when using the\nregressed data. Also the non responders tend to have scores mostly in\nthe negative scale, whereas the responders are more shifted to the\nright. SET ER/PR is also a good measure here. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-48-1.png){width=672}\n:::\n:::\n\n\nThere is a very good match between the two scores in general,\nmeaning that the regression scoring strategy capture relatively\nwell the scores. There is one patient that is a non-responder\nand has a low regressed estrogen early but a GSVA score \nclose to 0, let us check this patient.\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-93806035c6b8082ad801\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-93806035c6b8082ad801\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\"],[\"80\"],[43.2412247946229],[-5.64942273914443],[26.832381276351],[\"pos\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>patient_nb<\\/th>\\n      <th>ki67<\\/th>\\n      <th>PC3<\\/th>\\n      <th>change_ki67<\\/th>\\n      <th>er_status<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":[2,3,4]},{\"orderable\":false,\"targets\":0}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\nIt is a patient that is far to the left on the molecular landscape, among the\nbasal like, and had an increase in Ki67 upon ET. So the \nnew scoring system was able to capture this patient as with low score. \n\n### Survival analysis with the new scores\n\nWe can check how robust these scores are by performing survival analysis.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Overall survival analysis from SCANB and METABRIC cohorts and their scores. The formulas used were the same as for the estrogen signaling analysis. Coefficients were scaled before performing cox regression](trying_files/figure-html/fig-pca-mol-land-survival-regressed-1.png){#fig-pca-mol-land-survival-regressed width=864}\n:::\n:::\n\n\nThe plot with TCGA is shown below.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-52-1.png){width=432}\n:::\n:::\n\n\n\nScores for TCGA are noisier than SCANB and METABRIC. Though the\nscaled scores they have comparable hazard ratios and also \nthey follow what we saw previously. The only pathway that is \na bit different is the PI3K AKT MTOR signaling. This pathway had a noisier\ncorrelation with the GSVA score as well.\n\n## Regressing the PDXs\n\nWe can use the regressing strategy to score the PDXs and then evaluate\ntheir scores. \n\n\n::: {.cell}\n\n:::\n\n\nWe start by comparing the scores across the different \ncontrol samples and their positions in the molecular landscape.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Embedding of only regressed PDX control samples on top of the METABRIC, SCANB and TCGA samples](trying_files/figure-html/fig-pca-pdx-control-only-regressed-1.png){#fig-pca-pdx-control-only-regressed width=864}\n:::\n:::\n\n\nThe results are jus twhat we got previously as well, meaning that\nby using all these genes the information of the PDXs are still \ncaptured. The main differences is that the luminal B region is more\ncompact compare to @fig-pca-pdx-control-only.\n\nAnd now that we have the results we can compare the PDXs as well. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![Scores obtained from the regressed data of the PDXs.](trying_files/figure-html/fig-pdx-regressed-scores-1.png){#fig-pdx-regressed-scores width=960}\n:::\n:::\n\n\nThe random 200 is just a gene set with 200 random genes that works as a \ncontrol and serves as a comparison to the other pathways.\n\nAnd below we show the distribution of some of the scores calculated \nfor all the other cohorts as a comparison. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-56-1.png){width=768}\n:::\n:::\n\n\nWe see that METS15 is the one with the highest proliferation and\nlowest EMT, it is a PDX that comes from a pleural efusion. Also\nit is the PDX with the lowest apoptosis and highest DNA repair,\nprobably due to a higher replication rate. Moreover, all these\nPDXs they have a estrogen response early scores higher than 0\nin average, which is about the average of the scores in the\nER+ BC samples.\n\nNow we check what happens with some of the PDXs when they\nare treated with P4, to compare with @fig-pdx-p4-control-pathways.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Comparison of position in the molecular landscape between CTRL, E2 and P4 treated samples with the regressed data](trying_files/figure-html/fig-pdx-p4-control-pathways-regressed.-1.png){#fig-pdx-p4-control-pathways-regressed. width=1248}\n:::\n:::\n\n\nThe results are very similar to what was seen previously using the GSVA. What is \ninteresting here is that we have an absolute scale, so we can compare the scores.\n\n## singscore\n\nWe can try to use singscore instead, it is a sample dependent measure so \nit does not estimate the distribution of the gene expression levels before\ncalculating the enrichment score.\n\n\n::: {.cell}\n\n:::\n\n\nWe start by comparing with the GSVA scores.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-59-1.png){width=1920}\n:::\n:::\n\n\nWe see that in all cases there is a correlation, but the interpretation\nchanges. In some of the pathways there is difference in the singscores\nbased on the cohort, this is not seen on GSVA. \n\nThe next two figures are the distributions of the singscore and GSVA\nfilled by cohort.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-60-1.png){width=1920}\n:::\n:::\n\n\nFor several pathways in the singscore the distributions are similar,\nbut that is not always the case.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-61-1.png){width=1920}\n:::\n:::\n\n\nOn the other hand GSVA gives very similar distributions for all the \ndifferent cohorts. Therefore we actually need to use GSVA. It is important in \nthe end to calculate scores based on the cohort. \n\nWe now move on and try the same analysis on the regressed data.\n\n\n::: {.cell}\n\n:::\n\n\nWe start by comparing with the GSVA scores.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-63-1.png){width=1920}\n:::\n:::\n\n\nWe see that in all cases there is a correlation, but the interpretation\nchanges. In some of the pathways there is difference in the singscores\nbased on the cohort, this is not seen on GSVA. \n\nThe next two figures are the distributions of the singscore and GSVA\nfilled by cohort.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-64-1.png){width=1920}\n:::\n:::\n\n\nIn the end the best way of scoring seems to be using GSVA on the \nunregressed data though it depends on the pathways. For example the\nhallmark estrogen response early and set ER/PR pathways seem to \nhave been regressed quite well, so we can actually compare the results using \nthe scores. On the other hand we can't use the pathways G2M checkpoint,\nE2F targets and EMT. For the PI3K signaling score it seems it is \ncomparable to SCANB only.\n\n## Using several pathways or just one pathway for GSVA\n\nWe now evaluate the effect of the scores for each pathway when using all the\n53 pathways combined and each one individually. We use only TCGA for \nthis step.\n\n\n::: {.cell}\n\n:::\n\n\n### One vs all\n\nWe now calculate the scores for each gene set individually.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-68-1.png){width=1920}\n:::\n:::\n\n\nIt seems they are all positively correlated, so one could calculate the \nscores basically using just one gene set with exception of some of the\ngene sets. \n\n## Minimum number of samples for GSVA\n\nAccording to the original GSVA paper, a minimum of 10 samples are necessary\nto have a good power when using GSVA. Since here we have at least 5 \nmolecular subgroups, we hypothesize we need at least 50 samples to get a \ngood score so we can compare across cohorts. We will try with\ndifferent numbers of samples using TCGA, we start with 10, 25, 50 and\n100 samples and we compare with the scores using the full dataset.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-72-1.png){width=4800}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-73-1.png){width=4800}\n:::\n:::\n\n\nThe conclusion we can take here is that depending on the gene set not even 150\nsamples is enough. For some only 25 patients is already enough, such as SET \nER/PR, androgen response, estrogen response early and E2F targets.\n\nCould we mix around 20 samples of SCANB together with more samples from \nTCGA and METABRIC to get the scores? Let us try to adress this question\nagain. We are using the regressed data now here as this is the only way.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-76-1.png){width=1920}\n:::\n:::\n\n\nThere is still some correlation but the scores are \nshrinked in the end. \n\n## Normalization strategy\n\nWe can also try another way of normalizing, namely for each sample we\ncan z scale it.\n\n\n::: {.cell}\n\n:::\n\n\nAnd now we can visualize the results.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA projections colored by different factors and organized by different components. (A) Plot of the first two components colored by cohort. (B) Plot of the first two components colored by ER status. (C) Plot of the second and third components colored by cohort. (D) Plot of the second and third components colored by ER status. (E) Plot of the second and third components colored by PAM50. (F) Plot of the second and third components colored by INTCLUST, only METABRIC has an assigned value for this variable, NAs are TCGA samples.](trying_files/figure-html/fig-pca-embeddings-3-1.png){#fig-pca-embeddings-3 width=1344}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-80-1.png){width=672}\n:::\n:::\n\n\nWe see that samples are well embedded as well. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA embedding colored by cohort. The components used are the first and second components.](trying_files/figure-html/fig-pca-scanb-pc1-2-1.png){#fig-pca-scanb-pc1-2 width=672}\n:::\n:::\n\n\nSCANB and POETIC are in between as expected and they are closer\nto their sequencing technology. Interestingly the \nvariation for SCANB and TCGA are compressed in the PC1 vs PC2 axis compared\nto METABRIC and POETIC.\n\n@fig-pca-scanb-er-pam50-2 shows that the SCANB samples are also well mixed\nregarding the clinical factors, including the $SET_{ER/PR}$ signature.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA embedding of all samples from TCGA, SCANB and METABRIC. (A) Colored by cohort, (B) colored by ER status, (C) colored by PAM50 molecular subtype, (D) colored by the $SET_{ER/PR}$ signature and only SCANB samples.](trying_files/figure-html/fig-pca-scanb-er-pam50-2-1.png){#fig-pca-scanb-er-pam50-2 width=1536}\n:::\n:::\n\n\nIn the end normalizing by scaling the sample before doing any embedding\nworks as well. Though the embedding seems to be more compressed. \nI would argue that the qPCR-like normalization gives a bit better\nembedding. \n\n## ILC and position in the molecular landscape\n\nInvasive lobular carcinoma is a subtype of ER+ BC. They tend to respond\nbetter to ET in the short term but they recurr after 20 years. Here we\njust show where the ILC BC lie in the molecular landscape.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Embedding of the lobular samples from SCANB on top METABRIC and TCGA](trying_files/figure-html/fig-pca-lobular-scanb-1.png){#fig-pca-lobular-scanb width=864}\n:::\n:::\n\n\nWe see that they are mostly in the normal and luminal A region. Still\nthere are several samples that are luminal B, meaning they are more\nproliferative.\n\n## genefu \n\nWith genefu it is possible to calculate scores from comercially available \nsignatures. Here we try to use it on SCANB, METABRIC and TCGA. Moreover,\nwe can start with ABiM, as this dataset has the gold standard ROR score \nobtained from nCounter data. This is a good way of validating the\npipeline. \n\n\n::: {.cell}\n\n:::\n\n\nWe start by comparing the molecular subtypes:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\nFALSE  TRUE \n   14    86 \n```\n:::\n:::\n\n\n86 out of 100 were correctly called. Here we are using the gold standard wich\nis the molecular subtype called from FT samples. The normal like subtype is not\navailable from the FT prosigna assay. So we now compare the results with the\nSSP obtained from the SCANB team. \n\nBelow is the confusion matrix to see which subtypes were misclassified. \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nConfusion Matrix and Statistics\n\n          Reference\nPrediction Basal Her2 LumB LumA Normal\n    Basal     13    0    0    0      0\n    Her2       0    8    0    0      0\n    LumB       1    1   33    1      0\n    LumA       1    0    7   32      0\n    Normal     1    0    0    2      0\n\nOverall Statistics\n                                          \n               Accuracy : 0.86            \n                 95% CI : (0.7763, 0.9213)\n    No Information Rate : 0.4             \n    P-Value [Acc > NIR] : < 2.2e-16       \n                                          \n                  Kappa : 0.7965          \n                                          \n Mcnemar's Test P-Value : NA              \n\nStatistics by Class:\n\n                     Class: Basal Class: Her2 Class: LumB Class: LumA\nSensitivity                0.8125      0.8889      0.8250      0.9143\nSpecificity                1.0000      1.0000      0.9500      0.8769\nPos Pred Value             1.0000      1.0000      0.9167      0.8000\nNeg Pred Value             0.9655      0.9891      0.8906      0.9500\nPrevalence                 0.1600      0.0900      0.4000      0.3500\nDetection Rate             0.1300      0.0800      0.3300      0.3200\nDetection Prevalence       0.1300      0.0800      0.3600      0.4000\nBalanced Accuracy          0.9062      0.9444      0.8875      0.8956\n                     Class: Normal\nSensitivity                     NA\nSpecificity                   0.97\nPos Pred Value                  NA\nNeg Pred Value                  NA\nPrevalence                    0.00\nDetection Rate                0.00\nDetection Prevalence          0.03\nBalanced Accuracy               NA\n```\n:::\n:::\n\n\nAll luminal A were predicted correctly. Some normal like were predicted to\nbe luminal A or basal and Her2. There were some mismatches \nfor the LumB, that were misclassified as LumA. Still it is ok. \n\nLet us now calculate the ROR for the ABiM cohort.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Correlation between ROR obtained from prosigna assay and R package genefu](trying_files/figure-html/fig-ror-genefu-abim-1.png){#fig-ror-genefu-abim width=672}\n:::\n:::\n\n\nThe correlation is relatively good and respects the molecular subtypes\nin general. The ROR obtained from genefu for some luminal B are not \nquite right as they are below 50. \n\nWe now move on to the other signatures: Mammaprint, EndoPredict (EP) and \nOncotypeDX Risk Score (RS).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Correlation between ROR obtained from prosigna assay and the mammaprint signature obtained from the R package genefu](trying_files/figure-html/fig-ror-mammaprint-genefu-abim-1.png){#fig-ror-mammaprint-genefu-abim width=672}\n:::\n:::\n\n\n@fig-ror-mammaprint-genefu-abim shows the correlation between \nthe mammaprint signature (named GENE70) and the ROR from prosigna. \n\nLet us now compare the GENE70 signature with the risk score developed in \nthe previous chapters. We use the ABiM 100 cohort to make the comparison. \nOne side note, we are using only 51 out of the 70 probes available in the\npackage. 15 probes don't have any corresponding symbol. Out of the available\ngenes, some are duplicated. For the duplicated genes, the correlation \ncoefficients are all similar, so we can select just the first ocurrence \nin the list.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-89-1.png){width=672}\n:::\n:::\n\n\nThere is a good correlation between the two signatures, suggesting \nthat the Mammaprint signature is somehow based on the position of the samples in\nthe molecular landscape. \n\nWe now proceed and calculate the mammaprint scores for SCANB and \nMETABRIC as well and only for ER+ BC samples.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Embedding of ER+ BC samples colored by the mammaprint score.](trying_files/figure-html/fig-met-scanb-mammaprint-1.png){#fig-met-scanb-mammaprint width=960}\n:::\n:::\n\n\nWe see that the pattern is very close to what we have from the risk score \ncreated in the previous chapter. The figure below shows the correlation\nbetween mammaprint and the risk score once again.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-93-1.png){width=1344}\n:::\n:::\n\n\nNow for OncotypeDX:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Correlation between oncotypeDX and R package genefu](trying_files/figure-html/fig-ror-genefu-abim-oncotype-1.png){#fig-ror-genefu-abim-oncotype width=672}\n:::\n:::\n\n\nThere is also a correlation between the risk score and oncotypeDX.\nThe paper https://www.nature.com/articles/s41523-022-00492-0#Sec8\nalso used the genefu for calculating the oncotypeDX. \n\n### genefu and AIMS\n\nHere we try to use AIMS to calculate the PAM50 subtypes for the\nand compare with the results obtained previously. We want to compare\nthe classifications with the molecular landscape.\n\n\n::: {.cell}\n\n:::\n\n\nThe confusion matrix below show the results of the AIMS PAM50 as the\npredicted and the reference is the PAM50 subtypes obtained from the\nSCANB team.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nConfusion Matrix and Statistics\n\n          Reference\nPrediction luma basal lumb her2 normal\n    luma   2645     0  778   73     68\n    basal     0   739    0   95     16\n    lumb     19     0 1122   20      0\n    her2     10     7  237  729     17\n    normal  827    14    7   48   1004\n\nOverall Statistics\n                                          \n               Accuracy : 0.7362          \n                 95% CI : (0.7266, 0.7455)\n    No Information Rate : 0.4131          \n    P-Value [Acc > NIR] : < 2.2e-16       \n                                          \n                  Kappa : 0.6434          \n                                          \n Mcnemar's Test P-Value : NA              \n\nStatistics by Class:\n\n                     Class: luma Class: basal Class: lumb Class: her2\nSensitivity               0.7555      0.97237      0.5233     0.75544\nSpecificity               0.8152      0.98561      0.9938     0.96391\nPos Pred Value            0.7421      0.86941      0.9664     0.72900\nNeg Pred Value            0.8257      0.99725      0.8603     0.96843\nPrevalence                0.4131      0.08968      0.2530     0.11386\nDetection Rate            0.3121      0.08720      0.1324     0.08602\nDetection Prevalence      0.4205      0.10029      0.1370     0.11799\nBalanced Accuracy         0.7854      0.97899      0.7586     0.85968\n                     Class: normal\nSensitivity                 0.9086\nSpecificity                 0.8784\nPos Pred Value              0.5284\nNeg Pred Value              0.9846\nPrevalence                  0.1304\nDetection Rate              0.1185\nDetection Prevalence        0.2242\nBalanced Accuracy           0.8935\n```\n:::\n:::\n\n\nWe see that there is a big misclassification from luminal A samples to \nnormal like samples and several luminal B are misclassified as luminal A.\n\nThe plot below shows the coloring by the reference PAM50 and the predicted\nby AIMS.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![SCANB embedding stratified by PAM50 algorithms by both the ones provided by the SCANB (SSP) and the AIMS algorithm](trying_files/figure-html/fig-scanb-aims-1.png){#fig-scanb-aims width=672}\n:::\n:::\n\n\nOn the left there is the coloring for the AIMS algorithm and on the right\nfrom the reference. We see the missclassified samples are not randomly\nmisclassified, they are on the boundaries. \n\nThe plot below shows the maximum probability score for each sample\nindividually.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-98-1.png){width=384}\n:::\n:::\n\n\nThe majority of samples have probabilities of either 1 or \n0. Not so often in between. \n\nAnd the figure below shows the confusion matrix for the ABIM cohort.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nConfusion Matrix and Statistics\n\n          Reference\nPrediction luma basal lumb her2 normal\n    luma     28     0   17    1      3\n    basal     0    11    0    2      1\n    lumb      0     0   16    0      0\n    her2      0     0    0   13      0\n    normal    2     0    0    2      4\n\nOverall Statistics\n                                          \n               Accuracy : 0.72            \n                 95% CI : (0.6213, 0.8052)\n    No Information Rate : 0.33            \n    P-Value [Acc > NIR] : 1.786e-15       \n                                          \n                  Kappa : 0.6291          \n                                          \n Mcnemar's Test P-Value : NA              \n\nStatistics by Class:\n\n                     Class: luma Class: basal Class: lumb Class: her2\nSensitivity               0.9333       1.0000      0.4848      0.7222\nSpecificity               0.7000       0.9663      1.0000      1.0000\nPos Pred Value            0.5714       0.7857      1.0000      1.0000\nNeg Pred Value            0.9608       1.0000      0.7976      0.9425\nPrevalence                0.3000       0.1100      0.3300      0.1800\nDetection Rate            0.2800       0.1100      0.1600      0.1300\nDetection Prevalence      0.4900       0.1400      0.1600      0.1300\nBalanced Accuracy         0.8167       0.9831      0.7424      0.8611\n                     Class: normal\nSensitivity                 0.5000\nSpecificity                 0.9565\nPos Pred Value              0.5000\nNeg Pred Value              0.9565\nPrevalence                  0.0800\nDetection Rate              0.0400\nDetection Prevalence        0.0800\nBalanced Accuracy           0.7283\n```\n:::\n:::\n\n\nWe see here that in this case that there are several luminal B samples \nmissclassified as luminal A. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-100-1.png){width=768}\n:::\n:::\n\n\nThe misclassified samples from AIMS they really seem to be on the \ntop region together with the luminal A. Some of the normal\nsamples are even in the luminal A region. \n\nNow we check the PDXs. \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n$METS15\n treatment Basal Her2 LumA LumB Normal\n      CTRL     0    0    0    3      0\n       DHT     0    0    0    0      0\n        E2     0    0    1    3      0\n      E2P4     0    0    1    2      0\n        P4     0    0    1    3      0\n\n$T105\n treatment Basal Her2 LumA LumB Normal\n      CTRL     0    0    0    0      5\n       DHT     0    0    0    0      0\n        E2     0    0    0    0      4\n      E2P4     0    0    0    0      0\n        P4     0    4    0    0      0\n\n$T109\n treatment Basal Her2 LumA LumB Normal\n      CTRL     0    0    3    0      1\n       DHT     0    0    0    0      0\n        E2     0    0    1    0      3\n      E2P4     0    0    0    0      0\n        P4     0    0    4    0      0\n\n$T110\n treatment Basal Her2 LumA LumB Normal\n      CTRL     0    1    0    0      3\n       DHT     0    0    0    0      0\n        E2     0    0    0    0      2\n      E2P4     0    1    0    0      2\n        P4     0    0    0    0      4\n\n$T111\n treatment Basal Her2 LumA LumB Normal\n      CTRL     0    0    0    0      3\n       DHT     0    0    0    0      3\n        E2     0    0    0    0      3\n      E2P4     0    0    0    0      2\n        P4     1    0    0    0      2\n\n$T113\n treatment Basal Her2 LumA LumB Normal\n      CTRL     0    0    2    0      1\n       DHT     0    0    0    0      0\n        E2     0    0    0    0      3\n      E2P4     0    0    0    0      0\n        P4     0    0    2    0      2\n```\n:::\n:::\n\n\nThese molecular subtyping do not make much sense. We know that by \ngiving P4 estrogen signaling actually goes up, so a expected subtype\nchange is from normal to either luminal A and B. Moreover, these PDXs\nare in an active state of proliferation due to the MIND model, so\nbeing in the normal like region is not a good indication. Also this \nresults show that almost all PDXs would be normal like which does not \ngo in hand with the results we get from the lab.\n\nAnd the probabilities are available below.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-102-1.png){width=672}\n:::\n:::\n\n\nAnd another validation is using the normal cohort. Below is the number of\nall predicted molecular subtypes.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\nNormal \n    66 \n```\n:::\n:::\n\n\nAll samples are normal-like as expected, since they are normal. So it could\nbe that the AIMS algorithm is not suited for PDXs but for clinical samples\nit works quite well.\n\n## nanostring signatures\n\nIn this section we try the nanostring panel signatures provided by the\nBreast Cancer 360 test. We will compare some of the signatures\nby using GSVA on the original datasets and by calculating the sum of the\ngene expression levels of the genes when regressing out the 1st, 2nd and\n5th components.\n\nThe table below shows the number of genes available for each signature\nand each dataset. In general it seems that all signatures have over\n70% of the genes available, a good indication.\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> pathway </th>\n   <th style=\"text-align:right;\"> tcga </th>\n   <th style=\"text-align:right;\"> scanb </th>\n   <th style=\"text-align:right;\"> metabric </th>\n   <th style=\"text-align:right;\"> poetic </th>\n   <th style=\"text-align:right;\"> n </th>\n   <th style=\"text-align:left;\"> average_percentage </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> adhesion_and_migration </td>\n   <td style=\"text-align:right;\"> 65 </td>\n   <td style=\"text-align:right;\"> 61 </td>\n   <td style=\"text-align:right;\"> 68 </td>\n   <td style=\"text-align:right;\"> 83 </td>\n   <td style=\"text-align:right;\"> 83 </td>\n   <td style=\"text-align:left;\"> 0.83 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> angiogenesis </td>\n   <td style=\"text-align:right;\"> 27 </td>\n   <td style=\"text-align:right;\"> 27 </td>\n   <td style=\"text-align:right;\"> 29 </td>\n   <td style=\"text-align:right;\"> 33 </td>\n   <td style=\"text-align:right;\"> 34 </td>\n   <td style=\"text-align:left;\"> 0.85 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> antigen_presentation </td>\n   <td style=\"text-align:right;\"> 20 </td>\n   <td style=\"text-align:right;\"> 19 </td>\n   <td style=\"text-align:right;\"> 19 </td>\n   <td style=\"text-align:right;\"> 19 </td>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:left;\"> 0.92 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> apoptosis </td>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:left;\"> 0.78 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> cytokine_and_chemokine_signaling </td>\n   <td style=\"text-align:right;\"> 38 </td>\n   <td style=\"text-align:right;\"> 29 </td>\n   <td style=\"text-align:right;\"> 37 </td>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:right;\"> 50 </td>\n   <td style=\"text-align:left;\"> 0.76 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> dna_damage_repair </td>\n   <td style=\"text-align:right;\"> 126 </td>\n   <td style=\"text-align:right;\"> 108 </td>\n   <td style=\"text-align:right;\"> 118 </td>\n   <td style=\"text-align:right;\"> 133 </td>\n   <td style=\"text-align:right;\"> 143 </td>\n   <td style=\"text-align:left;\"> 0.85 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> emt </td>\n   <td style=\"text-align:right;\"> 72 </td>\n   <td style=\"text-align:right;\"> 71 </td>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:right;\"> 82 </td>\n   <td style=\"text-align:right;\"> 85 </td>\n   <td style=\"text-align:left;\"> 0.85 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> er_signaling </td>\n   <td style=\"text-align:right;\"> 27 </td>\n   <td style=\"text-align:right;\"> 25 </td>\n   <td style=\"text-align:right;\"> 24 </td>\n   <td style=\"text-align:right;\"> 25 </td>\n   <td style=\"text-align:right;\"> 27 </td>\n   <td style=\"text-align:left;\"> 0.94 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> epigenetic_regulation </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:right;\"> 17 </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:left;\"> 0.88 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> hedgehog </td>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:right;\"> 17 </td>\n   <td style=\"text-align:right;\"> 20 </td>\n   <td style=\"text-align:right;\"> 20 </td>\n   <td style=\"text-align:left;\"> 0.76 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> immune_infiltration </td>\n   <td style=\"text-align:right;\"> 24 </td>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:right;\"> 23 </td>\n   <td style=\"text-align:right;\"> 34 </td>\n   <td style=\"text-align:right;\"> 34 </td>\n   <td style=\"text-align:left;\"> 0.75 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> jak_stat </td>\n   <td style=\"text-align:right;\"> 37 </td>\n   <td style=\"text-align:right;\"> 36 </td>\n   <td style=\"text-align:right;\"> 35 </td>\n   <td style=\"text-align:right;\"> 45 </td>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:left;\"> 0.81 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> mapk </td>\n   <td style=\"text-align:right;\"> 67 </td>\n   <td style=\"text-align:right;\"> 61 </td>\n   <td style=\"text-align:right;\"> 68 </td>\n   <td style=\"text-align:right;\"> 95 </td>\n   <td style=\"text-align:right;\"> 100 </td>\n   <td style=\"text-align:left;\"> 0.73 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> notch </td>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:right;\"> 19 </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:right;\"> 22 </td>\n   <td style=\"text-align:left;\"> 0.88 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pi3k </td>\n   <td style=\"text-align:right;\"> 72 </td>\n   <td style=\"text-align:right;\"> 67 </td>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:right;\"> 91 </td>\n   <td style=\"text-align:right;\"> 96 </td>\n   <td style=\"text-align:left;\"> 0.76 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> proliferation </td>\n   <td style=\"text-align:right;\"> 121 </td>\n   <td style=\"text-align:right;\"> 113 </td>\n   <td style=\"text-align:right;\"> 114 </td>\n   <td style=\"text-align:right;\"> 136 </td>\n   <td style=\"text-align:right;\"> 144 </td>\n   <td style=\"text-align:left;\"> 0.84 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> stromal_markers </td>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:left;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> subtypes </td>\n   <td style=\"text-align:right;\"> 69 </td>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:right;\"> 62 </td>\n   <td style=\"text-align:right;\"> 69 </td>\n   <td style=\"text-align:right;\"> 70 </td>\n   <td style=\"text-align:left;\"> 0.94 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> tgf_beta </td>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:right;\"> 42 </td>\n   <td style=\"text-align:right;\"> 53 </td>\n   <td style=\"text-align:right;\"> 57 </td>\n   <td style=\"text-align:left;\"> 0.83 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> transcriptional_misregulation </td>\n   <td style=\"text-align:right;\"> 44 </td>\n   <td style=\"text-align:right;\"> 37 </td>\n   <td style=\"text-align:right;\"> 44 </td>\n   <td style=\"text-align:right;\"> 61 </td>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:left;\"> 0.74 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> triple_negative_biology </td>\n   <td style=\"text-align:right;\"> 38 </td>\n   <td style=\"text-align:right;\"> 32 </td>\n   <td style=\"text-align:right;\"> 41 </td>\n   <td style=\"text-align:right;\"> 49 </td>\n   <td style=\"text-align:right;\"> 50 </td>\n   <td style=\"text-align:left;\"> 0.8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> tumor_metabolism </td>\n   <td style=\"text-align:right;\"> 15 </td>\n   <td style=\"text-align:right;\"> 15 </td>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:right;\"> 15 </td>\n   <td style=\"text-align:left;\"> 0.97 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wnt </td>\n   <td style=\"text-align:right;\"> 37 </td>\n   <td style=\"text-align:right;\"> 34 </td>\n   <td style=\"text-align:right;\"> 44 </td>\n   <td style=\"text-align:right;\"> 51 </td>\n   <td style=\"text-align:right;\"> 51 </td>\n   <td style=\"text-align:left;\"> 0.81 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> internal_reference_gene </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:right;\"> 17 </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:left;\"> 0.96 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\nWe now compare the scores obtained by GSVA on the datasets and \nsee how they relate with nanostring scores obtained with the\nregressed data. \n\nFirst we compare GSVA SET ER/PR with ER signaling obtained by the\nscoring procedure when regressing the data.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-106-1.png){width=672}\n:::\n:::\n\n\nNext we compare EMT, G2M with proliferation and PI3K signaling. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-107-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-108-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-109-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-110-1.png){width=672}\n:::\n:::\n\n\nIn general there is a correlation but the scores are not so well correlated\nand they are noisy. One that works fairly well is the ER signaling score,\nbut the others not so well. The proliferation score barely shows any\ndifference between luminal A and B patients in any of the cohorts. \n\nPerhaps if we calculate the scores using the hallmarks pathways the scores are\nbetter correlated, since they are the same gene sets.\n\nBelow we plot the correlation between the proliferation pathway using GSVA and\nthe regressed scoring strategy for the TCGA cohort.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-111-1.png){width=672}\n:::\n:::\n\n\nIt is perfectly correlated.\n\nAnd for ER signaling:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-112-1.png){width=672}\n:::\n:::\n\n\nAlso it is very much correlated. So the problem in the end is comparing\nthe hallmarks signatures with the nanostring. But interestingly \nthe nanostring proliferation signature was not good to pick up the differences\nbetween luminal A and B.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-113-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "trying_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\n<link href=\"site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/datatables-binding-0.22/datatables.js\"></script>\n<script src=\"site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"site_libs/dt-core-1.11.3/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/dt-core-1.11.3/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/dt-core-1.11.3/js/jquery.dataTables.min.js\"></script>\n<link href=\"site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}