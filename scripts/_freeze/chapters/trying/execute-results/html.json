{
  "hash": "e7f9e63c4808d293064ea118e323cc4a",
  "result": {
    "markdown": "# Tests and tries \n\nThis is a file where we try different things using the molecular data.\nWe keep it here in case anyone finds anything here interesting and would like\nto further discuss with us for potential collaborations.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n* The library is already synchronized with the lockfile.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n    ../../results/plots/trying ../../results/rds_files/trying \n                         FALSE                          FALSE \n   ../../results/tables/trying \n                         FALSE \n```\n:::\n:::\n\n\n## Using several pathways or just one pathway for GSVA\n\nWe now evaluate the effect of the scores for each pathway when using all the\n53 pathways combined and each one individually. We use only TCGA for \nthis step.\n\n\n::: {.cell}\n\n:::\n\n\n### One vs all\n\nWe now calculate the scores for each gene set individually.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-5-1.png){width=1920}\n:::\n:::\n\n\nIt seems they are all positively correlated, so one could calculate the \nscores basically using just one gene set with exception of some of the\ngene sets. \n\n## Minimum number of samples for GSVA\n\nAccording to the original GSVA paper, a minimum of 10 samples are necessary\nto have a good power when using GSVA. Since here we have at least 5 \nmolecular subgroups, we hypothesize we need at least 50 samples to get a \ngood score so we can compare across cohorts. We will try with\ndifferent numbers of samples using TCGA, we start with 10, 25, 50 and\n100 samples and we compare with the scores using the full dataset.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-9-1.png){width=4800}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-10-1.png){width=4800}\n:::\n:::\n\n\nThe conclusion we can take here is that depending on the gene set not even 150\nsamples is enough. For some only 25 patients is already enough, such as SET \nER/PR, androgen response, estrogen response early and E2F targets.\n\nCould we mix around 20 samples of SCANB together with more samples from \nTCGA and METABRIC to get the scores? Let us try to adress this question\nagain. We are using the regressed data now here as this is the only way.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-13-1.png){width=1920}\n:::\n:::\n\n\nThere is still some correlation but the scores are \nshrinked in the end. \n\n## Normalization strategy\n\nWe can also try another way of normalizing, namely for each sample we\ncan z scale it.\n\n\n::: {.cell}\n\n:::\n\n\nAnd now we can visualize the results.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA projections colored by different factors and organized by different components. (A) Plot of the first two components colored by cohort. (B) Plot of the first two components colored by ER status. (C) Plot of the second and third components colored by cohort. (D) Plot of the second and third components colored by ER status. (E) Plot of the second and third components colored by PAM50. (F) Plot of the second and third components colored by INTCLUST, only METABRIC has an assigned value for this variable, NAs are TCGA samples.](trying_files/figure-html/fig-pca-embeddings-3-1.png){#fig-pca-embeddings-3 width=1344}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\nWe see that samples are well embedded as well. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA embedding colored by cohort. The components used are the first and second components.](trying_files/figure-html/fig-pca-scanb-pc1-2-1.png){#fig-pca-scanb-pc1-2 width=672}\n:::\n:::\n\n\nSCANB and POETIC are in between as expected and they are closer\nto their sequencing technology. Interestingly the \nvariation for SCANB and TCGA are compressed in the PC1 vs PC2 axis compared\nto METABRIC and POETIC.\n\n@fig-pca-scanb-er-pam50-2 shows that the SCANB samples are also well mixed\nregarding the clinical factors, including the $SET_{ER/PR}$ signature.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![PCA embedding of all samples from TCGA, SCANB and METABRIC. (A) Colored by cohort, (B) colored by ER status, (C) colored by PAM50 molecular subtype, (D) colored by the $SET_{ER/PR}$ signature and only SCANB samples.](trying_files/figure-html/fig-pca-scanb-er-pam50-2-1.png){#fig-pca-scanb-er-pam50-2 width=1536}\n:::\n:::\n\n\nIn the end normalizing by scaling the sample before doing any embedding\nworks as well. Though the embedding seems to be more compressed. \nI would argue that the qPCR-like normalization gives a bit better\nembedding. \n\n## genefu \n\nWith genefu it is possible to calculate scores from comercially available \nsignatures. Here we try to use it on SCANB, METABRIC and TCGA. Moreover,\nwe can start with ABiM, as this dataset has the gold standard ROR score \nobtained from nCounter data. This is a good way of validating the\npipeline. \n\n\n::: {.cell}\n\n:::\n\n\nWe start by comparing the molecular subtypes:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\nFALSE  TRUE \n   14    86 \n```\n:::\n:::\n\n\n86 out of 100 were correctly called. Here we are using the gold standard wich\nis the molecular subtype called from FT samples. The normal like subtype is not\navailable from the FT prosigna assay. So we now compare the results with the\nSSP obtained from the SCANB team. \n\nBelow is the confusion matrix to see which subtypes were misclassified. \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nConfusion Matrix and Statistics\n\n          Reference\nPrediction Basal Her2 LumB LumA Normal\n    Basal     13    0    0    0      0\n    Her2       0    8    0    0      0\n    LumB       1    1   33    1      0\n    LumA       1    0    7   32      0\n    Normal     1    0    0    2      0\n\nOverall Statistics\n                                          \n               Accuracy : 0.86            \n                 95% CI : (0.7763, 0.9213)\n    No Information Rate : 0.4             \n    P-Value [Acc > NIR] : < 2.2e-16       \n                                          \n                  Kappa : 0.7965          \n                                          \n Mcnemar's Test P-Value : NA              \n\nStatistics by Class:\n\n                     Class: Basal Class: Her2 Class: LumB Class: LumA\nSensitivity                0.8125      0.8889      0.8250      0.9143\nSpecificity                1.0000      1.0000      0.9500      0.8769\nPos Pred Value             1.0000      1.0000      0.9167      0.8000\nNeg Pred Value             0.9655      0.9891      0.8906      0.9500\nPrevalence                 0.1600      0.0900      0.4000      0.3500\nDetection Rate             0.1300      0.0800      0.3300      0.3200\nDetection Prevalence       0.1300      0.0800      0.3600      0.4000\nBalanced Accuracy          0.9062      0.9444      0.8875      0.8956\n                     Class: Normal\nSensitivity                     NA\nSpecificity                   0.97\nPos Pred Value                  NA\nNeg Pred Value                  NA\nPrevalence                    0.00\nDetection Rate                0.00\nDetection Prevalence          0.03\nBalanced Accuracy               NA\n```\n:::\n:::\n\n\nAll luminal A were predicted correctly. Some normal like were predicted to\nbe luminal A or basal and Her2. There were some mismatches \nfor the LumB, that were misclassified as LumA. Still it is ok. \n\nLet us now calculate the ROR for the ABiM cohort.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Correlation between ROR obtained from prosigna assay and R package genefu](trying_files/figure-html/fig-ror-genefu-abim-1.png){#fig-ror-genefu-abim width=672}\n:::\n:::\n\n\nThe correlation is relatively good and respects the molecular subtypes\nin general. The ROR obtained from genefu for some luminal B are not \nquite right as they are below 50. \n\nWe now move on to the other signatures: Mammaprint, EndoPredict (EP) and \nOncotypeDX Risk Score (RS).\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Correlation between ROR obtained from prosigna assay and the mammaprint signature obtained from the R package genefu](trying_files/figure-html/fig-ror-mammaprint-genefu-abim-1.png){#fig-ror-mammaprint-genefu-abim width=672}\n:::\n:::\n\n\n@fig-ror-mammaprint-genefu-abim shows the correlation between \nthe mammaprint signature (named GENE70) and the ROR from prosigna. \n\nLet us now compare the GENE70 signature with the risk score developed in \nthe previous chapters. We use the ABiM 100 cohort to make the comparison. \nOne side note, we are using only 51 out of the 70 probes available in the\npackage. 15 probes don't have any corresponding symbol. Out of the available\ngenes, some are duplicated. For the duplicated genes, the correlation \ncoefficients are all similar, so we can select just the first ocurrence \nin the list.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\nThere is a good correlation between the two signatures, suggesting \nthat the Mammaprint signature is somehow based on the position of the samples in\nthe molecular landscape. \n\nWe now proceed and calculate the mammaprint scores for SCANB and \nMETABRIC as well and only for ER+ BC samples.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Embedding of ER+ BC samples colored by the mammaprint score.](trying_files/figure-html/fig-met-scanb-mammaprint-1.png){#fig-met-scanb-mammaprint width=960}\n:::\n:::\n\n\nWe see that the pattern is very close to what we have from the risk score \ncreated in the previous chapter. The figure below shows the correlation\nbetween mammaprint and the risk score once again.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-29-1.png){width=1344}\n:::\n:::\n\n\nNow for OncotypeDX:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Correlation between oncotypeDX and R package genefu](trying_files/figure-html/fig-ror-genefu-abim-oncotype-1.png){#fig-ror-genefu-abim-oncotype width=672}\n:::\n:::\n\n\nThere is also a correlation between the risk score and oncotypeDX.\nThe paper https://www.nature.com/articles/s41523-022-00492-0#Sec8\nalso used the genefu for calculating the oncotypeDX. \n\n### genefu and AIMS\n\nHere we try to use AIMS to calculate the PAM50 subtypes for the\nand compare with the results obtained previously. We want to compare\nthe classifications with the molecular landscape.\n\n\n::: {.cell}\n\n:::\n\n\nThe confusion matrix below show the results of the AIMS PAM50 as the\npredicted and the reference is the PAM50 subtypes obtained from the\nSCANB team.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nConfusion Matrix and Statistics\n\n          Reference\nPrediction luma her2 normal lumb basal\n    luma   2301   61     51  664     0\n    her2      9  627     16  200     4\n    normal  724   37    830    6    11\n    lumb     17   17      0  938     0\n    basal     0   75     14    0   614\n\nOverall Statistics\n                                         \n               Accuracy : 0.7359         \n                 95% CI : (0.7255, 0.746)\n    No Information Rate : 0.4228         \n    P-Value [Acc > NIR] : < 2.2e-16      \n                                         \n                  Kappa : 0.6411         \n                                         \n Mcnemar's Test P-Value : NA             \n\nStatistics by Class:\n\n                     Class: luma Class: her2 Class: normal Class: lumb\nSensitivity               0.7542     0.76744        0.9111      0.5188\nSpecificity               0.8137     0.96421        0.8766      0.9937\nPos Pred Value            0.7478     0.73248        0.5162      0.9650\nNeg Pred Value            0.8188     0.97013        0.9856      0.8607\nPrevalence                0.4228     0.11322        0.1262      0.2506\nDetection Rate            0.3189     0.08689        0.1150      0.1300\nDetection Prevalence      0.4264     0.11863        0.2228      0.1347\nBalanced Accuracy         0.7839     0.86583        0.8938      0.7563\n                     Class: basal\nSensitivity               0.97615\nSpecificity               0.98649\nPos Pred Value            0.87340\nNeg Pred Value            0.99770\nPrevalence                0.08717\nDetection Rate            0.08509\nDetection Prevalence      0.09742\nBalanced Accuracy         0.98132\n```\n:::\n:::\n\n\nWe see that there is a big misclassification from luminal A samples to \nnormal like samples and several luminal B are misclassified as luminal A.\n\nThe plot below shows the coloring by the reference PAM50 and the predicted\nby AIMS.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![SCANB embedding stratified by PAM50 algorithms by both the ones provided by the SCANB (SSP) and the AIMS algorithm](trying_files/figure-html/fig-scanb-aims-1.png){#fig-scanb-aims width=672}\n:::\n:::\n\n\nOn the left there is the coloring for the AIMS algorithm and on the right\nfrom the reference. We see the missclassified samples are not randomly\nmisclassified, they are on the boundaries. \n\nThe plot below shows the maximum probability score for each sample\nindividually.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-34-1.png){width=384}\n:::\n:::\n\n\nThe majority of samples have probabilities of either 1 or \n0. Not so often in between. \n\nAnd the figure below shows the confusion matrix for the ABIM cohort.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nConfusion Matrix and Statistics\n\n          Reference\nPrediction luma lumb her2 normal\n    luma     28   17    1      3\n    lumb      0   16    0      0\n    her2      0    0   10      0\n    normal    2    0    2      2\n\nOverall Statistics\n                                          \n               Accuracy : 0.6914          \n                 95% CI : (0.5789, 0.7893)\n    No Information Rate : 0.4074          \n    P-Value [Acc > NIR] : 2.253e-07       \n                                          \n                  Kappa : 0.5401          \n                                          \n Mcnemar's Test P-Value : NA              \n\nStatistics by Class:\n\n                     Class: luma Class: lumb Class: her2 Class: normal\nSensitivity               0.9333      0.4848      0.7692       0.40000\nSpecificity               0.5882      1.0000      1.0000       0.94737\nPos Pred Value            0.5714      1.0000      1.0000       0.33333\nNeg Pred Value            0.9375      0.7385      0.9577       0.96000\nPrevalence                0.3704      0.4074      0.1605       0.06173\nDetection Rate            0.3457      0.1975      0.1235       0.02469\nDetection Prevalence      0.6049      0.1975      0.1235       0.07407\nBalanced Accuracy         0.7608      0.7424      0.8846       0.67368\n```\n:::\n:::\n\n\nWe see here that in this case that there are several luminal B samples \nmissclassified as luminal A. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-36-1.png){width=768}\n:::\n:::\n\n\nThe misclassified samples from AIMS they really seem to be on the \ntop region together with the luminal A. Some of the normal\nsamples are even in the luminal A region. \n\nAnd another validation is using the normal cohort. Below is the number of\nall predicted molecular subtypes.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\nNormal \n    66 \n```\n:::\n:::\n\n\nAll samples are normal-like as expected, since they are normal. \n\n## nanostring signatures\n\nIn this section we try the nanostring panel signatures provided by the\nBreast Cancer 360 test. We will compare some of the signatures\nby using GSVA on the original datasets and by calculating the sum of the\ngene expression levels of the genes when regressing out the 1st, 2nd and\n5th components.\n\nThe table below shows the number of genes available for each signature\nand each dataset. In general it seems that all signatures have over\n70% of the genes available, a good indication.\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> pathway </th>\n   <th style=\"text-align:right;\"> tcga </th>\n   <th style=\"text-align:right;\"> scanb </th>\n   <th style=\"text-align:right;\"> metabric </th>\n   <th style=\"text-align:right;\"> poetic </th>\n   <th style=\"text-align:right;\"> n </th>\n   <th style=\"text-align:left;\"> average_percentage </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> adhesion_and_migration </td>\n   <td style=\"text-align:right;\"> 65 </td>\n   <td style=\"text-align:right;\"> 61 </td>\n   <td style=\"text-align:right;\"> 68 </td>\n   <td style=\"text-align:right;\"> 83 </td>\n   <td style=\"text-align:right;\"> 83 </td>\n   <td style=\"text-align:left;\"> 0.83 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> angiogenesis </td>\n   <td style=\"text-align:right;\"> 27 </td>\n   <td style=\"text-align:right;\"> 27 </td>\n   <td style=\"text-align:right;\"> 29 </td>\n   <td style=\"text-align:right;\"> 33 </td>\n   <td style=\"text-align:right;\"> 34 </td>\n   <td style=\"text-align:left;\"> 0.85 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> antigen_presentation </td>\n   <td style=\"text-align:right;\"> 20 </td>\n   <td style=\"text-align:right;\"> 19 </td>\n   <td style=\"text-align:right;\"> 19 </td>\n   <td style=\"text-align:right;\"> 19 </td>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:left;\"> 0.92 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> apoptosis </td>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 7 </td>\n   <td style=\"text-align:right;\"> 5 </td>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:right;\"> 9 </td>\n   <td style=\"text-align:left;\"> 0.78 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> cytokine_and_chemokine_signaling </td>\n   <td style=\"text-align:right;\"> 38 </td>\n   <td style=\"text-align:right;\"> 29 </td>\n   <td style=\"text-align:right;\"> 37 </td>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:right;\"> 50 </td>\n   <td style=\"text-align:left;\"> 0.76 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> dna_damage_repair </td>\n   <td style=\"text-align:right;\"> 126 </td>\n   <td style=\"text-align:right;\"> 108 </td>\n   <td style=\"text-align:right;\"> 118 </td>\n   <td style=\"text-align:right;\"> 133 </td>\n   <td style=\"text-align:right;\"> 143 </td>\n   <td style=\"text-align:left;\"> 0.85 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> emt </td>\n   <td style=\"text-align:right;\"> 72 </td>\n   <td style=\"text-align:right;\"> 71 </td>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:right;\"> 82 </td>\n   <td style=\"text-align:right;\"> 85 </td>\n   <td style=\"text-align:left;\"> 0.85 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> er_signaling </td>\n   <td style=\"text-align:right;\"> 27 </td>\n   <td style=\"text-align:right;\"> 25 </td>\n   <td style=\"text-align:right;\"> 24 </td>\n   <td style=\"text-align:right;\"> 25 </td>\n   <td style=\"text-align:right;\"> 27 </td>\n   <td style=\"text-align:left;\"> 0.94 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> epigenetic_regulation </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:right;\"> 17 </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:left;\"> 0.88 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> hedgehog </td>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:right;\"> 17 </td>\n   <td style=\"text-align:right;\"> 20 </td>\n   <td style=\"text-align:right;\"> 20 </td>\n   <td style=\"text-align:left;\"> 0.76 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> immune_infiltration </td>\n   <td style=\"text-align:right;\"> 24 </td>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:right;\"> 23 </td>\n   <td style=\"text-align:right;\"> 34 </td>\n   <td style=\"text-align:right;\"> 34 </td>\n   <td style=\"text-align:left;\"> 0.75 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> jak_stat </td>\n   <td style=\"text-align:right;\"> 37 </td>\n   <td style=\"text-align:right;\"> 36 </td>\n   <td style=\"text-align:right;\"> 35 </td>\n   <td style=\"text-align:right;\"> 45 </td>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:left;\"> 0.81 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> mapk </td>\n   <td style=\"text-align:right;\"> 67 </td>\n   <td style=\"text-align:right;\"> 61 </td>\n   <td style=\"text-align:right;\"> 68 </td>\n   <td style=\"text-align:right;\"> 95 </td>\n   <td style=\"text-align:right;\"> 100 </td>\n   <td style=\"text-align:left;\"> 0.73 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> notch </td>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:right;\"> 19 </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:right;\"> 22 </td>\n   <td style=\"text-align:left;\"> 0.88 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> pi3k </td>\n   <td style=\"text-align:right;\"> 72 </td>\n   <td style=\"text-align:right;\"> 67 </td>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:right;\"> 91 </td>\n   <td style=\"text-align:right;\"> 96 </td>\n   <td style=\"text-align:left;\"> 0.76 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> proliferation </td>\n   <td style=\"text-align:right;\"> 121 </td>\n   <td style=\"text-align:right;\"> 113 </td>\n   <td style=\"text-align:right;\"> 114 </td>\n   <td style=\"text-align:right;\"> 136 </td>\n   <td style=\"text-align:right;\"> 144 </td>\n   <td style=\"text-align:left;\"> 0.84 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> stromal_markers </td>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:left;\"> 1 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> subtypes </td>\n   <td style=\"text-align:right;\"> 69 </td>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:right;\"> 62 </td>\n   <td style=\"text-align:right;\"> 69 </td>\n   <td style=\"text-align:right;\"> 70 </td>\n   <td style=\"text-align:left;\"> 0.94 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> tgf_beta </td>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:right;\"> 42 </td>\n   <td style=\"text-align:right;\"> 53 </td>\n   <td style=\"text-align:right;\"> 57 </td>\n   <td style=\"text-align:left;\"> 0.83 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> transcriptional_misregulation </td>\n   <td style=\"text-align:right;\"> 44 </td>\n   <td style=\"text-align:right;\"> 37 </td>\n   <td style=\"text-align:right;\"> 44 </td>\n   <td style=\"text-align:right;\"> 61 </td>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:left;\"> 0.74 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> triple_negative_biology </td>\n   <td style=\"text-align:right;\"> 38 </td>\n   <td style=\"text-align:right;\"> 32 </td>\n   <td style=\"text-align:right;\"> 41 </td>\n   <td style=\"text-align:right;\"> 49 </td>\n   <td style=\"text-align:right;\"> 50 </td>\n   <td style=\"text-align:left;\"> 0.8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> tumor_metabolism </td>\n   <td style=\"text-align:right;\"> 15 </td>\n   <td style=\"text-align:right;\"> 15 </td>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:right;\"> 15 </td>\n   <td style=\"text-align:left;\"> 0.97 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> wnt </td>\n   <td style=\"text-align:right;\"> 37 </td>\n   <td style=\"text-align:right;\"> 34 </td>\n   <td style=\"text-align:right;\"> 44 </td>\n   <td style=\"text-align:right;\"> 51 </td>\n   <td style=\"text-align:right;\"> 51 </td>\n   <td style=\"text-align:left;\"> 0.81 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> internal_reference_gene </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:right;\"> 17 </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:left;\"> 0.96 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\nWe now compare the scores obtained by GSVA on the datasets and \nsee how they relate with nanostring scores obtained with the\nregressed data. \n\nFirst we compare GSVA SET ER/PR with ER signaling obtained by the\nscoring procedure when regressing the data.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-40-1.png){width=672}\n:::\n:::\n\n\nNext we compare EMT, G2M with proliferation and PI3K signaling. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-41-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-42-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-43-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-44-1.png){width=672}\n:::\n:::\n\n\nIn general there is a correlation but the scores are not so well correlated\nand they are noisy. One that works fairly well is the ER signaling score,\nbut the others not so well. The proliferation score barely shows any\ndifference between luminal A and B patients in any of the cohorts. \n\nPerhaps if we calculate the scores using the hallmarks pathways the scores are\nbetter correlated, since they are the same gene sets.\n\nBelow we plot the correlation between the proliferation pathway using GSVA and\nthe regressed scoring strategy for the TCGA cohort.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\n\nIt is perfectly correlated.\n\nAnd for ER signaling:\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-46-1.png){width=672}\n:::\n:::\n\n\nAlso it is very much correlated. So the problem in the end is comparing\nthe hallmarks signatures with the nanostring. But interestingly \nthe nanostring proliferation signature was not good to pick up the differences\nbetween luminal A and B.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-47-1.png){width=672}\n:::\n:::\n\n\n## Risk stratification and the molecular landscape\n\nOne common problem in the clinics is what to do with patients that are \nin the so called intermediate risk group. Here we use the SSP \nclassification from the SCANB team to check what is the position of these\npatients in the molecular landscape.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Embedding of the SCANB samples colored by their predicted ROR risk category.](trying_files/figure-html/fig-scanb-risk-embedding-1.png){#fig-scanb-risk-embedding width=672}\n:::\n:::\n\n\n@fig-scanb-risk-embedding shows that the embedding detects the positions\nwhere the intermediate risk patients are, namely they are in the\nintersection of the luminal A and B subtypes.\n\nAnd @fig-intermediate-pca-position below shows that there is a shift in\nPC4 for the intermediate to the high risk group, which makes sense as this is\nexactly where the distinction between luminal A and B are.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Distribution of the principal components for the different risk groups defined by the SSP ROR scores.](trying_files/figure-html/fig-intermediate-pca-position-1.png){#fig-intermediate-pca-position width=768}\n:::\n:::\n\n\n## Late distant recurrence: trying to find biomarkers\n\nOne of the key problems in breast cancer research is finding patients that\nwill develop late recurrence. Here we use METABRIC as it has a long follow-up\nhistory. We start by plotting the embedding of all METABRIC patients that\nhad a followup longer than 10 years and received only ET. We then try to \npredict which patients recurr or not based on the molecular data by\nusing lasso regression. For this we use the package `glmnet` that \nprovides such functionality. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-50-1.png){width=672}\n:::\n:::\n\n\nIn general there is no distinction in terms of the molecular\nlandscape among the patients that recurred, both in terms of\nmolecular subtype and position in the molecular landscape. \n\nWe now compare their molecular scores. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-51-1.png){width=1920}\n:::\n:::\n\n \nEven here we don't see much difference. Unless there is some kind of \nlinear combination of pathways, I don't think it would be possible\nto classify these two groups by using only transcriptomic data\nand these pathways. In any case we proceed now with the \nlasso regression using the 50 pathways. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-52-1.png){width=672}\n:::\n:::\n\n\nWe see that actually it does not work. And when we predict all the \nsamples are predicted as there is no recurrence.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n.\n no \n407 \n```\n:::\n:::\n\n\nThis is probably because of the unbalanced dataset. Next we \ntry with random forest as well.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\n randomForest(formula = as.factor(is_there_recurrence) ~ ., data = et_metabric_late_data[,      c(\"is_there_recurrence\", pathways_to_compare, \"AGE_AT_DIAGNOSIS\",          \"LYMPH_NODES_EXAMINED_POSITIVE\", \"npi\")], ntree = 500) \n               Type of random forest: classification\n                     Number of trees: 500\nNo. of variables tried at each split: 7\n\n        OOB estimate of  error rate: 17.44%\nConfusion matrix:\n     no yes class.error\nno  336   3 0.008849558\nyes  68   0 1.000000000\n```\n:::\n:::\n\n\nThat is not the case, still we can't predict if a patient will develop\nrecurrence or not in this cohort. \n\n## Correlation of pathways with proliferation\n\nOne thing that is very common is defining a gene signature and then \nusing this gene signature to calculate survival analysis. The thing is, \nproliferation related genes are pretty much present in almost any signature\nand hence all these pathways are correlated to G2M and E2F to some extent \n[@Venet2011].\n\nHere we calculate the pathway scores by using the regressed data and do\nall pairwise comparison of some of the most important pathways to see\ntheir correlations.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-55-1.png){width=1632}\n:::\n:::\n\n\nFirst we see that G2M and E2F are encoding basically the same information. \nPI3K AKT MTOR, AR and the Biocarta HER2 and SET ER/PR are all correlated to\nsome extent to proliferation. Surprisingly the two HER2 signaling scores \nare not able to distinguish the HER2 subtype.\nThe SET ER/PR correlation with G2M is possibly explained by the fact that\nthe basal molecular subtype has higher G2M and lower ER signaling compared to\nluminal A and B.\n\n## ILC and position in the molecular landscape\n\nInvasive lobular carcinoma is a subtype of ER+ BC. They tend to respond\nbetter to ET in the short term but they recurr after 20 years. Here we\njust show where the ILC BC lie in the molecular landscape.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Embedding of the lobular samples from SCANB on top METABRIC and TCGA](trying_files/figure-html/fig-pca-lobular-scanb-1.png){#fig-pca-lobular-scanb width=864}\n:::\n:::\n\n\nWe see that they are mostly in the normal and luminal A region. Still\nthere are several samples that are luminal B, meaning they are more\nproliferative.\n\nIs there any difference in the SET ER/PR for lobulars when comparing\nto ER+ HER2- Ductal carcinomas? \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-57-1.png){width=672}\n:::\n:::\n\n\nThey seem to be the same, also when checking the risk score calculated \nfor all patients, the lobular patients don't seem to have a decreased \nrisk overall, it is mostly because they are in the same region \nof the molecular landscape. Interestingly there is way less\nluminal B patients in the lobular, but still their distributions\nare very similar.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-58-1.png){width=672}\n:::\n:::\n\n\nAnd we also plot by intrinsic molecular subtype. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-59-1.png){width=1344}\n:::\n:::\n\n\nWe also compare EMT.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-60-1.png){width=672}\n:::\n:::\n\n\nEMT is very similar across both histological subtypes. The plot \nbelow shows the densities for ER percentage, notice how the two \noverlap.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-61-1.png){width=672}\n:::\n:::\n\n\nWe now check the lobular signature LobSig that is touted to be superior\nto OncotypeDX, Prosigna's PAM50 and other signatures. In total, 63%\nof the genes are available here. Based on my experience this is \nalready a good number to make comparisons. For example, G2M checkpoint has\n71% of the genes available, estrogen response early has 66%.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-62-1.png){width=960}\n:::\n:::\n\n\nWe see that the LobSig is highgly correlated with G2M checkpoint and also\nthe risk of recurrence score obtained from PAM50. The random 200 is a signature\nof 200 random genes that works as a negative control. \n\nThe figure below shows the distinction of the signature among the 3 different\nrisk categories from ROR.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-63-1.png){width=672}\n:::\n:::\n\n\nThere is an increase in the score as expected based on the previous results\nthat show where the intermediate risk group is according to the molecular\nlandscape. \n\nLastly we check the CDH1 expression levels on the regressed data to \nsee if the differences are still captured upon the whole process. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-64-1.png){width=1344}\n:::\n:::\n\n\nThe differences are still captured, and CDH1 is decreased when \ncomparing lobular vs NST. Note also that the difference seems to be\nthe biggest in the luminal B subtype.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-65-1.png){width=1344}\n:::\n:::\n\n\nWe also check the PC3 and PC4 loadings for CDH1, to see how important\nthis gene is in the molecular landscape. \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n  gene          PC3        PC4\n1 CDH1 0.0002872375 0.01509738\n```\n:::\n:::\n\n\nPC4 has a relatively high value which puts it into the 95 percentile as \nshown below.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.9547769\n```\n:::\n:::\n\n\nNext we can plot the lobular samples from Ciriello's paper\nand color by the 3 subtypes they found. Note here that there is a mismatch\nbetween the cbioportal data and what is found in the original papers\n[@Curtis2012]. We will use the Curtis 2012 annotation as this is what \nmatches Ciriello's paper. Surprisingly the mismatch is not a systematic\nissue, rather 88 ILC samples are matching and the non-matching samples\nare NST but the other info matches usually, such as NPI.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Embedding of the lobular samples from METABRIC on top SCANB and TCGA](trying_files/figure-html/fig-pca-lobular-metabric-1.png){#fig-pca-lobular-metabric width=864}\n:::\n:::\n\n\nThe table below shows the number of subtypes for each molecular subtype. \nIn general there are samples in each one of the molecular subtypes.\nThe reactive-like is actually more enriched in the normal region.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n        subtype basal claudin-low her2 luma lumb normal\n Immune-Related     0           3    2   27   10      4\n  Proliferative     3           3    5   11   15      4\n  Reactive-like     0           5    1   22    2     20\n```\n:::\n:::\n\n\nAnd below is a plot of the lobular samples from Ciriello/Curtis with\nthe molecular subtypes defined by Ciriello. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-71-1.png){width=672}\n:::\n:::\n\n\nIt seems that more proliferative saaples are in the luminal B \nregion whereas the Reactive-like and Immune-related are not so\ndistinguishable, they are in the luminal A region.\n\nSome of the samples are NST on cbioportal and Lobular on Curtis. \nWe selected the following samples and checked on \ncbioPortal (https://www.cbioportal.org/study/clinicalData?id=brca_metabric)\ntheir histologic subtype directly.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n  sample_name   npi\n1     MB-0035 3.056\n2     MB-0050 4.066\n3     MB-0083 3.026\n4     MB-0101 3.068\n5     MB-0102 5.080\n6     MB-0112 6.300\n```\n:::\n:::\n\n\nAll the 6 samples are Ductal/NST and not Lobular.\n\n## Robustness to library protocol\n\nThe figure below shows the first two components\nfor SCANB stratified by the library protocol used in the \nstudy. We see that PC2 is partially capturing the\ndifferences due to library protocol.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-73-1.png){width=672}\n:::\n:::\n\n\n## Distance in 4th component for POETIC\n\nWe have seen previosuly that there is a bigger difference in \nbetween the matched samples in the responder than to non-responder \npatients. Hallmark G2M checkpoint is one of the signatures\ndriving the PC4, meaning that the position wrt the fourth component\nmight be used to define a new response status. \n\nBelow we plot the matched samples for all non responder patients\nwith no change at all in Ki67 (change >= 0%)\nand their respective positions in the molecular landscape.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-74-1.png){width=1536}\n:::\n:::\n\n\nNow we do the same for the top responders (change in Ki67 $\\leq$ -90%).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](trying_files/figure-html/unnamed-chunk-75-1.png){width=1536}\n:::\n:::\n\n\nIn general the distance for the responder samples seem to be higher and not only\nthat we see that the surgery sample goes to the bottom part of the embedding, \nsuggesting that the reduction of the proliferation is reflected in the\nmolecular landscape.",
    "supporting": [
      "trying_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}