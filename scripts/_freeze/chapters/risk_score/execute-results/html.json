{
  "hash": "45784b72794eed00cbb2cc6c15abe083",
  "result": {
    "markdown": "# Risk score model\n\nSeveral risk signatures were developed over the years using transcriptomic\ndatasets. Some examples were given in the previous chapters, such as \nOncotypeDX, Prosigna and EndoPredict. They were all derived in a similar\nmanner, subsetting genes related to usually estrogen and proliferation \nsignaling and then using recurrence free survival data to calculate\nthe risk scores. \n\nIn this chapter we introduce a new risk score that does not subset\ngenes and uses the information of the molecular landscape. The concept\nis simple, we will use the third and fourth components as covariates in\nthe survival modeling along with tumor size and node status. This\nway we avoid subsetting and selecting specific genes and we use all\nthe information the molecular landscape is providing us. Also it avoids\nany kind of binning for patients based on molecular subtype, thus not being\nnecessary calculating correlations with pre-defined molecular subtypes.\n\nLater in the chapter we compare the risk score with the ROR binary \ncategories: high and low/intermediate risk. We also compare the risk score\nwith the ROR continuous value obtained by the SCANB team using nearest\ncentroid classification (NCN). We use samples from patients that were treated\nwith endocrine therapy only for the training of the risk score. Even though \nthe ROR was trained on a cohort of patients that received no treatment, we \ncan still compare the signatures. @Buus2021 showed that the EndoPredict \nsignature is highly correlated to ROR ($\\rho = 0.68$), therefore we can \nto some extent take conclusions based on the ROR signature.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n* The library is already synchronized with the lockfile.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n    ../../results/plots/risk_score ../../results/rds_files/risk_score \n                              TRUE                               TRUE \n   ../../results/tables/risk_score \n                              TRUE \n```\n:::\n:::\n\n\n\nWe develop a risk score for early stage breast cancer patients that \nreceived only endocrine therapy (ET). The idea is similar to what was\ndone with the EndoPredict signatures, but here we extend it by using the\nmolecular landscape information. This provides a full framework where\nwe can analyse the risk of recurrence even for patients that have \nhigh ER+ percentage.\n\n## Generating the risk score\n\nWe focus only on the endocrine treated patients. For the training part\nof the algorithm we use a subset of patients from the METABRIC cohort.\nWe then test the risk scores in the test set and we further validate\nthe score on SCANB. \n\nWe will generate two risk scores: one including only the principal \ncomponents and another one including the clinical features of the \npatients when valiable, namely tumor size, node status and age (either having\none or more lymph node with breast cancer cells or none). \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(pcs_to_use, clin_vars), collapse = \"+\"))), data = training_set)\n\n  n= 556, number of events= 216 \n\n                    coef exp(coef)  se(coef)      z Pr(>|z|)    \nPC3            -0.091540  0.912525  0.027255 -3.359 0.000783 ***\nPC4             0.080512  1.083842  0.022588  3.564 0.000365 ***\ntumor_size      0.021809  1.022049  0.004292  5.082 3.74e-07 ***\nnode_statuspos  0.582681  1.790834  0.147602  3.948 7.89e-05 ***\nage             0.003150  1.003155  0.007030  0.448 0.654061    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n               exp(coef) exp(-coef) lower .95 upper .95\nPC3               0.9125     1.0959    0.8651    0.9626\nPC4               1.0838     0.9226    1.0369    1.1329\ntumor_size        1.0220     0.9784    1.0135    1.0307\nnode_statuspos    1.7908     0.5584    1.3410    2.3916\nage               1.0032     0.9969    0.9894    1.0171\n\nConcordance= 0.676  (se = 0.019 )\nLikelihood ratio test= 66.18  on 5 df,   p=6e-13\nWald test            = 71.92  on 5 df,   p=4e-14\nScore (logrank) test = 72.75  on 5 df,   p=3e-14\n```\n:::\n:::\n\n\nWe see that all coefficients have less variability than age. \nNow we calculate only the risk score based on the components. \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(pcs_to_use), collapse = \"+\"))), data = training_set)\n\n  n= 556, number of events= 216 \n\n        coef exp(coef) se(coef)      z Pr(>|z|)    \nPC3 -0.08657   0.91707  0.02699 -3.207  0.00134 ** \nPC4  0.09068   1.09492  0.02216  4.091 4.29e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n    exp(coef) exp(-coef) lower .95 upper .95\nPC3    0.9171     1.0904    0.8698    0.9669\nPC4    1.0949     0.9133    1.0484    1.1435\n\nConcordance= 0.626  (se = 0.019 )\nLikelihood ratio test= 22.5  on 2 df,   p=1e-05\nWald test            = 22.49  on 2 df,   p=1e-05\nScore (logrank) test = 22.78  on 2 df,   p=1e-05\n```\n:::\n:::\n\n\nWe see that the coefficients are very similar to what was found before,\nit didn't change much. Also when we include the principal components on the\ntop of the clinical variables the log likelihood increases, which is \na good indication: \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table\n Cox model: response is  Surv(time = rfs_months, event = rfs_status)\n Model 1: ~ tumor_size + node_status + age\n Model 2: ~ PC3 + PC4 + tumor_size + node_status + age\n   loglik Chisq Df Pr(>|Chi|)    \n1 -1231.1                        \n2 -1221.2 19.88  2  4.821e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\nNow we use the test set to calculate the score.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvival::coxph(formula = Surv(time = rfs_months, event = rfs_status) ~ \n    risk_score, data = test_set)\n\n  n= 371, number of events= 140 \n\n             coef exp(coef) se(coef)     z Pr(>|z|)    \nrisk_score 0.8632    2.3707   0.1583 5.453 4.96e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n           exp(coef) exp(-coef) lower .95 upper .95\nrisk_score     2.371     0.4218     1.738     3.233\n\nConcordance= 0.655  (se = 0.025 )\nLikelihood ratio test= 28.56  on 1 df,   p=9e-08\nWald test            = 29.73  on 1 df,   p=5e-08\nScore (logrank) test = 29.78  on 1 df,   p=5e-08\n```\n:::\n:::\n\n\nWe see that the higher the risk score the worse it is for the patients \ntreated only with endocrine therapy. \n\n## Validating the risk score on SCANB\n\nWe can now validate the risk score on the SCANB dataset. \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(\"risk_score\"), collapse = \"+\"))), data = endo_only_scanb)\n\n  n= 2442, number of events= 175 \n\n             coef exp(coef) se(coef)     z Pr(>|z|)    \nrisk_score 1.1248    3.0795   0.1138 9.885   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n           exp(coef) exp(-coef) lower .95 upper .95\nrisk_score     3.079     0.3247     2.464     3.849\n\nConcordance= 0.696  (se = 0.022 )\nLikelihood ratio test= 78.2  on 1 df,   p=<2e-16\nWald test            = 97.71  on 1 df,   p=<2e-16\nScore (logrank) test = 96.79  on 1 df,   p=<2e-16\n```\n:::\n:::\n\n\nAgain the risk score is prognostic with a high coefficient, meaning\nthat the higher the score the worse it is for the patient. \n\nWe now visualize a bit the risk scores developed here in terms \nof the molecular landscape. @fig-risk-endo-pam50\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Molecular landscape of SCANB patients treated with only endocrine therapy and that have ER+ breast cancer. Only patients with risk score less than 2 are plotted here. There are only 26 patients out of 2829 with risk score higher than 2 that would skew the color scale.](risk_score_files/figure-html/fig-risk-endo-pam50-1.png){#fig-risk-endo-pam50 width=672}\n:::\n:::\n\n\nWe now investigate the risk score among patients that have high ER IHC\npercentage as well. We have seen that these patients have different outcomes\nbased on the molecular estrogen signaling. We now investigate the effect\nof the risk score. \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(\"risk_score\"), collapse = \"+\"))), data = endo_only_scanb %>% \n    dplyr::filter(ER.pct >= 90 & risk_score < 2))\n\n  n= 1832, number of events= 126 \n\n             coef exp(coef) se(coef)     z Pr(>|z|)    \nrisk_score 1.1989    3.3165   0.1652 7.257 3.96e-13 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n           exp(coef) exp(-coef) lower .95 upper .95\nrisk_score     3.317     0.3015     2.399     4.585\n\nConcordance= 0.685  (se = 0.026 )\nLikelihood ratio test= 48.9  on 1 df,   p=3e-12\nWald test            = 52.66  on 1 df,   p=4e-13\nScore (logrank) test = 55.63  on 1 df,   p=9e-14\n```\n:::\n:::\n\n\nWe see that the score is still prognostic, meaning that even patients\nthat have high ER IHC percentage, there are those with higher risk. Note\nthough that the analysis still is a bit limited due to the followup time\nthat in median is 5.3 \nyears.\n\nWe also compare the risk score for the high risk group and low/intermediate\nrisk group of the ROR signature (@fig-risk-ror) \nobtained by the SCANB team using single \nsample predictor models, where rule based algorithms are used to determine\nif a patient is high or low/intermediate risk. They validate this on\nprosigna's own sequencing and showed good results [@SCANB2022].\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Risk score stratified by binary category risk as defined by the SCANB team at [@SCANB2022]. ER+ BC patients that received only ET were considered.](risk_score_files/figure-html/fig-risk-ror-1.png){#fig-risk-ror width=672}\n:::\n:::\n\n\nAs expected most of the patients in the high risk group are luminal B.\nThe ROR signature was developed in such a way to get luminal B patients to be\nof high risk. But here we see that there is still an overlap between\nlow/intermediate patients and high risk patients, suggesting that the\nnew risk score has additional information. For assessing this hypothesis\nwe perform recurrence free survival analysis with both variables and just\nthe risk score and compare the likelihood of the two models using anova. \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table\n Cox model: response is  Surv(time = rfs_months, event = rfs_status)\n Model 1: ~ tumor_size + node_status + age + SSP.ROR.binary.risk.cat\n Model 2: ~ risk_score + SSP.ROR.binary.risk.cat + tumor_size + node_status + age\n   loglik  Chisq Df Pr(>|Chi|)  \n1 -1229.7                       \n2 -1228.0 3.4646  1     0.0627 .\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n\n\nWe see that by adding the risk score it provides aditional value on top of \nthe binary category from prosigna. On top of that the SCANB team calculated\nalso the ROR score based on the original paper. So we actually have the \nactual scores derived from the nearest centroid technique for all patients.  \n\n@fig-ror-riskscore-comparison shows the comparison between risk score \nand the ROR score from prosigna calculated by using NC. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![Comparison of the risk score developed here with the ROR from Prosigna.](risk_score_files/figure-html/fig-ror-riskscore-comparison-1.png){#fig-ror-riskscore-comparison width=672}\n:::\n:::\n\n\nThere is a correlation but we see that among the luminal A patients \nthere are still those that have high risk score besides a ROR lower than\n50. Below we show the results of the spearman test on these two variables.\nWe see they are correlated.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\n\tSpearman's rank correlation rho\n\ndata:  endo_only_scanb$risk_score and endo_only_scanb$NCN.ROR.asT0\nS = 1233308206, p-value < 2.2e-16\nalternative hypothesis: true rho is not equal to 0\nsample estimates:\n     rho \n0.491857 \n```\n:::\n:::\n\n\nWith a p-value of:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n[1] 5.832521e-149\n```\n:::\n:::\n\n\n\nWe now evaluate the risk score only on luminal A patients that \nreceived just endocrine therapy.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(\"risk_score\", clin_vars), collapse = \"+\"))), data = endo_only_scanb %>% \n    dplyr::filter(pam50 == \"luma\"))\n\n                    coef exp(coef)  se(coef)      z      p\nrisk_score      1.548555  4.704666  0.730935  2.119 0.0341\ntumor_size      0.003568  1.003574  0.016252  0.220 0.8262\nnode_statuspos -0.673885  0.509724  0.486784 -1.384 0.1662\nage            -0.014232  0.985869  0.012078 -1.178 0.2386\n\nLikelihood ratio test=29.45  on 4 df, p=6.331e-06\nn= 1502, number of events= 71 \n```\n:::\n:::\n\n\nEven among these patients the score is prognostic, despite the number of \nevents, the hazard ratio is relatively high here. If we do the survival\nanalysis by using overall survival as endpoint the results are shown below.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = os_months, event = os_status) ~ \", \n    paste(c(\"risk_score\", clin_vars), collapse = \"+\"))), data = endo_only_scanb %>% \n    dplyr::filter(pam50 == \"luma\"))\n\n                     coef  exp(coef)   se(coef)      z      p\nrisk_score      5.046e-01  1.656e+00  4.293e-01  1.175  0.240\ntumor_size     -4.809e-05  1.000e+00  1.103e-02 -0.004  0.997\nnode_statuspos -2.390e-01  7.874e-01  2.738e-01 -0.873  0.383\nage             9.506e-02  1.100e+00  7.974e-03 11.921 <2e-16\n\nLikelihood ratio test=234.5  on 4 df, p=< 2.2e-16\nn= 1502, number of events= 227 \n```\n:::\n:::\n\n\nRisk score still an estimated hazard ratio higher than 1, with \nmore variability though, still in the expected direction. So we see that \nthis signature provides aditional information to the PAM50 ROR signature. \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(\"risk_score\", \"NCN.ROR.asT0\", clin_vars), collapse = \"+\"))), \n    data = endo_only_scanb %>% dplyr::filter(pam50 == \"luma\"))\n\n                   coef exp(coef) se(coef)      z     p\nrisk_score      0.94883   2.58268  0.98705  0.961 0.336\nNCN.ROR.asT0    0.01038   1.01043  0.01120  0.927 0.354\ntumor_size      0.01689   1.01704  0.02187  0.772 0.440\nnode_statuspos -0.31774   0.72779  0.62635 -0.507 0.612\nage            -0.01230   0.98778  0.01221 -1.007 0.314\n\nLikelihood ratio test=30.31  on 5 df, p=1.283e-05\nn= 1502, number of events= 71 \n```\n:::\n:::\n\n\n## Standardized survival curves for SCANB\n\nWe now use also the standardized survival curves as suggested in the \npaper [@Syriopoulou2022]. For this we use the package\n`flexsurv` along with the functions `flexsurvspline` to model\nthe baseline hazard using splines and then to calculate the \nstandardized survival curves we use the function `standsurv`.\n\nFor the sake of interpretation we categorize the risk score in 4 categories,\na low, intermediate, high and ultra-high risk. The thresholds are \nbased on the data, we use the quartiles. We understand that we loose power\nwhen doing this but we are able to communicate better the information. \nFor comparison we first show the spline based model on the continous \nscore.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 5\n  term           estimate std.error statistic   p.value\n  <chr>             <dbl>     <dbl>     <dbl>     <dbl>\n1 gamma0         -7.84      0.643       NA    NA       \n2 gamma1          0.971     0.299       NA    NA       \n3 gamma2          0.0661    0.290       NA    NA       \n4 gamma3         -0.384     0.901       NA    NA       \n5 gamma4          0.405     0.840       NA    NA       \n6 risk_score      1.66      0.263        6.32  1.30e-10\n7 tumor_size     -0.00950   0.00735     -1.29  9.80e- 2\n8 node_statuspos -0.718     0.224       -3.20  6.80e- 4\n```\n:::\n:::\n\n\nWe use the \"hazard\" scale to define the proportional hazards model. The\nestimate is above 0 (1.8), meaning that the higher the risk score the\nworse it is. Moreover, the p-value is 1.1e-14. \n\nBefore moving on we just compare the risk score distributions between METABRIC\nand SCANB.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](risk_score_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\nThe distribution shift makes sense as the majority of patients in SCANB have\nlower tumor stage. Let us compare by molecular subtype.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](risk_score_files/figure-html/unnamed-chunk-22-1.png){width=1536}\n:::\n:::\n\n\nIn general they agree a bit more when looking by subtype. \n\nWe now proceed with the categorized data for visualization purposes. We\nalso use the survival scale for the interpretation. For the categories we\nuse METABRIC's quantiles instead of SCANB. This way we used the training \ndataset for defining the risk scores and then we use SCAN-B to further\nvalidate the differences.\n\n\n::: {.cell}\n\n:::\n\n\nThe quartiles are (0, 0.25, 0.5, 0.75 and 1):\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n[1] -0.2767315  0.5788431  0.9485916  1.3608617  3.8333981\n```\n:::\n:::\n\n\nThe patients are stratified in the categories low, intermediate,\nhigh and ultra-high. For the analysis the low category is set as the\nbaseline.\n\n\n::: {.cell}\n\n:::\n\n\nFirst we show the marginal survival curves.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](risk_score_files/figure-html/fig-rfs-marginal-curve-1.png){#fig-rfs-marginal-curve width=672}\n:::\n:::\n\n\nAnd now the marginal curves for the differences with the low\nrisk as the baseline.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](risk_score_files/figure-html/fig-rfs-difference-marginal-curve-1.png){#fig-rfs-difference-marginal-curve width=672}\n:::\n:::\n\n\nHere we see that the difference between low and ultra-high can be\nas high as 40%. On the other hand the differences\nbetween intermediate and low stay around 3 to 10% after 5 years.\n\nThe confidence intervals are larger as you increase the risk groups\ndue to the number of patients available in each category.\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> risk_score_category </th>\n   <th style=\"text-align:left;\"> 1 </th>\n   <th style=\"text-align:left;\"> 2 </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> low </td>\n   <td style=\"text-align:left;\"> 95% (1,539) </td>\n   <td style=\"text-align:left;\"> 5%  (79) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> intermediate </td>\n   <td style=\"text-align:left;\"> 91%   (375) </td>\n   <td style=\"text-align:left;\"> 9%  (39) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> high </td>\n   <td style=\"text-align:left;\"> 89%   (198) </td>\n   <td style=\"text-align:left;\"> 11%  (24) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> ultra-high </td>\n   <td style=\"text-align:left;\"> 77%   (105) </td>\n   <td style=\"text-align:left;\"> 23%  (31) </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Total </td>\n   <td style=\"text-align:left;\"> 93% (2,217) </td>\n   <td style=\"text-align:left;\"> 7% (173) </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nStill the number of events in percentage goes up as one goes up in the\nrisk category, as expected.\n\n## Risk score and POETIC trial\n\nWe can evaluate one of the two risk scores, the one using only the \nprincipal components, in the POETIC trial data. The first question we\ncan address is if there is difference in scores in the baseline tissue \n(@fig-poetic-risk-score).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Risk scores for responders and non-responders in the baseline tumor tissue.](risk_score_files/figure-html/fig-poetic-risk-score-1.png){#fig-poetic-risk-score width=672}\n:::\n:::\n\n\nWe see in the @fig-poetic-risk-score that in average the non responders\nhave higher risk scores. Now if we compare the risk scores between\nbaseline and surgery, the slope of the line that fits for each group\nseparately, responder and non responder, is different. The slope\nfor the non responders is parallel to the identity line going through\nthe origin with a slope of 1, meaning that there is not much change of risk\nupon the treatment. On other hand, for the responder group the slope is\ndecreased and has a value lower than 1, meaning that the risk is decreased\nupon aromatase inhibition after two weeks (@fig-poetic-risk-base-surgery).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Comparison of risk scores using the PCs only before and after two weeks of aromatase inhibitors in post-menopausal women. The colored lines correspond do the linear regression for each response status group separately.](risk_score_files/figure-html/fig-poetic-risk-base-surgery-1.png){#fig-poetic-risk-base-surgery width=672}\n:::\n:::\n\n\n## Risk score vs pathways \n\nWe now compare the risk score with pathways of interest as discussed in the\nprevious sections. Again we only look at the patients that received only\nendocrine therapy in both SCANB and METABRIC.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Risk score versus pathways of interest. Each subplot corresponds to a different pathway.](risk_score_files/figure-html/fig-cor-risk-pathways-1.png){#fig-cor-risk-pathways width=1152}\n:::\n:::\n\n\n@fig-cor-risk-pathways shows that in general the signatures are not \nstrongly associated with one of the main pathways displayed here.\nOn the other hand, @fig-cor-riskpcs-pathways shows the association between\nthe signatures and the risk scores derived only from the principal components.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Risk score derived from the principal components only versus pathways of interest. Each subplot corresponds to a different pathway.](risk_score_files/figure-html/fig-cor-riskpcs-pathways-1.png){#fig-cor-riskpcs-pathways width=1152}\n:::\n:::\n\n\nIn this case we see some associations with G2M checkpoint in general and a bit\nwith estrogen signaling. We now calculate the correlation plots \nfor each one of these pathways with both risk scores. \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Correlation matrix for all pathways of interest and the two risk scores, both including the clinical factors and without the clinical factors.](risk_score_files/figure-html/fig-corr-risk-pathways-1.png){#fig-corr-risk-pathways width=960}\n:::\n:::\n\n\n@fig-corr-risk-pathways shows that G2M checkpoint is highly correlated\nwith the risk score using only the principal components ($\\rho = 0.72$). \nWhen you include the clinical factors this value decreases. Moreover,\nDNA repair is highly associated with RS PC. Estrogen signaling was not \nso important here in the signatures surprisingly. \n\nIf we subselect only the SCANB samples we can recalculate those values\nand compare with the NCN ROR score. \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Correlation matrix for all pathways of interest and the two risk scores, both including the clinical factors and without the clinical factors.](risk_score_files/figure-html/fig-corr-risk-pathways-scanb-1.png){#fig-corr-risk-pathways-scanb width=960}\n:::\n:::\n\n\n## ABiM and nCounter data\n\nIn [@SCANB2022], the authors validated their approach of using \nRNA-seq instead of nCounter data by showing how one can get the \nROR and compared to nCounter data sequenced at their facility and\nsent to prosigna for the calculation of the risk of recurrence. \nThey have matched RNA-seq data as well. Here we will use the \nROR obtained from the nCounter data and use the RNA-seq to \ncalculate the risk score here developed. \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nTotal number of stable genes: 44\nTotal number of genes: 1044\nNumber of samples: 100\n```\n:::\n:::\n\n\n@fig-pca-abim100-cohort shows the embedding of the ABiM cohort, it \nmatches perfectly the molecular landscape.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Embedding of all samples from TCGA, SCNAB and METABRIC including the samples from ABiM 100 that have matched nCounter data.](risk_score_files/figure-html/fig-pca-abim100-cohort-1.png){#fig-pca-abim100-cohort width=864}\n:::\n:::\n\n\n@fig-abim100-cohort shows how well the ABiM cohort actually overlays \nwith the SCANB dataset, which makes sense as the processing pipeline\nis all similar. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![Biplot of first two PCA components from ABiM 100, TCGA, SCANB and METABRIC. The normal cohort is highlighted in the plot and has bigger dot size.](risk_score_files/figure-html/fig-abim100-cohort-1.png){#fig-abim100-cohort width=672}\n:::\n:::\n\n\nAnd now we move on and calculate the risk scores for the ABiM \ncohort. \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Correlation between risk score calculated based on the principal components and clinical factors versus the Prosigna ROR obtained from the nCounter data and evaluated by Prosigna. Cohort used is the ABiM 100 samples.](risk_score_files/figure-html/fig-rorft-riskscore-abim-1.png){#fig-rorft-riskscore-abim width=672}\n:::\n:::\n\n\n@fig-rorft-riskscore-abim shows that there is a positive correlation\nbetween the risk score and ROR obtained from Prosigna. We see\nthat some of the luminal A patients have higher ROR but lower \nROR. Also, among luminal B patients there were some with the same \nROR but different risk score, showing that the risk. Also some\nof the basal samples have smaller ROR than some of the luminal\nB and A samples, and the risk score captures these differences, i.e.,\nall basal samples have risk scores higher than 0.75.\n",
    "supporting": [
      "risk_score_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}