{
  "hash": "dae100ce14e74c948097b91355922b17",
  "result": {
    "markdown": "# Estrogen receptor status is continuous, not dichotomous\n\nCurrently in the clinics estrogen receptor (ER) status is treated \nas dichotomous condition. Either a breast cancer (BC) is ER positive (ER+) or\nER negative (ER-). The threshold for ER+ cells usually is 1% or 10% of the \ncells positive in a IHC staining. The idea is that ER+ BC patients\nwill receive endocrine therapy, usually tamoxifen or some aromatase inhibitor,\nfor treatment. The problem is not all patients respond the same to these\ndrugs and they also have different proportions of ER+ cells. \n\nIn this document we show how leveraging molecular information distinguishes\nER+ BC patients and how one should look more carefully on ER status. In order\nto do this, estrogen related signatures: estrogen response early and late from\nMSigDB[@Subramanian2005] and $SET_{ER/PR}$[@Sinn2019], \nare used to calculate scores for each\nBC patient. These scores then are used to calculate associations with survival\nanalysis. When performing cox regression, we try to adjust for sensible \ncovariates in order to reduce bias. Even though we are adjusting, it is \nvery difficult to know if a covariate is missing in the regression. Thus,\ncare should be always taken when interpreting these results.\n\nThis chapter is structure in the following way. First section corresponds\nto loading the datasets and then filtering them. Estrogen signatures scores\nare calculated using GSVA [@Hnzelmann2013]. Given the scores, cox regression\ncan be performed adjusting for clinical variables. After this the Hazard\nratios can be computed and interpreted along with their confidence\nintervals.\n\n## Loading and filtering the datasets\n\nThe preprocessing of the datasets is described in the website below:\n> https://chronchi.github.io/transcriptomics\n\nTo check the code used here either click in the code button on the top right\npart of the page or check the github page \n(github.com/chronchi/molecular_landscape).\n\nThe TCGA, METABRIC and SCANB cohorts are used in this section here. They\nare the biggest cohort of Breast cancer patients in the world. Each datasets\nhas an overall equal distribution of ER+ and ER- patients and similar age\ndistribution. \n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n## UMAP projection of the datasets\n\nThe plots below show how each patient is different in a molecular sense, \nand even inside each molecular subtype there are some differences. This\nindicates how different patients, at least molecularly. We only do the umap\nof samples that have a PAM50 molecular subtype assigned.\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](surv_analysis_estrogen_files/figure-html/unnamed-chunk-6-1.png){width=960}\n:::\n:::\n\nFrom the plots above we see a distinction of the different molecular subtypes.\n\n## Calculating scores\n\nIn order to calculate the scores, the package `msigdb` is used to load\nthe hallmark data into R. The $SET_{ER/PR}$ is made of the following genes:\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Affy </th>\n   <th style=\"text-align:left;\"> ID </th>\n   <th style=\"text-align:left;\"> is_target </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 202089_s_at </td>\n   <td style=\"text-align:left;\"> SLC39A6 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 203438_at </td>\n   <td style=\"text-align:left;\"> STC2 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 204508_s_at </td>\n   <td style=\"text-align:left;\"> CA12 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 205225_at </td>\n   <td style=\"text-align:left;\"> ESR1 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 205380_at </td>\n   <td style=\"text-align:left;\"> PDZK1 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 205440_s_at </td>\n   <td style=\"text-align:left;\"> NPY1R </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 205831_at </td>\n   <td style=\"text-align:left;\"> CD2 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 206401_s_at </td>\n   <td style=\"text-align:left;\"> MAPT </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 209123_at </td>\n   <td style=\"text-align:left;\"> QDPR </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 209309_at </td>\n   <td style=\"text-align:left;\"> AZGP1 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 209459_s_at </td>\n   <td style=\"text-align:left;\"> ABAT </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 213245_at </td>\n   <td style=\"text-align:left;\"> ADCY1 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 213539_at </td>\n   <td style=\"text-align:left;\"> CD3D </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 214440_at </td>\n   <td style=\"text-align:left;\"> NAT1 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 218398_at </td>\n   <td style=\"text-align:left;\"> MRPS30 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 218976_at </td>\n   <td style=\"text-align:left;\"> DNAJC12 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 219197_s_at </td>\n   <td style=\"text-align:left;\"> SCUBE2 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 222379_at </td>\n   <td style=\"text-align:left;\"> KCNE4 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 200650_s_at </td>\n   <td style=\"text-align:left;\"> LDHA </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 202961_s_at </td>\n   <td style=\"text-align:left;\"> ATP5J2 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 211662_s_at </td>\n   <td style=\"text-align:left;\"> VDAC2 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 201623_s_at </td>\n   <td style=\"text-align:left;\"> DARS </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 205480_s_at </td>\n   <td style=\"text-align:left;\"> UGP2 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 217750_s_at </td>\n   <td style=\"text-align:left;\"> UBE2Z </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 212175_s_at </td>\n   <td style=\"text-align:left;\"> AK2 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 212050_at </td>\n   <td style=\"text-align:left;\"> WIPF2 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 202631_s_at </td>\n   <td style=\"text-align:left;\"> APPBP2 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 202342_s_at </td>\n   <td style=\"text-align:left;\"> TRIM2 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\nThe first 18 genes are considered to be the target genes, the last 10 genes\nare the genes used for reference. According to their paper, the score is \ncalculated in the following way:\n\n$$\nSET_{ER/PR} = \\sum_{i = 1}^{18} \\frac{T_i}{18} - \\sum_{j=1}^{10}\\frac{R_j}{10} + 2\n$$\n\nWhere $T_i$ are the expression levels of target genes and $R_j$ are the\nexpression levels of the reference genes. Here we use GSVA to calculate\nthe scores, even when using their genes. \n\n::: {.cell}\n\n:::\n\nBefore we calculate any score, let us check the number of genes available\nfor each pathway in each dataset. This is important, in other to have\nrobust scores, most of the genes should be available in the datasets. We also\nadd signatures of 18 and 200 random genes for control. \n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\">   </th>\n   <th style=\"text-align:right;\"> tcga </th>\n   <th style=\"text-align:right;\"> scanb </th>\n   <th style=\"text-align:right;\"> metabric </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_ESTROGEN_RESPONSE_EARLY </td>\n   <td style=\"text-align:right;\"> 195 </td>\n   <td style=\"text-align:right;\"> 192 </td>\n   <td style=\"text-align:right;\"> 172 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_ESTROGEN_RESPONSE_LATE </td>\n   <td style=\"text-align:right;\"> 189 </td>\n   <td style=\"text-align:right;\"> 184 </td>\n   <td style=\"text-align:right;\"> 177 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SET_ERPR </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:right;\"> 18 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> random_200 </td>\n   <td style=\"text-align:right;\"> 141 </td>\n   <td style=\"text-align:right;\"> 115 </td>\n   <td style=\"text-align:right;\"> 142 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> random_18 </td>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:right;\"> 12 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\nMost of the genes are available in all datasets. Especially the SET\ngene set is available in all of them, which is very good. Out of the\nrandom 18 subset, only half of genes in average are available.\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\nFor each dataset one can plot the differences in scores for ER+ and ER- BC\npatients. This should be already an indication that the scores are meaningful.\nThe next sections shows the results for each dataset individually.\n\n::: {.cell}\n\n:::\n\n::: {.panel-tabset}\n\n### TCGA\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](surv_analysis_estrogen_files/figure-html/unnamed-chunk-15-1.png){width=960}\n:::\n:::\n\n### METABRIC\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](surv_analysis_estrogen_files/figure-html/unnamed-chunk-17-1.png){width=960}\n:::\n:::\n\n### SCANB\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](surv_analysis_estrogen_files/figure-html/unnamed-chunk-19-1.png){width=960}\n:::\n:::\n\n:::\n\nFrom the plots above one can conclude that three different estrogen pathways\ncapture the differences between ER status and also molecular subtypes.\nThere are two plots with random genes for control and we can see that\nthere is no difference between the ER status when using those gene sets.\n\nAnother way to look at the data is to plot by molecular subtype instead\nof ER status.\n\n::: {.panel-tabset}\n\n### TCGA\n\n::: {.cell}\n\n:::\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](surv_analysis_estrogen_files/figure-html/unnamed-chunk-22-1.png){width=960}\n:::\n:::\n\n### METABRIC\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](surv_analysis_estrogen_files/figure-html/unnamed-chunk-24-1.png){width=960}\n:::\n:::\n\n### SCANB\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](surv_analysis_estrogen_files/figure-html/unnamed-chunk-26-1.png){width=960}\n:::\n:::\n\n:::\n\nIn all cohorts the luminal A and B patients have a similar score. Also\nthe distinction is very clear between the basal and HER2-like patients\nversus luminal A and B.\n\nOne question that usually arises when calculating scores from gene sets is\nif proliferation associated genes (PAG) are driving the distinctions. \nThese signatures are highly curated and they have close or no PAGs. \nTherefore, the scores are not affected by PAGs and they really reflect the\nbiology.\n\nIn the next section we will show how these scores are also prognostic for\nER+ BC patients.\n\n## Survival analysis\n\nSince the scores are continuous variables and they are already scaled due\nto the output of GSVA, cox regression [@Cox1972] can be used. The advantages \nof using cox regression is that one can control for other variables. You might\nask, why should one control for clinical variables? One of the reasons is \nbecause the data being dealt here is observational data. There are several\nconfounders, for example, a score might be up because patients with a higher\ntumor grade have higher expression of some genes. Thus the score is confounded\nby the tumor grade and the interpretation changes. \n\nThere are limitations still when dealing with observational data. A strong \nhypothesis for performing survival analysis with observational data is that\nwe have measured all the confounder variables. This is pretty strong and in\npractice we never know if a confounder is missing or not. For a more\nthorough overview of the causal framework for observational data, check\nthe books [@Gelman2020-uh; @McElreath2020-jn].\n\nAll the cohorts have a different set of clinical variables available. Therefore,\nthe regression will be done by adjusting a different set of variables. Below\nis the description of the variables used for each cohort.^[This [webpage](https://web.archive.org/web/20220630083539/https://www.cancer.net/cancer-types/breast-cancer/stages) explains with more details the different tumor stages and how\nBC are classified.]\n\n- *Age*: age is one of the most important factors to adjust, specially in\nbreast cancer. This covariate is used for all cohorts.\n- *NPI*: the Nottingham prognostic index scores each tumor\nbased on tumor grade, tumor size and number of lymph nodes. Only METABRIC\nhas this information. \n- *Tumor Size*: as name describes. Only SCANB has this information. \n- *Tumor Stage*: tumors are usually described in terms of stage, it reflects\nthe tumor size and location. SCANB and TCGA have this information.\n- *Node Stage*: similar to tumor stage, but encodes the number of lymph nodes\nwhere breast cancer cells can be found. SCANB and TCGA have this information.\n\nThus the models we are going to use for the survival analysis of each dataset\nis shown below.\n\n- TCGA: `~ score + age + node_stage + tumor_stage`,\n- SCANB: `~ score + age + node_stage + tumor_stage`,\n- METABRIC: `~ score + age + NPI`,\n\nwhere score is one of the scores calculated earlier with GSVA. Note here\nthat since each node stage and tumor stage have sub classifications they \nwill be grouped together, otherwise there will be too many variables with\nfew points. Also \n\n::: {.cell}\n\n:::\n",
    "supporting": [
      "surv_analysis_estrogen_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}