{
  "hash": "06e94296afcbd4d1473211473eceaba8",
  "result": {
    "markdown": "# Estrogen receptor status is continuous, not dichotomous\n\nCurrently in the clinics estrogen receptor (ER) status is treated \nas dichotomous condition. Either a breast cancer (BC) is ER positive (ER+) or\nER negative (ER-). The threshold for ER+ cells usually is 1% or 10% of the \ncells positive in a IHC staining. The idea is that ER+ BC patients\nwill receive endocrine therapy, usually tamoxifen or some aromatase inhibitor,\nfor treatment. The problem is not all patients respond the same to these\ndrugs and they also have different proportions of ER+ cells. \n\nIn this document we show how leveraging molecular information distinguishes\nER+ BC patients and how one should look more carefully on ER status. In order\nto do this, estrogen related signatures: estrogen response early and late from\nMSigDB[@Subramanian2005] and $SET_{ER/PR}$[@Sinn2019], \nare used to calculate scores for each\nBC patient. These scores then are used to calculate associations with survival\nanalysis. When performing cox regression, we try to adjust for sensible \ncovariates in order to reduce bias. Even though we are adjusting, it is \nvery difficult to know if a covariate is missing in the regression. Thus,\ncare should be always taken when interpreting these results.\n\nThis chapter is structure in the following way. First section corresponds\nto loading the datasets and then filtering them. Estrogen signatures scores\nare calculated using GSVA [@Hnzelmann2013]. Given the scores, cox regression\ncan be performed adjusting for clinical variables. After this the Hazard\nratios can be computed and interpreted along with their confidence\nintervals.\n\n## Loading and filtering the datasets\n\nThe preprocessing of the datasets is described in the website below:\n> https://chronchi.github.io/transcriptomics\n\nTo check the code used here either click in the code button on the top right\npart of the page or check the github page \n(github.com/chronchi/molecular_landscape).\n\nThe TCGA, METABRIC and SCANB cohorts are used in this section here. They\nare the biggest cohort of Breast cancer patients in the world. Each datasets\nhas an overall equal distribution of ER+ and ER- patients and similar age\ndistribution. \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n* The library is already synchronized with the lockfile.\n```\n:::\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n## UMAP embedding of the datasets\n\nThe plots below show how each patient is different in a molecular sense, \nand even inside each molecular subtype there are some differences.\nWe only do the umap\nof samples that have a molecular subtype assigned.\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![UMAP projections of all three cohorts in the following order\":\" TCGA, SCANB and METABRIC. They are colored by the PAM50 molecular subtype.](surv_analysis_estrogen_files/figure-html/fig-surv-umap-all-1.png){#fig-surv-umap-all width=960}\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\nFrom the plots above we see a distinction of the different molecular subtypes.\n\n## Calculating scores\n\nIn order to calculate the scores, the package `msigdb` is used to load\nthe hallmark data into R. The $SET_{ER/PR}$ is made of the following genes:\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Affy </th>\n   <th style=\"text-align:left;\"> ID </th>\n   <th style=\"text-align:left;\"> is_target </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> 202089_s_at </td>\n   <td style=\"text-align:left;\"> SLC39A6 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 203438_at </td>\n   <td style=\"text-align:left;\"> STC2 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 204508_s_at </td>\n   <td style=\"text-align:left;\"> CA12 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 205225_at </td>\n   <td style=\"text-align:left;\"> ESR1 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 205380_at </td>\n   <td style=\"text-align:left;\"> PDZK1 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 205440_s_at </td>\n   <td style=\"text-align:left;\"> NPY1R </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 205831_at </td>\n   <td style=\"text-align:left;\"> CD2 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 206401_s_at </td>\n   <td style=\"text-align:left;\"> MAPT </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 209123_at </td>\n   <td style=\"text-align:left;\"> QDPR </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 209309_at </td>\n   <td style=\"text-align:left;\"> AZGP1 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 209459_s_at </td>\n   <td style=\"text-align:left;\"> ABAT </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 213245_at </td>\n   <td style=\"text-align:left;\"> ADCY1 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 213539_at </td>\n   <td style=\"text-align:left;\"> CD3D </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 214440_at </td>\n   <td style=\"text-align:left;\"> NAT1 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 218398_at </td>\n   <td style=\"text-align:left;\"> MRPS30 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 218976_at </td>\n   <td style=\"text-align:left;\"> DNAJC12 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 219197_s_at </td>\n   <td style=\"text-align:left;\"> SCUBE2 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 222379_at </td>\n   <td style=\"text-align:left;\"> KCNE4 </td>\n   <td style=\"text-align:left;\"> yes </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 200650_s_at </td>\n   <td style=\"text-align:left;\"> LDHA </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 202961_s_at </td>\n   <td style=\"text-align:left;\"> ATP5J2 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 211662_s_at </td>\n   <td style=\"text-align:left;\"> VDAC2 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 201623_s_at </td>\n   <td style=\"text-align:left;\"> DARS </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 205480_s_at </td>\n   <td style=\"text-align:left;\"> UGP2 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 217750_s_at </td>\n   <td style=\"text-align:left;\"> UBE2Z </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 212175_s_at </td>\n   <td style=\"text-align:left;\"> AK2 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 212050_at </td>\n   <td style=\"text-align:left;\"> WIPF2 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 202631_s_at </td>\n   <td style=\"text-align:left;\"> APPBP2 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> 202342_s_at </td>\n   <td style=\"text-align:left;\"> TRIM2 </td>\n   <td style=\"text-align:left;\"> no </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nThe first 18 genes are considered to be the target genes, the last 10 genes\nare the genes used for reference. According to their paper, the score is \ncalculated in the following way:\n\n$$\nSET_{ER/PR} = \\sum_{i = 1}^{18} \\frac{T_i}{18} - \\sum_{j=1}^{10}\\frac{R_j}{10} + 2\n$$\n\nWhere $T_i$ are the expression levels of target genes and $R_j$ are the\nexpression levels of the reference genes. Here we use GSVA to calculate\nthe scores, even when using their genes. \n\n\n::: {.cell}\n\n:::\n\n\nBefore we calculate any score, let us check the number of genes available\nfor each pathway in each dataset. This is important, in other to have\nrobust scores, most of the genes should be available in the datasets. We also\nadd signatures of 18 and 200 random genes for control. \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> pathway </th>\n   <th style=\"text-align:right;\"> tcga </th>\n   <th style=\"text-align:right;\"> scanb </th>\n   <th style=\"text-align:right;\"> metabric </th>\n   <th style=\"text-align:right;\"> n </th>\n   <th style=\"text-align:left;\"> average_percentage </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_ADIPOGENESIS </td>\n   <td style=\"text-align:right;\"> 188 </td>\n   <td style=\"text-align:right;\"> 187 </td>\n   <td style=\"text-align:right;\"> 164 </td>\n   <td style=\"text-align:right;\"> 210 </td>\n   <td style=\"text-align:left;\"> 0.86 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_ALLOGRAFT_REJECTION </td>\n   <td style=\"text-align:right;\"> 141 </td>\n   <td style=\"text-align:right;\"> 134 </td>\n   <td style=\"text-align:right;\"> 139 </td>\n   <td style=\"text-align:right;\"> 335 </td>\n   <td style=\"text-align:left;\"> 0.41 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_ANDROGEN_RESPONSE </td>\n   <td style=\"text-align:right;\"> 93 </td>\n   <td style=\"text-align:right;\"> 92 </td>\n   <td style=\"text-align:right;\"> 83 </td>\n   <td style=\"text-align:right;\"> 102 </td>\n   <td style=\"text-align:left;\"> 0.88 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_ANGIOGENESIS </td>\n   <td style=\"text-align:right;\"> 30 </td>\n   <td style=\"text-align:right;\"> 29 </td>\n   <td style=\"text-align:right;\"> 28 </td>\n   <td style=\"text-align:right;\"> 36 </td>\n   <td style=\"text-align:left;\"> 0.81 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_APICAL_JUNCTION </td>\n   <td style=\"text-align:right;\"> 155 </td>\n   <td style=\"text-align:right;\"> 148 </td>\n   <td style=\"text-align:right;\"> 151 </td>\n   <td style=\"text-align:right;\"> 231 </td>\n   <td style=\"text-align:left;\"> 0.66 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_APICAL_SURFACE </td>\n   <td style=\"text-align:right;\"> 31 </td>\n   <td style=\"text-align:right;\"> 30 </td>\n   <td style=\"text-align:right;\"> 31 </td>\n   <td style=\"text-align:right;\"> 46 </td>\n   <td style=\"text-align:left;\"> 0.67 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_APOPTOSIS </td>\n   <td style=\"text-align:right;\"> 141 </td>\n   <td style=\"text-align:right;\"> 141 </td>\n   <td style=\"text-align:right;\"> 130 </td>\n   <td style=\"text-align:right;\"> 183 </td>\n   <td style=\"text-align:left;\"> 0.75 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_BILE_ACID_METABOLISM </td>\n   <td style=\"text-align:right;\"> 75 </td>\n   <td style=\"text-align:right;\"> 71 </td>\n   <td style=\"text-align:right;\"> 77 </td>\n   <td style=\"text-align:right;\"> 114 </td>\n   <td style=\"text-align:left;\"> 0.65 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_CHOLESTEROL_HOMEOSTASIS </td>\n   <td style=\"text-align:right;\"> 67 </td>\n   <td style=\"text-align:right;\"> 67 </td>\n   <td style=\"text-align:right;\"> 60 </td>\n   <td style=\"text-align:right;\"> 77 </td>\n   <td style=\"text-align:left;\"> 0.84 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_COAGULATION </td>\n   <td style=\"text-align:right;\"> 92 </td>\n   <td style=\"text-align:right;\"> 90 </td>\n   <td style=\"text-align:right;\"> 88 </td>\n   <td style=\"text-align:right;\"> 162 </td>\n   <td style=\"text-align:left;\"> 0.56 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_COMPLEMENT </td>\n   <td style=\"text-align:right;\"> 152 </td>\n   <td style=\"text-align:right;\"> 149 </td>\n   <td style=\"text-align:right;\"> 144 </td>\n   <td style=\"text-align:right;\"> 237 </td>\n   <td style=\"text-align:left;\"> 0.63 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_DNA_REPAIR </td>\n   <td style=\"text-align:right;\"> 145 </td>\n   <td style=\"text-align:right;\"> 144 </td>\n   <td style=\"text-align:right;\"> 127 </td>\n   <td style=\"text-align:right;\"> 170 </td>\n   <td style=\"text-align:left;\"> 0.82 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_E2F_TARGETS </td>\n   <td style=\"text-align:right;\"> 196 </td>\n   <td style=\"text-align:right;\"> 179 </td>\n   <td style=\"text-align:right;\"> 174 </td>\n   <td style=\"text-align:right;\"> 218 </td>\n   <td style=\"text-align:left;\"> 0.84 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_EPITHELIAL_MESENCHYMAL_TRANSITION </td>\n   <td style=\"text-align:right;\"> 179 </td>\n   <td style=\"text-align:right;\"> 172 </td>\n   <td style=\"text-align:right;\"> 172 </td>\n   <td style=\"text-align:right;\"> 204 </td>\n   <td style=\"text-align:left;\"> 0.85 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_ESTROGEN_RESPONSE_EARLY </td>\n   <td style=\"text-align:right;\"> 189 </td>\n   <td style=\"text-align:right;\"> 176 </td>\n   <td style=\"text-align:right;\"> 162 </td>\n   <td style=\"text-align:right;\"> 216 </td>\n   <td style=\"text-align:left;\"> 0.81 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_ESTROGEN_RESPONSE_LATE </td>\n   <td style=\"text-align:right;\"> 176 </td>\n   <td style=\"text-align:right;\"> 162 </td>\n   <td style=\"text-align:right;\"> 162 </td>\n   <td style=\"text-align:right;\"> 218 </td>\n   <td style=\"text-align:left;\"> 0.76 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_FATTY_ACID_METABOLISM </td>\n   <td style=\"text-align:right;\"> 128 </td>\n   <td style=\"text-align:right;\"> 124 </td>\n   <td style=\"text-align:right;\"> 127 </td>\n   <td style=\"text-align:right;\"> 165 </td>\n   <td style=\"text-align:left;\"> 0.77 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_G2M_CHECKPOINT </td>\n   <td style=\"text-align:right;\"> 187 </td>\n   <td style=\"text-align:right;\"> 172 </td>\n   <td style=\"text-align:right;\"> 173 </td>\n   <td style=\"text-align:right;\"> 204 </td>\n   <td style=\"text-align:left;\"> 0.87 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_GLYCOLYSIS </td>\n   <td style=\"text-align:right;\"> 173 </td>\n   <td style=\"text-align:right;\"> 167 </td>\n   <td style=\"text-align:right;\"> 167 </td>\n   <td style=\"text-align:right;\"> 215 </td>\n   <td style=\"text-align:left;\"> 0.79 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_HEDGEHOG_SIGNALING </td>\n   <td style=\"text-align:right;\"> 24 </td>\n   <td style=\"text-align:right;\"> 21 </td>\n   <td style=\"text-align:right;\"> 25 </td>\n   <td style=\"text-align:right;\"> 36 </td>\n   <td style=\"text-align:left;\"> 0.65 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_HEME_METABOLISM </td>\n   <td style=\"text-align:right;\"> 152 </td>\n   <td style=\"text-align:right;\"> 150 </td>\n   <td style=\"text-align:right;\"> 138 </td>\n   <td style=\"text-align:right;\"> 214 </td>\n   <td style=\"text-align:left;\"> 0.69 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_HYPOXIA </td>\n   <td style=\"text-align:right;\"> 168 </td>\n   <td style=\"text-align:right;\"> 163 </td>\n   <td style=\"text-align:right;\"> 163 </td>\n   <td style=\"text-align:right;\"> 215 </td>\n   <td style=\"text-align:left;\"> 0.77 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_IL2_STAT5_SIGNALING </td>\n   <td style=\"text-align:right;\"> 163 </td>\n   <td style=\"text-align:right;\"> 156 </td>\n   <td style=\"text-align:right;\"> 163 </td>\n   <td style=\"text-align:right;\"> 216 </td>\n   <td style=\"text-align:left;\"> 0.74 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_IL6_JAK_STAT3_SIGNALING </td>\n   <td style=\"text-align:right;\"> 65 </td>\n   <td style=\"text-align:right;\"> 62 </td>\n   <td style=\"text-align:right;\"> 63 </td>\n   <td style=\"text-align:right;\"> 103 </td>\n   <td style=\"text-align:left;\"> 0.61 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_INFLAMMATORY_RESPONSE </td>\n   <td style=\"text-align:right;\"> 142 </td>\n   <td style=\"text-align:right;\"> 131 </td>\n   <td style=\"text-align:right;\"> 144 </td>\n   <td style=\"text-align:right;\"> 222 </td>\n   <td style=\"text-align:left;\"> 0.63 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_INTERFERON_ALPHA_RESPONSE </td>\n   <td style=\"text-align:right;\"> 92 </td>\n   <td style=\"text-align:right;\"> 90 </td>\n   <td style=\"text-align:right;\"> 81 </td>\n   <td style=\"text-align:right;\"> 140 </td>\n   <td style=\"text-align:left;\"> 0.63 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_INTERFERON_GAMMA_RESPONSE </td>\n   <td style=\"text-align:right;\"> 178 </td>\n   <td style=\"text-align:right;\"> 176 </td>\n   <td style=\"text-align:right;\"> 164 </td>\n   <td style=\"text-align:right;\"> 286 </td>\n   <td style=\"text-align:left;\"> 0.6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_KRAS_SIGNALING_DN </td>\n   <td style=\"text-align:right;\"> 71 </td>\n   <td style=\"text-align:right;\"> 54 </td>\n   <td style=\"text-align:right;\"> 82 </td>\n   <td style=\"text-align:right;\"> 220 </td>\n   <td style=\"text-align:left;\"> 0.31 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_KRAS_SIGNALING_UP </td>\n   <td style=\"text-align:right;\"> 156 </td>\n   <td style=\"text-align:right;\"> 147 </td>\n   <td style=\"text-align:right;\"> 146 </td>\n   <td style=\"text-align:right;\"> 220 </td>\n   <td style=\"text-align:left;\"> 0.68 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_MITOTIC_SPINDLE </td>\n   <td style=\"text-align:right;\"> 194 </td>\n   <td style=\"text-align:right;\"> 189 </td>\n   <td style=\"text-align:right;\"> 168 </td>\n   <td style=\"text-align:right;\"> 215 </td>\n   <td style=\"text-align:left;\"> 0.85 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_MTORC1_SIGNALING </td>\n   <td style=\"text-align:right;\"> 190 </td>\n   <td style=\"text-align:right;\"> 189 </td>\n   <td style=\"text-align:right;\"> 176 </td>\n   <td style=\"text-align:right;\"> 211 </td>\n   <td style=\"text-align:left;\"> 0.88 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_MYC_TARGETS_V1 </td>\n   <td style=\"text-align:right;\"> 194 </td>\n   <td style=\"text-align:right;\"> 194 </td>\n   <td style=\"text-align:right;\"> 185 </td>\n   <td style=\"text-align:right;\"> 236 </td>\n   <td style=\"text-align:left;\"> 0.81 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_MYC_TARGETS_V2 </td>\n   <td style=\"text-align:right;\"> 58 </td>\n   <td style=\"text-align:right;\"> 57 </td>\n   <td style=\"text-align:right;\"> 52 </td>\n   <td style=\"text-align:right;\"> 60 </td>\n   <td style=\"text-align:left;\"> 0.93 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_MYOGENESIS </td>\n   <td style=\"text-align:right;\"> 126 </td>\n   <td style=\"text-align:right;\"> 131 </td>\n   <td style=\"text-align:right;\"> 139 </td>\n   <td style=\"text-align:right;\"> 212 </td>\n   <td style=\"text-align:left;\"> 0.62 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_NOTCH_SIGNALING </td>\n   <td style=\"text-align:right;\"> 29 </td>\n   <td style=\"text-align:right;\"> 28 </td>\n   <td style=\"text-align:right;\"> 29 </td>\n   <td style=\"text-align:right;\"> 34 </td>\n   <td style=\"text-align:left;\"> 0.84 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_OXIDATIVE_PHOSPHORYLATION </td>\n   <td style=\"text-align:right;\"> 199 </td>\n   <td style=\"text-align:right;\"> 185 </td>\n   <td style=\"text-align:right;\"> 169 </td>\n   <td style=\"text-align:right;\"> 220 </td>\n   <td style=\"text-align:left;\"> 0.84 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_P53_PATHWAY </td>\n   <td style=\"text-align:right;\"> 177 </td>\n   <td style=\"text-align:right;\"> 172 </td>\n   <td style=\"text-align:right;\"> 160 </td>\n   <td style=\"text-align:right;\"> 215 </td>\n   <td style=\"text-align:left;\"> 0.79 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_PANCREAS_BETA_CELLS </td>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:right;\"> 13 </td>\n   <td style=\"text-align:right;\"> 17 </td>\n   <td style=\"text-align:right;\"> 44 </td>\n   <td style=\"text-align:left;\"> 0.33 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_PEROXISOME </td>\n   <td style=\"text-align:right;\"> 85 </td>\n   <td style=\"text-align:right;\"> 84 </td>\n   <td style=\"text-align:right;\"> 87 </td>\n   <td style=\"text-align:right;\"> 110 </td>\n   <td style=\"text-align:left;\"> 0.78 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_PI3K_AKT_MTOR_SIGNALING </td>\n   <td style=\"text-align:right;\"> 91 </td>\n   <td style=\"text-align:right;\"> 91 </td>\n   <td style=\"text-align:right;\"> 84 </td>\n   <td style=\"text-align:right;\"> 118 </td>\n   <td style=\"text-align:left;\"> 0.75 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_PROTEIN_SECRETION </td>\n   <td style=\"text-align:right;\"> 94 </td>\n   <td style=\"text-align:right;\"> 92 </td>\n   <td style=\"text-align:right;\"> 90 </td>\n   <td style=\"text-align:right;\"> 98 </td>\n   <td style=\"text-align:left;\"> 0.94 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_REACTIVE_OXYGEN_SPECIES_PATHWAY </td>\n   <td style=\"text-align:right;\"> 46 </td>\n   <td style=\"text-align:right;\"> 47 </td>\n   <td style=\"text-align:right;\"> 43 </td>\n   <td style=\"text-align:right;\"> 58 </td>\n   <td style=\"text-align:left;\"> 0.78 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_SPERMATOGENESIS </td>\n   <td style=\"text-align:right;\"> 62 </td>\n   <td style=\"text-align:right;\"> 59 </td>\n   <td style=\"text-align:right;\"> 71 </td>\n   <td style=\"text-align:right;\"> 144 </td>\n   <td style=\"text-align:left;\"> 0.44 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_TGF_BETA_SIGNALING </td>\n   <td style=\"text-align:right;\"> 49 </td>\n   <td style=\"text-align:right;\"> 50 </td>\n   <td style=\"text-align:right;\"> 45 </td>\n   <td style=\"text-align:right;\"> 59 </td>\n   <td style=\"text-align:left;\"> 0.81 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_TNFA_SIGNALING_VIA_NFKB </td>\n   <td style=\"text-align:right;\"> 175 </td>\n   <td style=\"text-align:right;\"> 173 </td>\n   <td style=\"text-align:right;\"> 166 </td>\n   <td style=\"text-align:right;\"> 228 </td>\n   <td style=\"text-align:left;\"> 0.75 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_UNFOLDED_PROTEIN_RESPONSE </td>\n   <td style=\"text-align:right;\"> 106 </td>\n   <td style=\"text-align:right;\"> 106 </td>\n   <td style=\"text-align:right;\"> 98 </td>\n   <td style=\"text-align:right;\"> 115 </td>\n   <td style=\"text-align:left;\"> 0.9 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_UV_RESPONSE_DN </td>\n   <td style=\"text-align:right;\"> 129 </td>\n   <td style=\"text-align:right;\"> 131 </td>\n   <td style=\"text-align:right;\"> 121 </td>\n   <td style=\"text-align:right;\"> 152 </td>\n   <td style=\"text-align:left;\"> 0.84 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_UV_RESPONSE_UP </td>\n   <td style=\"text-align:right;\"> 129 </td>\n   <td style=\"text-align:right;\"> 126 </td>\n   <td style=\"text-align:right;\"> 127 </td>\n   <td style=\"text-align:right;\"> 191 </td>\n   <td style=\"text-align:left;\"> 0.67 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_WNT_BETA_CATENIN_SIGNALING </td>\n   <td style=\"text-align:right;\"> 36 </td>\n   <td style=\"text-align:right;\"> 33 </td>\n   <td style=\"text-align:right;\"> 36 </td>\n   <td style=\"text-align:right;\"> 50 </td>\n   <td style=\"text-align:left;\"> 0.7 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> HALLMARK_XENOBIOTIC_METABOLISM </td>\n   <td style=\"text-align:right;\"> 142 </td>\n   <td style=\"text-align:right;\"> 135 </td>\n   <td style=\"text-align:right;\"> 141 </td>\n   <td style=\"text-align:right;\"> 224 </td>\n   <td style=\"text-align:left;\"> 0.62 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SET_ERPR </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:right;\"> 16 </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:left;\"> 0.93 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> random_200 </td>\n   <td style=\"text-align:right;\"> 160 </td>\n   <td style=\"text-align:right;\"> 136 </td>\n   <td style=\"text-align:right;\"> 151 </td>\n   <td style=\"text-align:right;\"> 200 </td>\n   <td style=\"text-align:left;\"> 0.74 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> random_18 </td>\n   <td style=\"text-align:right;\"> 14 </td>\n   <td style=\"text-align:right;\"> 13 </td>\n   <td style=\"text-align:right;\"> 11 </td>\n   <td style=\"text-align:right;\"> 18 </td>\n   <td style=\"text-align:left;\"> 0.7 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nMost of the genes are available in all datasets. When calculating scores\nit is always good to check the availability of the genes. Otherwise this\ncan make the score unstable, since too many of the genes are missing. \nFor example, \nHALLMARK_PANCREAS_BETA_CELLS might have an unstable score, due to a lot \nof genes missing. \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\nFor each dataset one can plot the differences in scores for ER+ and ER- BC\npatients. This should be already an indication that the scores are meaningful.\nThe next sections shows the results for each dataset individually.\n\n\n::: {.cell}\n\n:::\n\n\n::: {.panel-tabset}\n\n### TCGA\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Scores for TCGA patients](surv_analysis_estrogen_files/figure-html/fig-scores-tcga-1.png){#fig-scores-tcga width=960}\n:::\n:::\n\n\n### METABRIC\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Scores for METABRIC patients](surv_analysis_estrogen_files/figure-html/fig-scores-metabric-1.png){#fig-scores-metabric width=960}\n:::\n:::\n\n\n### SCANB\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Scores for SCANB patients](surv_analysis_estrogen_files/figure-html/fig-scores-scanb-1.png){#fig-scores-scanb width=960}\n:::\n:::\n\n\n:::\n\nFrom the plots above one can conclude that three different estrogen pathways\ncapture the differences between ER status and also molecular subtypes.\nThere are two plots with random genes for control and we can see that\nthere is no difference between the ER status when using those gene sets.\n\nBelow is a combined image for TCGA, SCANB and METABRIC using the $SET_{ER/PR}$\nsignature.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![SET ER/PR scores for all three cohorts.](surv_analysis_estrogen_files/figure-html/fig-scores-metabric-tcga-scanb-1.png){#fig-scores-metabric-tcga-scanb width=576}\n:::\n:::\n\n\nAnd now using the hallmark estrogen response early.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Estrogen early scores for all three cohorts.](surv_analysis_estrogen_files/figure-html/fig-scores-metabric-tcga-scanb-estrogen-early-1.png){#fig-scores-metabric-tcga-scanb-estrogen-early width=1152}\n:::\n:::\n\n\nWe see that there is a considerable overlap between the ER+ and ER- BC samples.\nFor each cohort the numbers of ER+ BC samples that have scores below\n0 is shown below:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n$metabric\n                er_status                \n is_below_0           neg             pos\n         no   6.04%  (20)  64.80%   (869)\n        yes  93.96% (311)  35.20%   (472)\n      Total 100.00% (331) 100.00% (1,341)\n\n$scanb\n                  er_status                \n is_below_0             neg             pos\n         no   3.40%    (36)  48.27% (2,972)\n        yes  96.60% (1,023)  51.73% (3,185)\n      Total 100.00% (1,059) 100.00% (6,157)\n\n$tcga\n                er_status              \n is_below_0           neg           pos\n         no   3.03%   (7)  57.49% (445)\n        yes  96.97% (224)  42.51% (329)\n      Total 100.00% (231) 100.00% (774)\n```\n:::\n:::\n\n\n\nAnother way to look at the data is to plot by molecular subtype instead\nof ER status.\n\n::: {.panel-tabset}\n\n### TCGA\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Scores for TCGA patients stratified by PAM50 molecular subtype](surv_analysis_estrogen_files/figure-html/fig-scores-tcga-pam50-1.png){#fig-scores-tcga-pam50 width=960}\n:::\n:::\n\n\n### METABRIC\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Scores for METABRIC patients stratified by PAM50 molecular subtype](surv_analysis_estrogen_files/figure-html/fig-scores-metabric-pam50-1.png){#fig-scores-metabric-pam50 width=960}\n:::\n:::\n\n\n### SCANB\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Scores for SCANB patients stratified by PAM50 molecular subtype](surv_analysis_estrogen_files/figure-html/fig-scores-scanb-pam50-1.png){#fig-scores-scanb-pam50 width=960}\n:::\n:::\n\n\n:::\n\nIn all cohorts the luminal A and B patients have a similar score. Also\nthe distinction is very clear between the basal and HER2-like patients\nversus luminal A and B.\n\nOne question that usually arises when calculating scores from gene sets is\nif proliferation associated genes (PAG) are driving the distinctions. \nThese signatures are highly curated and they have close or no PAGs. \nTherefore, the scores are not affected by PAGs and they really reflect the\nbiology.\n\nLastly we show in @fig-scores-scanb-esr1 the correlation of \nthe estrogen signaling scores with the signatures. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![Scores for SCANB patients stratified by PAM50 molecular subtype](surv_analysis_estrogen_files/figure-html/fig-scores-scanb-esr1-1.png){#fig-scores-scanb-esr1 width=768}\n:::\n:::\n\n\nWe see that there is a positive correlation between signatures and scores,\nthe problem though is the high variability in the scores in this case. \n\nIn the next section we will show how these scores are also prognostic for\nER+ BC patients.\n\n## Survival analysis\n\nSince the scores are continuous variables and they are already scaled due\nto the output of GSVA, cox regression [@Cox1972] can be used. The advantages \nof using cox regression is that one can control for other variables. You might\nask, why should one control for clinical variables? One of the reasons is \nbecause the data being dealt here is observational data. There are several\nconfounders, for example, a score might be up because patients with a higher\ntumor grade have higher expression of some genes. Thus the score is confounded\nby the tumor grade and the interpretation changes. \n\nThere are limitations still when dealing with observational data. A strong \nhypothesis for performing survival analysis with observational data is that\nwe have measured all the confounder variables. This is pretty strong and in\npractice we never know if a confounder is missing or not. For a more\nthorough overview of the causal framework for observational data, check\nthe books [@Gelman2020-uh; @McElreath2020-jn].\n\nAll the cohorts have a different set of clinical variables available. Therefore,\nthe regression will be done by adjusting a different set of variables. Below\nis the description of the variables used for each cohort.^[This [webpage](https://web.archive.org/web/20220630083539/https://www.cancer.net/cancer-types/breast-cancer/stages) explains with more details the different tumor stages and how\nBC are classified.]\n\n- **Age**: age is one of the most important factors to adjust, specially in\nbreast cancer. This covariate is used for all cohorts.\n- **NPI**: the Nottingham prognostic index scores each tumor\nbased on tumor grade, tumor size and number of lymph nodes. Only METABRIC\nhas this information. \n- **Tumor Size**: as name describes. Only SCANB has this information. \n- **Tumor Stage**: tumors are usually described in terms of stage, it reflects\nthe tumor size and location. SCANB and TCGA have this information.\n- **Node Stage**: similar to tumor stage, but encodes the number of lymph nodes\nwhere breast cancer cells can be found. SCANB and TCGA have this information.\n\nThus the models we are going to use for the survival analysis of each dataset\nis shown below.\n\n- TCGA: `~ score + age + node_stage + tumor_stage`,\n- SCANB: `~ score + age + node_stage + tumor_stage`,\n- METABRIC: `~ score + age + NPI`,\n\nwhere score is one of the scores calculated earlier with GSVA. Note here\nthat since each node stage and tumor stage have sub classifications they \nwill be grouped together, otherwise there will be too many variables with\nfew points. We will also subselect specific tumor stages for TCGA and SCANB,\nsince there are very few patients with tumor stage 4.\n\nTo be very specific in the survival analysis, only endocrine treated patients\nshould be used in the analysis, as that is what are interested in. METABRIC\nand SCANB has this kind of annotation, but TCGA not. So the survival analysis\non SCANB and METABRIC will be performed on endocrine only treated, ER+ BC\npatients. On TCGA, to mitigate this effect, we subselect only luminal A and \nB patients, and we keep in mind that they might have been treated with\nchemotherapy as well. Moreover, in Sweden the guidelines for BC treatment is to\nuse 10% as the threshold for ER status. Therefore, ER+ BC patients used on\nSCANB are those that are above the 10% threshold.\n\nThe table below shows the number of patients for each cohort.\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> cohort </th>\n   <th style=\"text-align:right;\"> number_patients </th>\n   <th style=\"text-align:right;\"> nb_events </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> TCGA </td>\n   <td style=\"text-align:right;\"> 684 </td>\n   <td style=\"text-align:right;\"> 73 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SCANB </td>\n   <td style=\"text-align:right;\"> 3169 </td>\n   <td style=\"text-align:right;\"> 544 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> METABRIC </td>\n   <td style=\"text-align:right;\"> 934 </td>\n   <td style=\"text-align:right;\"> 573 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SCANB High ER </td>\n   <td style=\"text-align:right;\"> 2542 </td>\n   <td style=\"text-align:right;\"> 399 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SCANB Low ER </td>\n   <td style=\"text-align:right;\"> 203 </td>\n   <td style=\"text-align:right;\"> 38 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SCANB High ESR1 </td>\n   <td style=\"text-align:right;\"> 425 </td>\n   <td style=\"text-align:right;\"> 95 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> METABRIC High ESR1 </td>\n   <td style=\"text-align:right;\"> 254 </td>\n   <td style=\"text-align:right;\"> 175 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n### Results\n\nThe table below shows the results for each analysis performed for a specific\nterm. In order to understand the table the user can filter based on the term,\ncohort and type of analysis. Since METABRIC has recurrence free survival (RFS)\nand overall survival (OS), the results for both analysis are presented here. \n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-02572730445f886f4730\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-02572730445f886f4730\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td><\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.131195291476334\\\" data-max=\\\"0.618694005355132\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.135062702694085\\\" data-max=\\\"0.737296332838902\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"-7.06141477146393\\\" data-max=\\\"-1.8379989205591\\\" data-scale=\\\"14\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"1.648e-12\\\" data-max=\\\"0.066062564370589\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.054920184042876\\\" data-max=\\\"0.471765924783858\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.288410555115017\\\" data-max=\\\"1.03237420140414\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.131195291476334\\\" data-max=\\\"0.618694005355132\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\"],[\"os\",\"os\",\"os\",\"os\",\"os\",\"os\",\"rfs\",\"rfs\",\"rfs\",\"rfs\"],[\"tcga\",\"tcga\",\"scanb\",\"scanb\",\"metabric\",\"metabric\",\"scanb\",\"scanb\",\"metabric\",\"metabric\"],[\"HALLMARK_ESTROGEN_RESPONSE_EARLY\",\"SET_ERPR\",\"HALLMARK_ESTROGEN_RESPONSE_EARLY\",\"SET_ERPR\",\"HALLMARK_ESTROGEN_RESPONSE_EARLY\",\"SET_ERPR\",\"HALLMARK_ESTROGEN_RESPONSE_EARLY\",\"SET_ERPR\",\"HALLMARK_ESTROGEN_RESPONSE_EARLY\",\"SET_ERPR\"],[\"HALLMARK_ESTROGEN_RESPONSE_EARLY\",\"SET_ERPR\",\"HALLMARK_ESTROGEN_RESPONSE_EARLY\",\"SET_ERPR\",\"HALLMARK_ESTROGEN_RESPONSE_EARLY\",\"SET_ERPR\",\"HALLMARK_ESTROGEN_RESPONSE_EARLY\",\"SET_ERPR\",\"HALLMARK_ESTROGEN_RESPONSE_EARLY\",\"SET_ERPR\"],[0.233829225703695,0.230338944922228,0.618694005355132,0.5177938969911881,0.5584385300696471,0.6147409585363079,0.131195291476335,0.178874673339985,0.430913702461177,0.45293441930167],[0.7372963328389019,0.39763624663053,0.261232180399744,0.14151474134113,0.240219789131416,0.135062702694086,0.444296968002728,0.243728760170527,0.292397620536938,0.163586330692911],[-1.97093647428203,-3.69232783408581,-1.8379989205591,-4.65095008419381,-2.42532362208777,-3.60243276518523,-4.57142055320387,-7.06141477146393,-2.87911862514004,-4.84152881465094],[0.0487311424674724,0.000222210765540212,0.0660625643705889,3.30409301662962e-06,0.0152947457514795,0.000315252955042664,4.84428951881824e-06,1.64815822611846e-12,0.00398788301018185,1.28843987757473e-06],[0.0551202292573695,0.105657124357175,0.370778610838734,0.39237322229208,0.348738519932462,0.471765924783858,0.0549201840428763,0.110939590091377,0.242941102721224,0.328692948822314],[0.991942659343702,0.502152882455225,1.03237420140414,0.6833048346039809,0.894233283798828,0.801046506856718,0.31340398444628,0.288410555115017,0.764327719306833,0.624137478224522],[0.233829225703695,0.230338944922228,0.618694005355132,0.5177938969911881,0.5584385300696471,0.6147409585363079,0.131195291476335,0.178874673339985,0.430913702461177,0.45293441930167]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>type_analysis<\\/th>\\n      <th>cohort<\\/th>\\n      <th>score<\\/th>\\n      <th>term<\\/th>\\n      <th>estimate<\\/th>\\n      <th>std.error<\\/th>\\n      <th>statistic<\\/th>\\n      <th>p.value<\\/th>\\n      <th>conf.low<\\/th>\\n      <th>conf.high<\\/th>\\n      <th>HR<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"scrollX\":true,\"columnDefs\":[{\"targets\":8,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatSignif(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":5,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":6,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":7,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":11,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"className\":\"dt-right\",\"targets\":[5,6,7,8,9,10,11]},{\"orderable\":false,\"targets\":0}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"orderCellsTop\":true}},\"evals\":[\"options.columnDefs.0.render\",\"options.columnDefs.1.render\",\"options.columnDefs.2.render\",\"options.columnDefs.3.render\",\"options.columnDefs.4.render\"],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\nThe table above shows that $SET_{ER/PR}$ had a small hazard ratio (< 1) in all\n4 analysis performed. Moreover, for all cases where a measure of estrogen\nsignaling was used, the hazard ratio was below 1, indicating that the higher\nthe score, the less likely the patient is to suffer the event in a specific\ntimepoint. This indicates that ER signaling is actually something continuous\nand not dichotomous.\n\nNot only that but we also performed Accelerated Failure Time (AFT) survival\nanalysis with a log-normal distribution as our parametric distribution to \nmodel time. The results are shown in the table below.\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-67d96a4f0da7d83957e2\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-67d96a4f0da7d83957e2\">{\"x\":{\"filter\":\"top\",\"vertical\":false,\"filterHTML\":\"<tr>\\n  <td><\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"character\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.234287743935524\\\" data-max=\\\"1.63932921505999\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.099653139342088\\\" data-max=\\\"0.565400042892431\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"1.33552087841578\\\" data-max=\\\"6.59976975927939\\\" data-scale=\\\"14\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"2.0589e-11\\\" data-max=\\\"0.090852963301514\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"-0.109544799272244\\\" data-max=\\\"1.04837901253207\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n  <td data-type=\\\"number\\\" style=\\\"vertical-align: top;\\\">\\n    <div class=\\\"form-group has-feedback\\\" style=\\\"margin-bottom: auto;\\\">\\n      <input type=\\\"search\\\" placeholder=\\\"All\\\" class=\\\"form-control\\\" style=\\\"width: 100%;\\\"/>\\n      <span class=\\\"glyphicon glyphicon-remove-circle form-control-feedback\\\"><\\/span>\\n    <\\/div>\\n    <div style=\\\"display: none;position: absolute;width: 200px;opacity: 1\\\">\\n      <div data-min=\\\"0.578120287143292\\\" data-max=\\\"2.39228653312671\\\" data-scale=\\\"15\\\"><\\/div>\\n      <span style=\\\"float: left;\\\"><\\/span>\\n      <span style=\\\"float: right;\\\"><\\/span>\\n    <\\/div>\\n  <\\/td>\\n<\\/tr>\",\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"10\"],[\"os\",\"os\",\"os\",\"rfs\",\"rfs\",\"os\",\"os\",\"os\",\"rfs\",\"rfs\"],[\"tcga\",\"scanb\",\"metabric\",\"scanb\",\"metabric\",\"tcga\",\"scanb\",\"metabric\",\"scanb\",\"metabric\"],[\"HALLMARK_ESTROGEN_RESPONSE_EARLY\",\"HALLMARK_ESTROGEN_RESPONSE_EARLY\",\"HALLMARK_ESTROGEN_RESPONSE_EARLY\",\"HALLMARK_ESTROGEN_RESPONSE_EARLY\",\"HALLMARK_ESTROGEN_RESPONSE_EARLY\",\"SET_ERPR\",\"SET_ERPR\",\"SET_ERPR\",\"SET_ERPR\",\"SET_ERPR\"],[1.18623745414308,0.234287743935524,0.580261751375339,1.63932921505999,1.11469561815967,0.950044438085071,0.425196746936248,0.471057753852895,1.49123916799321,0.938261949291275],[0.565400042892431,0.175427990473231,0.176953121226715,0.384168956167539,0.328880702998797,0.30338798304552,0.100475443908163,0.0996531393420884,0.225953210852015,0.183989102732846],[2.09804981279204,1.33552087841578,3.27918347725496,4.26720896819436,3.38936157699635,3.13145045676554,4.23184740865526,4.72697355008408,6.59976975927939,5.09955174167918],[0.0179503726382668,0.09085296330151379,0.0005205396246708691,9.896686814992909e-06,0.000350277842886407,0.0008697256602758821,1.1588982051556e-05,1.13945468307404e-06,2.05898403840867e-11,1.70229397658402e-07],[0.0780737332165093,-0.109544799272244,0.233440006819026,0.886371896993267,0.470101285071816,0.355414917973603,0.228268495545574,0.27574118979605,1.04837901253207,0.577649934387056],[2.29440117506964,0.578120287143292,0.927083495931651,2.39228653312671,1.75928995124753,1.54467395819654,0.622124998326923,0.66637431790974,1.93409932345434,1.29887396419549]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>type_analysis<\\/th>\\n      <th>cohort<\\/th>\\n      <th>term<\\/th>\\n      <th>estimate<\\/th>\\n      <th>std.error<\\/th>\\n      <th>statistic<\\/th>\\n      <th>p.value<\\/th>\\n      <th>conf.low<\\/th>\\n      <th>conf.high<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"scrollX\":true,\"columnDefs\":[{\"targets\":7,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatSignif(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":4,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":5,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":6,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":8,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":9,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"className\":\"dt-right\",\"targets\":[4,5,6,7,8,9]},{\"orderable\":false,\"targets\":0}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false,\"orderCellsTop\":true}},\"evals\":[\"options.columnDefs.0.render\",\"options.columnDefs.1.render\",\"options.columnDefs.2.render\",\"options.columnDefs.3.render\",\"options.columnDefs.4.render\",\"options.columnDefs.5.render\"],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\nAnd when using AFT analysis we see similar results. The estimates are\non their scale ($beta$), meaning that values higher than 0 correspond\nto a slow down in the time to event. In this case here, if the estimate\nis higher than 0, then the time to death or time to recurrence is \nprolonged. In other words, estrogen signaling is associated with\ngood outcome as well.\n\n@fig-forest-plot shows the forest plot of HALLMARK_ESTROGEN_RESPONSE_EARLY for all \nthree cohorts. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![Forest plots of the different cohorts and their hazard ratios. The bars correspond to 95% confidence interval.](surv_analysis_estrogen_files/figure-html/fig-forest-plot-1.png){#fig-forest-plot width=576}\n:::\n:::\n\n\nThe hazard ratios are all below 1 and small for HALLMARK_ESTROGEN_RESPONSE_EARLY.\nThe variability changes depending on the cohort, \nspecially because they have different follow-up times, \nSCANB being the shortest. TCGA has very few number of events and we could\nnot select based on the treatment, the results for TCGA are less reliable.\n\nBelow we show the results for recurrence free survival.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Forest plots of the different cohorts and their hazard ratios. The bars correspond to 95% confidence interval.](surv_analysis_estrogen_files/figure-html/fig-forest-plot-rfs-1.png){#fig-forest-plot-rfs width=576}\n:::\n:::\n\n\nAnd @fig-surv-all-cohorts is a different way of display the same results\nbut only including the hazard ratios of the variables of interest. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![Hazard ratios for estrogen early and SET ER/PR for all the three cohorts of only endocrine treated patients with ER+ BC.](surv_analysis_estrogen_files/figure-html/fig-surv-all-cohorts-1.png){#fig-surv-all-cohorts width=1152}\n:::\n:::\n\n\n## Comparison of ER IHC and molecular ER signaling\n\nThe new released dataset from the SCANB consortium contains the ER \npercentage based on the IHC stainings. This is great, because we can\nnow compare the molecular ER signaling score to what is seen in the clinics.\n\nFirst we start by comparing the molecular score with the percentages \n(@fig-cor-ihc-rna).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Correlation between ER IHC percentage and molecular ER signaling by using the signature HALLMARK_ESTROGEN_RESPONSE_EARLY and SET ER/PR.](surv_analysis_estrogen_files/figure-html/fig-cor-ihc-rna-1.png){#fig-cor-ihc-rna width=1152}\n:::\n:::\n\n\nThe first thing that one can notice is that ER percentage is very discrete,\npathologists probably don't assign non rounded percentage values, which \nmakes sense. Another thing to notice is that for high ER percentage \npatients you have a whole spectrum of molecular ER signaling score.\n\nThe spearman correlation for Estrogen early and ER IHC is:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\n\tSpearman's rank correlation rho\n\ndata:  df_wide$ER.pct and df_wide$HALLMARK_ESTROGEN_RESPONSE_EARLY\nS = 2.4797e+10, p-value < 2.2e-16\nalternative hypothesis: true rho is not equal to 0\nsample estimates:\n     rho \n0.389119 \n```\n:::\n:::\n\n\nFor SET ER/PR is:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\n\tSpearman's rank correlation rho\n\ndata:  df_wide$ER.pct and df_wide$SET_ERPR\nS = 1.9706e+10, p-value < 2.2e-16\nalternative hypothesis: true rho is not equal to 0\nsample estimates:\n      rho \n0.5145412 \n```\n:::\n:::\n\n\nAnd finally for log(ESR1) is:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n\n\tSpearman's rank correlation rho\n\ndata:  df_wide$ER.pct and df_wide$`log2(ESR1)`\nS = 1.7107e+10, p-value < 2.2e-16\nalternative hypothesis: true rho is not equal to 0\nsample estimates:\n      rho \n0.5785603 \n```\n:::\n:::\n\n\nNow we look speficially at the high ER percentage patients and compare\ntheir ER signaling scores. We previously saw that the distribution\nof these scores seems to be wide.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Scores for high ER percentage breast cancer patients.](surv_analysis_estrogen_files/figure-html/fig-scores-high-er-1.png){#fig-scores-high-er width=576}\n:::\n:::\n\n\n@fig-scores-high-er shows how the distributions are not skewed towards\nhigh values only. It looks like there is a step in the SET ER/PR signature,\nwe now compare with the ESR1 values and hallmark estrogen response early.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Correlation between SET ER/PR and other scores.](surv_analysis_estrogen_files/figure-html/fig-seter-others-1.png){#fig-seter-others width=768}\n:::\n:::\n\n\nThere is a highly positive correlation. Also interesting to see that \nESR1 levels are not necessarily highly correlated with high \nSET ER/PR scores. Remember that for ESR1 the scale is \nlogarithmic, so even if the slope is smaller than in the\nhallmark estrogen response early, it might mean a higher correlation\neven..\n\n@fig-er-hist shows the distribution of the ER IHC percentage for the\npatients used in the previous survival analysis for SCANB. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![Histogram of ER IHC percentage of the SCANB samples used for survival analysis](surv_analysis_estrogen_files/figure-html/fig-er-hist-1.png){#fig-er-hist width=672}\n:::\n:::\n\n\nWe see that the majority of the patients actually have already pretty\nhigh percentage. It could be that the results of the overall survival \nanalysis are actually driven by the the low ER percentage patients,\nso we performed the survival analysis only on patients with ER percentage\nequal or higher than 90%. The table below shows the total number of \npatients for each analysis.\n\n\n::: {.cell}\n::: {.cell-output-display}\n`````{=html}\n<table class=\" lightable-classic\" style='font-family: \"Arial Narrow\", \"Source Sans Pro\", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> cohort </th>\n   <th style=\"text-align:right;\"> number_patients </th>\n   <th style=\"text-align:right;\"> nb_events </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> TCGA </td>\n   <td style=\"text-align:right;\"> 684 </td>\n   <td style=\"text-align:right;\"> 73 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SCANB </td>\n   <td style=\"text-align:right;\"> 3169 </td>\n   <td style=\"text-align:right;\"> 544 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> METABRIC </td>\n   <td style=\"text-align:right;\"> 934 </td>\n   <td style=\"text-align:right;\"> 573 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SCANB High ER </td>\n   <td style=\"text-align:right;\"> 2542 </td>\n   <td style=\"text-align:right;\"> 399 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SCANB Low ER </td>\n   <td style=\"text-align:right;\"> 203 </td>\n   <td style=\"text-align:right;\"> 38 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> SCANB High ESR1 </td>\n   <td style=\"text-align:right;\"> 425 </td>\n   <td style=\"text-align:right;\"> 95 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> METABRIC High ESR1 </td>\n   <td style=\"text-align:right;\"> 254 </td>\n   <td style=\"text-align:right;\"> 175 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nThere was a decrease of around 200 patients with 80 events less, so indeed\na lot of those patients with lower ER percentage had died. @fig-er-ihc-survival\nshows the results of the survival analysis when considering the ER IHC \npercentage as a continuous score on SCANB.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Survival analysis using ER IHC percentage as the score instead of the common molecular ER signaling scores](surv_analysis_estrogen_files/figure-html/fig-er-ihc-survival-1.png){#fig-er-ihc-survival width=672}\n:::\n:::\n\n\nWe a very tight confidence interval in this case with a HR very close\nto 1, meaning that for every 1% increase there is a 2% decrease in your \nrisk of dying. The table with the values is shown below.\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"datatables html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-b20ed8fe94406c751c30\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-b20ed8fe94406c751c30\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\"],[\"os\",\"rfs\"],[\"scanb\",\"scanb\"],[\"ER.pct\",\"ER.pct\"],[\"ER.pct\",\"ER.pct\"],[0.989705115325677,0.981124694105821],[0.00419771995258459,0.00566836270485196],[-2.46520578977943,-3.36176764022254],[0.0136934579900821,0.000774452633099724],[0.981595840115819,0.9702849331858771],[0.997881383835366,0.992085553903819],[0.989705115325677,0.981124694105821]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>type_analysis<\\/th>\\n      <th>cohort<\\/th>\\n      <th>score<\\/th>\\n      <th>term<\\/th>\\n      <th>estimate<\\/th>\\n      <th>std.error<\\/th>\\n      <th>statistic<\\/th>\\n      <th>p.value<\\/th>\\n      <th>conf.low<\\/th>\\n      <th>conf.high<\\/th>\\n      <th>HR<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"scrollX\":true,\"columnDefs\":[{\"targets\":5,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatSignif(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":6,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatSignif(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":7,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatSignif(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":8,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatSignif(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":9,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatSignif(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":10,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatSignif(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"targets\":11,\"render\":\"function(data, type, row, meta) {\\n    return type !== 'display' ? data : DTWidget.formatSignif(data, 2, 3, \\\",\\\", \\\".\\\", null);\\n  }\"},{\"className\":\"dt-right\",\"targets\":[5,6,7,8,9,10,11]},{\"orderable\":false,\"targets\":0}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[\"options.columnDefs.0.render\",\"options.columnDefs.1.render\",\"options.columnDefs.2.render\",\"options.columnDefs.3.render\",\"options.columnDefs.4.render\",\"options.columnDefs.5.render\",\"options.columnDefs.6.render\"],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\nNext we selected only patients that had 90% or more ER IHC percentage \nto perform the survival analysis. @fig-er-ihc-high-os shows the results\nfor both the analysis done on ER IHC percentage,  \nHALLMARK_ESTROGEN_RESPONSE_EARLY and SET_ERPR.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Survival analysis using ER IHC percentage, HALLMARK_ESTROGEN_RESPONSE_EARLY and SET_ERPR as the scores. Only patients with 90% or more in the ER IHC were selected.](surv_analysis_estrogen_files/figure-html/fig-er-ihc-high-os-1.png){#fig-er-ihc-high-os width=576}\n:::\n:::\n\n\nWhen performing the survival analysis among the high ER percentage, there is\nno evidence to differentiate between 90 to 100%, but by using the molecular\nscores that fact is still true, showing that perhaps the molecular score\ncould be more sensitive for these patients. \n\nWe can also analyse the recurrence free survival for this cohort \n(@fig-er-ihc-high-rfs).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Survival analysis using ER IHC percentage, HALLMARK_ESTROGEN_RESPONSE_EARLY and SET_ERPR as the scores. Only patients with 90% or more in the ER IHC were selected.](surv_analysis_estrogen_files/figure-html/fig-er-ihc-high-rfs-1.png){#fig-er-ihc-high-rfs width=576}\n:::\n:::\n\n\nThe problem now is that the number of events is much smaller, so the\nconfidence intervals for the estimates will be bigger. We see\nthat for both signatures the HR is way below 1, meaning that \nthe higher the score the better it is for the patient. Also the \nhazard ratio decreased in this case.\n\nAnother way of visualizing as previously is shown below \n(@fig-surv-high-er-ihc-ggplot2).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Hazard ratios for estrogen early and SET ER/PR for all the three cohorts of only endocrine treated patients with ER+ BC.](surv_analysis_estrogen_files/figure-html/fig-surv-high-er-ihc-ggplot2-1.png){#fig-surv-high-er-ihc-ggplot2 width=960}\n:::\n:::\n\n\nTo further validate the ER signaling we partitionate the score in \n4 different categories, low, intermediate, high, ultra high and perform\nthe OS and RFS analysis.\n\nFor SET ER/PR the results are:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvival::coxph(formula = Surv(rfs_months, rfs_status) ~ sig_dich + \n    age + node_stage + tumor_stage, data = df)\n\n                                 coef exp(coef)  se(coef)      z        p\nsig_dichhighERIHC_highERsig -0.843412  0.430240  0.179931 -4.687 2.77e-06\nsig_dichlowERIHC_lowERsig    0.184400  1.202496  0.309776  0.595   0.5517\nsig_dichlowERIHC_highERsig  -0.920174  0.398450  0.518530 -1.775   0.0760\nage                          0.019260  1.019447  0.008289  2.324   0.0201\nnode_stageN1                -0.236426  0.789444  0.215939 -1.095   0.2736\nnode_stageN2and3             1.140900  3.129585  0.255540  4.465 8.02e-06\ntumor_stageT2                0.835757  2.306559  0.185411  4.508 6.56e-06\ntumor_stageT3                0.787449  2.197782  0.386906  2.035   0.0418\n\nLikelihood ratio test=106.7  on 8 df, p=< 2.2e-16\nn= 1953, number of events= 143 \n   (1216 observations deleted due to missingness)\n```\n:::\n:::\n\n\nFor Estrogen early the results are:\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvival::coxph(formula = Surv(rfs_months, rfs_status) ~ sig_dich + \n    age + node_stage + tumor_stage, data = df)\n\n                                 coef exp(coef)  se(coef)      z        p\nsig_dichhighERIHC_highERsig -0.526967  0.590393  0.180072 -2.926  0.00343\nsig_dichlowERIHC_lowERsig    0.630550  1.878643  0.310235  2.032  0.04210\nsig_dichlowERIHC_highERsig  -1.057145  0.347446  0.530040 -1.994  0.04610\nage                          0.017054  1.017200  0.008363  2.039  0.04144\nnode_stageN1                -0.208378  0.811900  0.216655 -0.962  0.33615\nnode_stageN2and3             1.215071  3.370533  0.258466  4.701 2.59e-06\ntumor_stageT2                0.830548  2.294575  0.186152  4.462 8.13e-06\ntumor_stageT3                0.910210  2.484843  0.382392  2.380  0.01730\n\nLikelihood ratio test=99.35  on 8 df, p=< 2.2e-16\nn= 1953, number of events= 143 \n   (1216 observations deleted due to missingness)\n```\n:::\n:::\n\n\nHigh ER sig and high ER IHC have a better outcome than high ER IHC and \nlow ER sig for both signatures.\n\nThe table below shows the number of RFS events for each subgroup in the\nSET ER/PR dichotomization procedure.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n                         rfs_status                            \n            sig_dich              1           2           Total\n  highERIHC_lowERsig 88.04%   (508) 11.96% (69) 100.00%   (577)\n highERIHC_highERsig 95.11% (1,168)  4.89% (60) 100.00% (1,228)\n   lowERIHC_lowERsig 85.39%    (76) 14.61% (13) 100.00%    (89)\n  lowERIHC_highERsig 94.37%    (67)  5.63%  (4) 100.00%    (71)\n```\n:::\n:::\n\n\nNext we show the Kaplan Meier estimate curves for both signatures.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Kaplan-Meier estimate of the categorized SET ER/PR signature](surv_analysis_estrogen_files/figure-html/fig-km-seterpr-1.png){#fig-km-seterpr width=768}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![Kaplan-Meier estimate of the categorized Estrogen early signature](surv_analysis_estrogen_files/figure-html/fig-km-er-early-1.png){#fig-km-er-early width=768}\n:::\n:::\n\n\nIn both cases there is a good distinction between low ER sig/High ER IHC and\nHigh ER sig/Low ER IHC. Interestingly, there the worst group is really the\nlow ER sig/low ER IHC, as expected.\n\nWe can do a similar analysis now using the marginal survival curves\nfrom the package `flexsurv` along with the functions \n`flexsurvspline` and `standsurv`.\n\n\n::: {.cell}\n\n:::\n\n\nFirst we show the marginal RFS curves.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](surv_analysis_estrogen_files/figure-html/fig-rfs-marginal-curve-higher-ihc-1.png){#fig-rfs-marginal-curve-higher-ihc width=768}\n:::\n:::\n\n\nAnd now the marginal curves for the differences.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](surv_analysis_estrogen_files/figure-html/fig-rfs-difference-marginal-curve-higher-ihc-1.png){#fig-rfs-difference-marginal-curve-higher-ihc width=768}\n:::\n:::\n\n\nWe see similar things to the KM as done before. But here now we are \nusing the standardized survival curves.\n\nWe now evaluate the protective effect of the estrogen signaling signatures\nin the patients that have tumors with ER IHC lower than 90%. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![Survival analysis using ER IHC percentage, HALLMARK_ESTROGEN_RESPONSE_EARLY and SET_ERPR as the scores. Only patients with less than 90% in the ER IHC were selected.](surv_analysis_estrogen_files/figure-html/fig-er-ihc-low-rfs-1.png){#fig-er-ihc-low-rfs width=576}\n:::\n:::\n\n\nThe number of patients now is very low, but the effect is still there. \nWhen we look at the survival. Below we show the results for the \noverall survival.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Survival analysis using ER IHC percentage, HALLMARK_ESTROGEN_RESPONSE_EARLY and SET_ERPR as the scores. Only patients with less than 90% in the ER IHC were selected.](surv_analysis_estrogen_files/figure-html/fig-er-ihc-low-os-1.png){#fig-er-ihc-low-os width=576}\n:::\n:::\n\n\nThe hazard ratio is still below 1 but the uncertainty is much \nhigher, probably due to the number of patients and events. \n\nAnother way of evaluating the effect of estrogen signaling and not only\nthe presence of the estrogen receptor protein or the mRNA transcripts, is\nto check the patients whose tumor samples have high expression of ESR1. \nWe can perform such analysis in both METABRIC and SCANB. \n\n\n::: {.cell}\n::: {.cell-output-display}\n![Survival analysis using ER IHC percentage, HALLMARK_ESTROGEN_RESPONSE_EARLY and SET_ERPR as the scores. Only patients with more than 7.5 units of ESR1 in the logFPKM scale were selected.](surv_analysis_estrogen_files/figure-html/fig-er-ihc-highesr1-rfs-1.png){#fig-er-ihc-highesr1-rfs width=672}\n:::\n:::\n\n\nThe number of events is very small but the HR is very small also and confidence\ninterval is far away from 1. And now for METABRIC when we select all patients\nof 3rd quantile and above (median intensity higher than 11.5).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Survival analysis using HALLMARK_ESTROGEN_RESPONSE_EARLY and SET_ERPR as the scores. Only patients with more than 11 units of ESR1 in the log median intensity scale were selected.](surv_analysis_estrogen_files/figure-html/fig-er-ihc-highesr1-rfs-metabric-1.png){#fig-er-ihc-highesr1-rfs-metabric width=576}\n:::\n:::\n\n\nThe variability is way higher but the hazard ratio is still below 1 as \nexpected. In this case probably there are patients that have low score and\ndon't benefit as much from the treatment. @fig-er-signaling-highesr1-metabric\nshows the distribution of ER signaling scores for those patients. We notice\nthat the average is very close to the peak of the distributions.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](surv_analysis_estrogen_files/figure-html/fig-er-signaling-highesr1-metabric-1.png){#fig-er-signaling-highesr1-metabric width=960}\n:::\n:::\n\n\nAnd below for all patients used for the full analysis on METABRIC.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](surv_analysis_estrogen_files/figure-html/fig-er-signaling-all-metabric-1.png){#fig-er-signaling-all-metabric width=960}\n:::\n:::\n\n\n## Conclusion\n\nIn this chapter we've shown that ER+ BC patients are very distinct\nfrom each other, as it can be seen from the umap projections and \nthe subtypes. These patients might respond differently for endocrine therapy\nas well, and this might depend on the ER signaling, how active it is. \nTherefore, when deciding a treatment, more care should be taken with\nER+ BC patients and check their signaling scores somehow. The $SET_{ER/PR}$\nsignature is a good signature showing very good hazard ratios across\nthe different cohorts. This signature has also been validated on the clinics\nfor use.\n\nKnowing the ER signaling for a patient is very important when deciding\ntreatment, but not enough. What could be other alternatives for patients\nthat have low ER signaling and are still considered ER+? Should they use\nonly endocrine therapy or supplement it with something else? In the\nnext chapters we present a framework where we can take a look\nat a more personalised approach for treatments. \n\n",
    "supporting": [
      "surv_analysis_estrogen_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/htmlwidgets-1.6.2/htmlwidgets.js\"></script>\n<link href=\"site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/datatables-binding-0.28/datatables.js\"></script>\n<script src=\"site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"site_libs/dt-core-1.13.4/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"site_libs/dt-core-1.13.4/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/dt-core-1.13.4/js/jquery.dataTables.min.js\"></script>\n<link href=\"site_libs/nouislider-7.0.10/jquery.nouislider.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/nouislider-7.0.10/jquery.nouislider.min.js\"></script>\n<link href=\"site_libs/selectize-0.12.0/selectize.bootstrap3.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/selectize-0.12.0/selectize.min.js\"></script>\n<link href=\"site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}