{
  "hash": "9d3da43f70b488a6d94bd02cd6802707",
  "result": {
    "markdown": "# Risk score model\n\nSeveral risk signatures were developed over the years using transcriptomic\ndatasets. Some examples were given in the previous chapters, such as \nOncotypeDX, Prosigna and EndoPredict. They were all derived in a similar\nmanner, subsetting genes related to usually estrogen and proliferation \nsignaling and then using recurrence free survival data to calculate\nthe risk scores. \n\nIn this chapter we introduce a new risk score that does not subset\ngenes and uses the information of the molecular landscape. The concept\nis simple, we will use the third and fourth components as covariates in\nthe survival modeling along with tumor size and node status. This\nway we avoid subsetting and selecting specific genes and we use all\nthe information the molecular landscape is providing us. Also it avoids\nany kind of binning for patients based on molecular subtype, thus not being\nnecessary calculating correlations with pre-defined molecular subtypes.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\n* The library is already synchronized with the lockfile.\n```\n:::\n:::\n\n\n\nWe develop a risk score for early stage breast cancer patients that \nreceived only endocrine therapy (ET). The idea is similar to what was\ndone with the EndoPredict signatures, but here we extend it by using the\nmolecular landscape information. This provides a full framework where\nwe can analyse the risk of recurrence even for patients that have \nhigh ER+ percentage.\n\n## Generating the risk score\n\nWe focus only on the endocrine treated patients. For the training part\nof the algorithm we use a subset of patients from the METABRIC cohort.\nWe then test the risk scores in the test set and we further validate\nthe score on SCANB. \n\nWe will generate two risk scores: one including only the principal \ncomponents and another one including the clinical features of the \npatients when valiable, namely tumor size, node status and age (either having\none or more lymph node with breast cancer cells or none). \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(pcs_to_use, clin_vars), collapse = \"+\"))), data = training_set)\n\n  n= 556, number of events= 216 \n\n                    coef exp(coef)  se(coef)      z Pr(>|z|)    \nPC3            -0.091540  0.912525  0.027255 -3.359 0.000783 ***\nPC4             0.080512  1.083842  0.022588  3.564 0.000365 ***\ntumor_size      0.021809  1.022049  0.004292  5.082 3.74e-07 ***\nnode_statuspos  0.582681  1.790834  0.147602  3.948 7.89e-05 ***\nage             0.003150  1.003155  0.007030  0.448 0.654061    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n               exp(coef) exp(-coef) lower .95 upper .95\nPC3               0.9125     1.0959    0.8651    0.9626\nPC4               1.0838     0.9226    1.0369    1.1329\ntumor_size        1.0220     0.9784    1.0135    1.0307\nnode_statuspos    1.7908     0.5584    1.3410    2.3916\nage               1.0032     0.9969    0.9894    1.0171\n\nConcordance= 0.676  (se = 0.019 )\nLikelihood ratio test= 66.18  on 5 df,   p=6e-13\nWald test            = 71.92  on 5 df,   p=4e-14\nScore (logrank) test = 72.75  on 5 df,   p=3e-14\n```\n:::\n:::\n\n\nWe see that all coefficients have less variability than age. We still keep\nall the variables when calculating the risk score, since age has a coefficient\nrelatively small we can keep it. \n\nNow we calculate only the risk score based on the components. \n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(pcs_to_use), collapse = \"+\"))), data = training_set)\n\n  n= 556, number of events= 216 \n\n        coef exp(coef) se(coef)      z Pr(>|z|)    \nPC3 -0.08657   0.91707  0.02699 -3.207  0.00134 ** \nPC4  0.09068   1.09492  0.02216  4.091 4.29e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n    exp(coef) exp(-coef) lower .95 upper .95\nPC3    0.9171     1.0904    0.8698    0.9669\nPC4    1.0949     0.9133    1.0484    1.1435\n\nConcordance= 0.626  (se = 0.019 )\nLikelihood ratio test= 22.5  on 2 df,   p=1e-05\nWald test            = 22.49  on 2 df,   p=1e-05\nScore (logrank) test = 22.78  on 2 df,   p=1e-05\n```\n:::\n:::\n\n\nWe see that the coefficients are very similar to what was found before,\nit didn't change much. Also when we include the principal components on the\ntop of the clinical variables the log likelihood increases, which is \na good indication: \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nAnalysis of Deviance Table\n Cox model: response is  Surv(time = rfs_months, event = rfs_status)\n Model 1: ~ tumor_size + node_status + age\n Model 2: ~ PC3 + PC4 + tumor_size + node_status + age\n   loglik Chisq Df P(>|Chi|)    \n1 -1231.1                       \n2 -1221.2 19.88  2 4.821e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n:::\n:::\n\n::: {.cell}\n\n:::\n\n\nNow we use the test set to calculate the score.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvival::coxph(formula = Surv(time = rfs_months, event = rfs_status) ~ \n    risk_score, data = test_set)\n\n  n= 371, number of events= 140 \n\n             coef exp(coef) se(coef)     z Pr(>|z|)    \nrisk_score 0.8632    2.3707   0.1583 5.453 4.96e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n           exp(coef) exp(-coef) lower .95 upper .95\nrisk_score     2.371     0.4218     1.738     3.233\n\nConcordance= 0.655  (se = 0.025 )\nLikelihood ratio test= 28.56  on 1 df,   p=9e-08\nWald test            = 29.73  on 1 df,   p=5e-08\nScore (logrank) test = 29.78  on 1 df,   p=5e-08\n```\n:::\n:::\n\n\nWe see that the higher the risk score the worse it is for the patients \ntreated only with endocrine therapy. \n\n## Validating the risk score on SCANB\n\nWe can now validate the risk score on the SCANB dataset. \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(\"risk_score\"), collapse = \"+\"))), data = endo_only_scanb)\n\n  n= 2829, number of events= 212 \n\n             coef exp(coef) se(coef)     z Pr(>|z|)    \nrisk_score 1.0568    2.8772   0.1001 10.56   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n           exp(coef) exp(-coef) lower .95 upper .95\nrisk_score     2.877     0.3476     2.365     3.501\n\nConcordance= 0.699  (se = 0.02 )\nLikelihood ratio test= 87.08  on 1 df,   p=<2e-16\nWald test            = 111.4  on 1 df,   p=<2e-16\nScore (logrank) test = 108.8  on 1 df,   p=<2e-16\n```\n:::\n:::\n\n\nAgain the risk score is predictive with a high coefficient, meaning\nthat the higher the score the worse it is for the patient. \n\nWe now visualize a bit the risk scores developed here in terms \nof the molecular landscape. @fig-risk-endo-pam50\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Molecular landscape of SCANB patients treated with only endocrine therapy and that have ER+ breast cancer. Only patients with risk score less than 2 are plotted here. There are only 26 patients out of 2829 with risk score higher than 2 that would skew the color scale.](risk_score_files/figure-html/fig-risk-endo-pam50-1.png){#fig-risk-endo-pam50 width=672}\n:::\n:::\n\n\nWe now investigate the risk score among patients that have high ER IHC\npercentage as well. We have seen that these patients have different outcomes\nbased on the molecular estrogen signaling. We now investigate the effect\nof the risk score. \n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n```\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(\"risk_score\"), collapse = \"+\"))), data = endo_only_scanb %>% \n    dplyr::filter(ER.pct >= 90 & risk_score < 2))\n\n  n= 2109, number of events= 153 \n\n             coef exp(coef) se(coef)     z Pr(>|z|)    \nrisk_score 1.1937    3.2994   0.1498 7.967 1.63e-15 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n           exp(coef) exp(-coef) lower .95 upper .95\nrisk_score     3.299     0.3031      2.46     4.426\n\nConcordance= 0.695  (se = 0.023 )\nLikelihood ratio test= 58.92  on 1 df,   p=2e-14\nWald test            = 63.47  on 1 df,   p=2e-15\nScore (logrank) test = 66.98  on 1 df,   p=3e-16\n```\n:::\n:::\n\n\nWe see that the score is still predictive, meaning that even patients\nthat have high ER IHC percentage, there are those with higher risk. Note\nthough that the analysis still is a bit limited due to the followup time\nthat in median is 5.3 \nyears.\n\n## Risk score and POETIC trial\n\nWe can evaluate one of the two risk scores, the one using only the \nprincipal components, in the POETIC trial data. The first question we\ncan address is if there is difference in scores in the baseline tissue \n(@fig-poetic-risk-score).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Risk scores for responders and non-responders in the baseline tumor tissue.](risk_score_files/figure-html/fig-poetic-risk-score-1.png){#fig-poetic-risk-score width=672}\n:::\n:::\n\n\nWe see in the @fig-poetic-risk-score that in average the non responders\nhave higher risk scores. Now if we compare the risk scores between\nbaseline and surgery, the slope of the line that fits for each group\nseparately, responder and non responder, is different. The slope\nfor the non responders is parallel to the identity line going through\nthe origin with a slope of 1, meaning that there is not much change of risk\nupon the treatment. On other hand, for the responder group the slope is\ndecreased and has a value lower than 1, meaning that the risk is decreased\nupon aromatase inhibition after two weeks (@fig-poetic-risk-base-surgery).\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Comparison of risk scores using the PCs only before and after two weeks of aromatase inhibitors in post-menopausal women. The colored lines correspond do the linear regression for each response status group separately.](risk_score_files/figure-html/fig-poetic-risk-base-surgery-1.png){#fig-poetic-risk-base-surgery width=672}\n:::\n:::\n",
    "supporting": [
      "risk_score_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}