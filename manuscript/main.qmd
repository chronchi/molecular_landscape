# Abstract

# Introduction

# Methods

# Results

## Estrogen receptor is a clinical continuous variable

We used three independent breast cancer molecular datasets 
[@Saal2015; @tcgabrca; @Curtis2012] to calculate estrogen signaling scores. 
The estrogen signatures HALLMARK_ESTROGEN_RESPONSE_EARLY and 
HALLMARK_ESTROGEN_RESPONSE_LATE were extracted from the molecular signature
database [@Subramanian2005] and $SET_{ER/PR}$ from [@Sinn2019]. The individual
scores for each patient sample
are shown in @fig-01 (a) for each cohort stratified by
estrogen receptor status. It shows the scores capture the differences
between the two breast cancer subtypes as expected. Moreover, there is a 
wide range of values in the estrogen receptor positive (ER+) subgroup. 

Cox regression was used to determine the hazard ratio of the estrogen signaling
in overall survival (OS) for TCGA, SCANB and METABRIC and
recurrence free survival (RFS) for METABRIC. Each survival analysis was done
independently and adjusted for available clinical variables. Tumor size and
number of lymph nodes were used for TCGA and SCANB cohorts. The Nottingham 
prognostic index (NPI) was used for METABRIC. Age was used in all cohorts 
as a clinical variable for adjustment. Only ER+ BC patients were used and 
when possible only those that received endocrine therapy. 
@fig-01 (b) shows the forest plots for each cohort individually 
when calculating the hazard ratio for the
$SET_{ER/PR}$ estrogen signaling signature. In all the three cases, the 
hazard ratio for $SET_{ER/PR}$ was below 1, with values ranging from 
0.23 to 0.61. There is moderate variability for each hazard ratio. 
This shows the continuous aspect of estrogen receptor status.

```{r}
#| label: fig-01
#| fig-cap: "Scores and survival analysis results from TCGA, SCANB and METABRIC
#|     cohorts. (a) GSVA scores for the SET ER/PR signature for each cohort.
#|     Each point corresponds to a patient sample and they are divided by
#|     estrogen receptor status. (b) Forest plot of the survival analysis
#|     for each cohort separately. NPI: Nottingham prognostic index. 
#|     Ti: i-th stage of tumor. Ni: i lymph nodes with breast cancer cells."
knitr::include_graphics("images/png/figure01.png")
```

## Single sample integration preserves relevant breast cancer properties

Since each patient has a different ER signaling score, we assumed that 
patients should be treated individually, not just binned in two big
subgroups as ER+ and ER-. Therefore, it is important to consider each
patient individually. We developed a single sample
batch effect removal method
(See methods section for the step by step)
to integrate microarray and bulk RNA-seq and create a molecular landscape.
The advantage of the method is that
given a new sample, it can easily be integrated with all the other previous
samples without any retraining. 

The biplot in @fig-02 (a) with the third and fourth
components from TCGA and METABRIC samples shows that the samples are well
integrated. All samples, including those using for training
and validation, are plotted. The third components corresponds
to the separation between ER+ and ER- BC patients in
both cohorts (@fig-02 (b)). A combination of the third and fourth components
shows a good distinction among the PAM50 molecular subtypes (@fig-02 (c)).
The fourth component is mostly dividing the luminal A and luminal B subtypes,
whereas the normal-like subtype is spread across the third and fourth 
component. This also highlights the fact that one cannot interpret the 
PCA locations globally, rather when comparing samples one should consider
only its neighborhood. As pointed out before, ER status should be considered
continuous and not dichotomous, @fig-02 (d) shows a gradient of the 
ER signaling score $SET_{ER/PR}$. The higher values are on the far right
of the third component, going to negative values as one goes from right
to left, i.e., moving from a more ER+ status to the ER-. 

```{r}
#| label: fig-02
#| fig-cap: > 
#|     (a) Biplot using the third and fourth components on TCGA and METABRIC
#|     samples. Colored by cohort. (b) Same as **a**, colored by ER status.
#|     (c) Same as **a**, colored by PAM50 molecular subtype. (d) Hex grid
#|     calculated on the biplot of the fourth and third component. Each hex 
#|     is colored based on its average value of the SET ER/PR signature.
knitr::include_graphics("images/png/figure02.png")
```

## Embedding is robust to missing genes and generalized to a validation cohort

METABRIC and TCGA were used to train and validate the projections. SCANB was
used as an external validation cohort. SCANB is well mixed with both
METABRIC and TCGA samples (@fig-03 (a)). ER+ and ER- BC patients are well
separated (@fig-03 (b)) and the procedure can also distinguish the 
molecular subtypes (@fig-03 (c)). As an RNA-seq cohort, it is expected that
SCANB samples will be closer to TCGA than to METABRIC when removing batch
effects, due to platform biases and initial scale of the genes. Biplot of
PC1 and PC2 (@fig-03 (d)) shows that SCANB is closer to TCGA than to METABRIC.
It is also in between the two cohorts.

In order to check the robustness of the procedure, we redid all the 
pipeline 10 times with 10 random sets of patient samples from TCGA and
METABRIC, simulating a cross validation process.
The PCA embedding is invariant to rotation, translation and reflection 
(@fig-03 (e)). Another problem that arises with publicly available 
datasets, is the fact that there are missing genes. We try to understand
the effect of missing genes in the embedding based on their loading values. 
Ideally if a low amount of genes with high loadings are missing, this should
not affect very much the embedding. On the other hand, the more genes missing
with high loadings, the more it will impact the embedding. We removed 200
genes in total with a varying proportion of top loading genes
(ranging from 0 to 100% in a 5% step). The number of top loading genes 
missing from the dataset is key for the embedding (@fig-03 (f)). The
higher the proportion the less precise the embedding is. 

```{r}
#| label: fig-03
#| fig-cap: > 
#|     Validation of the molecular landscape with an external cohort
#|     (a) Biplot using the third and fourth components and now including
#|     all samples from the three cohorts: TCGA, METABRIC and SCANB.
#|     (b) Same as **a**, colored by ER status. 
#|     (c) Same as **a**, colored by PAM50 molecular subtype.
#|     (d) Biplot using the first and second component of TCGA, METABRIC and
#|     SCANB. 
#|     (e) Embedding of random samples given different training sets for 
#|     PCA. Blue dots correspond to the original embedding of a sample and
#|     red dots correspond to the new embedding given the new training set.
#|     (f) Biplot of all possible embeddings of sample given a certain
#|     proportion of top loadings missing in the dataset.
knitr::include_graphics("images/png/figure03.png")
```

## Molecular landscape is a tool to understand and reveal patient heterogeneity

```{r}
#| label: fig-04
#| fig-cap: > 
#|     Embedding of the POETIC cohort into the molecular landscape and
#|     pathway analysis for patient samples. (a) Biplots of the 
#|     POETIC samples (baseline and surgery) into the molecular landscape.
#|     Left plot is colored by ER status and right plot is colored by
#|     molecular subtype PAM50 when available. 
#|     (b) Biplot highlighting two patients with similar embedding and 
#|     different response status.
#|     (c) Posterior distributions of the average scores in the neighborhood
#|     of the responder patient. Red line corresponds to the patient score.
#|     (d) Posterior distributions of the average scores in the neighborhood
#|     of the **non**-responder patient. 
#|     Red line corresponds to the patient score.

knitr::include_graphics("images/png/figure04.png")
```

# Discussion

# References

::: {#refs}
:::
