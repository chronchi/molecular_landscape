# Abstract

# Introduction

# Methods

## Cohorts

The breast cancer cohorts TCGA, SCANB, METABRIC and POETIC 
[@tcgabrca; @Saal2015; @Curtis2012; @Gao2019]
were used to calculate the PCA embeddings and scores. The samples are of 
primary breast cancer samples from different molecular subtypes and age 
distribution. TCGA was download from Firebrowse, SCANB data was downloaded
from GEO (accession code GSE96058)
using the package GEOquery [@geoquery] in R along the clinical data from the 
https://oncogenomics.bmc.lu.se/MutationExplorer/ website. METABRIC 
was downloaded directly from cBioPortal. POETIC data was downloaded 
from GEO (accession code GSE105777) using the R package GEOquery. 
More details about the download and preprocessing steps are described in 
https://chronchi.github.io/transcriptomics. 

## Selection of highly variable genes

In order to perform the PCA, we sub selected 1000 common and 
highly variable genes
in the TCGA and METABRIC cohorts. For each gene and in each cohort
separately, the standard deviation of that gene was calculated. Then an
average standard deviation was calculated using the formula below.

$$
\text{average sd} = \sqrt{\frac{(sd_{TCGA}^2 + sd_{METABRIC}^2)}{k}}
$$

## qPCR-like normalization

Since samples are coming from different platforms, they need to be
scaled in a way that they are comparable. For this we developed a new way
to scale the data based on the ranking of the samples. Given a list of 44
stable genes across different cancers [@Bhuva2020] and the 1000
genes selected previously, all genes were ranked from lowest to highest
expression for each sample separately and the rankings were divided by 
the average ranking of the stable genes. Stable genes are considered
the housekeeping genes. 

## PCA embedding

Using the normalized data, a total of 1000 random samples
coming from TCGA and METABRIC were selected to perform the initial PCA. 
This is an unsupervised learning method, therefore there is no need to label
the samples with respect to some category. The package PCAtools 
[@Blighe2022] in R was used to perform the PCA and to obtain the loadings for 
downstream analysis. The embedding for new individual samples is obtained
by multiplying the loadings matrix with the normalized data for that sample.
Since the normalization procedure is performed sample-wise, this step is
independent of the number of samples. If there are missing genes in a sample,
the normalization is performed and the missing genes are padded with 0. 

## Scoring strategies

For the 4 big cohorts, TCGA, SCANB, METABRIC and POETIC, GSVA 
[@Hnzelmann2013] was applied along with the $SET_{ER/PR}$ signature 
[@Sinn2019] and the hallmark collection from the molecular signature
database [@Subramanian2005; @Mootha2003]. Default parameters were used
in the `gsva` function from the GSVA package. 

## Average neighborhood scores

In order to calculate the posterior distribution of the average scores
in each neighborhood, a linear regression witho only intercept was
fit using `rstanarm` [@Goodrich2022]. 
The package `tidybayes` [@Kay2022] was used to extract
the draws and put them in a tidy format. 

## Code availability

The code used to generate all the analysis is available on
https://github.com/chronchi/molecular_landscape. Descriptions for 
a docker image to reproduce the analysis are available on the github
repository. An online version with a website containing all the analysis
can be found on 
[https://chronchi.github.io/molecular_landscape](https://chronchi.github.io/molecular_landscape)

# Results

## Estrogen receptor is a clinical continuous variable

We used three independent breast cancer molecular datasets 
[@Saal2015; @tcgabrca; @Curtis2012] to calculate estrogen signaling scores. 
The estrogen signatures HALLMARK_ESTROGEN_RESPONSE_EARLY and 
HALLMARK_ESTROGEN_RESPONSE_LATE were extracted from the molecular signature
database [@Subramanian2005] and $SET_{ER/PR}$ from [@Sinn2019]. The individual
scores for each patient sample
are shown in @fig-01 (a) for each cohort stratified by
estrogen receptor status. It shows the scores capture the differences
between the two breast cancer subtypes as expected. Moreover, there is a 
wide range of values in the estrogen receptor positive (ER+) subgroup. 

Cox regression was used to determine the hazard ratio of the estrogen signaling
in overall survival (OS) for TCGA, SCANB and METABRIC and
recurrence free survival (RFS) for METABRIC. Each survival analysis was done
independently and adjusted for available clinical variables. Tumor size and
number of lymph nodes were used for TCGA and SCANB cohorts. The Nottingham 
prognostic index (NPI) was used for METABRIC. Age was used in all cohorts 
as a clinical variable for adjustment. Only ER+ BC patients were used and 
when possible only those that received endocrine therapy. 
@fig-01 (b) shows the forest plots for each cohort individually 
when calculating the hazard ratio for the
$SET_{ER/PR}$ estrogen signaling signature. In all the three cases, the 
hazard ratio for $SET_{ER/PR}$ was below 1, with values ranging from 
0.23 to 0.61. There is moderate variability for each hazard ratio. 
This shows the continuous aspect of estrogen receptor status.

```{r}
#| label: fig-01
#| fig-cap: "Scores and survival analysis results from TCGA, SCANB and METABRIC
#|     cohorts. (a) GSVA scores for the SET ER/PR signature for each cohort.
#|     Each point corresponds to a patient sample and they are divided by
#|     estrogen receptor status. (b) Forest plot of the survival analysis
#|     for each cohort separately. NPI: Nottingham prognostic index. 
#|     Ti: i-th stage of tumor. Ni: i lymph nodes with breast cancer cells."
knitr::include_graphics("images/png/figure01.png")
```

## Single sample integration preserves relevant breast cancer properties

Since each patient has a different ER signaling score, we assumed that 
patients should be treated individually, not just binned in two big
subgroups as ER+ and ER-. Therefore, it is important to consider each
patient individually. We developed a single sample
batch effect removal method
(See methods section for the step by step)
to integrate microarray and bulk RNA-seq and create a molecular landscape.
The advantage of the method is that
given a new sample, it can easily be integrated with all the other previous
samples without any retraining. 

The biplot in @fig-02 (a) with the third and fourth
components from TCGA and METABRIC samples shows that the samples are well
integrated. All samples, including those using for training
and validation, are plotted. The third components corresponds
to the separation between ER+ and ER- BC patients in
both cohorts (@fig-02 (b)). A combination of the third and fourth components
shows a good distinction among the PAM50 molecular subtypes (@fig-02 (c)).
The fourth component is mostly dividing the luminal A and luminal B subtypes,
whereas the normal-like subtype is spread across the third and fourth 
component. This also highlights the fact that one cannot interpret the 
PCA locations globally, rather when comparing samples one should consider
only its neighborhood. As pointed out before, ER status should be considered
continuous and not dichotomous, @fig-02 (d) shows a gradient of the 
ER signaling score $SET_{ER/PR}$. The higher values are on the far right
of the third component, going to negative values as one goes from right
to left, i.e., moving from a more ER+ status to the ER-. 

```{r}
#| label: fig-02
#| fig-cap: > 
#|     (a) Biplot using the third and fourth components on TCGA and METABRIC
#|     samples. Colored by cohort. (b) Same as **a**, colored by ER status.
#|     (c) Same as **a**, colored by PAM50 molecular subtype. (d) Hex grid
#|     calculated on the biplot of the fourth and third component. Each hex 
#|     is colored based on its average value of the SET ER/PR signature.
knitr::include_graphics("images/png/figure02.png")
```

## Embedding is robust to missing genes and generalized to a validation cohort

METABRIC and TCGA were used to train and validate the projections. SCANB was
used as an external validation cohort. SCANB is well mixed with both
METABRIC and TCGA samples (@fig-03 (a)). ER+ and ER- BC patients are well
separated (@fig-03 (b)) and the procedure can also distinguish the 
molecular subtypes (@fig-03 (c)). As an RNA-seq cohort, it is expected that
SCANB samples will be closer to TCGA than to METABRIC when removing batch
effects, due to platform biases and initial scale of the genes. Biplot of
PC1 and PC2 (@fig-03 (d)) shows that SCANB is closer to TCGA than to METABRIC.
It is also in between the two cohorts.

In order to check the robustness of the procedure, we redid all the 
pipeline 10 times with 10 random sets of patient samples from TCGA and
METABRIC, simulating a cross validation process.
The PCA embedding is invariant to rotation, translation and reflection 
(@fig-03 (e)). Another problem that arises with publicly available 
datasets, is the fact that there are missing genes. We try to understand
the effect of missing genes in the embedding based on their loading values. 
Ideally if a low amount of genes with high loadings are missing, this should
not affect very much the embedding. On the other hand, the more genes missing
with high loadings, the more it will impact the embedding. We removed 200
genes in total with a varying proportion of top loading genes
(ranging from 0 to 100% in a 5% step). The number of top loading genes 
missing from the dataset is key for the embedding (@fig-03 (f)). The
higher the proportion the less precise the embedding is. 

```{r}
#| label: fig-03
#| fig-cap: > 
#|     Validation of the molecular landscape with an external cohort
#|     (a) Biplot using the third and fourth components and now including
#|     all samples from the three cohorts: TCGA, METABRIC and SCANB.
#|     (b) Same as **a**, colored by ER status. 
#|     (c) Same as **a**, colored by PAM50 molecular subtype.
#|     (d) Biplot using the first and second component of TCGA, METABRIC and
#|     SCANB. 
#|     (e) Embedding of random samples given different training sets for 
#|     PCA. Blue dots correspond to the original embedding of a sample and
#|     red dots correspond to the new embedding given the new training set.
#|     (f) Biplot of all possible embeddings of sample given a certain
#|     proportion of top loadings missing in the dataset.
knitr::include_graphics("images/png/figure03.png")
```

## Molecular landscape is a tool to understand and explore patient heterogeneity

Since the molecular landscape relies in a single sample embedding, we can 
add samples from any cohort with relative good data. The POETIC trial 
[@Dowsett2011] was a trial that evaluated the use of perioperative
aromatase inhibitors in ER+, postmenopausal BC patients. Its primary 
endpoint was time to recurrence. 
They sent for microarray hybridization matched samples from baseline
(before treatment) and at surgery (after an average of 14 days of treatment)
[@Gao2019]. There are also untreated patients, used to control for sample
processing artefacts. Moreover, the patients have matched Ki67 percentage levels, 
which can be considered an indication of how well a patient responded to 
the endocrine therapy. Patients with more than 5% of baseline Ki67 and a 
reduction of 60% upon endocrine therapy are considered responders, otherwise
they are called non responders.

The molecular landscape can shed light on the differences between
responders and non responders.
We embedded the POETIC trial samples using the procedure (@fig-04 (a) left). 
The samples are spread across the whole molecular landscape, showing that 
patients indeed have different molecular biological properties. Moreover,
given the available information, the patients that are ER+ and in the
left part of the landscape (ER- patients), are all non responders 
(@fig-04 (a) right). 
This highlights the importance to look more carefully to ER+ patients.
We selected two patients, a responder and non responder that are close
in the embedding (@fig-04 (b)) to highlight their molecular
differences and see what is their context. @fig-04 (c) shows the average 
posterior distribution of the neighborhood for the responder patient. The 
responder patient has a ER signaling score higher than the average. 
On the other hand, the non responder has a smaller ER signaling score
than the average (@fig-04 (d)) and also a higher androgen signaling
score (Androgen response). Other pathways and their average posterior
distributions are shown for both patients.


```{r}
#| label: fig-04
#| fig-cap: > 
#|     Embedding of the POETIC cohort into the molecular landscape and
#|     pathway analysis for patient samples. (a) Biplots of the 
#|     POETIC samples (baseline and surgery) into the molecular landscape.
#|     Left plot is colored by ER status and right plot is colored by
#|     molecular subtype PAM50 when available. 
#|     (b) Biplot highlighting two patients with similar embedding and 
#|     different response status.
#|     (c) Posterior distributions of the average scores in the neighborhood
#|     of the responder patient. Red line corresponds to the patient score.
#|     (d) Posterior distributions of the average scores in the neighborhood
#|     of the **non**-responder patient. 
#|     Red line corresponds to the patient score.

knitr::include_graphics("images/png/figure04.png")
```

# Discussion

Personalized medicine is a key topic in medicine. The goal of better 
understanding the molecular underpinnings of the diseases leads to a better
allocation of treatments and resources in the patient care. We have 
shown here a possible framework to deal with personalized medicine in 
breast cancer in general with a focus on ER+ BC patients. 

In general, estrogen receptor status is considered either a dichotomous or
trichotomous state [@Allison2020]. Breast cancers are classified either in
ER+ or ER- based on their protein expression levels and IHC. For those tumors
that are ER+, they can be subdivided into low ER positive (1\% < IHC\% < 10\%)
and simply ER positive. Those that are into the low ER positive do not 
usually benefit as much on endocrine therapy. Here we show using cox 
regression and multiple
big study cohorts [@tcgabrca; @Curtis2012; @Saal2015] 
with both RNA-seq and microarray data, that ER status is more of a continuous
rather than a categorical state. This can aid in treatment decision 
when evaluating the breast cancer. Several gene signatures already are being
used, such as OncotypeDX, Mammaprint and Prosigna to assign chemotherapy
for those patients with higher risk of recurrence 
[@oncotypedx; @mammaprint; @pam50]. This score might be 
associated with the commercial signatures, as it has been shown that 
OncotypeDX's estrogen module is highly correlated with the signature 
itself [@Buus2021].

Integrating molecular data steaming from different sources is a 
challenge. On one hand batch effect tools are usually
able to remove the batch effects across the different sources of
variability [@Zhang2020; @Risso2014], on the other hand they are not 
single sample based, meaning each time a new sample comes the algorithm runs. 
It is also based on the fact one has enough data in the different datasets,
otherwise it skews the possible integration towards one of the datasets. 
Here we show by using TCGA, METABRIC and SCANB that it is 
possible to integrate the samples from these cohorts in a single sample 
manner. The samples show good mixing when using test samples not seen during
the training stage. The embeddings preserve key molecular features of
breast cancer. PC3 is clearly driven by estrogen signaling where from
right to left there is a gradient of ER positivity. On the other hand,
PC4 is what makes a difference between the molecular subtypes
luminal A and B, which in practice differ by proliferation status in terms
of Ki67 levels [@Arima2018]. 
 
Moreover, the embeddings in a validation set 
preserve the key features of breast cancer. 
Samples are projected by their different PAM50 molecular subtypes and
there is a gradient of estrogen signaling pathway from ER+ BC
towards ER- BC patients. The first two components are the batch effect 
removal components and SCANB is projected closer to TCGA, since both
datasets are RNA-seq. On the other hand, part of the POETIC trial was sequenced
using microarray dataset [@Dowsett2011; @Gao2019], 
and we show that it is projected closer to METABRIC as expected
according to the first two components. 
We also show that the embedding is independent
of the training set and that when changing the training set the embedding
is only rotated or translated, thus not affecting the global
structure of the projection.

Sometimes when dealing with publicly available datasets, not all of the 
genes are available due to ethical [@Saal2015], pre-processing or 
technological reasons. Therefore we showed how robust the projection is to 
missing genes with high loadings in the projection. If less than 20% of the
genes we can recover almost surely the position of the embedding if all the
genes are available. The more genes that are missing, the closer the 
projection will be to the origin, i.e., the (0,0) coordinate in the plane. 

To show the clinical validity of the projection, we used a subset
of patients from the POETIC trial with microarray and clinical information 
[@Gao2019]. The samples are projected as expected and surprisingly the 
samples that are considered to be non responders upon 2 weeks of
aromatase inhibition are projected among the ER- BC patients. When 
looking further upon two different patients that have similar embedding 
but different response to endocrine therapy, we see that the responder
has a higher value of estrogen signaling than the average. On the other hand,
the non responder patient has a smaller estrogen signaling score than
the average, which suggests a possible explanation for the difference in 
response. Moreover, estrogen and androgen receptor signaling have been show
to be tightly linked [@Hickey2021] and these two patients have different
androgen signaling scores. The non responder has a higher score than
the average compared to the responder, whose score is just the same as the
average.

Some weaknesses of the proposed method is that we rely on GSVA scores,
which can be used and compared across different cohorts since they have
a representation of all molecular subtypes. A possible way to circumvent
this problem is by using singscore or stingscore [@Foroutan2018; @Bhuva2020], 
a single sample pathway scorer. There is still a cost barrier for using
RNA-seq dataset in the clinical setting, but efforts are being made to 
reduce costs by using shallow sequencing of multiple samples at the 
same time, such as done by Alithea Genomics.

In conclusion we provide some evidence that ER status should be considered
a continuous marker rather than a categorical one. We also extend this notion
to a framework for personalized medicine, where each patient is embedded in
some context that can be used for the interpretation of its molecular 
underpinnings. In this paper we only discussed some pathways, but when
analysing patient data, several pathways can be considered and should be 
taken into account when deciding tumor treatment. 

# References


::: {#refs}
:::
