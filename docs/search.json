[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "EMBER creates a unified space for independent breast cancer transcriptomic datasets enabling precision oncology.",
    "section": "",
    "text": "Preface\nThese are the scripts and prose used to generate the analysis and images for the manuscript.",
    "crumbs": [
      "Preface"
    ]
  },
  {
    "objectID": "chapters/intro.html",
    "href": "chapters/intro.html",
    "title": "Introduction",
    "section": "",
    "text": "Motivation",
    "crumbs": [
      "Introduction"
    ]
  },
  {
    "objectID": "chapters/intro.html#what-is-currently-know",
    "href": "chapters/intro.html#what-is-currently-know",
    "title": "Introduction",
    "section": "What is currently know",
    "text": "What is currently know",
    "crumbs": [
      "Introduction"
    ]
  },
  {
    "objectID": "chapters/intro.html#problems",
    "href": "chapters/intro.html#problems",
    "title": "Introduction",
    "section": "Problems",
    "text": "Problems",
    "crumbs": [
      "Introduction"
    ]
  },
  {
    "objectID": "chapters/intro.html#how-we-will-tackle-the-problem",
    "href": "chapters/intro.html#how-we-will-tackle-the-problem",
    "title": "Introduction",
    "section": "How we will tackle the problem",
    "text": "How we will tackle the problem",
    "crumbs": [
      "Introduction"
    ]
  },
  {
    "objectID": "chapters/intro.html#description-of-the-cohorts",
    "href": "chapters/intro.html#description-of-the-cohorts",
    "title": "Introduction",
    "section": "Description of the cohorts",
    "text": "Description of the cohorts",
    "crumbs": [
      "Introduction"
    ]
  },
  {
    "objectID": "chapters/surv_analysis_estrogen.html",
    "href": "chapters/surv_analysis_estrogen.html",
    "title": "1  Estrogen receptor status is continuous, not dichotomous",
    "section": "",
    "text": "1.1 Loading and filtering the datasets\nThe preprocessing of the datasets is described in the website below: &gt; https://chronchi.github.io/transcriptomics\nTo check the code used here either click in the code button on the top right part of the page or check the github page (github.com/chronchi/molecular_landscape).\nThe TCGA, METABRIC and SCANB cohorts are used in this section here. They are the biggest cohort of Breast cancer patients in the world. Each datasets has an overall equal distribution of ER+ and ER- patients and similar age distribution.\n* The library is already synchronized with the lockfile.\n\n\n    ../../results/plots/surv_analysis_estrogen \n                                         FALSE \n../../results/rds_files/surv_analysis_estrogen \n                                         FALSE \n   ../../results/tables/surv_analysis_estrogen \n                                         FALSE",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Estrogen receptor status is continuous, not dichotomous</span>"
    ]
  },
  {
    "objectID": "chapters/surv_analysis_estrogen.html#umap-embedding-of-the-datasets",
    "href": "chapters/surv_analysis_estrogen.html#umap-embedding-of-the-datasets",
    "title": "1  Estrogen receptor status is continuous, not dichotomous",
    "section": "1.2 UMAP embedding of the datasets",
    "text": "1.2 UMAP embedding of the datasets\nThe plots below show how each patient is different in a molecular sense, and even inside each molecular subtype there are some differences. We only do the umap of samples that have a molecular subtype assigned.\n\n\n\n\n\n\n\n\nFigure 1.1: UMAP projections of all three cohorts in the following order”:” TCGA, SCANB and METABRIC. They are colored by the PAM50 molecular subtype.\n\n\n\n\n\nFrom the plots above we see a distinction of the different molecular subtypes.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Estrogen receptor status is continuous, not dichotomous</span>"
    ]
  },
  {
    "objectID": "chapters/surv_analysis_estrogen.html#calculating-scores",
    "href": "chapters/surv_analysis_estrogen.html#calculating-scores",
    "title": "1  Estrogen receptor status is continuous, not dichotomous",
    "section": "1.3 Calculating scores",
    "text": "1.3 Calculating scores\nIn order to calculate the scores, the package msigdb is used to load the hallmark data into R. The \\(SET_{ER/PR}\\) is made of the following genes:\n\n\n\n\n\n\nAffy\nID\nis_target\n\n\n\n\n202089_s_at\nSLC39A6\nyes\n\n\n203438_at\nSTC2\nyes\n\n\n204508_s_at\nCA12\nyes\n\n\n205225_at\nESR1\nyes\n\n\n205380_at\nPDZK1\nyes\n\n\n205440_s_at\nNPY1R\nyes\n\n\n205831_at\nCD2\nyes\n\n\n206401_s_at\nMAPT\nyes\n\n\n209123_at\nQDPR\nyes\n\n\n209309_at\nAZGP1\nyes\n\n\n209459_s_at\nABAT\nyes\n\n\n213245_at\nADCY1\nyes\n\n\n213539_at\nCD3D\nyes\n\n\n214440_at\nNAT1\nyes\n\n\n218398_at\nMRPS30\nyes\n\n\n218976_at\nDNAJC12\nyes\n\n\n219197_s_at\nSCUBE2\nyes\n\n\n222379_at\nKCNE4\nyes\n\n\n200650_s_at\nLDHA\nno\n\n\n202961_s_at\nATP5J2\nno\n\n\n211662_s_at\nVDAC2\nno\n\n\n201623_s_at\nDARS\nno\n\n\n205480_s_at\nUGP2\nno\n\n\n217750_s_at\nUBE2Z\nno\n\n\n212175_s_at\nAK2\nno\n\n\n212050_at\nWIPF2\nno\n\n\n202631_s_at\nAPPBP2\nno\n\n\n202342_s_at\nTRIM2\nno\n\n\n\n\n\n\n\n\nThe first 18 genes are considered to be the target genes, the last 10 genes are the genes used for reference. According to their paper, the score is calculated in the following way:\n\\[\nSET_{ER/PR} = \\sum_{i = 1}^{18} \\frac{T_i}{18} - \\sum_{j=1}^{10}\\frac{R_j}{10} + 2\n\\]\nWhere \\(T_i\\) are the expression levels of target genes and \\(R_j\\) are the expression levels of the reference genes. Here we use GSVA to calculate the scores, even when using their genes.\nBefore we calculate any score, let us check the number of genes available for each pathway in each dataset. This is important, in other to have robust scores, most of the genes should be available in the datasets. We also add signatures of 18 and 200 random genes for control.\n\n\n\n\n\n\npathway\ntcga\nscanb\nmetabric\nn\naverage_percentage\n\n\n\n\nHALLMARK_ADIPOGENESIS\n188\n187\n164\n210\n0.86\n\n\nHALLMARK_ALLOGRAFT_REJECTION\n141\n134\n139\n335\n0.41\n\n\nHALLMARK_ANDROGEN_RESPONSE\n93\n92\n83\n102\n0.88\n\n\nHALLMARK_ANGIOGENESIS\n30\n29\n28\n36\n0.81\n\n\nHALLMARK_APICAL_JUNCTION\n155\n148\n151\n231\n0.66\n\n\nHALLMARK_APICAL_SURFACE\n31\n30\n31\n46\n0.67\n\n\nHALLMARK_APOPTOSIS\n141\n141\n130\n183\n0.75\n\n\nHALLMARK_BILE_ACID_METABOLISM\n75\n71\n77\n114\n0.65\n\n\nHALLMARK_CHOLESTEROL_HOMEOSTASIS\n67\n67\n60\n77\n0.84\n\n\nHALLMARK_COAGULATION\n92\n90\n88\n162\n0.56\n\n\nHALLMARK_COMPLEMENT\n152\n149\n144\n237\n0.63\n\n\nHALLMARK_DNA_REPAIR\n145\n144\n127\n170\n0.82\n\n\nHALLMARK_E2F_TARGETS\n196\n179\n174\n218\n0.84\n\n\nHALLMARK_EPITHELIAL_MESENCHYMAL_TRANSITION\n179\n172\n172\n204\n0.85\n\n\nHALLMARK_ESTROGEN_RESPONSE_EARLY\n189\n176\n162\n216\n0.81\n\n\nHALLMARK_ESTROGEN_RESPONSE_LATE\n176\n162\n162\n218\n0.76\n\n\nHALLMARK_FATTY_ACID_METABOLISM\n128\n124\n127\n165\n0.77\n\n\nHALLMARK_G2M_CHECKPOINT\n187\n172\n173\n204\n0.87\n\n\nHALLMARK_GLYCOLYSIS\n173\n167\n167\n215\n0.79\n\n\nHALLMARK_HEDGEHOG_SIGNALING\n24\n21\n25\n36\n0.65\n\n\nHALLMARK_HEME_METABOLISM\n152\n150\n138\n214\n0.69\n\n\nHALLMARK_HYPOXIA\n168\n163\n163\n215\n0.77\n\n\nHALLMARK_IL2_STAT5_SIGNALING\n163\n156\n163\n216\n0.74\n\n\nHALLMARK_IL6_JAK_STAT3_SIGNALING\n65\n62\n63\n103\n0.61\n\n\nHALLMARK_INFLAMMATORY_RESPONSE\n142\n131\n144\n222\n0.63\n\n\nHALLMARK_INTERFERON_ALPHA_RESPONSE\n92\n90\n81\n140\n0.63\n\n\nHALLMARK_INTERFERON_GAMMA_RESPONSE\n178\n176\n164\n286\n0.6\n\n\nHALLMARK_KRAS_SIGNALING_DN\n71\n54\n82\n220\n0.31\n\n\nHALLMARK_KRAS_SIGNALING_UP\n156\n147\n146\n220\n0.68\n\n\nHALLMARK_MITOTIC_SPINDLE\n194\n189\n168\n215\n0.85\n\n\nHALLMARK_MTORC1_SIGNALING\n190\n189\n176\n211\n0.88\n\n\nHALLMARK_MYC_TARGETS_V1\n194\n194\n185\n236\n0.81\n\n\nHALLMARK_MYC_TARGETS_V2\n58\n57\n52\n60\n0.93\n\n\nHALLMARK_MYOGENESIS\n126\n131\n139\n212\n0.62\n\n\nHALLMARK_NOTCH_SIGNALING\n29\n28\n29\n34\n0.84\n\n\nHALLMARK_OXIDATIVE_PHOSPHORYLATION\n199\n185\n169\n220\n0.84\n\n\nHALLMARK_P53_PATHWAY\n177\n172\n160\n215\n0.79\n\n\nHALLMARK_PANCREAS_BETA_CELLS\n14\n13\n17\n44\n0.33\n\n\nHALLMARK_PEROXISOME\n85\n84\n87\n110\n0.78\n\n\nHALLMARK_PI3K_AKT_MTOR_SIGNALING\n91\n91\n84\n118\n0.75\n\n\nHALLMARK_PROTEIN_SECRETION\n94\n92\n90\n98\n0.94\n\n\nHALLMARK_REACTIVE_OXYGEN_SPECIES_PATHWAY\n46\n47\n43\n58\n0.78\n\n\nHALLMARK_SPERMATOGENESIS\n62\n59\n71\n144\n0.44\n\n\nHALLMARK_TGF_BETA_SIGNALING\n49\n50\n45\n59\n0.81\n\n\nHALLMARK_TNFA_SIGNALING_VIA_NFKB\n175\n173\n166\n228\n0.75\n\n\nHALLMARK_UNFOLDED_PROTEIN_RESPONSE\n106\n106\n98\n115\n0.9\n\n\nHALLMARK_UV_RESPONSE_DN\n129\n131\n121\n152\n0.84\n\n\nHALLMARK_UV_RESPONSE_UP\n129\n126\n127\n191\n0.67\n\n\nHALLMARK_WNT_BETA_CATENIN_SIGNALING\n36\n33\n36\n50\n0.7\n\n\nHALLMARK_XENOBIOTIC_METABOLISM\n142\n135\n141\n224\n0.62\n\n\nSET_ERPR\n18\n16\n16\n18\n0.93\n\n\nrandom_200\n156\n131\n148\n200\n0.72\n\n\nrandom_18\n14\n12\n14\n18\n0.74\n\n\n\n\n\n\n\n\nMost of the genes are available in all datasets. When calculating scores it is always good to check the availability of the genes. Otherwise this can make the score unstable, since too many of the genes are missing. For example, HALLMARK_PANCREAS_BETA_CELLS might have an unstable score, due to a lot of genes missing.\nFor each dataset one can plot the differences in scores for ER+ and ER- BC patients. This should be already an indication that the scores are meaningful. The next sections shows the results for each dataset individually.\n\nTCGAMETABRICSCANB\n\n\n\n\n\n\n\n\n\n\nFigure 1.2: Scores for TCGA patients\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 1.3: Scores for METABRIC patients\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 1.4: Scores for SCANB patients\n\n\n\n\n\n\n\n\nFrom the plots above one can conclude that three different estrogen pathways capture the differences between ER status and also molecular subtypes. There are two plots with random genes for control and we can see that there is no difference between the ER status when using those gene sets.\nBelow is a combined image for TCGA, SCANB and METABRIC using the \\(SET_{ER/PR}\\) signature.\n\n\n\n\n\n\n\n\nFigure 1.5: SET ER/PR scores for all three cohorts.\n\n\n\n\n\nAnd now using the hallmark estrogen response early.\n\n\n\n\n\n\n\n\nFigure 1.6: Estrogen early scores for all three cohorts.\n\n\n\n\n\nWe see that there is a considerable overlap between the ER+ and ER- BC samples. For each cohort the numbers of ER+ BC samples that have scores below 0 is shown below:\n\n\n$metabric\n                er_status                \n is_below_0           neg             pos\n         no   6.04%  (20)  64.80%   (869)\n        yes  93.96% (311)  35.20%   (472)\n      Total 100.00% (331) 100.00% (1,341)\n\n$scanb\n                  er_status                \n is_below_0             neg             pos\n         no   3.40%    (36)  48.27% (2,972)\n        yes  96.60% (1,023)  51.73% (3,185)\n      Total 100.00% (1,059) 100.00% (6,157)\n\n$tcga\n                er_status              \n is_below_0           neg           pos\n         no   3.03%   (7)  57.49% (445)\n        yes  96.97% (224)  42.51% (329)\n      Total 100.00% (231) 100.00% (774)\n\n\nAnother way to look at the data is to plot by molecular subtype instead of ER status.\n\nTCGAMETABRICSCANB\n\n\n\n\n\n\n\n\n\n\nFigure 1.7: Scores for TCGA patients stratified by PAM50 molecular subtype\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 1.8: Scores for METABRIC patients stratified by PAM50 molecular subtype\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 1.9: Scores for SCANB patients stratified by PAM50 molecular subtype\n\n\n\n\n\n\n\n\nIn all cohorts the luminal A and B patients have a similar score. Also the distinction is very clear between the basal and HER2-like patients versus luminal A and B.\nOne question that usually arises when calculating scores from gene sets is if proliferation associated genes (PAG) are driving the distinctions. These signatures are highly curated and they have close or no PAGs. Therefore, the scores are not affected by PAGs and they really reflect the biology.\nLastly we show in Figure 1.10 the correlation of the estrogen signaling scores with the signatures.\n\n\n\n\n\n\n\n\nFigure 1.10: Scores for SCANB patients stratified by PAM50 molecular subtype\n\n\n\n\n\nWe see that there is a positive correlation between signatures and scores, the problem though is the high variability in the scores in this case.\nIn the next section we will show how these scores are also prognostic for ER+ BC patients.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Estrogen receptor status is continuous, not dichotomous</span>"
    ]
  },
  {
    "objectID": "chapters/surv_analysis_estrogen.html#survival-analysis",
    "href": "chapters/surv_analysis_estrogen.html#survival-analysis",
    "title": "1  Estrogen receptor status is continuous, not dichotomous",
    "section": "1.4 Survival analysis",
    "text": "1.4 Survival analysis\nSince the scores are continuous variables and they are already scaled due to the output of GSVA, cox regression (Cox 1972) can be used. The advantages of using cox regression is that one can control for other variables. You might ask, why should one control for clinical variables? One of the reasons is because the data being dealt here is observational data. There are several confounders, for example, a score might be up because patients with a higher tumor grade have higher expression of some genes. Thus the score is confounded by the tumor grade and the interpretation changes.\nThere are limitations still when dealing with observational data. A strong hypothesis for performing survival analysis with observational data is that we have measured all the confounder variables. This is pretty strong and in practice we never know if a confounder is missing or not. For a more thorough overview of the causal framework for observational data, check the books (Gelman, Hill, and Vehtari 2020; McElreath 2020).\nAll the cohorts have a different set of clinical variables available. Therefore, the regression will be done by adjusting a different set of variables. Below is the description of the variables used for each cohort.1\n1 This webpage explains with more details the different tumor stages and how BC are classified.\nAge: age is one of the most important factors to adjust, specially in breast cancer. This covariate is used for all cohorts.\nNPI: the Nottingham prognostic index scores each tumor based on tumor grade, tumor size and number of lymph nodes. Only METABRIC has this information.\nTumor Size: as name describes. Only SCANB has this information.\nTumor Stage: tumors are usually described in terms of stage, it reflects the tumor size and location. SCANB and TCGA have this information.\nNode Stage: similar to tumor stage, but encodes the number of lymph nodes where breast cancer cells can be found. SCANB and TCGA have this information.\n\nThus the models we are going to use for the survival analysis of each dataset is shown below.\n\nTCGA: ~ score + age + node_stage + tumor_stage,\nSCANB: ~ score + age + node_stage + tumor_stage,\nMETABRIC: ~ score + age + NPI,\n\nwhere score is one of the scores calculated earlier with GSVA. Note here that since each node stage and tumor stage have sub classifications they will be grouped together, otherwise there will be too many variables with few points. We will also subselect specific tumor stages for TCGA and SCANB, since there are very few patients with tumor stage 4.\nTo be very specific in the survival analysis, only endocrine treated patients should be used in the analysis, as that is what are interested in. METABRIC and SCANB has this kind of annotation, but TCGA not. So the survival analysis on SCANB and METABRIC will be performed on endocrine only treated, ER+ BC patients. On TCGA, to mitigate this effect, we subselect only luminal A and B patients, and we keep in mind that they might have been treated with chemotherapy as well. Moreover, in Sweden the guidelines for BC treatment is to use 10% as the threshold for ER status. Therefore, ER+ BC patients used on SCANB are those that are above the 10% threshold.\nThe table below shows the number of patients for each cohort.\n\n\n\n\n\n\ncohort\nnumber_patients\nnb_events\n\n\n\n\nTCGA\n684\n73\n\n\nTCGA High ER\n216\n7\n\n\nSCANB\n3169\n544\n\n\nMETABRIC\n934\n573\n\n\nSCANB High ER\n2542\n399\n\n\nSCANB Low ER\n203\n38\n\n\nSCANB High ESR1\n425\n95\n\n\nMETABRIC High ESR1\n254\n175\n\n\n\n\n\n\n\n\nThe total number of HER2+ samples in the lists is:\n\n\n\n\n\n\ncohort\nnumber_patients\nher2_positive\n\n\n\n\nSCANB\n3169\n83\n\n\nMETABRIC\n934\n169\n\n\n\n\n\n\n\n\n\n1.4.1 Results\nThe table below shows the results for each analysis performed for a specific term. In order to understand the table the user can filter based on the term, cohort and type of analysis. Since METABRIC has recurrence free survival (RFS) and overall survival (OS), the results for both analysis are presented here.\n\n\n\n\n\n\nThe table above shows that \\(SET_{ER/PR}\\) had a small hazard ratio (&lt; 1) in all 4 analysis performed. Moreover, for all cases where a measure of estrogen signaling was used, the hazard ratio was below 1, indicating that the higher the score, the less likely the patient is to suffer the event in a specific timepoint. This indicates that ER signaling is actually something continuous and not dichotomous.\nNot only that but we also performed Accelerated Failure Time (AFT) survival analysis with a log-normal distribution as our parametric distribution to model time. The results are shown in the table below.\n\n\n\n\n\n\nAnd when using AFT analysis we see similar results. The estimates are on their scale (\\(beta\\)), meaning that values higher than 0 correspond to a slow down in the time to event. In this case here, if the estimate is higher than 0, then the time to death or time to recurrence is prolonged. In other words, estrogen signaling is associated with good outcome as well.\nFigure 1.11 shows the forest plot of HALLMARK_ESTROGEN_RESPONSE_EARLY for all three cohorts.\n\n\n\n\n\n\n\n\nFigure 1.11: Forest plots of the different cohorts and their hazard ratios. The bars correspond to 95% confidence interval.\n\n\n\n\n\nThe hazard ratios are all below 1 and small for HALLMARK_ESTROGEN_RESPONSE_EARLY. The variability changes depending on the cohort, specially because they have different follow-up times, SCANB being the shortest. TCGA has very few number of events and we could not select based on the treatment, the results for TCGA are less reliable.\nBelow we show the results for recurrence free survival.\n\n\n\n\n\n\n\n\nFigure 1.12: Forest plots of the different cohorts and their hazard ratios. The bars correspond to 95% confidence interval.\n\n\n\n\n\nAnd Figure 1.13 is a different way of display the same results but only including the hazard ratios of the variables of interest.\n\n\n\n\n\n\n\n\nFigure 1.13: Hazard ratios for estrogen early and SET ER/PR for all the three cohorts of only endocrine treated patients with ER+ BC.\n\n\n\n\n\nAnd now including only SCANB and METABRIC using the HER2- samples only.\n\n\n\n\n\n\n\n\nFigure 1.14: Hazard ratios for estrogen early and SET ER/PR for all the three cohorts of only endocrine treated patients with ER+ HER2- BC.\n\n\n\n\n\n\n\n\n    Pearson's product-moment correlation\n\ndata:  colData(datasets$scanb)[scanb_samples_her2_neg, \"HALLMARK_ESTROGEN_RESPONSE_EARLY\"] and colData(datasets$scanb)[scanb_samples_her2_neg, \"SET_ERPR\"]\nt = 30.347, df = 3034, p-value &lt; 2.2e-16\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n 0.4547881 0.5093842\nsample estimates:\n      cor \n0.4825548 \n\n\n\n\n\n    Pearson's product-moment correlation\n\ndata:  colData(datasets$metabric)[metabric_samples_her2_neg, \"HALLMARK_ESTROGEN_RESPONSE_EARLY\"] and colData(datasets$metabric)[metabric_samples_her2_neg, \"SET_ERPR\"]\nt = 22.125, df = 763, p-value &lt; 2.2e-16\nalternative hypothesis: true correlation is not equal to 0\n95 percent confidence interval:\n 0.5799848 0.6665138\nsample estimates:\n      cor \n0.6251665",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Estrogen receptor status is continuous, not dichotomous</span>"
    ]
  },
  {
    "objectID": "chapters/surv_analysis_estrogen.html#comparison-of-er-ihc-and-molecular-er-signaling",
    "href": "chapters/surv_analysis_estrogen.html#comparison-of-er-ihc-and-molecular-er-signaling",
    "title": "1  Estrogen receptor status is continuous, not dichotomous",
    "section": "1.5 Comparison of ER IHC and molecular ER signaling",
    "text": "1.5 Comparison of ER IHC and molecular ER signaling\nThe new released dataset from the SCANB consortium contains the ER percentage based on the IHC stainings. This is great, because we can now compare the molecular ER signaling score to what is seen in the clinics.\nFirst we start by comparing the molecular score with the percentages (Figure 1.15).\n\n\n\n\n\n\n\n\nFigure 1.15: Correlation between ER IHC percentage and molecular ER signaling by using the signature HALLMARK_ESTROGEN_RESPONSE_EARLY and SET ER/PR.\n\n\n\n\n\nThe first thing that one can notice is that ER percentage is very discrete, pathologists probably don’t assign non rounded percentage values, which makes sense. Another thing to notice is that for high ER percentage patients you have a whole spectrum of molecular ER signaling score.\nThe spearman correlation for Estrogen early and ER IHC is:\n\n\n\n    Spearman's rank correlation rho\n\ndata:  df_wide$ER.pct and df_wide$HALLMARK_ESTROGEN_RESPONSE_EARLY\nS = 2.4797e+10, p-value &lt; 2.2e-16\nalternative hypothesis: true rho is not equal to 0\nsample estimates:\n     rho \n0.389119 \n\n\nFor SET ER/PR is:\n\n\n\n    Spearman's rank correlation rho\n\ndata:  df_wide$ER.pct and df_wide$SET_ERPR\nS = 1.9706e+10, p-value &lt; 2.2e-16\nalternative hypothesis: true rho is not equal to 0\nsample estimates:\n      rho \n0.5145412 \n\n\nAnd finally for log(ESR1) is:\n\n\n\n    Spearman's rank correlation rho\n\ndata:  df_wide$ER.pct and df_wide$`log2(ESR1)`\nS = 1.7107e+10, p-value &lt; 2.2e-16\nalternative hypothesis: true rho is not equal to 0\nsample estimates:\n      rho \n0.5785603 \n\n\nNow we look speficially at the high ER percentage patients and compare their ER signaling scores. We previously saw that the distribution of these scores seems to be wide.\n\n\n\n\n\n\n\n\nFigure 1.16: Scores for high ER percentage breast cancer patients.\n\n\n\n\n\nFigure 1.16 shows how the distributions are not skewed towards high values only. It looks like there is a step in the SET ER/PR signature, we now compare with the ESR1 values and hallmark estrogen response early.\n\n\n\n\n\n\n\n\nFigure 1.17: Scores for high ER percentage breast cancer patients.\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 1.18: Correlation between SET ER/PR and other scores.\n\n\n\n\n\nThere is a highly positive correlation. Also interesting to see that ESR1 levels are not necessarily highly correlated with high SET ER/PR scores. Remember that for ESR1 the scale is logarithmic, so even if the slope is smaller than in the hallmark estrogen response early, it might mean a higher correlation even.\nFigure 1.19 shows the distribution of the ER IHC percentage for the patients used in the previous survival analysis for SCANB.\n\n\n\n\n\n\n\n\nFigure 1.19: Histogram of ER IHC percentage of the SCANB samples used for survival analysis\n\n\n\n\n\nWe see that the majority of the patients actually have already pretty high percentage. It could be that the results of the overall survival analysis are actually driven by the the low ER percentage patients, so we performed the survival analysis only on patients with ER percentage equal or higher than 90%. The table below shows the total number of patients for each analysis.\n\n\n\n\n\n\ncohort\nnumber_patients\nnb_events\n\n\n\n\nTCGA\n684\n73\n\n\nTCGA High ER\n216\n7\n\n\nSCANB\n3169\n544\n\n\nMETABRIC\n934\n573\n\n\nSCANB High ER\n2542\n399\n\n\nSCANB Low ER\n203\n38\n\n\nSCANB High ESR1\n425\n95\n\n\nMETABRIC High ESR1\n254\n175\n\n\n\n\n\n\n\n\nThere was a decrease of around 200 patients with 80 events less, so indeed a lot of those patients with lower ER percentage had died. Figure 1.20 shows the results of the survival analysis when considering the ER IHC percentage as a continuous score on SCANB.\n\n\n\n\n\n\n\n\nFigure 1.20: Survival analysis using ER IHC percentage as the score instead of the common molecular ER signaling scores\n\n\n\n\n\nWe a very tight confidence interval in this case with a HR very close to 1, meaning that for every 1% increase there is a 2% decrease in your risk of dying. The table with the values is shown below.\n\n\n\n\n\n\nNext we selected only patients that had 90% or more ER IHC percentage to perform the survival analysis. Figure 1.21 shows the results for both the analysis done on ER IHC percentage,\nHALLMARK_ESTROGEN_RESPONSE_EARLY and SET_ERPR.\n\n\n\n\n\n\n\n\nFigure 1.21: Survival analysis using ER IHC percentage, HALLMARK_ESTROGEN_RESPONSE_EARLY and SET_ERPR as the scores. Only patients with 90% or more in the ER IHC were selected.\n\n\n\n\n\nWhen performing the survival analysis among the high ER percentage, there is no evidence to differentiate between 90 to 100%, but by using the molecular scores that fact is still true, showing that perhaps the molecular score could be more sensitive for these patients.\nWe can also analyse the recurrence free survival for this cohort (Figure 1.22).\n\n\n\n\n\n\n\n\nFigure 1.22: Survival analysis using ER IHC percentage, HALLMARK_ESTROGEN_RESPONSE_EARLY and SET_ERPR as the scores. Only patients with 90% or more in the ER IHC were selected.\n\n\n\n\n\nThe problem now is that the number of events is much smaller, so the confidence intervals for the estimates will be bigger. We see that for both signatures the HR is way below 1, meaning that the higher the score the better it is for the patient. Also the hazard ratio decreased in this case.\nAnother way of visualizing as previously is shown below (Figure 1.23).\n\n\n\n\n\n\n\n\nFigure 1.23: Hazard ratios for estrogen early and SET ER/PR for all the three cohorts of only endocrine treated patients with ER+ BC.\n\n\n\n\n\nTo further validate the ER signaling we partitionate the score in 4 different categories, low, intermediate, high, ultra high and perform the OS and RFS analysis.\nFor SET ER/PR the results are:\n\n\nCall:\nsurvival::coxph(formula = Surv(rfs_months, rfs_status) ~ sig_dich + \n    age + node_stage + tumor_stage, data = df)\n\n                                 coef exp(coef)  se(coef)      z        p\nsig_dichhighERIHC_highERsig -0.843412  0.430240  0.179931 -4.687 2.77e-06\nsig_dichlowERIHC_lowERsig    0.184400  1.202496  0.309776  0.595   0.5517\nsig_dichlowERIHC_highERsig  -0.920174  0.398450  0.518530 -1.775   0.0760\nage                          0.019260  1.019447  0.008289  2.324   0.0201\nnode_stageN1                -0.236426  0.789444  0.215939 -1.095   0.2736\nnode_stageN2and3             1.140900  3.129585  0.255540  4.465 8.02e-06\ntumor_stageT2                0.835757  2.306559  0.185411  4.508 6.56e-06\ntumor_stageT3                0.787449  2.197782  0.386906  2.035   0.0418\n\nLikelihood ratio test=106.7  on 8 df, p=&lt; 2.2e-16\nn= 1953, number of events= 143 \n   (1216 observations deleted due to missingness)\n\n\nFor Estrogen early the results are:\n\n\nCall:\nsurvival::coxph(formula = Surv(rfs_months, rfs_status) ~ sig_dich + \n    age + node_stage + tumor_stage, data = df)\n\n                                 coef exp(coef)  se(coef)      z        p\nsig_dichhighERIHC_highERsig -0.526967  0.590393  0.180072 -2.926  0.00343\nsig_dichlowERIHC_lowERsig    0.630550  1.878643  0.310235  2.032  0.04210\nsig_dichlowERIHC_highERsig  -1.057145  0.347446  0.530040 -1.994  0.04610\nage                          0.017054  1.017200  0.008363  2.039  0.04144\nnode_stageN1                -0.208378  0.811900  0.216655 -0.962  0.33615\nnode_stageN2and3             1.215071  3.370533  0.258466  4.701 2.59e-06\ntumor_stageT2                0.830548  2.294575  0.186152  4.462 8.13e-06\ntumor_stageT3                0.910210  2.484843  0.382392  2.380  0.01730\n\nLikelihood ratio test=99.35  on 8 df, p=&lt; 2.2e-16\nn= 1953, number of events= 143 \n   (1216 observations deleted due to missingness)\n\n\nHigh ER sig and high ER IHC have a better outcome than high ER IHC and low ER sig for both signatures.\nThe table below shows the number of RFS events for each subgroup in the SET ER/PR dichotomization procedure.\n\n\n                         rfs_status                            \n            sig_dich              1           2           Total\n  highERIHC_lowERsig 88.04%   (508) 11.96% (69) 100.00%   (577)\n highERIHC_highERsig 95.11% (1,168)  4.89% (60) 100.00% (1,228)\n   lowERIHC_lowERsig 85.39%    (76) 14.61% (13) 100.00%    (89)\n  lowERIHC_highERsig 94.37%    (67)  5.63%  (4) 100.00%    (71)\n\n\nNext we show the Kaplan Meier estimate curves for both signatures.\n\n\n\n\n\n\n\n\nFigure 1.24: Kaplan-Meier estimate of the categorized SET ER/PR signature\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 1.25: Kaplan-Meier estimate of the categorized Estrogen early signature\n\n\n\n\n\nIn both cases there is a good distinction between low ER sig/High ER IHC and High ER sig/Low ER IHC. Interestingly, there the worst group is really the low ER sig/low ER IHC, as expected.\nWe can do a similar analysis now using the marginal survival curves from the package flexsurv along with the functions flexsurvspline and standsurv.\nFirst we show the marginal RFS curves.\n\n\n\n\n\n\n\n\nFigure 1.26\n\n\n\n\n\nAnd now the marginal curves for the differences.\n\n\n\n\n\n\n\n\nFigure 1.27\n\n\n\n\n\nWe see similar things to the KM as done before. But here now we are using the standardized survival curves.\nWe now evaluate the protective effect of the estrogen signaling signatures in the patients that have tumors with ER IHC lower than 90%.\n\n\n\n\n\n\n\n\nFigure 1.28: Survival analysis using ER IHC percentage, HALLMARK_ESTROGEN_RESPONSE_EARLY and SET_ERPR as the scores. Only patients with less than 90% in the ER IHC were selected.\n\n\n\n\n\nThe number of patients now is very low, but the effect is still there. When we look at the survival. Below we show the results for the overall survival.\n\n\n\n\n\n\n\n\nFigure 1.29: Survival analysis using ER IHC percentage, HALLMARK_ESTROGEN_RESPONSE_EARLY and SET_ERPR as the scores. Only patients with less than 90% in the ER IHC were selected.\n\n\n\n\n\nThe hazard ratio is still below 1 but the uncertainty is much higher, probably due to the number of patients and events.\nAnother way of evaluating the effect of estrogen signaling and not only the presence of the estrogen receptor protein or the mRNA transcripts, is to check the patients whose tumor samples have high expression of ESR1. We can perform such analysis in both METABRIC and SCANB.\n\n\n\n\n\n\n\n\nFigure 1.30: Survival analysis using ER IHC percentage, HALLMARK_ESTROGEN_RESPONSE_EARLY and SET_ERPR as the scores. Only patients with more than 7.5 units of ESR1 in the logFPKM scale were selected.\n\n\n\n\n\nThe number of events is very small but the HR is very small also and confidence interval is far away from 1. And now for METABRIC when we select all patients of 3rd quantile and above (median intensity higher than 11.5).\n\n\n\n\n\n\n\n\nFigure 1.31: Survival analysis using HALLMARK_ESTROGEN_RESPONSE_EARLY and SET_ERPR as the scores. Only patients with more than 11 units of ESR1 in the log median intensity scale were selected.\n\n\n\n\n\nThe variability is way higher but the hazard ratio is still below 1 as expected. In this case probably there are patients that have low score and don’t benefit as much from the treatment. Figure 1.32 shows the distribution of ER signaling scores for those patients. We notice that the average is very close to the peak of the distributions.\n\n\n\n\n\n\n\n\nFigure 1.32\n\n\n\n\n\nAnd below for all patients used for the full analysis on METABRIC.\n\n\n\n\n\n\n\n\nFigure 1.33",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Estrogen receptor status is continuous, not dichotomous</span>"
    ]
  },
  {
    "objectID": "chapters/surv_analysis_estrogen.html#conclusion",
    "href": "chapters/surv_analysis_estrogen.html#conclusion",
    "title": "1  Estrogen receptor status is continuous, not dichotomous",
    "section": "1.6 Conclusion",
    "text": "1.6 Conclusion\nIn this chapter we’ve shown that ER+ BC patients are very distinct from each other, as it can be seen from the umap projections and the subtypes. These patients might respond differently for endocrine therapy as well, and this might depend on the ER signaling, how active it is. Therefore, when deciding a treatment, more care should be taken with ER+ BC patients and check their signaling scores somehow. The \\(SET_{ER/PR}\\) signature is a good signature showing very good hazard ratios across the different cohorts. This signature has also been validated on the clinics for use.\nKnowing the ER signaling for a patient is very important when deciding treatment, but not enough. What could be other alternatives for patients that have low ER signaling and are still considered ER+? Should they use only endocrine therapy or supplement it with something else? In the next chapters we present a framework where we can take a look at a more personalised approach for treatments.\n\n\n\n\n\n\nCox, D. R. 1972. “Regression Models and Life-Tables.” Journal of the Royal Statistical Society: Series B (Methodological) 34 (2): 187–202. https://doi.org/10.1111/j.2517-6161.1972.tb00899.x.\n\n\nGelman, Andrew, Jennifer Hill, and Aki Vehtari. 2020. Regression and Other Stories. Analytical Methods for Social Research. Cambridge, England: Cambridge University Press.\n\n\nHänzelmann, Sonja, Robert Castelo, and Justin Guinney. 2013. “GSVA: Gene Set Variation Analysis for Microarray and RNA-Seq Data.” BMC Bioinformatics 14 (1). https://doi.org/10.1186/1471-2105-14-7.\n\n\nMcElreath, Richard. 2020. Statistical Rethinking. 2nd ed. Chapman & Hall/CRC Texts in Statistical Science. London, England: CRC Press.\n\n\nSinn, Bruno V., Chunxiao Fu, Rosanna Lau, Jennifer Litton, Tsung-Heng Tsai, Rashmi Murthy, Alda Tam, et al. 2019. “SETER/PR: A Robust 18-Gene Predictor for Sensitivity to Endocrine Therapy for Metastatic Breast Cancer.” Npj Breast Cancer 5 (1). https://doi.org/10.1038/s41523-019-0111-0.\n\n\nSubramanian, Aravind, Pablo Tamayo, Vamsi K. Mootha, Sayan Mukherjee, Benjamin L. Ebert, Michael A. Gillette, Amanda Paulovich, et al. 2005. “Gene Set Enrichment Analysis: A Knowledge-Based Approach for Interpreting Genome-Wide Expression Profiles.” Proceedings of the National Academy of Sciences 102 (43): 15545–50. https://doi.org/10.1073/pnas.0506580102.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Estrogen receptor status is continuous, not dichotomous</span>"
    ]
  },
  {
    "objectID": "chapters/pca_merging.html",
    "href": "chapters/pca_merging.html",
    "title": "2  A new framework for personalized medicine: integrating",
    "section": "",
    "text": "2.1 Transcriptomics and qPCR normalization\nIn this first step we introduce a new normalization. The rational is that we need a normalization procedure that is applied in a single sample only, similar to logCPM, but that can be applied to microarray too. In this case, given a set of samples, we start by ranking the genes in each sample. We then normalize the ranking to be between 0 and 1, i.e., we divide by the total number of genes available in that sample. Then, given a list of 50 stable genes across cancer (Bhuva, Cursons, and Davis 2020), we calculate the average ranking of these genes in the sample and then for each gene in the sample we divide by this average.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>A new framework for personalized medicine: integrating</span>"
    ]
  },
  {
    "objectID": "chapters/pca_merging.html#transcriptomics-and-qpcr-normalization",
    "href": "chapters/pca_merging.html#transcriptomics-and-qpcr-normalization",
    "title": "2  A new framework for personalized medicine: integrating",
    "section": "",
    "text": "2.1.1 Selecting stable genes\nThe first step is to check what number of these 50 genes are available on TCGA and METABRIC, as these datasets will be used for training the PCA projection. The total number of available genes is 44. Table 2.1 shows the name of the genes available in TCGA and METABRIC.\nNow we select the 1000 most variable genes across METABRIC and TCGA. Reducing the number of genes used when calculating the PCA helps in the future. Several publicly available datasets don’t have many genes available, therefore reducing the number of genes increases the chances of using this approach in other datasets.\nMoreover, the use of a large number of genes is used because if some of them are not available. We show in later sections that if some number of stable genes are missing, it will not affect the normalization.\n\n\n\n\n\n\n\n\nFigure 2.1: (Table 2.1) Available stable genes in both TCGA and METABRIC cohorts.\n\n\n\n\n\n\n2.1.2 Calculating the normalization\nWe will create subset of the summarised experiment objects to save these information. Moreover, since a summarized experiment object is being used, we can save the new normalization in the assays and the average ranking scores of the housekeeping genes in the column data colData. This way it is very easy to retrieve the information for the patients.\n\n\n\n\n\n\n\n\nFigure 2.2: Comparison of coefficient of variation and standard deviation scores.\n\n\n\n\n\nThey are highly correlated values, so we stick to the coefficient of variation as it makes more sense in this kind of analysis.\nTable 2.3 shows the top 1000 genes along with their standard deviation. The stable genes are also added to the list.\n\n\n\n\n\n\n\n\nFigure 2.3: (Table 2.3) Standard deviation of each gene in each condition and pooled standard deviation.\n\n\n\n\nOverall we can see that housekeeping genes have very low standard deviation across cohorts, which is good.\nFigure 2.4 shows a histogram with the distribution of the average ranking of the housekeeping genes for each sample in each cohort.\n\n\n\n\n\n\n\n\nFigure 2.4: Distribution of the average ranking of the housekeeping genes defined previously for each cohort separately.\n\n\n\n\n\nThe average ranking are somewhat similar. For the two experiments where there are RNA-seq samples, the distribution is the same. For METABRIC, a microarray experiment, the distribution is shifted a bit below.\n\n\n\n\n\n\n\n\nFigure 2.5: Distribution of the average ranking of the housekeeping genes defined previously for each cohort separately.\n\n\n\n\n\nFigure 2.6 shows histograms of gene expression from some important genes in breast cancer.\n\n\n\n\n\n\n\n\nFigure 2.6: Distribution of the gene expression levels of ESR1 and TFF1 in each one of the cohorts\n\n\n\n\n\nESR1 and TFF1 expressions are divided across ER status, as expected.\n\n\n\n\n\n\n\n\nFigure 2.7: Distribution of the gene expression levels of ESR1 and TFF1 in each one of the cohorts\n\n\n\n\n\nThe numbers of samples available for each cohort are shown in the table below.\n\n\n   cohort      Negative      Positive         Total\n METABRIC  4.3%   (429) 14.3% (1,439) 18.5% (1,868)\n   SCAN-B 10.5% (1,059) 61.0% (6,157) 71.5% (7,216)\n     TCGA  2.3%   (231)  7.7%   (774) 10.0% (1,005)\n\n\n\n\n2.1.3 Checking robustness with respect of number of stable genes available\nWhen calculating the normalized data, a total of 44 stable genes were used. Sometimes not all of these genes are available, therefore we will calculate the normalization using random subsets of 44 stable genes with different random sizes. The sets will have a minimum of 20 genes and maximum of 44. The sampling of the set size is obtained by using a uniform distribution. We focus just on TCGA for simplicity. The correlation used in this case was the Pearson correlation.\n\n\n\n\n\n\n\n\nFigure 2.8: Correlation distribution for different subsets of housekeeping genes (HKGs). Each different subset has a different number of HKGs.\n\n\n\n\n\nFigure 2.8 shows the different distributions given the subsets of housekeeping genes. All the correlation coefficients are close to 1. This means that if a subset of housekeeping genes are missing it is fine, as the others will compensate.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 2.9",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>A new framework for personalized medicine: integrating</span>"
    ]
  },
  {
    "objectID": "chapters/pca_merging.html#integrating-tcga-and-metabric-using-pca",
    "href": "chapters/pca_merging.html#integrating-tcga-and-metabric-using-pca",
    "title": "2  A new framework for personalized medicine: integrating",
    "section": "2.2 Integrating TCGA and METABRIC using PCA",
    "text": "2.2 Integrating TCGA and METABRIC using PCA\nThe next step is creating the framework where we can integrate any patient sample and compare each other, at least spatially. The approach is similar to some sort of unsupervised learning, where no labels or groups are specified, which is something common in algorithms for batch removal. By using PCA in some subset of TCGA and METABRIC, we should learn the idiosyncrasies of the RNA-seq and microarray technologies as well as batch effects general to datasets. Since these two cohorts are big ones, we assume that if there are common batch effects, they are represented on them.\nThe practical steps are: first subselect 1000 samples in total from METABRIC and TCGA. Train PCA using these 1000 samples. Validate the results by projecting the other samples. In the next section we show how robust the approach is when selecting the samples. In the next chapters we validate the projection in unseen cohorts.\nIntegrating as laid out here only uses molecular data, therefore patients might be close to each other but they might have very different clinical features. This should always be kept in mind.\nThe table below shows the molecular characteristics of the patients selected for the PCA training.\n\n\n\n\n\n\ncohort\nbasal\nher2\nlumb\nluma\nnormal\nclaudin-low\nTotal\n\n\n\n\nmetabric\n7.3% (73)\n7.4% (74)\n16.3% (163)\n22.4% (224)\n4.6% (46)\n6.8% (68)\n64.8% (648)\n\n\ntcga\n7.0% (70)\n2.8% (28)\n6.1% (61)\n17.7% (177)\n1.6% (16)\n0.0% (0)\n35.2% (352)\n\n\nTotal\n14.3% (143)\n10.2% (102)\n22.4% (224)\n40.1% (401)\n6.2% (62)\n6.8% (68)\n100.0% (1,000)\n\n\n\n\n\n\n\n\nFigure 2.10 shows the embedding of the two datasets together of the 1000 samples used for training. We select several PCs of interest to show how the embedding works.\n\n\n\n\n\n\n\n\nFigure 2.10: PCA projections colored by different factors and organized by different components. (A) Plot of the first two components colored by cohort. (B) Plot of the first two components colored by ER status. (C) Plot of the second and third components colored by cohort. (D) Plot of the second and third components colored by ER status. (E) Plot of the second and third components colored by PAM50. (F) Plot of the second and third components colored by INTCLUST, only METABRIC has an assigned value for this variable, NAs are TCGA samples.\n\n\n\n\n\nThe first three components correspond to the batch effect. The third component explains the ER status and the two cohorts are well inter mingled. When plotting the third and fourth components and coloring by the molecular subtype, we see a clear distinction, recapitulating the biology.\nThe plot below shows how the loadings of the first component are really concentrated around zero, so there are not actually specific genes that are accounting for the batch effects we see in the first component. We show latter that the genes that are the most important are the ones with high loading, so the tail of the distributions. In this sense there are really no genes in the tail of the loadings for PC1.\n\n\n\n\n\n\n\n\nFigure 2.11: Different loadings for the first 4 components.\n\n\n\n\n\nFigure 2.12 shows all the samples from TCGA and cohort projected into the molecular landscape.\n\n\n\n\n\n\n\n\nFigure 2.12: Original PC3 and PC4 of all samples, including test and train samples, of TCGA and METABRIC.\n\n\n\n\n\nAnd the first two PCs.\n\n\n\n\n\n\n\n\nFigure 2.13: Original PC1 and PC2 of all samples, including test and train samples, of TCGA and METABRIC.\n\n\n\n\n\nAnd Figure 2.14.\n\n\n\n\n\n\n\n\nFigure 2.14: Original PC3 and PC4 of all samples, including test and train samples, of TCGA and METABRIC.\n\n\n\n\n\nIn order to check if the integration made sense, it is possible to color by ER status, NPI for METABRIC samples and tumor/node stage for TCGA. To check ER signaling scores, the pathways Estrogen response early/late and \\(SET_{ER/PR}\\) are used to color the projection.\nFigure 2.15 shows the coloring by age.\n\n\n\n\n\n\n\n\nFigure 2.15: PC3 and PC4 of samples from TCGA and METABRIC colored by age.\n\n\n\n\n\nAge seems to be well mixed. Figure 2.16 shows the PCA colored by ER status.\n\n\n\n\n\n\n\n\nFigure 2.16: PC3 and PC4 of samples from TCGA and METABRIC colored by ER status.\n\n\n\n\n\nIt has a very good separation among the different patients. Figure 2.17 is the PCA embedding colored by NPI. Only METABRIC samples have this information.\n\n\n\n\n\n\n\n\nFigure 2.17: PC3 and PC4 of samples from METABRIC only colored by NPI.\n\n\n\n\n\nIt looks good, ER+ BC patients have lower NPI, which makes sense. Figure 2.18 shows then how there is barely any correlation between the different subtypes and the NPI when stratified by the molecular subtype.\n\n\n\n\n\n\n\n\nFigure 2.18: PC3 and NPI correlation colored and stratified by the intrinsic molecular subtype.\n\n\n\n\n\nFigure 2.19 shows the biplot colored by tumor purity.\n\n\n\n\n\n\n\n\nFigure 2.19: PC3 and PC4 of samples from METABRIC only colored by tumor purity.\n\n\n\n\n\nThe tumor purity is not a factor that is affecting the embedding as samples with low cellularity (&lt; 40% of tumor cells) and high cellularity (&gt; 70% of tumor cells) intermingle.\nAnother way to visualize is the distribution of the principal components over the tumor purity (Figure 2.20).\n\n\n\n\n\n\n\n\nFigure 2.20: PC3 and PC4 stratified by tumor purity\n\n\n\n\n\nMETABRIC has also inferred menopausal status for the patients, we use this information to check if there is any enrichment based on the patient menopausal status (Figure 2.21)\n\n\n\n\n\n\n\n\nFigure 2.21: PC3 and PC4 of samples from METABRIC only colored by menopausal status.\n\n\n\n\n\nWe don’t see any difference between the two status. We proceed now with the analysis using clinical factors from TCGA.\n\n\n\n\n\n\n\n\nFigure 2.22: PC3 and PC4 of samples from TCGA only colored by tumor stage and node stage.\n\n\n\n\n\nFor both tumor and node stage the samples seem to have mixed well, indicating the projection is not a function of the stages, as shown in Figure 2.22.\nAnd finally Figure 2.23 below shows the color by PAM50 molecular subtype.\n\n\n\n\n\n\n\n\nFigure 2.23: Corrected PC3 and PC4 of samples from TCGA and METABRIC colored by PAM50 molecular subtype.\n\n\n\n\n\nThe molecular subtypes are projected as expected, going from left to right there are the basal-like BC patients, going to HER2 and then they are split between luminal A and B. The normal like patients are in the top and closer to the luminal A, reflecting the biology.\nThe next figures show the ER signaling measures coloring the projections.\n\n\n\n\n\n\n\n\nFigure 2.24: biplot of PC3 and PC4 of samples from TCGA and METABRIC colored by the SET ER/PR score.\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 2.25: biplot of PC3 and PC4 of samples from TCGA and METABRIC colored by the hallmark estrogen response early.\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 2.26: biplot of PC3 and PC4 of samples from TCGA and METABRIC colored by the hallmark estrogen response late\n\n\n\n\n\nIn all cases the mixing is relatively good. For \\(SET_{ER/PR}\\) you have a gradient going from the right to the left, showing again that patients on the far top right probably are those patients with better prognosis.\nAnd we now display the plots together to include in the first figure of the paper.\n\n\n\n\n\n\n\n\nFigure 2.27\n\n\n\n\n\nAnd now we also plot by age (TCGA and METABRIC), NPI, tumor purity and menopausal state (METABRIC only) and Node stage (TCGA only) all combined for the supplementary figure of the paper.\n\n\n\n\n\n\n\n\nFigure 2.28\n\n\n\n\n\nAnd lastly we use the correlation plot available from PCAtools to check the PC correlation with all the clinical factors, we check the first 10 components as these are the ones with more variation.\n\n\n\n\n\n\n\n\nFigure 2.29: Pearson r-squared between clinical factors and principal components.\n\n\n\n\n\nWe see that the two biggest correlations is with cohort and PC1/PC2 as expected. There is a bit of correlation of NPI and PC3, since basal-like tumors have usually higher NPI scores, they are more aggressive. Also, as expected ER status has a pretty high correlation with PC3 since the basal like are on the left of the principal component and the luminal A/B are on the right region.\nMoreover, basal-like tumors are more pure compared to the luminal A. For the luminal A subtype the amount of tumors that are high or moderate in terms of purity are balanced (around 45%). In all subtypes, the amount of samples with low tumor purity are overall low, excluding the normal-like and claudin-low.\n\n\n\n\n\n\nCELLULARITY\nbasal\nher2\nlumb\nluma\nnormal\nclaudin-low\n\n\n\n\nHigh\n60.5% (118)\n59.0% (121)\n63.1% (281)\n47.6% (315)\n21.9% (28)\n33.7% (61)\n\n\nLow\n12.8% (25)\n7.3% (15)\n4.5% (20)\n7.4% (49)\n34.4% (44)\n22.7% (41)\n\n\nModerate\n26.7% (52)\n33.7% (69)\n32.4% (144)\n45.0% (298)\n43.8% (56)\n43.6% (79)\n\n\nTotal\n100.0% (195)\n100.0% (205)\n100.0% (445)\n100.0% (662)\n100.0% (128)\n100.0% (181)\n\n\n\n\n\n\n\n\nNext we just show the \\(r^2\\) pearson residuals for the SCAN-B, an external cohort.\n\n\n\n\n\n\n\n\nFigure 2.30\n\n\n\n\n\nWe see that the majority of the residuals are explained in PC3 and PC4, as expected. The HER2 seems to have a similar correlation in PC3 and PC7. Below we plot only basal-like, luminal B and HER2 enriched tumor samples to compare.\n\n\n\n\n\n\n\n\n\nIn fact the difference is mainly on PC3 and not so much on PC7. It is only a subset of those samples that have lower PC7. And when we compare PC3 vs PC4.\n\n\n\n\n\n\n\n\n\nPC7 is not adding much in general to the separation.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>A new framework for personalized medicine: integrating</span>"
    ]
  },
  {
    "objectID": "chapters/pca_merging.html#the-integration-is-robust-with-respect-of-selection-of-samples",
    "href": "chapters/pca_merging.html#the-integration-is-robust-with-respect-of-selection-of-samples",
    "title": "2  A new framework for personalized medicine: integrating",
    "section": "2.3 The integration is robust with respect of selection of samples",
    "text": "2.3 The integration is robust with respect of selection of samples\nThe embedding could be due to the patients selected and samples that are close to each other in one embedding would be far away from them in another embedding. Ten random sets of 1000 patients are sampled and the embedding is calculate. A total of 10 PCA embeddings are obtained.\n\n\n\n\n\n\n\n\nFigure 2.31: Selecting a random set of 1000 patients an rerunning the pipeline to obtain other embeddings. Red color corresponds to the embedding using the new fitted PCA. Blue corresponds to the embedding of the original PCA. Each dot corresponds to a patient.\n\n\n\n\n\nFigure 2.31 shows that the embedding is invariant for rotation, translation and reflection for 4 random sets of samples coming from either METABRIC or TCGA.\nFigure 2.32 shows the jaccard index distributions for each cohort separately when comparing the sample neighborhoods of the new embeddings with the original embedding. The jaccard index is counting the number of samples in the intersection of the neighborhoods in the original and the new embedding divided by the total number of unique samples in both neighborhoods. A high value means a good agreement with the neighborhoods.\nA thousand samples were randomly selected from each cohort individually and the jaccard index for each new embedding was calculated.\n\n\n\n\n\n\n\n\nFigure 2.32: Jaccard index distribution for 1000 samples in each cohort individually. Each color corresponds to a different seed and embedding, with a total of 18 seeds.\n\n\n\n\n\nAnd below we show the standard deviation of the average of the distributions.\n\n\n# A tibble: 1 × 2\n  mean_of_jaccard_mean sd_of_jaccard_mean\n                 &lt;dbl&gt;              &lt;dbl&gt;\n1                0.747             0.0605\n\n\nThis indicates a high agreement.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>A new framework for personalized medicine: integrating</span>"
    ]
  },
  {
    "objectID": "chapters/pca_merging.html#normalization-is-necessary-to-reduce-batch-effects-in-other-components",
    "href": "chapters/pca_merging.html#normalization-is-necessary-to-reduce-batch-effects-in-other-components",
    "title": "2  A new framework for personalized medicine: integrating",
    "section": "2.4 Normalization is necessary to reduce batch effects in other components",
    "text": "2.4 Normalization is necessary to reduce batch effects in other components\nSince PCA is removing batch effects from the datasets, one could argue it could also remove platform dependent normalization values and therefore one would need to look only at lower principal components. In this section we show that doing the normalization is necessary to get a good integration in the datasets.\nThe idea is similar as before, but instead of performing the qPCR-like normalization on the datasets, one would use the logFPKM values for TCGA and median intensity for microarray. The problem with this kind of approach also includes the fact that only other samples that went through this processing could be used in the pipeline.\n\n\n\n\n\n\n\n\nFigure 2.33: PCA projections colored by different factors and organized by different components. (A) Plot of the first two components colored by cohort. (B) Plot of the first two components colored by ER status. (C) Plot of the second and third components colored by cohort. (D) Plot of the second and third components colored by ER status. (E) Plot of the second and third components colored by PAM50.\n\n\n\n\n\nFigure 2.33 shows the contrast with the other method including the normalization. Without the normalization, the samples from METABRIC tend to concentrate close to the center, they are not so well mixed.\n\n\n\n\n\n\n\n\nFigure 2.34: PC3 and PC4 from all METABRIC and TCGA samples. (A) Embedding using the qPCR-like normalization. (B) Embedding using the original normalization from each dataset.\n\n\n\n\n\nFigure 2.34 shows side by side the differences when using the qPCR-like normalization and when not using. The left plot is using the qPCR normalization and shows how well the mixing gets, putting samples in the same scale. If the scaling in a sample level is not performed, samples do not mix well.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>A new framework for personalized medicine: integrating</span>"
    ]
  },
  {
    "objectID": "chapters/pca_merging.html#molecular-landscape-is-characterized-by-several-pathways",
    "href": "chapters/pca_merging.html#molecular-landscape-is-characterized-by-several-pathways",
    "title": "2  A new framework for personalized medicine: integrating",
    "section": "2.5 Molecular landscape is characterized by several pathways",
    "text": "2.5 Molecular landscape is characterized by several pathways\nAmong the 1000 genes that are used when calculating the molecular landscape, several might be involved in biological process. Figure 2.35 shows that several pathways are associated with the position in the molecular landscape. Something that is particularly remarkable here is the association of the epithelial mesenchymal transition and DNA repair pathways with PC4.\n\n\n\n\n\n\n\n\nFigure 2.35: Hex biplots colored by different pathways. Each hex is colored based on the average score in the hex.\n\n\n\n\n\nWe see that these pathways are somehow relevant to the embedding, but are they also prognostic of overall survival in the two cohorts? In the next chunks we evaluate this hypothesis. Mostly the focus is on ER+ BC patients that received some kind of hormonal therapy. As seen before, for the TCGA dataset we select ER+ BC patients that have the molecular subtype luminal A and B instead.\nJust before moving on we plot the embedding colored by molecular subtype stratified by cohort so it can go together with a figure in the paper and it is easier to compare the pathways.\n\n\n\n\n\n\n\n\nFigure 2.36\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 2.37: Overall survival analysis from all the three big cohorts and their scores. The formulas used were the same as for the estrogen signaling analysis.\n\n\n\n\n\nWe see that G2M checkpoint has hazard ratio higher than 1. The other scores are a bit more variable and can change the sign (type S error).\n\n\n\n\n\n\n\n\nFigure 2.38: Overall survival analysis from all the three big cohorts and their scores. The formulas used were the same as for the estrogen signaling analysis.\n\n\n\n\n\nBelow is the table with the scores.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>A new framework for personalized medicine: integrating</span>"
    ]
  },
  {
    "objectID": "chapters/pca_merging.html#tumor-purity",
    "href": "chapters/pca_merging.html#tumor-purity",
    "title": "2  A new framework for personalized medicine: integrating",
    "section": "2.6 Tumor Purity",
    "text": "2.6 Tumor Purity\nOne possible problem that might arise in the analysis is the tumor purity. We showed already the molecular embedder colored by tumor purity but here we look more carefully at the relationship between PC3 and PC4 with tumor purity as made available by METABRIC.\nWe actually compare the PC3 and PC4 with tumor purity stratified by molecular subtype, as it is expected that the normal-like subtype is correlated with lower tumor purity.\n\n\n\n\n\n\n\n\n\nAnd when we look at all subtypes together.\n\n\n\n\n\n\n\n\n\nOverall there is an absence of evidence that tumor purity is affecting PC3 and PC4 in a systematic way.\n\n\n\n\n\n\nBhuva, Dharmesh D, Joseph Cursons, and Melissa J Davis. 2020. “Stable Gene Expression for Normalisation and Single-Sample Scoring.” Nucleic Acids Research 48 (19): e113–13. https://doi.org/10.1093/nar/gkaa802.\n\n\nFei, Teng, Tengjiao Zhang, Weiyang Shi, and Tianwei Yu. 2018. “Mitigating the Adverse Impact of Batch Effects in Sample Pattern Detection.” Edited by Inanc Birol. Bioinformatics 34 (15): 2634–41. https://doi.org/10.1093/bioinformatics/bty117.\n\n\nPaik, Soonmyung, Steven Shak, Gong Tang, Chungyeul Kim, Joffre Baker, Maureen Cronin, Frederick L. Baehner, et al. 2004. “A Multigene Assay to Predict Recurrence of Tamoxifen-Treated, Node-Negative Breast Cancer.” New England Journal of Medicine 351 (27): 2817–26. https://doi.org/10.1056/nejmoa041588.\n\n\nRisso, Davide, John Ngai, Terence P Speed, and Sandrine Dudoit. 2014. “Normalization of RNA-Seq Data Using Factor Analysis of Control Genes or Samples.” Nature Biotechnology 32 (9): 896–902. https://doi.org/10.1038/nbt.2931.\n\n\nVijver, Marc J. van de, Yudong D. He, Laura J. van t Veer, Hongyue Dai, Augustinus A. M. Hart, Dorien W. Voskuil, George J. Schreiber, et al. 2002. “A Gene-Expression Signature as a Predictor of Survival in Breast Cancer.” New England Journal of Medicine 347 (25): 1999–2009. https://doi.org/10.1056/nejmoa021967.\n\n\nWallden, Brett, James Storhoff, Torsten Nielsen, Naeem Dowidar, Carl Schaper, Sean Ferree, Shuzhen Liu, et al. 2015. “Development and Verification of the PAM50-Based Prosigna Breast Cancer Gene Signature Assay.” BMC Medical Genomics 8 (1). https://doi.org/10.1186/s12920-015-0129-6.\n\n\nWishart, Gordon C, Elizabeth M Azzato, David C Greenberg, Jem Rashbass, Olive Kearins, Gill Lawrence, Carlos Caldas, and Paul DP Pharoah. 2010. “PREDICT: A New UK Prognostic Model That Predicts Survival Following Surgery for Invasive Breast Cancer.” Breast Cancer Research 12 (1). https://doi.org/10.1186/bcr2464.\n\n\nZhang, Yuqing, Giovanni Parmigiani, and W Evan Johnson. 2020. “ComBat-Seq: Batch Effect Adjustment for RNA-Seq Count Data.” NAR Genomics and Bioinformatics 2 (3). https://doi.org/10.1093/nargab/lqaa078.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>A new framework for personalized medicine: integrating</span>"
    ]
  },
  {
    "objectID": "chapters/validation.html",
    "href": "chapters/validation.html",
    "title": "3  Validating the molecular landscape",
    "section": "",
    "text": "3.1 SCANB embedding\nThe embedding was already calculate before when calculating the fit and tests, since the datasets were organized and loaded together. We also know already that all the 1044 genes are available in the SCANB cohort. SCANB is well mixed with all cohorts as Figure 3.1 shows.\nFigure 3.1: PCA embedding colored by cohort. All samples from TCGA, METABRIC and SCANB were used.\nIdeally there would be some overlap between SCANB and TCGA already in the first component. Moreover, if there isn’t, the cohort should be closer to TCGA than to METABRIC, due to technologies and normalization procedures, as both of them are log FPKM. Even though SCANB was processed in a way to get directly FPKM values, by using cufflinks, TCGA was normalized to get log FPKM as well, as discussed previously. Figure 6.3 shows how close SCANB is from TCGA, moreover there is already some overlap. The variability in the first component is bigger for METABRIC compared to TCGA and SCANB. Probably this is due to the technology processing, since they have genes in the same scale. Figure 2.33 contrasts the different normalization procedures. If genes are not scaled correctly, the PCA shows an inverse picture.\nFigure 3.2: PCA embedding colored by cohort. The components used are the first and second components.\nFigure 3.3 shows that the SCANB samples are also well mixed regarding the clinical factors, including the \\(SET_{ER/PR}\\) signature.\nFigure 3.3: PCA embedding of all samples from TCGA, SCANB and METABRIC. (A) Colored by cohort, (B) colored by ER status, (C) colored by PAM50 molecular subtype, (D) colored by the \\(SET_{ER/PR}\\) signature and only SCANB samples.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Validating the molecular landscape</span>"
    ]
  },
  {
    "objectID": "chapters/validation.html#missing-genes",
    "href": "chapters/validation.html#missing-genes",
    "title": "3  Validating the molecular landscape",
    "section": "3.2 Missing genes",
    "text": "3.2 Missing genes\nGenes missing in publicly available datasets is very common. Usually this is due to processing pipelines or even data quality, therefore genes are removed. This should not be much of a problem, if the data is good enough, when calculating the qPCR-like normalization as it was shown before. The problem arises when multiplying the loadings obtained in the PCA with the normalized expression of the sample. If several genes are missing, 0s are added to the matrix and therefore the loadings for these genes cannot be used. Since 1000 genes were used, we investigate the loadings of genes and try to calculate a fuzziness score, indicating when the embedding should be trusted if genes are missing, and which genes are missing.\n\n3.2.1 Fuzziness score\nThe idea of the fuzziness score is that we use the loadings of the missing genes and calculate the cumulative sum of their absolute values. The higher this value the more it indicates the missing genes are important. We start by removing random genes from random samples of the SCANB cohort. Each sample will have a random number of genes removed from the set of 1044 genes. Then two scores are calculated, one for PC3 and another for PC4. We also calculate the fuzziness score for the top loading genes and the low loadings genes, to compare these values.\nWe start by comparing the scores from top loadings and low loading genes. For this we remove the top 50 loadings and bottom 50 loadings, in terms of absolute values. Figure 3.4 shows the cumulative sum of the absolute values from the top and bottom loadings respectively. See how important the top loadings are compared to the bottom loadings. A way of thinking of this is that the top loadings weights are much more important when calculating the embedding.\n\n\n\n\n\n\n\n\nFigure 3.4: Cumulative sum of absolute values for the top loadings and bottom loadings as a function of the number of selected genes.\n\n\n\n\n\nThis was using the top loadings, so probably the fuzziness score of a sample with relatively good data will be between 0 and 12 maximum, meaning that they have less than 200 genes missing. When genes are missing, we hope that they are in the bottom part of the loadings, so the fuzziness score is as small as possible.\nSuppose now that the genes missing in a sample are random. We will calculate random fuzziness scores based on this to have a feeling of the scores.\n\n\n\n\n\n\n\n\nFigure 3.5: Distribution of the fuzziness scores from random missing genes. Each color corresponds to a different distribution using a different number of genes.\n\n\n\n\n\nFigure 3.5 shows the results as a function of the number of missing genes. We see that in average, if 200 genes are missing, the fuzziness score is around 5. If less than a 100 genes are missing, the fuzziness score is around 3. In the next section we show how this influences the position where the sample is projected into the embedding.\nFinally, we calculate the fuzziness score as a number of top loadings missing. Suppose 150 genes are missing. We will change the proportion of genes that are in the top loadings and in the missing list. Since the cumulative sum for PC2 and PC3 are very similar, we focus only on PC2.\n\n\n\n\n\n\n\n\nFigure 3.6: Distribution of the fuzziness scores from 150 random missing genes with different proportions of top loading genes in the list. Each color corresponds to a different distribution using a different proportion of genes.\n\n\n\n\n\nFigure 3.6 shows the fuzziness score with different proportions of the top loading genes. We see that they are actually very important when calculating the score. The top loading genes were defined as the top 150 genes in the list. So when calculating the number of missing genes it is important to check the number of top loadings in the list.\n\n\n3.2.2 Validating the score\nIn this section we calculate the embeddings with different number of genes missing from a given sample and then plot the original embedding with the newly one. For this we use samples from TCGA. The genes are removed even before the normalization procedure, as they are usually not available there. We select randomly a number of top genes from PC3 and PC4 to compose the list of missing genes. The proportion of the top loading genes is varied.\n\nTCGA-OL-A66K-01A-11R-A29R-07TCGA-GI-A2C9-01A-11R-A21T-07TCGA-3C-AALK-01A-11R-A41B-07TCGA-BH-A0BW-01A-11R-A115-07TCGA-A1-A0SI-01A-11R-A144-07TCGA-D8-A27L-01A-11R-A16F-07\n\n\n\n\n\n\n\n\n\n\nFigure 3.7\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 3.8\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 3.9\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 3.10\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 3.11\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 3.12\n\n\n\n\n\n\n\n\nWhen looking at the figures above, it seems that whenever there are genes missing, and the more of top loadings they are, the closer they are to the origin. This makes sense, since PCA is doing a simple linear combination of the loadings. This should be fine to correct, since we can fit a line going through the origin and goes through the points above. Then the adjustment will depend on the number of genes that are missing and are top loadings. The more they are, the more adjustment we will need.\nFor the adjustment we only know two things, its current position and how many of the top loadings are missing. Based on this information we should be able to correct the samples. Given the list of genes that are missing, we fit lines that would go through the genes that are missing in the TCGA and METABRIC samples. We then try to find the line that is closes to the point. After performing the fit and the line, we can then move the point to closer to the METABRIC and TCGA samples. The point should be close to the line and close to points that have the same proportion of top loadings missing.\nThese plots show how the fuzziness score might be indicative of how good the embedding will be depending on the number of missing genes. The video below shows the images for 20 different patients. Notice how all of them are connected to the origin as well.\n\n\n\n\n3.2.3 Systematic approach\nWe now use a more systematic approach to see the impact of the missing genes in the position in the embedding. The idea is that we extract some metrics from the TCGA samples as we increase the amount of the most important genes removed from the sample. What we simply do is for each patient we calculate the distance of the new embedding to the original embedding. Since for each proportion we ran the analysis 10 times we get 10 distances. We average over those. In the end we have 20 “distances” for each one of the 200 TCGA samples.\nFigure 3.13 shows the relationship between the proportion of missing top loading genes among the 200 genes that were selected out and the average distance to the original embedding. Each dot corresponds to the a sample. In total there are 200 dots in each proportion.\n\n\n\n\n\n\n\n\nFigure 3.13: Average distance to the original embedding\n\n\n\n\n\nWe see that the more top loading genes that are missing the worse the embedding gets. Still the average distance is a bit difficult to interpret, so next we show the relationship between the variance and the proportion of missing genes.\n\n\n\n\n\n\n\n\nFigure 3.14\n\n\n\n\n\nIndeed as the proportion of the most important genes goes missing, there is a higher variance in the average distance.\nNext we evaluate the number of samples in the neighborhood of samples, so we can understand a bit better what is distance in the molecular embedder.\nFigure 3.15 shows the proportion of samples in a neighborhood based on its radius. For samples within a radius of 1, in average the percentage of samples from the whole dataset including TCGA and METABRIC is of 2.5%.\n\n\n\n\n\n\n\n\nFigure 3.15: Percentage of number of samples in the neighborhood with varyiing radii. The total number of samples is 2873, including all samples from TCGA and METABRIC.\n\n\n\n\n\nThis means that around 30% of top missing genes gives us neighborhoods that do not change much, since the average distance from the original embedding is below 1, so the neighborhood will not change much.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Validating the molecular landscape</span>"
    ]
  },
  {
    "objectID": "chapters/validation.html#smc-embedding",
    "href": "chapters/validation.html#smc-embedding",
    "title": "3  Validating the molecular landscape",
    "section": "3.3 SMC embedding",
    "text": "3.3 SMC embedding\nBy following the same procedures as previously, normalizing and getting the PC coordinates, Figure 3.16 shows the biplot of PC1 and PC2 when coloring by cohorts. The samples seem to be well mixed already in the RNA-seq samples. This is probably due to the fact that the SMC cohort has TPM values.\nWhen checking the total number of genes missing, there are only 4 genes missing. And as seen before, this number is almost irrelevant, in the sense that the embedding will still be robust and locations will be precise enough.\n\n\n\n\n\n\n\n\nFigure 3.16: Biplot of first two PCA components from SMC, TCGA, SCANB and METABRIC. SMC is highlighted in the plot and has a bigger dot.\n\n\n\n\n\nAs previously, Figure 3.17 shows the biplot of PC3 and PC4, highlighting the well mixing of the cohorts. When coloring by ER status, samples are in the right group. Molecular subtype is also correct. This cohort is special in the sense that there are more luminal B patients, as discussed in the paper. That is why there are more samples in the luminal B region.\n\n\n\n\n\n\n\n\nFigure 3.17: PCA embedding of all samples from TCGA, SCANB and METABRIC including the SMC samples on top. (A) Colored by cohort, (B) colored by ER status, (C) colored by PAM50 molecular subtype.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Validating the molecular landscape</span>"
    ]
  },
  {
    "objectID": "chapters/validation.html#pdx",
    "href": "chapters/validation.html#pdx",
    "title": "3  Validating the molecular landscape",
    "section": "3.4 PDX",
    "text": "3.4 PDX\nAnother way to validate the results is to use patient derived xenografts. In the Brisken lab the MIND model is used (Sflomos et al. 2016; Scabia et al. 2022). ER+ breast cancer samples coming from patients are processed in a specific way and injected into the mammary glands of mice. Based on that they can stablish themselves and proliferate. The environment should recapitulate what is seen in women as well, in the sense that estrogen (E2) levels are similar to those of post-menopausal women. Since these cells have to proliferate in order to establish and grow in the ducts, we expect them to be more proliferative in terms of RNA-seq components and also to lie in the luminal B region of the molecular landscape. We validate this now.\nWhen checking the total number of genes missing, there are only 27 genes missing. And as seen before, this number is almost irrelevant, in the sense that the embedding will still be robust and locations will be precise enough.\n\n\n\n\n\n\n\n\nFigure 3.18: Biplot of first two PCA components from PDX, TCGA, SCANB and METABRIC. PDX is highlighted in the plot and has bigger dot size.\n\n\n\n\n\nAs previously, Figure 3.19 shows the biplot of PC3 and PC4, highlighting the well mixing of the cohorts. As expected the samples are overall in the luminal B region, since these are tumor cells in a proliferative state.\n\n\n\n\n\n\n\n\nFigure 3.19: Embedding of all samples from TCGA and METABRIC including the PDX samples on top.\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 3.20: Embedding of only PDX control samples on top of the METABRIC, SCANB and TCGA samples\n\n\n\n\n\nAnd we check the PDXs response to estrogen and see how much they move away from the untreated sample.\n\n\n\n\n\n\n\n\nFigure 3.21: Comparison of position in the molecular landscape between CTRL and P4 treated samples\n\n\n\n\n\nIt looks like some of the PDXs had a bigger shift towards the left when treated with estrogen or at least some stabilization. On the other hand, another set of PDXs, the last three, they didn’t see much change.\n\n\n\n\n\n\n\n\n\nWe now include as well the embedding for the P4 treated samples as well.\n\n\n\n\n\n\n\n\nFigure 3.22: Embedding of only PDX control and P4 samples\n\n\n\n\n\nWe see that T110 has a change in position as well, it goes towards the center meaning that there is a decrease in proliferation and also ER signaling. T105 has a very strong effect, it goes up on the diagonal, meaning higher proliferation and lower ER signaling.\n\n\n\n\n\n\n\n\nFigure 3.23: Comparison of position in the molecular landscape between CTRL, E2 and P4 treated samples\n\n\n\n\n\nWhat we can see from these scores is that if there is an increase in G2M checkpoint and the control samples have scores below 0, then the fourth principal component will change it is value, it will go upwards and to the left in the molecular landscape, reflecting the biological response of the tumors to the given hormones.\nBefore we move on we also do the same using facet_grid instead of facet_wrap.\n\n\n\n\n\n\n\n\n\nAnd the next two tables show the results for the differential expression analysis on the pathway level for each PDX individually. The estimate, i.e. difference, and the p-values are presented.\nFirst for G2M:\n\n\n\n\n\n\nThen to Estrogen Early:\n\n\n\n\n\n\nNext we add these p-values to the plot.\n\n\n\n\n\n\n\n\nFigure 3.24\n\n\n\n\n\nWe now further validate the results with the stainings performed on those samples. We will compare the differences with the stainings and the number of PR+ tumors cells.\n\n\n\n\n\n\n\n\nFigure 3.25: Quantification of PR+ cells based on DAB stainings performed on the patient derived xenografts.\n\n\n\n\n\nWe see that T111 has a big increase in absolute values. T113 as well has a big increase, but has a baseline level already low and it does not go to higher values. Probably the reason there is not much difference in the fourth component of the PDX T113 is because of the low Ki67 index.\nBased on the data shown here we see that there is an increase in proliferation upon P4 treatment for T111 and T113. Moreover, P4 reduced estrogen signaling and also change the third component of the three PDXs to a smaller value, towards a more basal like region. Overall, the molecular landscape is able to capture the differences between the treatments.\nLastly we check changes in the embedding upon E2 treatment.\n\n\n\n\n\n\n\n\nFigure 3.26: Embedding of only PDX control and E2 treated samples\n\n\n\n\n\nIt looks like there is not big changes in the molecular landscape as there was for samples treated with progesterone.\nAnd lastly we show for Ki67 as well.\n\n\n\n\n\n\n\n\nFigure 3.27: Quantification of Ki67+ cells based on DAB stainings performed on the patient derived xenografts.\n\n\n\n\n\nAnd below we plot both results together with the respective p-values.\n\n\n\n\n\n\n\n\nFigure 3.28\n\n\n\n\n\n\n3.4.1 Growth curves\n\n\n\n\n\n\n\n\nFigure 3.29: Estimates of the 6 PDXs together. Comparison between P4 vs CTRL.\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 3.30: Average growth curves for each PDX individually with their estimates. The credible intervals corresponds to the 25th and 50th CIs.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Validating the molecular landscape</span>"
    ]
  },
  {
    "objectID": "chapters/validation.html#normal-samples",
    "href": "chapters/validation.html#normal-samples",
    "title": "3  Validating the molecular landscape",
    "section": "3.5 Normal samples",
    "text": "3.5 Normal samples\nWe now further validate the molecular landscape on the normal samples that were sequenced using the same pipeline as the SCANB data. These are samples obtained from reduction mammoplasty of swiss women and were sent to Sweden for the tissue processing and sequecing. The hypotheses here is that the samples will be embedded in the region of the normal like BC samples.\nWhen checking the total number of genes missing, there are only 0 genes missing, i.e., no genes were missing. This makes sense as these samples were processed in the same way as the ones from SCANB.\n\n\n\n\n\n\n\n\nFigure 3.31: Biplot of first two PCA components from Normal Swiss Cohort, TCGA, SCANB and METABRIC. The normal cohort is highlighted in the plot and has bigger dot size.\n\n\n\n\n\nAs previously, Figure 3.32 shows the biplot of PC3 and PC4, highlighting the well mixing of the cohorts. As expected the samples are overall in the luminal B region, since these are tumor cells in a proliferative state.\n\n\n\n\n\n\n\n\nFigure 3.32: Embedding of all samples from TCGA, SCNAB and METABRIC including the Normal samples on top.\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 3.33: Embedding of Normal Swiss cohort with the other cohorts colored by the PAM50.\n\n\n\n\n\nAnd since we finished getting all the plots for the second figure in the paper, we combine it below.\n\n\n\n\n\n\n\n\nFigure 3.34: All figures combined for Fig2 in the paper.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Validating the molecular landscape</span>"
    ]
  },
  {
    "objectID": "chapters/validation.html#third-component-as-a-prognostic-measure",
    "href": "chapters/validation.html#third-component-as-a-prognostic-measure",
    "title": "3  Validating the molecular landscape",
    "section": "3.6 Third component as a prognostic measure?",
    "text": "3.6 Third component as a prognostic measure?\nWe have seen that estrogen signaling is a continuous measure across the third component. The farthest to the right you are the higher the ER signaling scores are also. Here we hypothesized then that the third component is correlated to the prognostic nature of the estrogen signaling score. For this we select only samples with PC3 higher than 0, as these would be the ones that are from luminal A and B subtypes and we use PC3 as a score in the survival analysis.\n\n\n\n\n\n\ncohort\nnumber_patients\nnb_events\n\n\n\n\nSCANB\n2777\n456\n\n\nMETABRIC\n724\n445\n\n\nSCANB High ER\n2253\n347\n\n\n\n\n\n\n\n\nFirst we check the correlation of PC3 with estrogen response early and G2M checkpoint.\n\n\n\n\n\n\n\n\n\nThere is indeed the correlation with the components but still a lot of variability. So it will be unlikely to see such strong effects on the third component.\nThe table below shows the results for the survival analysis using all the samples from SCANB and METABRIC coming from patients that received only endocrine therapy and whose samples had a \\(PC3 &gt; 0\\). OS means overall survival and RFS means recurrence free survival.\n\n\n\n\n\n\nWe see that in all cases the HR for PC3 is below 1, for OS the values are 0.98 and 0.97 and the HR and for RFS from 0.80 to 0.93. What is interesting to note here is that in all cases the confidence interval is crossing 1, as expected due to the variability of the correlation with SET ER/PR and estrogen response early. Remember that the hazard ratio scale is not linear. Indeed it seems that the more a sample is on the right side of the plot the better is its outcome. Notice that the scale for HR is different for PC3 and SET ER/PR, since one is a positive score ranging from 0 to 8 and the other is a score ranging from -1 to 1. If we were to rescale SET ER/PR to an interval between 0 to 10 by multiplying by 5 and then summing 5, we would get hazard ratios in the range of 0.8. Moreover, estrogen signaling is not the only thing fully explaining the third component as it can be seen from Figure 2.35. In this case, G2M Checkpoint and PI3K signaling have also a role in the third component.\nThe following figures correspond to the overall survival analysis and recurrence free survival analysis from the SCANB and METABRIC.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 3.35: Overall and recurrence free survival analysis of the principal components PC3 and PC4. The rows correspond to a different PC and cohort and if the case sub cohort.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Validating the molecular landscape</span>"
    ]
  },
  {
    "objectID": "chapters/validation.html#high-risk-patients",
    "href": "chapters/validation.html#high-risk-patients",
    "title": "3  Validating the molecular landscape",
    "section": "3.7 High risk patients",
    "text": "3.7 High risk patients\nThe Prosigna risk of recurrence score takes into account the tumor stage and the molecular subtype, this is the ROR-C and the formula from the original paper is presented below:\n\\[\nROR-C = 0.05\\times basal + 0.11 \\times HER2 - 0.23 \\times LumA + 0.09 \\times\nLumB  + 0.17 \\times Tumor size\n\\]\nWe see that if a tumor sample has a high correlation to the luminal A subtype it will decrease the score, whereas for all other cases there is an increase in the risk. We want to evaluate if the position in the molecular landscape is somehow correlated with the risk score, specially in the forth component for luminal A patients.\nIn (Staaf et al. 2022) they showed that they are able to predict the Prosigna binary categories high or low/intermediate risk for the patients based only on the RNA-seq provided by their pipeline. We use these categories here to understand the molecular scores of the samples and also their correlation with the position and risk groups. All the following analysis are done for ER+ BC patients only.\nFirst we stratify the risk groups by the molecular subtype.\n\n\n\n\n\n\nAs expected the majority of luminal A patients are low/intermediate risk, on the other hand most of the luminal B patients are considered of high risk.\nIf we look more specifically for luminal A patients and stratify on the tumor stage we get the following numbers.\n\n\n\n\n\n\nWe see that for tumor stage 1 the number of high individuals is lower in percentage than in tumor stage 3, as expected. We now plot (Figure 3.36) for all these patients the G2M molecular score, an index of proliferation, stratified by the tumor stage.\n\n\n\n\n\n\n\n\nFigure 3.36: Luminal A BC patients G2M scores stratified by tumor stage.\n\n\n\n\n\nWe see that in all three cases in average the G2M scores are higher in the high risk groups than in the Low/Intermediate.\nWe saw previously that some of the G2M checkpoint genes have higher loadings for the fourth component. We now plot the PC4 components stratified by the risk groups for the luminal A patients (Figure 3.37).\n\n\n\n\n\n\n\n\nFigure 3.37: Luminal A BC patients PC4 values stratified by risk category.\n\n\n\n\n\nIndeed, in average the higher the PC4, the more likely it is to be in the High risk group. And now we compare the G2M Checkpoint, Estrogen response early and random 200 signature for each molecular subtype separately (Figure 3.38) of ER+ BC patients.\n\n\n\n\n\n\n\n\nFigure 3.38: ER+ BC patients and molecular scores stratified by molecular subtype and binary risk categories.\n\n\n\n\n\nWe see that in this case the binary risk category has distinct distributions for the G2M checkpoint for all molecular subtypes, in particular with the basal like.\n\n\n\n\n\n\nKan, Zhengyan, Ying Ding, Jinho Kim, Hae Hyun Jung, Woosung Chung, Samir Lal, Soonweng Cho, et al. 2018. “Multi-Omics Profiling of Younger Asian Breast Cancers Reveals Distinctive Molecular Signatures.” Nature Communications 9 (1). https://doi.org/10.1038/s41467-018-04129-4.\n\n\nScabia, Valentina, Ayyakkannu Ayyanan, Fabio De Martino, Andrea Agnoletto, Laura Battista, Csaba Laszlo, Assia Treboux, et al. 2022. “Estrogen Receptor Positive Breast Cancers Have Patient Specific Hormone Sensitivities and Rely on Progesterone Receptor.” Nature Communications 13 (1). https://doi.org/10.1038/s41467-022-30898-0.\n\n\nSflomos, George, Valerian Dormoy, Tauno Metsalu, Rachel Jeitziner, Laura Battista, Valentina Scabia, Wassim Raffoul, et al. 2016. “A Preclinical Model for ER\\(\\upalpha\\)-Positive Breast Cancer Points to the Epithelial Microenvironment as Determinant of Luminal Phenotype and Hormone Response.” Cancer Cell 29 (3): 407–22. https://doi.org/10.1016/j.ccell.2016.02.002.\n\n\nStaaf, Johan, Jari Häkkinen, Cecilia Hegardt, Lao H. Saal, Siker Kimbung, Ingrid Hedenfalk, Tonje Lien, et al. 2022. “RNA Sequencing-Based Single Sample Predictors of Molecular Subtype and Risk of Recurrence for Clinical Assessment of Early-Stage Breast Cancer.” Npj Breast Cancer 8 (1). https://doi.org/10.1038/s41523-022-00465-3.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Validating the molecular landscape</span>"
    ]
  },
  {
    "objectID": "chapters/scoring.html",
    "href": "chapters/scoring.html",
    "title": "4  Pathway activity in a personalized context",
    "section": "",
    "text": "4.1 Calculating scores in neighborhoods\nPatients close to each other in the molecular landscape are somewhat molecularly close, due to how the embedding works. Therefore, we can look at patients in a neighborhood and calculate the average scores, to see what it means to be in a specific neighborhood.\nTo do this, we define a radius for a patient where all the patients within the euclidean ball with this radius will be selected and an average score distribution is calculated.\nTo calculate the average score distribution we use the rstanarm package. We set the prior distribution for the intercept to be a normal distribution centered at 0 with standard deviation of 1. All scores are in a range of -1 to 1, so this is a relatively flat prior for our use case.\nThe video below shows how scores change in average when comparing different neighborhoods.\nGoing from right to left it shows how ER signaling is decreased. From top to bottom there is a reduction of proliferation, E2F targets, and a change in EMT and TGFb signaling. These are representative scores, other pathways could be used as well.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Pathway activity in a personalized context</span>"
    ]
  },
  {
    "objectID": "chapters/scoring.html#poetic-embedding",
    "href": "chapters/scoring.html#poetic-embedding",
    "title": "4  Pathway activity in a personalized context",
    "section": "4.2 POETIC embedding",
    "text": "4.2 POETIC embedding\nIn this section we show the embedding of the POETIC trial samples. But first we analyse some basic properties of the dataset. The data for this dataset was downloaded and processed as described at chronchi.github.io/transcriptomics in the chapter AI - GSE105777.\n\n4.2.1 Number of samples\nIn this dataset there are matched samples from patients that are treated and untreated. Table 4.1\n\n\n\n\nTable 4.1: Table showing the number of samples for treated and untreated patients\n\n\n\n\n\n\n\ngroup\nn\npercent\n\n\n\n\ntreated\n157\n74\n\n\nuntreated\n56\n26\n\n\n\n\n\n\n\n\n\n\n\nIn this cohort, there is the PAM50 molecular subtype available for the untreated. Table 4.2 shows the number of patients for each subtype.\n\n\n\n\nTable 4.2: Table showing the number of molecular subtypes for each group.\n\n\n\n\n\n\n\npam50\nn\npercent\n\n\n\n\nher2\n1\n0.235\n\n\nluma\n77\n18.075\n\n\nlumb\n31\n7.277\n\n\nnormal\n3\n0.704\n\n\nnot_available\n314\n73.709\n\n\n\n\n\n\n\n\n\n\n\nThe numbers differ from previously, since the molecular subtype is calculated for each sample, so two molecular subtypes for each patient.\n\n\n4.2.2 Proportion of top loadings\nThere are in total 1008 genes available out of the . Among them, 39 are the housekeeping genes. Out of the 36 genes missing, a total number of 8 are missing from the top 200 PC3 loadings, a proportion of 4%. A total number of 5 are missing from the top 200 PC4 loadings, a proportion of 2%. These are very small proportions, and we have seen from the last chapter that they will not affect the position of the patients in the embedding.\n\n\n4.2.3 Embedding\nFigure 4.1 shows a good mixing of the POETIC sample and how all the patients are scattered across the whole landscape. Here all samples are plotted, meaning that every two dots correspond to a single patient.\n\n\n\n\n\n\n\n\nFigure 4.1: PCA embedding of all samples from TCGA, SCANB and METABRIC including the POETIC samples on top. (A) Colored by cohort, (B) colored by ER status, (C) colored by PAM50 molecular subtype.\n\n\n\n\n\nFigure 4.2 shows the embedding of baseline samples from patients that received endocrine therapy prior to surgery. Patients on the left part of the molecular landscape are considered to be non responders, this coincides with the fact this region corresponds to the ER- BC patients.\n\n\n\n\n\n\n\n\nFigure 4.2: PCA embedding of all samples from TCGA, SCANB and METABRIC including the POETIC samples on top. POETIC samples correspond to only baseline treated patients.\n\n\n\n\n\nAnd when checking the first two components, the POETIC data is closer to METABRIC, which makes sense since both are microarrays, as it can be seen in Figure 4.3.\n\n\n\n\n\n\n\n\nFigure 4.3: Biplot of first two PCA components from POETIC, TCGA, SCANB and METABRIC. POETIC is highlighted in the plot and has a bigger point.\n\n\n\n\n\n\n\n4.2.4 Differences in PC3 for responders and non responders\nWe now also compare the differences in non responders vs responders according to the third component.\n\n\n\n\n\n\n\n\nFigure 4.4: Comparison of the PC3 between responders and non responders\n\n\n\n\n\nWe see that there is a clear difference, we now use bayesian stats to do the comparison and get the posterior distribution of the difference in PC3.\n\n\n\nModel Info:\n function:     stan_lm\n family:       gaussian [identity]\n formula:      PC3 ~ is_responder\n algorithm:    sampling\n sample:       4000 (posterior sample size)\n priors:       see help('prior_summary')\n observations: 137\n predictors:   2\n\nEstimates:\n                        mean   sd   10%   50%   90%\n(Intercept)           -0.8    0.3 -1.2  -0.8  -0.4 \nis_responderResponder  1.6    0.3  1.2   1.6   2.0 \nsigma                  2.0    0.1  1.8   2.0   2.2 \nlog-fit_ratio         -0.3    0.1 -0.4  -0.3  -0.1 \nR2                     0.2    0.1  0.1   0.2   0.4 \n\nFit Diagnostics:\n           mean   sd   10%   50%   90%\nmean_PPD 0.3    0.2  0.0   0.3   0.6  \n\nThe mean_ppd is the sample average posterior predictive distribution of the outcome variable (for details see help('summary.stanreg')).\n\nMCMC diagnostics\n                      mcse Rhat n_eff\n(Intercept)           0.0  1.0  1160 \nis_responderResponder 0.0  1.0  1185 \nsigma                 0.0  1.0  1776 \nlog-fit_ratio         0.0  1.0  1237 \nR2                    0.0  1.0  1005 \nmean_PPD              0.0  1.0  3388 \nlog-posterior         0.0  1.0  1161 \n\nFor each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).\n\n\nThe difference is clear, when looking at the parameter is_responderResponder. The Rhat is reasonable and the number of effective sample size is good as well. Below we plot the average posterior distribution of the difference between responders and non responders.\n\n\n\n\n\n\n\n\nFigure 4.5: Comparison of the PC3 between responders and non responders. Difference in the expected posterior predictive distributions. Each dot corresponds to a 1% quantile.\n\n\n\n\n\nWe see that the difference is 100% higher than 0 and even more the difference is higher than 0.5, meaning that responders have higher PC3 compared to non responders. The plot below shows the average values as well for responders and non responders separately.\n\n\n\n\n\n\n\n\nFigure 4.6\n\n\n\n\n\nAnd to conclude we also calculate the p-value for the sake of it.\n\n\n\n\n\n\nThe p-value is around 2.9e-06, very small, three stars!\nAlso, it is good to compare the continuous score with the third component. We calculate the pearson correlation coefficient and see that PC3 and change in Ki67 is correlated.\n\n\n\n\n\n\n\n\nFigure 4.7\n\n\n\n\n\nWe can also compare the top responders and top non-responders. We select all the samples that have a change in ki67 higher than 0% and we select the same amount of samples among the top responders.\n\n\n\n\n\n\n\n\nFigure 4.8\n\n\n\n\n\nThere is a clear distinction between the top responders and top non-responders. Similar to before we calculate the difference using bayesian stats.\n\n\n\nModel Info:\n function:     stan_lm\n family:       gaussian [identity]\n formula:      PC3 ~ is_responder\n algorithm:    sampling\n sample:       4000 (posterior sample size)\n priors:       see help('prior_summary')\n observations: 20\n predictors:   2\n\nEstimates:\n                        mean   sd   10%   50%   90%\n(Intercept)           -1.3    0.8 -2.3  -1.4  -0.4 \nis_responderResponder  2.3    1.1  0.9   2.3   3.6 \nsigma                  2.5    0.4  2.0   2.4   3.0 \nlog-fit_ratio          0.1    0.2 -0.1   0.1   0.3 \nR2                     0.2    0.1  0.0   0.1   0.3 \n\nFit Diagnostics:\n           mean   sd   10%   50%   90%\nmean_PPD -0.2    0.8 -1.1  -0.2   0.8 \n\nThe mean_ppd is the sample average posterior predictive distribution of the outcome variable (for details see help('summary.stanreg')).\n\nMCMC diagnostics\n                      mcse Rhat n_eff\n(Intercept)           0.0  1.0  1430 \nis_responderResponder 0.0  1.0  1415 \nsigma                 0.0  1.0  1788 \nlog-fit_ratio         0.0  1.0  1636 \nR2                    0.0  1.0  1625 \nmean_PPD              0.0  1.0  3448 \nlog-posterior         0.0  1.0  1198 \n\nFor each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).\n\n\nThe difference is clear, when looking at the parameter is_responderResponder. The Rhat is reasonable and the number of effective sample size is good as well. Below we plot the average posterior distribution of the difference between responders and non responders.\n\n\n\n\n\n\n\n\nFigure 4.9: Comparison of the PC3 between top responders and non responders. Difference in the expected posterior predictive distributions. Each dot corresponds to a 1% quantile.\n\n\n\n\n\nThere is a 99% probability that the difference is higher than 0, and a probability of 91% that the difference is higher than 1.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Pathway activity in a personalized context</span>"
    ]
  },
  {
    "objectID": "chapters/scoring.html#scoring-all-samples",
    "href": "chapters/scoring.html#scoring-all-samples",
    "title": "4  Pathway activity in a personalized context",
    "section": "4.3 Scoring all samples",
    "text": "4.3 Scoring all samples\nIn the last chapters scores were showed for TCGA, SCANB and METABRIC. Figure 2.24 shows how ER signaling changes as patients move across the molecular landscape. We intend to use the scores now for the POETIC samples. We first start by calculating using GSVA as well and include in the dataframe with the other cohorts. Before moving to the next chapter, we will analyse and compare the scores across the responders and non responders.\nFigure 4.10 shows that when using the scores, it looks like in average at baseline \\(SET_{ER/PR}\\) is lower in non responders than in responders. For the other scores there is no clear difference.\n\n\n\n\n\n\n\n\nFigure 4.10: Baseline scores for all treated patients in the POETIC trial. G2M corresponds to a proliferation score, EMT to epithelial to mesenchymal transition score and the others are related to ER signaling.\n\n\n\n\n\nWe see that for PC3 and SET ER/PR There are some differences in terms of the responders and non responders.\nLet us take a closer look at those patients. We start by plotting the scatter plot of PC3 vs SET ER/PR and color by response status defined by the POETIC trial.\n\n\n\n\n\n\n\n\nFigure 4.11: Comparison of the third component with SET ER/PR scores colored by response status.\n\n\n\n\n\nThis figure shows that there is a correlation between third component and SET ER/PR for the POETIC trial data as well as it was already seen from the other cohorts. Moreover, it seems that the responders have higher PC scores in general. We now correlate for each subgroup (responder and non responders) the PC3 and the change in percentage for Ki67.\n\n\n\n\n\n\n\n\nFigure 4.12: Correlation between change in Ki67 versus PC3 stratified by response group.\n\n\n\n\n\nNow another metric we can calculate from our dataset is the difference of the embedding positions between the different samples of the same patient. The idea is that if a patient responded well, there were bigger changes as well in the transcriptomics and that is reflected in the embedding.\n\n\n\n\n\n\n\n\nFigure 4.13: Differences of the embeddings for each patient individually stratified by response status. Each dot corresponds to a single patient.\n\n\n\n\n\nAnd now we perform a comparison of these positions by using rstanarm to get the posterior distributions of the differences.\nThe figure below shows the distribution of the averages of the differences in the embedding of the projections.\n\n\n\n\n\n\n\n\nFigure 4.14: Differences of the embeddings for each patient individually stratified by response status. Each dot corresponds to a single patient.\n\n\n\n\n\n\n\n# A tibble: 2 × 8\n  is_responder   .row .epred .lower .upper .width .point .interval\n  &lt;fct&gt;         &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    \n1 responder         1   2.77   2.45   3.09   0.95 median qi       \n2 non_responder     2   2.05   1.60   2.54   0.95 median qi       \n\n\nAnd the figure below shows the posterior distribution of the differences in average.\n\n\n\n\n\n\n\n\nFigure 4.15: Differences of the average differences in the embedding for each patient individually. The comparison made was non responder vs responder, which means that if non responder has a lower difference in average, the difference in difference will be negative.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Pathway activity in a personalized context</span>"
    ]
  },
  {
    "objectID": "chapters/scoring.html#analysing-patient-neighborhoods",
    "href": "chapters/scoring.html#analysing-patient-neighborhoods",
    "title": "4  Pathway activity in a personalized context",
    "section": "4.4 Analysing patient neighborhoods",
    "text": "4.4 Analysing patient neighborhoods\nThere are two ways to interpret the embedding. If the patient has ER+ BC and its embedding is close to the ER- BC patients, we can infer that the endocrine response might not work so well, as it was shown in Figure 4.2. The other option is to compare the patient’s score to the average score of its neighborhood.\nWhat is a neighborhood? When performing the embedding, global structures are not preserved usually. In this sense we only compare patients that are close to each other in an euclidean neighborhood, i.e., we calculate a radius around each sample and see what other samples are within this ball given the euclidean distance.\nGiven a neighborhood, one can calculate the posterior average score of all samples from METABRIC, SCANB and TCGA and use that as an indication of average score that we can compare other patients to. The concept is that if an ER+ BC patient has a much lower ER signaling score, it means the patients will not respond so well to endocrine therapy, as they are very different from their neighboors.\nTo showcase the ability to use the scores and infer results, we use the POETIC trial patients to compare the scores. This cohort is special in the sense that the patients are filtered based on selection criterias, meaning that the patients are clinically similar.\nTwo random patients in very close neighborhoods were selected to showcase the ability of the molecular landscape. The id of the patients are 63 and 236. Table 4.3 shows the clinical features of these patients. One of them is HER2+. Patient 63 had a higher Ki67 baseline level but a very good response to endocrine therapy. Patient 236 did not respond to endocrine therapy in terms of reduction of Ki67 levels.\n\n\n\n\nTable 4.3: Clinical features from patients 63 and 236.\n\n\n\n\n\n\n\npatient_nb\ner_status\nher2_status\nki67\nchange_ki67\nccca_surgery_ki67_2_7\n\n\n\n\n63\npos\nPositive\n16.60702\n-69.958509\nnoCCCA\n\n\n236\npos\nNegative\n11.30906\n5.593711\nnoCCCA\n\n\n\n\n\n\n\n\n\n\n\nFigure 4.16 shows the embedding of two distinct patients in a similar neighborhood.\n\n\n\n\n\n\n\n\nFigure 4.16: Plot of two selected patients in the molecular landscape. One is a responder and the other is a non responder. The patient id numbers are 63 and 236.\n\n\n\n\n\nAnd now we calculate the average scores for each patient neighborhoods. We start by defining a radius value. After that we select the patients in the neighborhood and use rstanarm to get the posterior distribution of the average score in the neighborhood. For this we use the function stan_glm to calculate the average. This is effective because it can be paired with the package tidybayes for plotting. It makes extremely easy to deal with posterior data. For the average we use a normal prior centered at 0 with 1 standard deviation, since all scores are between -1 and 1.\nPatient 63 Figure 6.8 is considered a responder. According to the scores, when comparing the estrogen early signature to its average distribution in the neighborhood, the score is higher.\n\n\n\n\n\n\n\n\nFigure 4.17: Posterior distribution of the average scores in the neighborhood of patient 236 from POETIC trial. Each dot corresponds to a 1% quantile.\n\n\n\n\n\nPatient 236 Figure 6.9 was considered a non responder. According to the scores, when comparing the estrogen early signature to its average distribution in the neighborhood, the score is lower, being in the 5% quantile.\n\n\n\n\n\n\n\n\nFigure 4.18: Posterior distribution of the average scores in the neighborhood of patient 236 from POETIC trial. Each dot corresponds to a 1% quantile.\n\n\n\n\n\nWhen comparing these two patients, there is also a difference in the androgen response score, which could be a reflection of different estrogen signaling.\nNow we show only the plots from the ER signaling signatures and androgen response as well.\n\n\n\n\n\n\n\n\nFigure 4.19: Posterior distribution of the average scores in the neighborhood of patient 236 from POETIC trial. Each dot corresponds to a 1% quantile.\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 4.20: Posterior distribution of the average scores in the neighborhood of patient 236 from POETIC trial. Each dot corresponds to a 1% quantile.\n\n\n\n\n\n\n4.4.1 Matching other responders and non-responders\nIn this section we now match all the responders and non-responders in a close neighbourhood and try to do a similar analysis. We use a threshold of 0.5 for samples close enough, which corresponds to the 1% percentile.\n\n\n\n\n\n\nIn total there is number of 38 neighborhoods that we will analyse with a total of 56 unique samples, with a total of 32 responders and 24 non-responders, meaning that some responders they share non-responders.\nBy analysing the table below we get the following results. The way the table was obtained was by manually inspecting all the 38 neighrborhoods and checking in which the samples scores were below (b), in the average (m) and above average (a). The columns with the a, m and b letters represent the scores ER Early and SET ER/PR along with their respective positions.\n\n\n\n\n\n\nIn out of the 38 neighborhoods, there are 8 where the responders are at average or above estrogen response early and non responders are below. The total number of unique non-responders is 6. On the other hand, there are 9 neighborhoods with 6 unique non-responders that have higher scores than average and in which 8 non-responders have scores below average.\nThe number increases to 14 when we consider SET ER/PR and out of the 14 neighborhoods, there are 10 unique samples from non-responders.\nOn the other hand there are 8 neighborhoods which have non responders with SET ER/PR higher than average and responders with scores below average. Out of these 8 neighborhoods, the number of unique non-responders are 6. In total, there are 10 non-responders that are below average, 6 that are above average and the remaining 8 have similar direction as the responders.\nThese results suggest that SET ER/PR might be a better signature to compare in the neighborhoods.\n\n\n4.4.2 Analysing all patients\nWe now try to extend this comparison to something more systematic. Instead of looking just for these two patients we will compare the neighborhoods for the top responders and non-responder patients. The first thing we have to have in mind is that some non responders they did respond to the drug, just the reduction in Ki67 was not so big. For example patient 209 has a reduction of 40% in Ki67 going from 16% to 9%. Still this patient is considered a non-responder.\nWe don’t select all patients for the comparisons. We select only patients that are at least in the HER2 enriched region to the right, so we exclude the basal like patients. The reason for this as well is because they all either have low Estrogen response early scores or low SET ER/PR.\n\n\n\n\n\n\n\nHALLMARK_ESTROGEN_RESPONSE_EARLY\nSET_ERPR\nPC3\n\n\n\n\ntreated_nb69_baseline\n-0.265\n-0.50\n-4.5\n\n\ntreated_nb76_baseline\n-0.275\n-0.19\n-4.1\n\n\ntreated_nb80_baseline\n-0.013\n-0.49\n-5.6\n\n\ntreated_nb229_baseline\n-0.234\n-0.54\n-4.7\n\n\ntreated_nb230_baseline\n-0.308\n-0.50\n-7.5\n\n\ntreated_nb237_baseline\n-0.377\n-0.29\n-7.9\n\n\n\n\n\n\n\n\n\n4.4.2.1 Non-responders\n\n\n\n\n\n\n\n\n\nEstrogen score still close to 0, high proliferation at baseline and higher androgen score. But in this case SET ER/PR is lower than average. There is a mismatch.\n\n\n\n\n\n\n\n\n\nThis patient has a score close to 0 still but low proliferation in general. This is a case where the EMT signaling is really at average and TGFb is super low. Again SET ER/PR is much lower, mismatch with ER signaling.\n\n\n\n\n\n\n\n\n\nEstrogen signaling close to 0, high androgen and E2F targets and high EMT. Intriguing patient, both ER and SET ER/PR are going in the same direction and above average.\n\n\n\n\n\n\n\n\n\nLow ER signaling and super high EMT with an increase P53 pathway expression. Super low ER signaling here in terms of SET ER/PR.\n\n\n\n\n\n\n\n\n\nLow ER score, even lower than average and low EMT signaling. Average E2F targets and lower than average for SET ER/PR.\n\n\n\n\n\n\n\n\n\nThis case is a bit different, the ER signaling is higher, E2F targets at baseline is not so high, even lower than the average, but in this case androgen response is much higher and EMT is extremely high. There is a relative mismatch between ER early and SET ER/PR. SET ER/PR is relatively small and close to the average.\n\n\n\n\n\n\n\n\n\nAndrogen score lower than the average and high E2F targets at baseline. In this case we see a very small EMT signature. In this case there is again a mismatch between ER signaling and SET ER/PR.\n\n\n\n\n\n\n\n\n\nThis one has a low ER signaling as well and higher E2F targets score. Massive difference in SET ER/PR here when comparing to the average.\nIn general all these non responders with no change in Ki67 had a low ER signaling score or a mismatch between ER early and SET ER/PR\n\n\n4.4.2.2 Top responders\nWe now investigate the top responders with the biggest decrease in Ki67.\n\n\n\n\n\n\n\n\n\nFirst thing is that this patient had already a positive score and a very low Androgen signaling score. Moreover the Ki67 is low. This is one of the furthest patients to the right and still has a low ER signaling score.\n\n\n\n\n\n\n\n\n\nA bit high E2F targets but higher than average of the estrogen signaling score. High SET ER/PR.\n\n\n\n\n\n\n\n\n\nHere the ER signaling is above average and androgen response is similar to the average. E2F targets is high. Also super high SET ER/PR.\n\n\n\n\n\n\n\n\n\nVery low E2F targets and low Androgen response. ER is about the average. SET ER/PR is still positive. This sample is in the luminal A region also.\n\n\n\n\n\n\n\n\n\nIn this case ER signaling is also above average and E2F targets is similar to the average of neighbors. SET ER/PR on average and in the expected direction.\n\n\n\n\n\n\n\n\n\nThis one is intriguing, ER signaling is extremely low, E2F targets is very low as well but the patient responded pretty well. But there is a big mismatch between Ki67 and transcriptomics for this patient. Further investigation should be performed. Actually probably the samples have mixed names. Below are the values of the pathways after treatment:\n\n\n\n\n\n\nIt looks super weird that there is a big increase in proliferation based on the transcriptomic data considering the reduction in the Ki67 percentage. Not only that, ER signaling increases. It is very likely that the sample has a mixed label.\nMoving to the next one.\n\n\n\n\n\n\n\n\n\nThis one also is intriguing, estrogen signaling is very low but the patient is a responder with a good decrease in Ki67. Below is a table with the values for surgery and baseline. We see that there is indeed a decrease in proliferation and also in estrogen signaling. Also this sample is closer to the normal like and luminal A region.\n\n\n\n\n\n\nAnd last patient.\n\n\n\n\n\n\n\n\n\nThis patient has a score slightly higher than the average, but still negative. Nonetheless, the patient responded well to the therapy. One note is that this patient is close to the HER2 enriched region.\nIn general non responders had more mismatches between SET ER/PR and below average values than responders.\n\n\n4.4.2.3 Responders in the middle of embedding\nWe lastly check the responders that are in the middle of the molecular landscape to see how they are.\n\n\n\n\n\n\n\n\n\nLow ER signaling in both cases. This patient specifically had very high Ki67 levels at baseline.\n\n\n\n\n\n\n\n\n\nAlso ER signaling is low here compared to the average, but a very low Ki67 proliferation index at baseline.\n\n\n4.4.2.4 Conclusion\nIn general what we can see is that when comparing responders and non responders the main difference is in the position of the molecular landscape. If we select the top responders and the top non-responders in terms of decrease in Ki67 levels, we see that non responders have way lower third principal component (Figure 4.21).\n\n\n\n\n\n\n\n\nFigure 4.21: PC3 comparison of the top non responders and responders",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Pathway activity in a personalized context</span>"
    ]
  },
  {
    "objectID": "chapters/scoring.html#predicting-response-to-endocrine-therapy",
    "href": "chapters/scoring.html#predicting-response-to-endocrine-therapy",
    "title": "4  Pathway activity in a personalized context",
    "section": "4.5 Predicting response to endocrine therapy",
    "text": "4.5 Predicting response to endocrine therapy\nWe now try to use a penalized logistic regression to predict patient response, as defined by the POETIC trialists using the principal components. For this we already saw that in average the patients further to the left are non-responders and further to the right would be responders, suggesting a predictive power of the molecular landscape. The landscape still is not perfect as there is a lot of overlap between the responders and non-responders. So we try to use more principal components to capture the differences.\nJust when randomizing the train test split, we need to make sure that we include some of the samples that are in the basal like region in both splits, since they are in small numbers. Due to the small sample size, we use the components starting from 3 and going up to 20.\nIn this dataset the total of responders vs non responder is:\n\n\n\n\n\n\nMore than 2/3 are responders. Using a set seed for the randomization, the numbers of responders and non responders are shown below for the training set.\n\n\n\n\n\n\nAnd for the test set.\n\n\n\n\n\n\nAnd we compare the PC3 values distributions to see if they are equally distributed.\n\n\n\n\n\n\n\n\n\nThey are similarly distributed, so we can proceed with the training and testing strategy.\nThe plot below shows the misclassification error versus the lambda used for the penalization term in the logistic regression.\nThe plot below shows the misclassification error for different \\(\\lambda\\) values and number of components.\n\n\n\n\n\n\n\n\n\nOverall the misclassification is pretty similar for all number of variables. We select the variables obtained with the lambda that is 1 SE away from the minimum. So in total we have three variables: The intercept and PC3, PC10, PC20.\nAnd below we show the confusion matrix.\n\n\n         True\nPredicted  0  1 Total\n    0      1  3     4\n    1     14 28    42\n    Total 15 31    46\n\n Percent Correct:  0.6304 \n\n\nWe see that the accuracy is very low and most of the patients are classified as responders. This could be potentially due to the class imbalance, but the results are still underwhelming.\nLet us take a look on the patients that were predicted to be non responders and check their Ki67 differences in baseline and surgery.\n\n\n                             PC3 change_ki67     ki67\ntreated_nb64_baseline  -2.733038   -66.53449 44.46653\ntreated_nb80_baseline  -5.649423    26.83238 43.24122\ntreated_nb129_baseline -3.468263   -86.59865 21.55340\ntreated_nb147_baseline -3.421153   -81.93744 42.51592\n\n\nAll the patients that were misclassified as non responders they have a very low third principal component and their baseline Ki67 is quite high, so the decrease in proliferation is not actually big enough. It is still considered a responder.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Pathway activity in a personalized context</span>"
    ]
  },
  {
    "objectID": "chapters/scoring.html#differential-expression-analysis",
    "href": "chapters/scoring.html#differential-expression-analysis",
    "title": "4  Pathway activity in a personalized context",
    "section": "4.6 Differential expression analysis",
    "text": "4.6 Differential expression analysis\nInstead of looking at the neighborhood, we could do a differential expression analysis at baseline between responders and non-responders that are close to each other. We can then perform gene set enrichment analysis to understand which pathways are different across these two groups.\nBased on the histogram below there is not differentially expressed gene.\n\n\n\n\n\n\n\n\n\nAnd the plot below shows the position of the selected samples in the embedding.\n\n\n\n\n\n\n\n\n\nBelow we show the embedding using the response status to color.\n\n\n\n\n\n\n\n\nFigure 4.22\n\n\n\n\n\nWe now show the position in the embedding colored by the responders and non responders but with the threshold set to -10% of change in Ki67 instead of the -60%.\n\n\n\n\n\n\n\n\n\nSome of the samples are really in the middle of the embedding, but they are very few, only 5 in total.\nWe now do a paired analysis of these samples. For each pair of samples we take the difference of the scores and compare the results for each one of the selected pathways.\n\n\n\n\n\n\n\n\n\nWe next show the plot with the average of the score for the responders if there is only one non-responders in the neighborhood versus the difference.\n\n\n\n\n\n\n\n\n\nFirst we see that there is a negative correlation in Androgen response and PI3K AKT MTOR signaling. Moreover, all responders had a negative PI3K AKT MTOR signaling score, whereas among the non-responders there were 4 with positive scores. The dashed lines correspond to the lines crossing 0 in both directions and the identity line, slope 1 and intercept 0.\nNext we do an analysis on the remaining samples just out of curiosity. Since all the non-responders on the basal like region are in this other set, we expect to see many DEGs and also ER signaling down in the non-responders.\n\n\n\n\n\n\n\n\n\nAs expected the distribution of p-values below shows that there are statistically significant differentially expressed genes.\n\n\n\n\n\n\n\n\n\nAnd the plot below shows also that there are differences in the pathways when comparing responders and non-responders.\n\n\n\n\n\n\n\n\n\nThe differences in ER signaling are clear and also differences in PI3K AKT MTOR signaling, but mostly driven by the samples that are in the basal like region.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Pathway activity in a personalized context</span>"
    ]
  },
  {
    "objectID": "chapters/scoring.html#thresholding-change-in-ki67",
    "href": "chapters/scoring.html#thresholding-change-in-ki67",
    "title": "4  Pathway activity in a personalized context",
    "section": "4.7 Thresholding change in Ki67",
    "text": "4.7 Thresholding change in Ki67\nWe saw previously that the line between responders and non responders is very thin. Next we change the thresholds of Ki67 to see how much the responder and non-responder proportion of androgen response with respect to the neighborhood changes. We should look at different thresholds since Ki67 is a noisy estimate.\nJust to double check we randomly select one patient and compare visually the results.\n\n\n            sample_name                 pathway position threshold is_responder\n1 treated_nb65_baseline       Androgen response        a       -60    responder\n2 treated_nb65_baseline             E2F targets        b       -60    responder\n3 treated_nb65_baseline                     EMT        a       -60    responder\n4 treated_nb65_baseline Estrogen response early        a       -60    responder\n5 treated_nb65_baseline             P53 pathway        a       -60    responder\n6 treated_nb65_baseline               SET ER/PR        b       -60    responder\n7 treated_nb65_baseline          TGFb signaling        m       -60    responder\n\n\n\n\n\n\n\n\n\n\n\nAll looks good, we can move on and do a similar analysis for the Androgen response signature.\n\n\n\n\n\n\n\n\n\nHere we see that there is a distinction as one changes the threshold for androgen response and TGF\\(\\beta\\) signaling. Androgen response is expected and TGF\\(\\beta\\) signaling has been linked to EMT and an increase in proliferation in several cancers. Figure 4.23 shows the differences across the difference thresholds for both AR and TGFb signaling.\n\n\n\n\n\n\n\n\nFigure 4.23: Comparison between responders and non-responders and the proportion of samples in each group when comparing to the average distribution and changing threshold for the change in Ki67.\n\n\n\n\n\nAnd next we do a similar analysis as done by the SET ER/PR and Estrogen response early. For each pair of samples we compare the responders and non-responders and check if Androgen response is above average for non-responders and below/middle average for non-responders. On the other hand we do similarly for TGF\\(\\beta\\) signaling but we compare below average for non-responders versus middle/above average for responders.\n\n\n Androgen response  n   percent\n                no 22 0.5789474\n               yes 16 0.4210526\n\n\n\n\n TGFb signaling  n   percent\n             no 28 0.7368421\n            yes 10 0.2631579\n\n\nAnd the number of neighborhoods that have both comparisons with a “yes” are:\n\n\n                    TGFb signaling          \n1 Androgen response             no       yes\n2                no     36.8% (14) 21.1% (8)\n3               yes     36.8% (14)  5.3% (2)\n\n\nWe see that in general there is a kind of matching, i.e., high androgen response in non-responders and low/median for responders and also low TGF\\(\\beta\\) signaling for non-responders and the opposite for responders in the majority of the cases. In only two pairs there was the mismatch in the expected directions. But in these two pairs they represent samples that are close to each other, meaning that there is just one responders where this happens and two non-responders. Below is a figure representing that as well.\n\n\n\n\n\n\n\n\nFigure 4.24",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Pathway activity in a personalized context</span>"
    ]
  },
  {
    "objectID": "chapters/scoring.html#figure-for-the-paper",
    "href": "chapters/scoring.html#figure-for-the-paper",
    "title": "4  Pathway activity in a personalized context",
    "section": "4.8 Figure for the paper",
    "text": "4.8 Figure for the paper\nBelow we compiled some of the plots for a figure in the paper, so they look nicer together.\n\n\n\n\n\n\n\n\nFigure 4.25: All plots combined for Figure 4 in the paper.\n\n\n\n\n\n\n\n\n\n\n\nGao, Qiong, and Elena López-Knowles, Maggie Chon U. Cheang, James Morden, Ricardo Ribas, Kally Sidhu, David Evans, et al. 2019. “Impact of Aromatase Inhibitor Treatment on Global Gene Expression and Its Association with Antiproliferative Response in ER\\(\\mathplus\\) Breast Cancer in Postmenopausal Patients.” Breast Cancer Research 22 (1). https://doi.org/10.1186/s13058-019-1223-z.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Pathway activity in a personalized context</span>"
    ]
  },
  {
    "objectID": "chapters/risk_score.html",
    "href": "chapters/risk_score.html",
    "title": "5  Risk score model",
    "section": "",
    "text": "5.1 Generating the risk score\nWe focus only on the endocrine treated patients. For the training part of the algorithm we use a subset of patients from the METABRIC cohort. We then test the risk scores in the test set and we further validate the score on SCANB.\nWe will generate two risk scores: one including only the principal components and another one including the clinical features of the patients when valiable, namely tumor size, node status and age (either having one or more lymph node with breast cancer cells or none).\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(pcs_to_use, clin_vars), collapse = \"+\"))), data = training_set)\n\n  n= 556, number of events= 216 \n\n                    coef exp(coef)  se(coef)      z Pr(&gt;|z|)    \nPC3            -0.091540  0.912525  0.027255 -3.359 0.000783 ***\nPC4             0.080512  1.083842  0.022588  3.564 0.000365 ***\ntumor_size      0.021809  1.022049  0.004292  5.082 3.74e-07 ***\nnode_statuspos  0.582681  1.790834  0.147602  3.948 7.89e-05 ***\nage             0.003150  1.003155  0.007030  0.448 0.654061    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n               exp(coef) exp(-coef) lower .95 upper .95\nPC3               0.9125     1.0959    0.8651    0.9626\nPC4               1.0838     0.9226    1.0369    1.1329\ntumor_size        1.0220     0.9784    1.0135    1.0307\nnode_statuspos    1.7908     0.5584    1.3410    2.3916\nage               1.0032     0.9969    0.9894    1.0171\n\nConcordance= 0.676  (se = 0.019 )\nLikelihood ratio test= 66.18  on 5 df,   p=6e-13\nWald test            = 71.92  on 5 df,   p=4e-14\nScore (logrank) test = 72.75  on 5 df,   p=3e-14\nWe see that all coefficients have less variability than age. Now we calculate only the risk score based on the components.\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(pcs_to_use), collapse = \"+\"))), data = training_set)\n\n  n= 556, number of events= 216 \n\n        coef exp(coef) se(coef)      z Pr(&gt;|z|)    \nPC3 -0.08657   0.91707  0.02699 -3.207  0.00134 ** \nPC4  0.09068   1.09492  0.02216  4.091 4.29e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n    exp(coef) exp(-coef) lower .95 upper .95\nPC3    0.9171     1.0904    0.8698    0.9669\nPC4    1.0949     0.9133    1.0484    1.1435\n\nConcordance= 0.626  (se = 0.019 )\nLikelihood ratio test= 22.5  on 2 df,   p=1e-05\nWald test            = 22.49  on 2 df,   p=1e-05\nScore (logrank) test = 22.78  on 2 df,   p=1e-05\nWe see that the coefficients are very similar to what was found before, it didn’t change much. Also when we include the principal components on the top of the clinical variables the log likelihood increases, which is a good indication:\nAnalysis of Deviance Table\n Cox model: response is  Surv(time = rfs_months, event = rfs_status)\n Model 1: ~ tumor_size + node_status + age\n Model 2: ~ PC3 + PC4 + tumor_size + node_status + age\n   loglik Chisq Df Pr(&gt;|Chi|)    \n1 -1231.1                        \n2 -1221.2 19.88  2  4.821e-05 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nNow we use the test set to calculate the score.\nCall:\nsurvival::coxph(formula = Surv(time = rfs_months, event = rfs_status) ~ \n    risk_score, data = test_set)\n\n  n= 371, number of events= 140 \n\n             coef exp(coef) se(coef)     z Pr(&gt;|z|)    \nrisk_score 0.8632    2.3707   0.1583 5.453 4.96e-08 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n           exp(coef) exp(-coef) lower .95 upper .95\nrisk_score     2.371     0.4218     1.738     3.233\n\nConcordance= 0.655  (se = 0.025 )\nLikelihood ratio test= 28.56  on 1 df,   p=9e-08\nWald test            = 29.73  on 1 df,   p=5e-08\nScore (logrank) test = 29.78  on 1 df,   p=5e-08\nWe see that the higher the risk score the worse it is for the patients treated only with endocrine therapy.",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Risk score model</span>"
    ]
  },
  {
    "objectID": "chapters/risk_score.html#validating-the-risk-score-on-scanb",
    "href": "chapters/risk_score.html#validating-the-risk-score-on-scanb",
    "title": "5  Risk score model",
    "section": "5.2 Validating the risk score on SCANB",
    "text": "5.2 Validating the risk score on SCANB\nWe can now validate the risk score on the SCANB dataset.\n\n\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(\"risk_score\"), collapse = \"+\"))), data = endo_only_scanb)\n\n  n= 2442, number of events= 175 \n\n             coef exp(coef) se(coef)     z Pr(&gt;|z|)    \nrisk_score 1.1248    3.0795   0.1138 9.885   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n           exp(coef) exp(-coef) lower .95 upper .95\nrisk_score     3.079     0.3247     2.464     3.849\n\nConcordance= 0.696  (se = 0.022 )\nLikelihood ratio test= 78.2  on 1 df,   p=&lt;2e-16\nWald test            = 97.71  on 1 df,   p=&lt;2e-16\nScore (logrank) test = 96.79  on 1 df,   p=&lt;2e-16\n\n\nAgain the risk score is prognostic with a high coefficient, meaning that the higher the score the worse it is for the patient.\nWe now visualize a bit the risk scores developed here in terms of the molecular landscape. Figure 5.1\n\n\n\n\n\n\n\n\nFigure 5.1: Molecular landscape of SCANB patients treated with only endocrine therapy and that have ER+ breast cancer. Only patients with risk score less than 2 are plotted here. There are only 26 patients out of 2829 with risk score higher than 2 that would skew the color scale.\n\n\n\n\n\nWe now investigate the risk score among patients that have high ER IHC percentage as well. We have seen that these patients have different outcomes based on the molecular estrogen signaling. We now investigate the effect of the risk score.\n\n\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(\"risk_score\"), collapse = \"+\"))), data = endo_only_scanb %&gt;% \n    dplyr::filter(ER.pct &gt;= 90 & risk_score &lt; 2))\n\n  n= 1832, number of events= 126 \n\n             coef exp(coef) se(coef)     z Pr(&gt;|z|)    \nrisk_score 1.1989    3.3165   0.1652 7.257 3.96e-13 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n           exp(coef) exp(-coef) lower .95 upper .95\nrisk_score     3.317     0.3015     2.399     4.585\n\nConcordance= 0.685  (se = 0.026 )\nLikelihood ratio test= 48.9  on 1 df,   p=3e-12\nWald test            = 52.66  on 1 df,   p=4e-13\nScore (logrank) test = 55.63  on 1 df,   p=9e-14\n\n\nWe see that the score is still prognostic, meaning that even patients that have high ER IHC percentage, there are those with higher risk. Note though that the analysis still is a bit limited due to the followup time that in median is 5.3 years.\nWe also compare the risk score for the high risk group and low/intermediate risk group of the ROR signature (Figure 5.2) obtained by the SCANB team using single sample predictor models, where rule based algorithms are used to determine if a patient is high or low/intermediate risk. They validate this on prosigna’s own sequencing and showed good results (Staaf et al. 2022).\n\n\n\n\n\n\n\n\nFigure 5.2: Risk score stratified by binary category risk as defined by the SCANB team at (Staaf et al. 2022). ER+ BC patients that received only ET were considered.\n\n\n\n\n\nAs expected most of the patients in the high risk group are luminal B. The ROR signature was developed in such a way to get luminal B patients to be of high risk. But here we see that there is still an overlap between low/intermediate patients and high risk patients, suggesting that the new risk score has additional information. For assessing this hypothesis we perform recurrence free survival analysis with both variables and just the risk score and compare the likelihood of the two models using anova.\n\n\nAnalysis of Deviance Table\n Cox model: response is  Surv(time = rfs_months, event = rfs_status)\n Model 1: ~ tumor_size + node_status + age + SSP.ROR.binary.risk.cat\n Model 2: ~ risk_score + SSP.ROR.binary.risk.cat + tumor_size + node_status + age\n   loglik  Chisq Df Pr(&gt;|Chi|)  \n1 -1229.7                       \n2 -1228.0 3.4646  1     0.0627 .\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\nWe see that by adding the risk score it provides aditional value on top of the binary category from prosigna. On top of that the SCANB team calculated also the ROR score based on the original paper. So we actually have the actual scores derived from the nearest centroid technique for all patients.\nFigure 5.3 shows the comparison between risk score and the ROR score from prosigna calculated by using NC.\n\n\n\n\n\n\n\n\nFigure 5.3: Comparison of the risk score developed here with the ROR from Prosigna.\n\n\n\n\n\nThere is a correlation but we see that among the luminal A patients there are still those that have high risk score besides a ROR lower than 50. Below we show the results of the spearman test on these two variables. We see they are correlated.\n\n\n\n    Spearman's rank correlation rho\n\ndata:  endo_only_scanb$risk_score and endo_only_scanb$NCN.ROR.asT0\nS = 1233308206, p-value &lt; 2.2e-16\nalternative hypothesis: true rho is not equal to 0\nsample estimates:\n     rho \n0.491857 \n\n\nWith a p-value of:\n\n\n[1] 5.832521e-149\n\n\nWe now evaluate the risk score only on luminal A patients that received just endocrine therapy.\n\n\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(\"risk_score\", clin_vars), collapse = \"+\"))), data = endo_only_scanb %&gt;% \n    dplyr::filter(pam50 == \"luma\"))\n\n                    coef exp(coef)  se(coef)      z      p\nrisk_score      1.548555  4.704666  0.730935  2.119 0.0341\ntumor_size      0.003568  1.003574  0.016252  0.220 0.8262\nnode_statuspos -0.673885  0.509724  0.486784 -1.384 0.1662\nage            -0.014232  0.985869  0.012078 -1.178 0.2386\n\nLikelihood ratio test=29.45  on 4 df, p=6.331e-06\nn= 1502, number of events= 71 \n\n\nEven among these patients the score is prognostic, despite the number of events, the hazard ratio is relatively high here. If we do the survival analysis by using overall survival as endpoint the results are shown below.\n\n\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = os_months, event = os_status) ~ \", \n    paste(c(\"risk_score\", clin_vars), collapse = \"+\"))), data = endo_only_scanb %&gt;% \n    dplyr::filter(pam50 == \"luma\"))\n\n                     coef  exp(coef)   se(coef)      z      p\nrisk_score      5.046e-01  1.656e+00  4.293e-01  1.175  0.240\ntumor_size     -4.809e-05  1.000e+00  1.103e-02 -0.004  0.997\nnode_statuspos -2.390e-01  7.874e-01  2.738e-01 -0.873  0.383\nage             9.506e-02  1.100e+00  7.974e-03 11.921 &lt;2e-16\n\nLikelihood ratio test=234.5  on 4 df, p=&lt; 2.2e-16\nn= 1502, number of events= 227 \n\n\nRisk score still an estimated hazard ratio higher than 1, with more variability though, still in the expected direction. So we see that this signature provides aditional information to the PAM50 ROR signature.\n\n\nCall:\nsurvival::coxph(formula = as.formula(paste0(\"Surv(time = rfs_months, event = rfs_status) ~ \", \n    paste(c(\"risk_score\", \"NCN.ROR.asT0\", clin_vars), collapse = \"+\"))), \n    data = endo_only_scanb %&gt;% dplyr::filter(pam50 == \"luma\"))\n\n                   coef exp(coef) se(coef)      z     p\nrisk_score      0.94883   2.58268  0.98705  0.961 0.336\nNCN.ROR.asT0    0.01038   1.01043  0.01120  0.927 0.354\ntumor_size      0.01689   1.01704  0.02187  0.772 0.440\nnode_statuspos -0.31774   0.72779  0.62635 -0.507 0.612\nage            -0.01230   0.98778  0.01221 -1.007 0.314\n\nLikelihood ratio test=30.31  on 5 df, p=1.283e-05\nn= 1502, number of events= 71",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Risk score model</span>"
    ]
  },
  {
    "objectID": "chapters/risk_score.html#standardized-survival-curves-for-scanb",
    "href": "chapters/risk_score.html#standardized-survival-curves-for-scanb",
    "title": "5  Risk score model",
    "section": "5.3 Standardized survival curves for SCANB",
    "text": "5.3 Standardized survival curves for SCANB\nWe now use also the standardized survival curves as suggested in the paper (Syriopoulou et al. 2022). For this we use the package flexsurv along with the functions flexsurvspline to model the baseline hazard using splines and then to calculate the standardized survival curves we use the function standsurv.\nFor the sake of interpretation we categorize the risk score in 4 categories, a low, intermediate, high and ultra-high risk. The thresholds are based on the data, we use the quartiles. We understand that we loose power when doing this but we are able to communicate better the information. For comparison we first show the spline based model on the continous score.\n\n\n# A tibble: 8 × 5\n  term           estimate std.error statistic   p.value\n  &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;\n1 gamma0         -7.84      0.643       NA    NA       \n2 gamma1          0.971     0.299       NA    NA       \n3 gamma2          0.0661    0.290       NA    NA       \n4 gamma3         -0.384     0.901       NA    NA       \n5 gamma4          0.405     0.840       NA    NA       \n6 risk_score      1.66      0.263        6.32  1.30e-10\n7 tumor_size     -0.00950   0.00735     -1.29  9.80e- 2\n8 node_statuspos -0.718     0.224       -3.20  6.80e- 4\n\n\nWe use the “hazard” scale to define the proportional hazards model. The estimate is above 0 (1.8), meaning that the higher the risk score the worse it is. Moreover, the p-value is 1.1e-14.\nBefore moving on we just compare the risk score distributions between METABRIC and SCANB.\n\n\n\n\n\n\n\n\n\nThe distribution shift makes sense as the majority of patients in SCANB have lower tumor stage. Let us compare by molecular subtype.\n\n\n\n\n\n\n\n\n\nIn general they agree a bit more when looking by subtype.\nWe now proceed with the categorized data for visualization purposes. We also use the survival scale for the interpretation. For the categories we use METABRIC’s quantiles instead of SCANB. This way we used the training dataset for defining the risk scores and then we use SCAN-B to further validate the differences.\nThe quartiles are (0, 0.25, 0.5, 0.75 and 1):\n\n\n[1] -0.2767315  0.5788431  0.9485916  1.3608617  3.8333981\n\n\nThe patients are stratified in the categories low, intermediate, high and ultra-high. For the analysis the low category is set as the baseline.\nFirst we show the marginal survival curves.\n\n\n\n\n\n\n\n\nFigure 5.4\n\n\n\n\n\nAnd now the marginal curves for the differences with the low risk as the baseline.\n\n\n\n\n\n\n\n\nFigure 5.5\n\n\n\n\n\nHere we see that the difference between low and ultra-high can be as high as 40%. On the other hand the differences between intermediate and low stay around 3 to 10% after 5 years.\nThe confidence intervals are larger as you increase the risk groups due to the number of patients available in each category.\n\n\n\n\n\n\nrisk_score_category\n1\n2\n\n\n\n\nlow\n95% (1,539)\n5% (79)\n\n\nintermediate\n91% (375)\n9% (39)\n\n\nhigh\n89% (198)\n11% (24)\n\n\nultra-high\n77% (105)\n23% (31)\n\n\nTotal\n93% (2,217)\n7% (173)\n\n\n\n\n\n\n\n\nStill the number of events in percentage goes up as one goes up in the risk category, as expected.",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Risk score model</span>"
    ]
  },
  {
    "objectID": "chapters/risk_score.html#risk-score-and-poetic-trial",
    "href": "chapters/risk_score.html#risk-score-and-poetic-trial",
    "title": "5  Risk score model",
    "section": "5.4 Risk score and POETIC trial",
    "text": "5.4 Risk score and POETIC trial\nWe can evaluate one of the two risk scores, the one using only the principal components, in the POETIC trial data. The first question we can address is if there is difference in scores in the baseline tissue (Figure 5.6).\n\n\n\n\n\n\n\n\nFigure 5.6: Risk scores for responders and non-responders in the baseline tumor tissue.\n\n\n\n\n\nWe see in the Figure 5.6 that in average the non responders have higher risk scores. Now if we compare the risk scores between baseline and surgery, the slope of the line that fits for each group separately, responder and non responder, is different. The slope for the non responders is parallel to the identity line going through the origin with a slope of 1, meaning that there is not much change of risk upon the treatment. On other hand, for the responder group the slope is decreased and has a value lower than 1, meaning that the risk is decreased upon aromatase inhibition after two weeks (Figure 5.7).\n\n\n\n\n\n\n\n\nFigure 5.7: Comparison of risk scores using the PCs only before and after two weeks of aromatase inhibitors in post-menopausal women. The colored lines correspond do the linear regression for each response status group separately.",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Risk score model</span>"
    ]
  },
  {
    "objectID": "chapters/risk_score.html#risk-score-vs-pathways",
    "href": "chapters/risk_score.html#risk-score-vs-pathways",
    "title": "5  Risk score model",
    "section": "5.5 Risk score vs pathways",
    "text": "5.5 Risk score vs pathways\nWe now compare the risk score with pathways of interest as discussed in the previous sections. Again we only look at the patients that received only endocrine therapy in both SCANB and METABRIC.\n\n\n\n\n\n\n\n\nFigure 5.8: Risk score versus pathways of interest. Each subplot corresponds to a different pathway.\n\n\n\n\n\nFigure 5.8 shows that in general the signatures are not strongly associated with one of the main pathways displayed here. On the other hand, Figure 5.9 shows the association between the signatures and the risk scores derived only from the principal components.\n\n\n\n\n\n\n\n\nFigure 5.9: Risk score derived from the principal components only versus pathways of interest. Each subplot corresponds to a different pathway.\n\n\n\n\n\nIn this case we see some associations with G2M checkpoint in general and a bit with estrogen signaling. We now calculate the correlation plots for each one of these pathways with both risk scores.\n\n\n\n\n\n\n\n\nFigure 5.10: Correlation matrix for all pathways of interest and the two risk scores, both including the clinical factors and without the clinical factors.\n\n\n\n\n\nFigure 5.10 shows that G2M checkpoint is highly correlated with the risk score using only the principal components (\\(\\rho = 0.72\\)). When you include the clinical factors this value decreases. Moreover, DNA repair is highly associated with RS PC. Estrogen signaling was not so important here in the signatures surprisingly.\nIf we subselect only the SCANB samples we can recalculate those values and compare with the NCN ROR score.\n\n\n\n\n\n\n\n\nFigure 5.11: Correlation matrix for all pathways of interest and the two risk scores, both including the clinical factors and without the clinical factors.",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Risk score model</span>"
    ]
  },
  {
    "objectID": "chapters/risk_score.html#abim-and-ncounter-data",
    "href": "chapters/risk_score.html#abim-and-ncounter-data",
    "title": "5  Risk score model",
    "section": "5.6 ABiM and nCounter data",
    "text": "5.6 ABiM and nCounter data\nIn (Staaf et al. 2022), the authors validated their approach of using RNA-seq instead of nCounter data by showing how one can get the ROR and compared to nCounter data sequenced at their facility and sent to prosigna for the calculation of the risk of recurrence. They have matched RNA-seq data as well. Here we will use the ROR obtained from the nCounter data and use the RNA-seq to calculate the risk score here developed.\n\n\nTotal number of stable genes: 44\nTotal number of genes: 1044\nNumber of samples: 100\n\n\nFigure 5.12 shows the embedding of the ABiM cohort, it matches perfectly the molecular landscape.\n\n\n\n\n\n\n\n\nFigure 5.12: Embedding of all samples from TCGA, SCNAB and METABRIC including the samples from ABiM 100 that have matched nCounter data.\n\n\n\n\n\nFigure 5.13 shows how well the ABiM cohort actually overlays with the SCANB dataset, which makes sense as the processing pipeline is all similar.\n\n\n\n\n\n\n\n\nFigure 5.13: Biplot of first two PCA components from ABiM 100, TCGA, SCANB and METABRIC. The normal cohort is highlighted in the plot and has bigger dot size.\n\n\n\n\n\nAnd now we move on and calculate the risk scores for the ABiM cohort.\n\n\n\n\n\n\n\n\nFigure 5.14: Correlation between risk score calculated based on the principal components and clinical factors versus the Prosigna ROR obtained from the nCounter data and evaluated by Prosigna. Cohort used is the ABiM 100 samples.\n\n\n\n\n\nFigure 5.14 shows that there is a positive correlation between the risk score and ROR obtained from Prosigna. We see that some of the luminal A patients have higher ROR but lower ROR. Also, among luminal B patients there were some with the same ROR but different risk score, showing that the risk. Also some of the basal samples have smaller ROR than some of the luminal B and A samples, and the risk score captures these differences, i.e., all basal samples have risk scores higher than 0.75.\n\n\n\n\n\n\nBuus, Richard, Ivana Sestak, Ralf Kronenwett, Sean Ferree, Catherine A. Schnabel, Frederick L. Baehner, Elizabeth A. Mallon, Jack Cuzick, and Mitch Dowsett. 2021. “Molecular Drivers of Onco\\(\\less\\)i\\(\\greater\\)type\\(\\less\\)/i\\(\\greater\\) DX, Prosigna, EndoPredict, and the Breast Cancer Index: A TransATAC Study.” Journal of Clinical Oncology 39 (2): 126–35. https://doi.org/10.1200/jco.20.00853.\n\n\nStaaf, Johan, Jari Häkkinen, Cecilia Hegardt, Lao H. Saal, Siker Kimbung, Ingrid Hedenfalk, Tonje Lien, et al. 2022. “RNA Sequencing-Based Single Sample Predictors of Molecular Subtype and Risk of Recurrence for Clinical Assessment of Early-Stage Breast Cancer.” Npj Breast Cancer 8 (1). https://doi.org/10.1038/s41523-022-00465-3.\n\n\nSyriopoulou, Elisavet, Tove Wästerlid, Paul C. Lambert, and Therese M.-L. Andersson. 2022. “Standardised Survival Probabilities: A Useful and Informative Tool for Reporting Regression Models for Survival Data.” British Journal of Cancer 127 (10): 1808–15. https://doi.org/10.1038/s41416-022-01949-6.",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Risk score model</span>"
    ]
  },
  {
    "objectID": "chapters/expanding_ember.html",
    "href": "chapters/expanding_ember.html",
    "title": "6  Expanding embedding and removing batch effects",
    "section": "",
    "text": "6.1 Embedding with more than 1000 genes\nTotal number of stable genes: 39\nTotal number of genes: 8248\nNumber of samples: 1005\nTotal number of stable genes: 39\nTotal number of genes: 8248\nNumber of samples: 7216\nTotal number of stable genes: 39\nTotal number of genes: 8248\nNumber of samples: 1868\nTotal number of stable genes: 39\nTotal number of genes: 8248\nNumber of samples: 426\nAnd now we can visualize the results.\nFigure 6.1: PCA projections colored by different factors and organized by different components. (A) Plot of the first two components colored by cohort. (B) Plot of the first two components colored by ER status. (C) Plot of the second and third components colored by cohort. (D) Plot of the second and third components colored by ER status. (E) Plot of the second and third components colored by PAM50. (F) Plot of the second and third components colored by INTCLUST, only METABRIC has an assigned value for this variable, NAs are TCGA samples.\nAnd now we can visualize the results.\nFigure 6.2: PCA projections colored by different factors and organized by different components. (A) Plot of the first two components colored by cohort. (B) Plot of the first two components colored by ER status. (C) Plot of the second and third components colored by cohort. (D) Plot of the second and third components colored by ER status. (E) Plot of the second and third components colored by PAM50. (F) Plot of the second and third components colored by INTCLUST, only METABRIC has an assigned value for this variable, NAs are TCGA samples.\nFigure 6.3: PCA embedding colored by cohort. The components used are the first and second components.\nFigure 6.4 shows that the SCANB samples are also well mixed regarding the clinical factors, including the \\(SET_{ER/PR}\\) signature.\nFigure 6.4: PCA embedding of all samples from TCGA, SCANB and METABRIC. (A) Colored by cohort, (B) colored by ER status, (C) colored by PAM50 molecular subtype, (D) colored by the \\(SET_{ER/PR}\\) signature and only SCANB samples.\nLet us also check the other components in the biplots.\nWe see that the pam50 subtypes are being separated using the components 3, 4 and also 8. In the component 8 there is some expression that is able to differentiate between HER2-like from all other samples.\nWe now plot by cohort.\nIn PC1, 2 and 5 there are some small differences in the differences of the distributions from the datasets. We will then remove these 3 components up to component 10 with exception of components 3, 4 and 5.",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Expanding embedding and removing batch effects</span>"
    ]
  },
  {
    "objectID": "chapters/expanding_ember.html#removing-the-batch-effects",
    "href": "chapters/expanding_ember.html#removing-the-batch-effects",
    "title": "6  Expanding embedding and removing batch effects",
    "section": "6.2 Removing the batch effects",
    "text": "6.2 Removing the batch effects\nWe now try to remove the batch effects by removing all the PCs that are not of interest, so we remove the first two components and the fifth as well. We then calculate the scores for each cohort separately and then compare to what was calculated before. We can then try to calculate the scores using samples coming from all cohorts.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nIn general it looks good, the luminal B population is a bit compressed towards the luminal A population though.\n\n\n\n\n\n\n\n\n\nThere is a very good merging of the datasets. We see mostly green points because they are the majority.\n\n\n\n\n\n\n\n\n\nNow we see that the first loadings has a tail in a similar fashio as the other loadings.\nWe now try to calculate the scores of the samples using these new embeddings only from TCGA samples as we will compare the results later on.\nAnd we can now check and compare the scores.\n\n\n\n\n\n\n\n\n\nWe see that for the three pathways the correlation is positive and strong. The difference is that it is a bit noisy, so the correlation is not perfect. What is interesting to see is that at the extremes the scores have less variation usually.\nWe now calculate the scores from SCANB and compare the results. Remember that SCANB was not used for the PCA training.\nAnd we can now check and compare the scores.\n\n\n\n\n\n\n\n\n\nThe same phenomenon happened. Samples in the endges have lower variability, but samples in the middle are the ones that have high variability. For example there are several samples from the regressed data with SET_ERPR score close to 0.25 and negative scores.\nWhat happens now if we use another dataset and then use only one sample to calculate the score. Let us include SCANB samples in the pipeline. For this we select 50 scanb samples and 100 random samples from tcga and metabric. We then combine all these samples together and calculate the GSVA scores.\nWe now plot only the scores from the SCANB samples.\n\n\n\n\n\n\n\n\n\nSo it seems there are still dataset related problems there when calculating the scores. The scores are positively correlated, but they are not quite the same as only using the SCANB dataset. Moreover, for G2M checkpoint the scores are concentrated around -0.4 from the regressed data but they are in a range going from - 0.4 to 0.1 in the unregressed data.\nIf we try to instead add some samples from the SCANB dataset as well randomly into the mix. How well does the scores get compared to the “ground truth”?\n\n\n\n\n\n\n\n\n\nIt does not work so well when including some SCANB samples together with the METABRIC and TCGA samples. We are trying to achieve a correlation of almost 1 with very low variability since we want to use the scores clinically.\nLet us check the distribution of some genes for SCANB and TCGA after regressing out the first two PCs.\n\n\n\n\n\n\n\n\n\nWe see that even though the expression profile of the samples are overlapping there are discrepancies. That is why when using GSVA it does not work so well perhaps.",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Expanding embedding and removing batch effects</span>"
    ]
  },
  {
    "objectID": "chapters/expanding_ember.html#scoring-strategy-with-regressed-data",
    "href": "chapters/expanding_ember.html#scoring-strategy-with-regressed-data",
    "title": "6  Expanding embedding and removing batch effects",
    "section": "6.3 Scoring strategy with regressed data",
    "text": "6.3 Scoring strategy with regressed data\nWe now try to use a slightly different scoring strategy. We can think of our data in a log scale, so what we do now instead is to sum all of our genes of interest and then subtract an average of the housekeeping genes expression levels.\nFirst we check the distribution of this average for each cohort separately.\n\n\n\n\n\n\n\n\nFigure 6.5: Distribution of the average of the housekeeping genes for distinct cohorts.\n\n\n\n\n\nIndeed the tcga and metabric cohorts have an overlapping distribution, but the SCANB does not overlap completely, it is actually shifted. One should still take into account that the distributions are very close to 0, meaning that the housekeeping genes have very close to 0 values, as expected here in this case. We now calculate the score by taking this into account.\n\n\n\n\n\n\n\n\nFigure 6.6: Scores obtained from regressed data of all the four cohorts TCGA, SCANB, METABRIC and POETIC compared to the original GSVA scores.\n\n\n\n\n\nThe scores are actually highly correlated, specially the estrogen related pathways. Also the correlation between the scores in general follows the same trends.\nThe plot below is a subset of the scores above to include in the publication.\n\n\n\n\n\n\n\n\nFigure 6.7: Scores obtained from regressed data of all the four cohorts TCGA, SCANB, METABRIC and POETIC compared to the original GSVA scores.\n\n\n\n\n\nWe now compare the distributions of these scores across the different cohorts and pathways of interest.\n\n\n\n\n\n\n\n\n\nAnd with all molecular subtypes together.\n\n\n\n\n\n\n\n\n\nWe see that the overlap is actually pretty good in general, even for SCANB. The only part where there is a bigger discrepancy is for G2M checkpoint. We see below that by calculating the GSVA score on the whole scanb cohort we don’t have this problem.\nAnd as a comparison we plot with the original scores using GSVA on the whole cohort individually.\n\n\n\n\n\n\n\n\n\nAnd all the subtypes together for the original score:\n\n\n\n\n\n\n\n\n\nWe see that by doing GSVA the distributions they overlap much more than using the regressed data and the simple sum of the values for those genes. Still for estrogen signaling it seems that the estrogen early signature is pretty robust.\n\n6.3.1 Checking the patients from POETIC with new scores\nWe now use the new scores to evaluate the comparison with the neighboorhood, just as before in the previous chapter where we used the POETIC trial data.\n\n\n[1] \"treated_nb63_baseline\"\n[1] \"treated_nb236_baseline\"\n\n\nPatient 63 Figure 6.8 is considered a responder. According to the scores, when comparing the estrogen early signature to its average distribution in the neighborhood, the score is higher.\n\n\n\n\n\n\n\n\nFigure 6.8: Posterior distribution of the average scores in the neighborhood of patient 63 from POETIC trial. Each dot corresponds to a 1% quantile.\n\n\n\n\n\nPatient 236 Figure 6.9 was considered a non responder. According to the scores, when comparing the estrogen early signature to its average distribution in the neighborhood, the score is lower, being in the 5% quantile.\n\n\n\n\n\n\n\n\nFigure 6.9: Posterior distribution of the average scores in the neighborhood of patient 236 from POETIC trial. Each dot corresponds to a 1% quantile.\n\n\n\n\n\nWhen comparing these two patients, there is also a difference in the androgen response score, which could be a reflection of different estrogen signaling.\nIt reflects what we saw previously as well.\n\n\n6.3.2 Responder vs non responder comparison of new scores\nWe now compare the scores for responders and non responders.\n\n\n\n\n\n\n\n\n\nThe higher E2F targets in average the lower the estrogen early score is for non responders, whereas this correlation does not exist for responder patients. This difference is mostly drive by the high E2F target non responder tumors.\nNow the plot below shows the correlation for baselien Ki67% and E2F targets for the score calculated in the regressed data in a single sample manner. We see a positive correlation between the two scores. Moreover, it is interesting to see that when the tumor has low Ki67, there is still a spectrum on the E2F targets score. Also there is no difference in the correlation between responders and non responders.\n\n\n\n\n\n\n\n\n\nAnd lastly we compare the estrogen signaling signatures between responders and non-responder.\n\n\n\n\n\n\n\n\n\nWe see that the estrogen response early has a wider range when compared to the SET ER/PR score. That makes sense as this signature has over 100 genes, whereas SET ER/PR has only 18. Also the responder was very good in discriminating the responders and non responders. What we can conclude from this figure is that the samples with very low scores are usually non responders, which reflect their position in the molecular landscape, also in general responders have higher ER signaling than non responders.\nBelow is the figure with the GSVA scores before regressing the data, we see that SET ER/PR is not able to really distinguish completely the non-responders with very low score similar to what was done with GSVA. Even estrogen early had some differences.\n\n\n\n\n\n\n\n\n\nAnd below is a figure with both GSVA and regressed scores together.\n\n\n\n\n\n\n\n\nFigure 6.10: Comparing scoring strategies for responders and non responders in the POETIC dataset.\n\n\n\n\n\nBelow we show the correlation between these scores for all cohorts.\n\n\n\n\n\n\n\n\n\nThese scores are highly correlated but in different absolute scales. We now check the change in Ki67 for all patients and compare the scores with the original ones obtained with GSVA.\n\n\n\n\n\n\n\n\nFigure 6.11: Comparison of original GSVA and regressed scores between responders and non responders compared to change in Ki67.\n\n\n\n\n\nWe see that the bigger the change the higher the score is when using the regressed data. Also the non responders tend to have scores mostly in the negative scale, whereas the responders are more shifted to the right. SET ER/PR is also a good measure here.\n\n\n\n\n\n\n\n\n\nThere is a very good match between the two scores in general, meaning that the regression scoring strategy capture relatively well the scores. There is one patient that is a non-responder and has a low regressed estrogen early but a GSVA score close to 0, let us check this patient.\n\n\n\n\n\n\nIt is a patient that is far to the left on the molecular landscape, among the basal like, and had an increase in Ki67 upon ET. So the new scoring system was able to capture this patient as with low score.\n\n\n6.3.3 Survival analysis with the new scores\nWe can check how robust these scores are by performing survival analysis.\n\n\n\n\n\n\n\n\nFigure 6.12: Overall survival analysis from SCANB and METABRIC cohorts and their scores. The formulas used were the same as for the estrogen signaling analysis. Coefficients were scaled before performing cox regression\n\n\n\n\n\nThe plot with TCGA is shown below.\n\n\n\n\n\n\n\n\n\nScores for TCGA are noisier than SCANB and METABRIC. Though the scaled scores they have comparable hazard ratios and also they follow what we saw previously. The only pathway that is a bit different is the PI3K AKT MTOR signaling. This pathway had a noisier correlation with the GSVA score as well.",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Expanding embedding and removing batch effects</span>"
    ]
  },
  {
    "objectID": "chapters/expanding_ember.html#regressing-the-pdxs",
    "href": "chapters/expanding_ember.html#regressing-the-pdxs",
    "title": "6  Expanding embedding and removing batch effects",
    "section": "6.4 Regressing the PDXs",
    "text": "6.4 Regressing the PDXs\nWe can use the regressing strategy to score the PDXs and then evaluate their scores.\n\n\nTotal number of stable genes: 39\nTotal number of genes: 8205\nNumber of samples: 76\n[1] \"Normalization done.\"\n\n\nWe start by comparing the scores across the different control samples and their positions in the molecular landscape.\n\n\n\n\n\n\n\n\nFigure 6.13: Embedding of only regressed PDX control samples on top of the METABRIC, SCANB and TCGA samples\n\n\n\n\n\nThe results are jus twhat we got previously as well, meaning that by using all these genes the information of the PDXs are still captured. The main differences is that the luminal B region is more compact compare to Figure 3.20.\nAnd now that we have the results we can compare the PDXs as well.\n\n\n\n\n\n\n\n\nFigure 6.14: Scores obtained from the regressed data of the PDXs.\n\n\n\n\n\nThe random 200 is just a gene set with 200 random genes that works as a control and serves as a comparison to the other pathways.\nAnd below we show the distribution of some of the scores calculated for all the other cohorts as a comparison.\n\n\n\n\n\n\n\n\n\nWe see that METS15 is the one with the highest proliferation and lowest EMT, it is a PDX that comes from a pleural efusion. Also it is the PDX with the lowest apoptosis and highest DNA repair, probably due to a higher replication rate. Moreover, all these PDXs they have a estrogen response early scores higher than 0 in average, which is about the average of the scores in the ER+ BC samples.\nNow we check what happens with some of the PDXs when they are treated with P4, to compare with Figure 3.23.\n\n\n\n\n\n\n\n\nFigure 6.15: Comparison of position in the molecular landscape between CTRL, E2 and P4 treated samples with the regressed data\n\n\n\n\n\nThe results are very similar to what was seen previously using the GSVA. What is interesting here is that we have an absolute scale, so we can compare the scores.",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Expanding embedding and removing batch effects</span>"
    ]
  },
  {
    "objectID": "chapters/expanding_ember.html#singscore",
    "href": "chapters/expanding_ember.html#singscore",
    "title": "6  Expanding embedding and removing batch effects",
    "section": "6.5 singscore",
    "text": "6.5 singscore\nWe can try to use singscore instead, it is a sample dependent measure so it does not estimate the distribution of the gene expression levels before calculating the enrichment score.\nWe start by comparing with the GSVA scores.\n\n\n\n\n\n\n\n\nFigure 6.16\n\n\n\n\n\nWe see that in all cases there is a correlation, but the interpretation changes. In some of the pathways there is difference in the singscores based on the cohort, this is not seen on GSVA.\n\n\n\n\n\n\n\n\nFigure 6.17\n\n\n\n\n\nThe next figure shows the same comparison but instead of using singscore, we used ssGSEA.\n\n\n[1] \"Calculating ranks...\"\n[1] \"Calculating absolute values from ranks...\"\n[1] \"Calculating ranks...\"\n[1] \"Calculating absolute values from ranks...\"\n[1] \"Calculating ranks...\"\n[1] \"Calculating absolute values from ranks...\"\n[1] \"Calculating ranks...\"\n[1] \"Calculating absolute values from ranks...\"\n\n\n\n\n\n\n\n\n\n\n\nThe picture is similar as before, but now we actually look at the distributions across the 3 big cohorts. We used ssGSEA without the normalization, as that would be necessary in the case of an individual sample.\n\n\n\n\n\n\n\n\nFigure 6.18\n\n\n\n\n\nWe see that overall there is a discrepancy, sometimes big, depending on the pathway, including the random genes pathway. Next we show the same distribution for singscore. Similarly there is a big discrepancy in several cases.\n\n\n\n\n\n\n\n\nFigure 6.19\n\n\n\n\n\nBut now, Figure 6.20 shows that when we calculate the scores with the regressed data using our methodology the distributions are matched and adjusted, with the expection of G2M, which seems to be something more fundamental instead of batch effect. Note that all the distributions are overlapping significantly.\n\n\n\n\n\n\n\n\nFigure 6.20\n\n\n\n\n\nThe next two figures are the distributions of the singscore and GSVA filled by cohort.\n\n\n\n\n\n\n\n\n\nFor several pathways in the singscore the distributions are similar, but that is not always the case.\n\n\n\n\n\n\n\n\n\nOn the other hand GSVA gives very similar distributions for all the different cohorts. Therefore we actually need to use GSVA. It is important in the end to calculate scores based on the cohort.\nWe now move on and try the same analysis on the regressed data.\nWe start by comparing with the GSVA scores.\n\n\n\n\n\n\n\n\n\nWe see that in all cases there is a correlation, but the interpretation changes. In some of the pathways there is difference in the singscores based on the cohort, this is not seen on GSVA.\nThe next two figures are the distributions of the singscore and GSVA filled by cohort.\n\n\n\n\n\n\n\n\n\nIn the end the best way of scoring seems to be using GSVA on the unregressed data though it depends on the pathways. For example the hallmark estrogen response early and set ER/PR pathways seem to have been regressed quite well, so we can actually compare the results using the scores. On the other hand we can’t use the pathways G2M checkpoint, E2F targets and EMT. For the PI3K signaling score it seems it is comparable to SCANB only.",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Expanding embedding and removing batch effects</span>"
    ]
  },
  {
    "objectID": "chapters/trying.html",
    "href": "chapters/trying.html",
    "title": "7  Tests and tries",
    "section": "",
    "text": "7.1 Using several pathways or just one pathway for GSVA\nWe now evaluate the effect of the scores for each pathway when using all the 53 pathways combined and each one individually. We use only TCGA for this step.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Tests and tries</span>"
    ]
  },
  {
    "objectID": "chapters/trying.html#using-several-pathways-or-just-one-pathway-for-gsva",
    "href": "chapters/trying.html#using-several-pathways-or-just-one-pathway-for-gsva",
    "title": "7  Tests and tries",
    "section": "",
    "text": "7.1.1 One vs all\nWe now calculate the scores for each gene set individually.\n\n\n\n\n\n\n\n\n\nIt seems they are all positively correlated, so one could calculate the scores basically using just one gene set with exception of some of the gene sets.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Tests and tries</span>"
    ]
  },
  {
    "objectID": "chapters/trying.html#minimum-number-of-samples-for-gsva",
    "href": "chapters/trying.html#minimum-number-of-samples-for-gsva",
    "title": "7  Tests and tries",
    "section": "7.2 Minimum number of samples for GSVA",
    "text": "7.2 Minimum number of samples for GSVA\nAccording to the original GSVA paper, a minimum of 10 samples are necessary to have a good power when using GSVA. Since here we have at least 5 molecular subgroups, we hypothesize we need at least 50 samples to get a good score so we can compare across cohorts. We will try with different numbers of samples using TCGA, we start with 10, 25, 50 and 100 samples and we compare with the scores using the full dataset.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nThe conclusion we can take here is that depending on the gene set not even 150 samples is enough. For some only 25 patients is already enough, such as SET ER/PR, androgen response, estrogen response early and E2F targets.\nCould we mix around 20 samples of SCANB together with more samples from TCGA and METABRIC to get the scores? Let us try to adress this question again. We are using the regressed data now here as this is the only way.\n\n\n\n\n\n\n\n\n\nThere is still some correlation but the scores are shrinked in the end.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Tests and tries</span>"
    ]
  },
  {
    "objectID": "chapters/trying.html#normalization-strategy",
    "href": "chapters/trying.html#normalization-strategy",
    "title": "7  Tests and tries",
    "section": "7.3 Normalization strategy",
    "text": "7.3 Normalization strategy\nWe can also try another way of normalizing, namely for each sample we can z scale it.\nAnd now we can visualize the results.\n\n\n\n\n\n\n\n\nFigure 7.1: PCA projections colored by different factors and organized by different components. (A) Plot of the first two components colored by cohort. (B) Plot of the first two components colored by ER status. (C) Plot of the second and third components colored by cohort. (D) Plot of the second and third components colored by ER status. (E) Plot of the second and third components colored by PAM50. (F) Plot of the second and third components colored by INTCLUST, only METABRIC has an assigned value for this variable, NAs are TCGA samples.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nWe see that samples are well embedded as well.\n\n\n\n\n\n\n\n\nFigure 7.2: PCA embedding colored by cohort. The components used are the first and second components.\n\n\n\n\n\nSCANB and POETIC are in between as expected and they are closer to their sequencing technology. Interestingly the variation for SCANB and TCGA are compressed in the PC1 vs PC2 axis compared to METABRIC and POETIC.\nFigure 7.3 shows that the SCANB samples are also well mixed regarding the clinical factors, including the \\(SET_{ER/PR}\\) signature.\n\n\n\n\n\n\n\n\nFigure 7.3: PCA embedding of all samples from TCGA, SCANB and METABRIC. (A) Colored by cohort, (B) colored by ER status, (C) colored by PAM50 molecular subtype, (D) colored by the \\(SET_{ER/PR}\\) signature and only SCANB samples.\n\n\n\n\n\nIn the end normalizing by scaling the sample before doing any embedding works as well. Though the embedding seems to be more compressed. I would argue that the qPCR-like normalization gives a bit better embedding.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Tests and tries</span>"
    ]
  },
  {
    "objectID": "chapters/trying.html#genefu",
    "href": "chapters/trying.html#genefu",
    "title": "7  Tests and tries",
    "section": "7.4 genefu",
    "text": "7.4 genefu\nWith genefu it is possible to calculate scores from comercially available signatures. Here we try to use it on SCANB, METABRIC and TCGA. Moreover, we can start with ABiM, as this dataset has the gold standard ROR score obtained from nCounter data. This is a good way of validating the pipeline.\nWe start by comparing the molecular subtypes:\n\n\n\nFALSE  TRUE \n   14    86 \n\n\n86 out of 100 were correctly called. Here we are using the gold standard wich is the molecular subtype called from FT samples. The normal like subtype is not available from the FT prosigna assay. So we now compare the results with the SSP obtained from the SCANB team.\nBelow is the confusion matrix to see which subtypes were misclassified.\n\n\nConfusion Matrix and Statistics\n\n          Reference\nPrediction Basal Her2 LumB LumA Normal\n    Basal     13    0    0    0      0\n    Her2       0    8    0    0      0\n    LumB       1    1   33    1      0\n    LumA       1    0    7   32      0\n    Normal     1    0    0    2      0\n\nOverall Statistics\n                                          \n               Accuracy : 0.86            \n                 95% CI : (0.7763, 0.9213)\n    No Information Rate : 0.4             \n    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       \n                                          \n                  Kappa : 0.7965          \n                                          \n Mcnemar's Test P-Value : NA              \n\nStatistics by Class:\n\n                     Class: Basal Class: Her2 Class: LumB Class: LumA\nSensitivity                0.8125      0.8889      0.8250      0.9143\nSpecificity                1.0000      1.0000      0.9500      0.8769\nPos Pred Value             1.0000      1.0000      0.9167      0.8000\nNeg Pred Value             0.9655      0.9891      0.8906      0.9500\nPrevalence                 0.1600      0.0900      0.4000      0.3500\nDetection Rate             0.1300      0.0800      0.3300      0.3200\nDetection Prevalence       0.1300      0.0800      0.3600      0.4000\nBalanced Accuracy          0.9062      0.9444      0.8875      0.8956\n                     Class: Normal\nSensitivity                     NA\nSpecificity                   0.97\nPos Pred Value                  NA\nNeg Pred Value                  NA\nPrevalence                    0.00\nDetection Rate                0.00\nDetection Prevalence          0.03\nBalanced Accuracy               NA\n\n\nAll luminal A were predicted correctly. Some normal like were predicted to be luminal A or basal and Her2. There were some mismatches for the LumB, that were misclassified as LumA. Still it is ok.\nLet us now calculate the ROR for the ABiM cohort.\n\n\n\n\n\n\n\n\nFigure 7.4: Correlation between ROR obtained from prosigna assay and R package genefu\n\n\n\n\n\nThe correlation is relatively good and respects the molecular subtypes in general. The ROR obtained from genefu for some luminal B are not quite right as they are below 50.\nWe now move on to the other signatures: Mammaprint, EndoPredict (EP) and OncotypeDX Risk Score (RS).\n\n\n\n\n\n\n\n\nFigure 7.5: Correlation between ROR obtained from prosigna assay and the mammaprint signature obtained from the R package genefu\n\n\n\n\n\nFigure 7.5 shows the correlation between the mammaprint signature (named GENE70) and the ROR from prosigna.\nLet us now compare the GENE70 signature with the risk score developed in the previous chapters. We use the ABiM 100 cohort to make the comparison. One side note, we are using only 51 out of the 70 probes available in the package. 15 probes don’t have any corresponding symbol. Out of the available genes, some are duplicated. For the duplicated genes, the correlation coefficients are all similar, so we can select just the first ocurrence in the list.\n\n\n\n\n\n\n\n\n\nThere is a good correlation between the two signatures, suggesting that the Mammaprint signature is somehow based on the position of the samples in the molecular landscape.\nWe now proceed and calculate the mammaprint scores for SCANB and METABRIC as well and only for ER+ BC samples.\n\n\n\n\n\n\n\n\nFigure 7.6: Embedding of ER+ BC samples colored by the mammaprint score.\n\n\n\n\n\nWe see that the pattern is very close to what we have from the risk score created in the previous chapter. The figure below shows the correlation between mammaprint and the risk score once again.\n\n\n\n\n\n\n\n\n\nNow for OncotypeDX:\n\n\n\n\n\n\n\n\nFigure 7.7: Correlation between oncotypeDX and R package genefu\n\n\n\n\n\nThere is also a correlation between the risk score and oncotypeDX. The paper https://www.nature.com/articles/s41523-022-00492-0#Sec8 also used the genefu for calculating the oncotypeDX.\n\n7.4.1 genefu and AIMS\nHere we try to use AIMS to calculate the PAM50 subtypes for the and compare with the results obtained previously. We want to compare the classifications with the molecular landscape.\nThe confusion matrix below show the results of the AIMS PAM50 as the predicted and the reference is the PAM50 subtypes obtained from the SCANB team.\n\n\nConfusion Matrix and Statistics\n\n          Reference\nPrediction luma her2 normal lumb basal\n    luma   2301   61     51  664     0\n    her2      9  627     16  200     4\n    normal  724   37    830    6    11\n    lumb     17   17      0  938     0\n    basal     0   75     14    0   614\n\nOverall Statistics\n                                         \n               Accuracy : 0.7359         \n                 95% CI : (0.7255, 0.746)\n    No Information Rate : 0.4228         \n    P-Value [Acc &gt; NIR] : &lt; 2.2e-16      \n                                         \n                  Kappa : 0.6411         \n                                         \n Mcnemar's Test P-Value : NA             \n\nStatistics by Class:\n\n                     Class: luma Class: her2 Class: normal Class: lumb\nSensitivity               0.7542     0.76744        0.9111      0.5188\nSpecificity               0.8137     0.96421        0.8766      0.9937\nPos Pred Value            0.7478     0.73248        0.5162      0.9650\nNeg Pred Value            0.8188     0.97013        0.9856      0.8607\nPrevalence                0.4228     0.11322        0.1262      0.2506\nDetection Rate            0.3189     0.08689        0.1150      0.1300\nDetection Prevalence      0.4264     0.11863        0.2228      0.1347\nBalanced Accuracy         0.7839     0.86583        0.8938      0.7563\n                     Class: basal\nSensitivity               0.97615\nSpecificity               0.98649\nPos Pred Value            0.87340\nNeg Pred Value            0.99770\nPrevalence                0.08717\nDetection Rate            0.08509\nDetection Prevalence      0.09742\nBalanced Accuracy         0.98132\n\n\nWe see that there is a big misclassification from luminal A samples to normal like samples and several luminal B are misclassified as luminal A.\nThe plot below shows the coloring by the reference PAM50 and the predicted by AIMS.\n\n\n\n\n\n\n\n\nFigure 7.8: SCANB embedding stratified by PAM50 algorithms by both the ones provided by the SCANB (SSP) and the AIMS algorithm\n\n\n\n\n\nOn the left there is the coloring for the AIMS algorithm and on the right from the reference. We see the missclassified samples are not randomly misclassified, they are on the boundaries.\nThe plot below shows the maximum probability score for each sample individually.\n\n\n\n\n\n\n\n\n\nThe majority of samples have probabilities of either 1 or 0. Not so often in between.\nAnd the figure below shows the confusion matrix for the ABIM cohort.\n\n\nConfusion Matrix and Statistics\n\n          Reference\nPrediction luma lumb her2 normal\n    luma     28   17    1      3\n    lumb      0   16    0      0\n    her2      0    0   10      0\n    normal    2    0    2      2\n\nOverall Statistics\n                                          \n               Accuracy : 0.6914          \n                 95% CI : (0.5789, 0.7893)\n    No Information Rate : 0.4074          \n    P-Value [Acc &gt; NIR] : 2.253e-07       \n                                          \n                  Kappa : 0.5401          \n                                          \n Mcnemar's Test P-Value : NA              \n\nStatistics by Class:\n\n                     Class: luma Class: lumb Class: her2 Class: normal\nSensitivity               0.9333      0.4848      0.7692       0.40000\nSpecificity               0.5882      1.0000      1.0000       0.94737\nPos Pred Value            0.5714      1.0000      1.0000       0.33333\nNeg Pred Value            0.9375      0.7385      0.9577       0.96000\nPrevalence                0.3704      0.4074      0.1605       0.06173\nDetection Rate            0.3457      0.1975      0.1235       0.02469\nDetection Prevalence      0.6049      0.1975      0.1235       0.07407\nBalanced Accuracy         0.7608      0.7424      0.8846       0.67368\n\n\nWe see here that in this case that there are several luminal B samples missclassified as luminal A.\n\n\n\n\n\n\n\n\n\nThe misclassified samples from AIMS they really seem to be on the top region together with the luminal A. Some of the normal samples are even in the luminal A region.\nAnd another validation is using the normal cohort. Below is the number of all predicted molecular subtypes.\n\n\n\nNormal \n    66 \n\n\nAll samples are normal-like as expected, since they are normal.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Tests and tries</span>"
    ]
  },
  {
    "objectID": "chapters/trying.html#nanostring-signatures",
    "href": "chapters/trying.html#nanostring-signatures",
    "title": "7  Tests and tries",
    "section": "7.5 nanostring signatures",
    "text": "7.5 nanostring signatures\nIn this section we try the nanostring panel signatures provided by the Breast Cancer 360 test. We will compare some of the signatures by using GSVA on the original datasets and by calculating the sum of the gene expression levels of the genes when regressing out the 1st, 2nd and 5th components.\nThe table below shows the number of genes available for each signature and each dataset. In general it seems that all signatures have over 70% of the genes available, a good indication.\n\n\n\n\n\n\npathway\ntcga\nscanb\nmetabric\npoetic\nn\naverage_percentage\n\n\n\n\nadhesion_and_migration\n65\n61\n68\n83\n83\n0.83\n\n\nangiogenesis\n27\n27\n29\n33\n34\n0.85\n\n\nantigen_presentation\n20\n19\n19\n19\n21\n0.92\n\n\napoptosis\n7\n7\n5\n9\n9\n0.78\n\n\ncytokine_and_chemokine_signaling\n38\n29\n37\n47\n50\n0.76\n\n\ndna_damage_repair\n126\n108\n118\n133\n143\n0.85\n\n\nemt\n72\n71\n63\n82\n85\n0.85\n\n\ner_signaling\n27\n25\n24\n25\n27\n0.94\n\n\nepigenetic_regulation\n16\n16\n14\n17\n18\n0.88\n\n\nhedgehog\n14\n10\n17\n20\n20\n0.76\n\n\nimmune_infiltration\n24\n21\n23\n34\n34\n0.75\n\n\njak_stat\n37\n36\n35\n45\n47\n0.81\n\n\nmapk\n67\n61\n68\n95\n100\n0.73\n\n\nnotch\n21\n19\n16\n21\n22\n0.88\n\n\npi3k\n72\n67\n63\n91\n96\n0.76\n\n\nproliferation\n121\n113\n114\n136\n144\n0.84\n\n\nstromal_markers\n6\n6\n6\n6\n6\n1\n\n\nsubtypes\n69\n63\n62\n69\n70\n0.94\n\n\ntgf_beta\n47\n47\n42\n53\n57\n0.83\n\n\ntranscriptional_misregulation\n44\n37\n44\n61\n63\n0.74\n\n\ntriple_negative_biology\n38\n32\n41\n49\n50\n0.8\n\n\ntumor_metabolism\n15\n15\n14\n14\n15\n0.97\n\n\nwnt\n37\n34\n44\n51\n51\n0.81\n\n\ninternal_reference_gene\n18\n18\n16\n17\n18\n0.96\n\n\n\n\n\n\n\n\nWe now compare the scores obtained by GSVA on the datasets and see how they relate with nanostring scores obtained with the regressed data.\nFirst we compare GSVA SET ER/PR with ER signaling obtained by the scoring procedure when regressing the data.\n\n\n\n\n\n\n\n\n\nNext we compare EMT, G2M with proliferation and PI3K signaling.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nIn general there is a correlation but the scores are not so well correlated and they are noisy. One that works fairly well is the ER signaling score, but the others not so well. The proliferation score barely shows any difference between luminal A and B patients in any of the cohorts.\nPerhaps if we calculate the scores using the hallmarks pathways the scores are better correlated, since they are the same gene sets.\nBelow we plot the correlation between the proliferation pathway using GSVA and the regressed scoring strategy for the TCGA cohort.\n\n\n\n\n\n\n\n\n\nIt is perfectly correlated.\nAnd for ER signaling:\n\n\n\n\n\n\n\n\n\nAlso it is very much correlated. So the problem in the end is comparing the hallmarks signatures with the nanostring. But interestingly the nanostring proliferation signature was not good to pick up the differences between luminal A and B.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Tests and tries</span>"
    ]
  },
  {
    "objectID": "chapters/trying.html#risk-stratification-and-the-molecular-landscape",
    "href": "chapters/trying.html#risk-stratification-and-the-molecular-landscape",
    "title": "7  Tests and tries",
    "section": "7.6 Risk stratification and the molecular landscape",
    "text": "7.6 Risk stratification and the molecular landscape\nOne common problem in the clinics is what to do with patients that are in the so called intermediate risk group. Here we use the SSP classification from the SCANB team to check what is the position of these patients in the molecular landscape.\n\n\n\n\n\n\n\n\nFigure 7.9: Embedding of the SCANB samples colored by their predicted ROR risk category.\n\n\n\n\n\nFigure 7.9 shows that the embedding detects the positions where the intermediate risk patients are, namely they are in the intersection of the luminal A and B subtypes.\nAnd Figure 7.10 below shows that there is a shift in PC4 for the intermediate to the high risk group, which makes sense as this is exactly where the distinction between luminal A and B are.\n\n\n\n\n\n\n\n\nFigure 7.10: Distribution of the principal components for the different risk groups defined by the SSP ROR scores.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Tests and tries</span>"
    ]
  },
  {
    "objectID": "chapters/trying.html#late-distant-recurrence-trying-to-find-biomarkers",
    "href": "chapters/trying.html#late-distant-recurrence-trying-to-find-biomarkers",
    "title": "7  Tests and tries",
    "section": "7.7 Late distant recurrence: trying to find biomarkers",
    "text": "7.7 Late distant recurrence: trying to find biomarkers\nOne of the key problems in breast cancer research is finding patients that will develop late recurrence. Here we use METABRIC as it has a long follow-up history. We start by plotting the embedding of all METABRIC patients that had a followup longer than 10 years and received only ET. We then try to predict which patients recurr or not based on the molecular data by using lasso regression. For this we use the package glmnet that provides such functionality.\n\n\n\n\n\n\n\n\n\nIn general there is no distinction in terms of the molecular landscape among the patients that recurred, both in terms of molecular subtype and position in the molecular landscape.\nWe now compare their molecular scores.\n\n\n\n\n\n\n\n\n\nEven here we don’t see much difference. Unless there is some kind of linear combination of pathways, I don’t think it would be possible to classify these two groups by using only transcriptomic data and these pathways. In any case we proceed now with the lasso regression using the 50 pathways.\n\n\n\n\n\n\n\n\n\nWe see that actually it does not work. And when we predict all the samples are predicted as there is no recurrence.\n\n\n.\n no \n407 \n\n\nThis is probably because of the unbalanced dataset. Next we try with random forest as well.\n\n\n\nCall:\n randomForest(formula = as.factor(is_there_recurrence) ~ ., data = et_metabric_late_data[,      c(\"is_there_recurrence\", pathways_to_compare, \"AGE_AT_DIAGNOSIS\",          \"LYMPH_NODES_EXAMINED_POSITIVE\", \"npi\")], ntree = 500) \n               Type of random forest: classification\n                     Number of trees: 500\nNo. of variables tried at each split: 7\n\n        OOB estimate of  error rate: 17.44%\nConfusion matrix:\n     no yes class.error\nno  336   3 0.008849558\nyes  68   0 1.000000000\n\n\nThat is not the case, still we can’t predict if a patient will develop recurrence or not in this cohort.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Tests and tries</span>"
    ]
  },
  {
    "objectID": "chapters/trying.html#correlation-of-pathways-with-proliferation",
    "href": "chapters/trying.html#correlation-of-pathways-with-proliferation",
    "title": "7  Tests and tries",
    "section": "7.8 Correlation of pathways with proliferation",
    "text": "7.8 Correlation of pathways with proliferation\nOne thing that is very common is defining a gene signature and then using this gene signature to calculate survival analysis. The thing is, proliferation related genes are pretty much present in almost any signature and hence all these pathways are correlated to G2M and E2F to some extent (Venet, Dumont, and Detours 2011).\nHere we calculate the pathway scores by using the regressed data and do all pairwise comparison of some of the most important pathways to see their correlations.\n\n\n\n\n\n\n\n\n\nFirst we see that G2M and E2F are encoding basically the same information. PI3K AKT MTOR, AR and the Biocarta HER2 and SET ER/PR are all correlated to some extent to proliferation. Surprisingly the two HER2 signaling scores are not able to distinguish the HER2 subtype. The SET ER/PR correlation with G2M is possibly explained by the fact that the basal molecular subtype has higher G2M and lower ER signaling compared to luminal A and B.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Tests and tries</span>"
    ]
  },
  {
    "objectID": "chapters/trying.html#ilc-and-position-in-the-molecular-landscape",
    "href": "chapters/trying.html#ilc-and-position-in-the-molecular-landscape",
    "title": "7  Tests and tries",
    "section": "7.9 ILC and position in the molecular landscape",
    "text": "7.9 ILC and position in the molecular landscape\nInvasive lobular carcinoma is a subtype of ER+ BC. They tend to respond better to ET in the short term but they recurr after 20 years. Here we just show where the ILC BC lie in the molecular landscape.\n\n\n\n\n\n\n\n\nFigure 7.11: Embedding of the lobular samples from SCANB on top METABRIC and TCGA\n\n\n\n\n\nWe see that they are mostly in the normal and luminal A region. Still there are several samples that are luminal B, meaning they are more proliferative.\nIs there any difference in the SET ER/PR for lobulars when comparing to ER+ HER2- Ductal carcinomas?\n\n\n\n\n\n\n\n\n\nThey seem to be the same, also when checking the risk score calculated for all patients, the lobular patients don’t seem to have a decreased risk overall, it is mostly because they are in the same region of the molecular landscape. Interestingly there is way less luminal B patients in the lobular, but still their distributions are very similar.\n\n\n\n\n\n\n\n\n\nAnd we also plot by intrinsic molecular subtype.\n\n\n\n\n\n\n\n\n\nWe also compare EMT.\n\n\n\n\n\n\n\n\n\nEMT is very similar across both histological subtypes. The plot below shows the densities for ER percentage, notice how the two overlap.\n\n\n\n\n\n\n\n\n\nWe now check the lobular signature LobSig that is touted to be superior to OncotypeDX, Prosigna’s PAM50 and other signatures. In total, 63% of the genes are available here. Based on my experience this is already a good number to make comparisons. For example, G2M checkpoint has 71% of the genes available, estrogen response early has 66%.\n\n\n\n\n\n\n\n\n\nWe see that the LobSig is highgly correlated with G2M checkpoint and also the risk of recurrence score obtained from PAM50. The random 200 is a signature of 200 random genes that works as a negative control.\nThe figure below shows the distinction of the signature among the 3 different risk categories from ROR.\n\n\n\n\n\n\n\n\n\nThere is an increase in the score as expected based on the previous results that show where the intermediate risk group is according to the molecular landscape.\nLastly we check the CDH1 expression levels on the regressed data to see if the differences are still captured upon the whole process.\n\n\n\n\n\n\n\n\n\nThe differences are still captured, and CDH1 is decreased when comparing lobular vs NST. Note also that the difference seems to be the biggest in the luminal B subtype.\n\n\n\n\n\n\n\n\n\nWe also check the PC3 and PC4 loadings for CDH1, to see how important this gene is in the molecular landscape.\n\n\n  gene          PC3        PC4\n1 CDH1 0.0002872375 0.01509738\n\n\nPC4 has a relatively high value which puts it into the 95 percentile as shown below.\n\n\n[1] 0.9547769\n\n\nNext we can plot the lobular samples from Ciriello’s paper and color by the 3 subtypes they found. Note here that there is a mismatch between the cbioportal data and what is found in the original papers (Curtis et al. 2012). We will use the Curtis 2012 annotation as this is what matches Ciriello’s paper. Surprisingly the mismatch is not a systematic issue, rather 88 ILC samples are matching and the non-matching samples are NST but the other info matches usually, such as NPI.\n\n\n\n\n\n\n\n\nFigure 7.12: Embedding of the lobular samples from METABRIC on top SCANB and TCGA\n\n\n\n\n\nThe table below shows the number of subtypes for each molecular subtype. In general there are samples in each one of the molecular subtypes. The reactive-like is actually more enriched in the normal region.\n\n\n        subtype basal claudin-low her2 luma lumb normal\n Immune-Related     0           3    2   27   10      4\n  Proliferative     3           3    5   11   15      4\n  Reactive-like     0           5    1   22    2     20\n\n\nAnd below is a plot of the lobular samples from Ciriello/Curtis with the molecular subtypes defined by Ciriello.\n\n\n\n\n\n\n\n\n\nIt seems that more proliferative saaples are in the luminal B region whereas the Reactive-like and Immune-related are not so distinguishable, they are in the luminal A region.\nSome of the samples are NST on cbioportal and Lobular on Curtis. We selected the following samples and checked on cbioPortal (https://www.cbioportal.org/study/clinicalData?id=brca_metabric) their histologic subtype directly.\n\n\n  sample_name   npi\n1     MB-0035 3.056\n2     MB-0050 4.066\n3     MB-0083 3.026\n4     MB-0101 3.068\n5     MB-0102 5.080\n6     MB-0112 6.300\n\n\nAll the 6 samples are Ductal/NST and not Lobular.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Tests and tries</span>"
    ]
  },
  {
    "objectID": "chapters/trying.html#robustness-to-library-protocol",
    "href": "chapters/trying.html#robustness-to-library-protocol",
    "title": "7  Tests and tries",
    "section": "7.10 Robustness to library protocol",
    "text": "7.10 Robustness to library protocol\nThe figure below shows the first two components for SCANB stratified by the library protocol used in the study. We see that PC2 is partially capturing the differences due to library protocol.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Tests and tries</span>"
    ]
  },
  {
    "objectID": "chapters/trying.html#distance-in-4th-component-for-poetic",
    "href": "chapters/trying.html#distance-in-4th-component-for-poetic",
    "title": "7  Tests and tries",
    "section": "7.11 Distance in 4th component for POETIC",
    "text": "7.11 Distance in 4th component for POETIC\nWe have seen previosuly that there is a bigger difference in between the matched samples in the responder than to non-responder patients. Hallmark G2M checkpoint is one of the signatures driving the PC4, meaning that the position wrt the fourth component might be used to define a new response status.\nBelow we plot the matched samples for all non responder patients with no change at all in Ki67 (change &gt;= 0%) and their respective positions in the molecular landscape.\n\n\n\n\n\n\n\n\n\nNow we do the same for the top responders (change in Ki67 \\(\\leq\\) -90%).\n\n\n\n\n\n\n\n\n\nIn general the distance for the responder samples seem to be higher and not only that we see that the surgery sample goes to the bottom part of the embedding, suggesting that the reduction of the proliferation is reflected in the molecular landscape.\n\n\n\n\n\n\nCurtis, Christina, and Sohrab P. Shah, Suet-Feung Chin, Gulisa Turashvili, Oscar M. Rueda, Mark J. Dunning, Doug Speed, et al. 2012. “The Genomic and Transcriptomic Architecture of 2, 000 Breast Tumours Reveals Novel Subgroups.” Nature 486 (7403): 346–52. https://doi.org/10.1038/nature10983.\n\n\nVenet, David, Jacques E. Dumont, and Vincent Detours. 2011. “Most Random Gene Expression Signatures Are Significantly Associated with Breast Cancer Outcome.” Edited by Isidore Rigoutsos. PLoS Computational Biology 7 (10): e1002240. https://doi.org/10.1371/journal.pcbi.1002240.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Tests and tries</span>"
    ]
  },
  {
    "objectID": "chapters/revision.html",
    "href": "chapters/revision.html",
    "title": "8  Revision",
    "section": "",
    "text": "8.1 Comparing to combat’s performance\nWe know that the first two components of PCA correspond to cohort and platform specific effects. We can apply combat from the sva package on the unnormalized data.\nWe now check what is the relationship between the PC1 and PC2 from combat to the actual PCs from EMBER.\nAnd the spearman correlation is for PC3 and PC1:\nFigure 8.1\nIn a nutshell, the EMBER position corresponds to what is obtained by combat, with the advantage that we can actually use the embedding for new samples. Combat is restricted to the samples inputted.",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Revision</span>"
    ]
  },
  {
    "objectID": "chapters/revision.html#autoencoders",
    "href": "chapters/revision.html#autoencoders",
    "title": "8  Revision",
    "section": "8.2 Autoencoders",
    "text": "8.2 Autoencoders\n\n\n\nH2O is not running yet, starting it now...\n\nNote:  In case of errors look at the following log files:\n    /tmp/Rtmp1onj4w/file190e51b5063/h2o_ronchi_started_from_r.out\n    /tmp/Rtmp1onj4w/file190e565434c9f/h2o_ronchi_started_from_r.err\n\n\nStarting H2O JVM and connecting: .. Connection successful!\n\nR is connected to the H2O cluster: \n    H2O cluster uptime:         1 seconds 451 milliseconds \n    H2O cluster timezone:       Europe/Zurich \n    H2O data parsing timezone:  UTC \n    H2O cluster version:        3.44.0.3 \n    H2O cluster version age:    5 months \n    H2O cluster name:           H2O_started_from_R_ronchi_dzs657 \n    H2O cluster total nodes:    1 \n    H2O cluster total memory:   20.00 GB \n    H2O cluster total cores:    32 \n    H2O cluster allowed cores:  32 \n    H2O cluster healthy:        TRUE \n    H2O Connection ip:          localhost \n    H2O Connection port:        54321 \n    H2O Connection proxy:       NA \n    H2O Internal Security:      FALSE \n    R Version:                  R version 4.2.0 (2022-04-22) \n\n\nFeatures are the columns and the rows are the samples. So for the genomic data we have to transpose it.\n\n\n\n\n\n\n\n\nFigure 8.2\n\n\n\n\n\nJust using the autoencoder in the data does not work.\nWe now use on the normalized data instead on 4 units in the hidden layer.\n\n\n\n\n\n\n\n\nFigure 8.3\n\n\n\n\n\nAnd now coloring by er status. It is not really able to completely distinguish the ER+ and ER- samples.\n\n\n\n\n\n\n\n\nFigure 8.4\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 8.5\n\n\n\n\n\nWe do a pairsplot coloring by cohort to see where the distinction between cohorts is coming from.\n\n\n\n\n\n\n\n\nFigure 8.6\n\n\n\n\n\nAnd now coloring by ER status instead.\n\n\n\n\n\n\n\n\nFigure 8.7\n\n\n\n\n\nPerhaps now if we include more layers instead and use 4 components.\nIn terms of mean squared error all the models are very similar to each other. And based on the previous results it seems that by using",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Revision</span>"
    ]
  },
  {
    "objectID": "chapters/revision.html#mixing-analysis",
    "href": "chapters/revision.html#mixing-analysis",
    "title": "8  Revision",
    "section": "8.3 Mixing analysis",
    "text": "8.3 Mixing analysis\nIn this section we try to understand what is the minimum number of genes necessary to be able to distinguish ER+ and ER- BC samples. We select the top 10, 25, 50, 100, 200, 500, 750, 1000, 2500, 5000 and all the genes and try to classify the samples bewteen ER+ and ER- based on their position of the third component. This should give an idea of how good the embedding is based on the number of genes.\n\n\n\n\n\n\n\n\nFigure 8.8\n\n\n\n\n\nUsing less than 25 genes mixes well the cohorts in the first two components. When using more than 50 genes the mixing is already lost in the first two components. So what we actually want is a mixing in just one of the pairs of components, either PC1+PC2 or PC3+PC4 while there is no mixing in the other pair of component. By analysing visually this happens when using at least 1000 genes.\nDue to the difference in cohort sizes, METABRIC has 648 samples and TCGA 352, the expected iLISI coefficient is:\n\n\n[1] 1.84\n\n\nThe expected value for the iLISI coefficient when calculating for ER status is:\n\n\n[1] 1.59\n\n\nAnd the plot below shows the iLISI numbers for each combination of PC1+PC2 and PC3+PC4 annotated by the total number of genes. An integration by ER status means that the combination of components is not capturing the biology.\n\n\n\n\n\n\n\n\nFigure 8.9",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Revision</span>"
    ]
  },
  {
    "objectID": "chapters/revision.html#stable-genes",
    "href": "chapters/revision.html#stable-genes",
    "title": "8  Revision",
    "section": "8.4 Stable genes",
    "text": "8.4 Stable genes\nOne of the raised issues is that the average ranking of the stable genes might depend on phenotypes. Here we show that the distribution of average of stable genes is stable across different phenotypes, such as ER status and molecular subtype.\nFirst we plot by ER status in both METABRIC and TCGA.\n\n\n\n\n\n\n\n\nFigure 8.10",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Revision</span>"
    ]
  },
  {
    "objectID": "chapters/revision.html#scaling",
    "href": "chapters/revision.html#scaling",
    "title": "8  Revision",
    "section": "8.5 Scaling",
    "text": "8.5 Scaling\nWe now show the embedding using no scaling, i.e., just log FPKM and median intensity, using the qPCR like normalization and using a z-normalization on the sample level.\n\n\n\n\n\n\n\n\nFigure 8.11\n\n\n\n\n\nAnd now we compare the iLISI scores of the qPCR-like normalization and z-scaling as well.\n\n\n\n\n\n\n\n\nFigure 8.12",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Revision</span>"
    ]
  },
  {
    "objectID": "chapters/revision.html#tumor-purity-statistical-tests",
    "href": "chapters/revision.html#tumor-purity-statistical-tests",
    "title": "8  Revision",
    "section": "8.6 Tumor purity: statistical tests",
    "text": "8.6 Tumor purity: statistical tests\nOne of the points raised by the reviewers was about the statistics on the differences between the principal components stratified by molecular subtype. We perform ANOVA followed by a Tukey post hoc test.\n\n\n\n\n\n\n\n\nFigure 8.13",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Revision</span>"
    ]
  },
  {
    "objectID": "chapters/revision.html#metastasis-and-ffpe-data",
    "href": "chapters/revision.html#metastasis-and-ffpe-data",
    "title": "8  Revision",
    "section": "8.7 Metastasis and FFPE data",
    "text": "8.7 Metastasis and FFPE data\nAccessed 20240425: https://www.cbioportal.org/study/summary?id=brca_mbcproject_2022\nIn the cBioportal one can check the clinical data directly with all the information. When hovering over the column names it is possible to obtain the column names from the data available when downloaded. For example, the ER percentage is available from the sample in the diagnostics. Ki67, similarly. In general the metastasis do not have ER percentage.\n\n\n\n\n\n\nWe now try to understand if samples are coming from core biopsy, surgical procedures or from a metastasis setting. To start with that, we look at a single patient ID that has two breast samples.\n\n\n  BX_TIME_DAYS CALC_TREATMENT_NAIVE    BX_TYPE\n1            0                  YES       CORE\n2          114                   NO MASTECTOMY\n\n\nFor patient with ID MBCProject_4MF1FlFQ, there are two samples. One at time of diagnosis, core biopsy, and the other at a mastectomy after 114 days of treatment. The column CALC_TREATMENT_NAIVE tells if the sample is treatment naive or not, BX_TYPE corresponds to the type of surgery (PATH Procedure Type column on cBioPortal).\nWe now look at another patient (MBCProject_5gHasou8):\n\n\n  BX_TIME_DAYS CALC_TREATMENT_NAIVE    BX_TYPE\n1            0                  YES       CORE\n2          199                   NO MASTECTOMY\n\n\nThe results are similar for this patient too. We now move on and use EMBER on all available samples and then compare these matched samples.\n\n\nTotal number of stable genes: 44\nTotal number of genes: 1037\nNumber of samples: 153\n\n\nWe show all the samples from the project below on top of TCGA, SCAN-B and METABRIC.\n\n\n\n\n\n\n\n\nFigure 8.14\n\n\n\n\n\nAnd now stratified by either local metastasis/primary sample or by distant metastasis.\n\n\n\n\n\n\n\n\nFigure 8.15\n\n\n\n\n\nBoth combined for the response to reviewers:",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Revision</span>"
    ]
  },
  {
    "objectID": "chapters/revision.html#tnbc-and-er",
    "href": "chapters/revision.html#tnbc-and-er",
    "title": "8  Revision",
    "section": "8.8 TNBC and ER+",
    "text": "8.8 TNBC and ER+\nHere we use another cohort with both ER+ and ER- samples coming from FFPE with two different library preparation protocols: Illumina-Access and Nugen-Ovation.\n\n\nTotal number of stable genes: 44\nTotal number of genes: 1022\nNumber of samples: 21\n\n\nWe now show the samples highlighted on top of EMBER space with samples from TCGA and METABRIC.\n\n\n\n\n\n\n\n\nFigure 8.16",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Revision</span>"
    ]
  },
  {
    "objectID": "chapters/revision.html#scan-b-library-protocol",
    "href": "chapters/revision.html#scan-b-library-protocol",
    "title": "8  Revision",
    "section": "8.9 SCAN-B library protocol",
    "text": "8.9 SCAN-B library protocol\nSCAN-B has 3 different types of samples based on their library protocol, namely: dUTP, NeoPrep and TruSeq.\nHere we show that EMBER is capable of fully removing any effects associated to library protocol.\n\n\n\n\n\n\n\n\nFigure 8.17",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Revision</span>"
    ]
  },
  {
    "objectID": "chapters/revision.html#scaling-before-doing-pca",
    "href": "chapters/revision.html#scaling-before-doing-pca",
    "title": "8  Revision",
    "section": "8.10 Scaling before doing PCA",
    "text": "8.10 Scaling before doing PCA\nWhen developing EMBER we did not center or scale the data, as the gene expressions after normalization all had the same range. Here we compare what happens when doing the centering followed by the scaling and then applying PCA.\nTo understand the effect of centering and scaling the data prior to applying PCA, we compared the loadings of PC1 from EMBER to the average of the genes in the normalized data (a). The correlation between these two variables is -1, showing that PC1 corresponds to centering. When comparing the loadings with PC2 and the standard deviation of genes after centering, the higher loadings in absolute value are correlated with higher standard deviation (b).\nNext, we show that PC1 and PC2 are correlated with PC1 obtained after centering and scaling the data (c), showing that EMBER’s PC1 and PC2 is automatically centering and scaling the data at the same time removing batch effects. In order to confirm that no biological information is lost when performing PCA on the uncentered and unscaled data, we compared EMBER’s PC3 and PC4 with PC2 and PC3 from the scaled data respectively (d and e). The correlation is 1 in both cases for both cohorts: METABRIC and TCGA. We show that there is no need to center and scale prior to applying PCA in EMBER’s context.\n\n\n\n\n\n\n\n\nFigure 8.18",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Revision</span>"
    ]
  },
  {
    "objectID": "chapters/references.html",
    "href": "chapters/references.html",
    "title": "References",
    "section": "",
    "text": "Bhuva, Dharmesh D, Joseph Cursons, and Melissa J Davis. 2020.\n“Stable Gene Expression for Normalisation and Single-Sample\nScoring.” Nucleic Acids Research 48 (19): e113–13. https://doi.org/10.1093/nar/gkaa802.\n\n\nBuus, Richard, Ivana Sestak, Ralf Kronenwett, Sean Ferree, Catherine A.\nSchnabel, Frederick L. Baehner, Elizabeth A. Mallon, Jack Cuzick, and\nMitch Dowsett. 2021. “Molecular Drivers of Onco&lt;i&gt;type&lt;/i&gt;\nDX, Prosigna, EndoPredict, and the Breast\nCancer Index: A TransATAC Study.” Journal of\nClinical Oncology 39 (2): 126–35. https://doi.org/10.1200/jco.20.00853.\n\n\nCox, D. R. 1972. “Regression Models and Life-Tables.”\nJournal of the Royal Statistical Society: Series B\n(Methodological) 34 (2): 187–202. https://doi.org/10.1111/j.2517-6161.1972.tb00899.x.\n\n\nCurtis, Christina, and Sohrab P. Shah, Suet-Feung Chin, Gulisa\nTurashvili, Oscar M. Rueda, Mark J. Dunning, Doug Speed, et al. 2012.\n“The Genomic and Transcriptomic Architecture of 2, 000 Breast\nTumours Reveals Novel Subgroups.” Nature 486 (7403):\n346–52. https://doi.org/10.1038/nature10983.\n\n\nFei, Teng, Tengjiao Zhang, Weiyang Shi, and Tianwei Yu. 2018.\n“Mitigating the Adverse Impact of Batch Effects in Sample Pattern\nDetection.” Edited by Inanc Birol. Bioinformatics 34\n(15): 2634–41. https://doi.org/10.1093/bioinformatics/bty117.\n\n\nGao, Qiong, and Elena López-Knowles, Maggie Chon U. Cheang, James\nMorden, Ricardo Ribas, Kally Sidhu, David Evans, et al. 2019.\n“Impact of Aromatase Inhibitor Treatment on Global Gene Expression\nand Its Association with Antiproliferative Response in\nER$\\mathplus$ Breast\nCancer in Postmenopausal Patients.” Breast Cancer\nResearch 22 (1). https://doi.org/10.1186/s13058-019-1223-z.\n\n\nGelman, Andrew, Jennifer Hill, and Aki Vehtari. 2020. Regression and\nOther Stories. Analytical Methods for Social Research. Cambridge,\nEngland: Cambridge University Press.\n\n\nHänzelmann, Sonja, Robert Castelo, and Justin Guinney. 2013.\n“GSVA: Gene Set Variation Analysis for Microarray and\nRNA-Seq Data.” BMC\nBioinformatics 14 (1). https://doi.org/10.1186/1471-2105-14-7.\n\n\nKan, Zhengyan, Ying Ding, Jinho Kim, Hae Hyun Jung, Woosung Chung, Samir\nLal, Soonweng Cho, et al. 2018. “Multi-Omics Profiling of Younger\nAsian Breast Cancers Reveals Distinctive Molecular Signatures.”\nNature Communications 9 (1). https://doi.org/10.1038/s41467-018-04129-4.\n\n\nMcElreath, Richard. 2020. Statistical Rethinking. 2nd ed.\nChapman & Hall/CRC Texts in Statistical Science. London, England:\nCRC Press.\n\n\nPaik, Soonmyung, Steven Shak, Gong Tang, Chungyeul Kim, Joffre Baker,\nMaureen Cronin, Frederick L. Baehner, et al. 2004. “A Multigene\nAssay to Predict Recurrence of Tamoxifen-Treated, Node-Negative Breast\nCancer.” New England Journal of Medicine 351 (27):\n2817–26. https://doi.org/10.1056/nejmoa041588.\n\n\nRisso, Davide, John Ngai, Terence P Speed, and Sandrine Dudoit. 2014.\n“Normalization of RNA-Seq Data Using Factor Analysis\nof Control Genes or Samples.” Nature Biotechnology 32\n(9): 896–902. https://doi.org/10.1038/nbt.2931.\n\n\nScabia, Valentina, Ayyakkannu Ayyanan, Fabio De Martino, Andrea\nAgnoletto, Laura Battista, Csaba Laszlo, Assia Treboux, et al. 2022.\n“Estrogen Receptor Positive Breast Cancers Have Patient Specific\nHormone Sensitivities and Rely on Progesterone Receptor.”\nNature Communications 13 (1). https://doi.org/10.1038/s41467-022-30898-0.\n\n\nSflomos, George, Valerian Dormoy, Tauno Metsalu, Rachel Jeitziner, Laura\nBattista, Valentina Scabia, Wassim Raffoul, et al. 2016. “A\nPreclinical Model for ERα-Positive Breast Cancer Points to the\nEpithelial Microenvironment as Determinant of Luminal Phenotype and\nHormone Response.” Cancer Cell 29 (3): 407–22. https://doi.org/10.1016/j.ccell.2016.02.002.\n\n\nSinn, Bruno V., Chunxiao Fu, Rosanna Lau, Jennifer Litton, Tsung-Heng\nTsai, Rashmi Murthy, Alda Tam, et al. 2019.\n“SETER/PR: A Robust 18-Gene Predictor\nfor Sensitivity to Endocrine Therapy for Metastatic Breast\nCancer.” Npj Breast Cancer 5 (1). https://doi.org/10.1038/s41523-019-0111-0.\n\n\nStaaf, Johan, Jari Häkkinen, Cecilia Hegardt, Lao H. Saal, Siker\nKimbung, Ingrid Hedenfalk, Tonje Lien, et al. 2022.\n“RNA Sequencing-Based Single Sample Predictors of\nMolecular Subtype and Risk of Recurrence for Clinical Assessment of\nEarly-Stage Breast Cancer.” Npj Breast Cancer 8 (1). https://doi.org/10.1038/s41523-022-00465-3.\n\n\nSubramanian, Aravind, Pablo Tamayo, Vamsi K. Mootha, Sayan Mukherjee,\nBenjamin L. Ebert, Michael A. Gillette, Amanda Paulovich, et al. 2005.\n“Gene Set Enrichment Analysis: A Knowledge-Based Approach for\nInterpreting Genome-Wide Expression Profiles.” Proceedings of\nthe National Academy of Sciences 102 (43): 15545–50. https://doi.org/10.1073/pnas.0506580102.\n\n\nSyriopoulou, Elisavet, Tove Wästerlid, Paul C. Lambert, and Therese\nM.-L. Andersson. 2022. “Standardised Survival Probabilities: A\nUseful and Informative Tool for Reporting Regression Models for Survival\nData.” British Journal of Cancer 127 (10): 1808–15. https://doi.org/10.1038/s41416-022-01949-6.\n\n\nVenet, David, Jacques E. Dumont, and Vincent Detours. 2011. “Most\nRandom Gene Expression Signatures Are Significantly Associated with\nBreast Cancer Outcome.” Edited by Isidore Rigoutsos.\nPLoS Computational Biology 7 (10): e1002240. https://doi.org/10.1371/journal.pcbi.1002240.\n\n\nVijver, Marc J. van de, Yudong D. He, Laura J. van t Veer, Hongyue Dai,\nAugustinus A. M. Hart, Dorien W. Voskuil, George J. Schreiber, et al.\n2002. “A Gene-Expression Signature as a Predictor of Survival in\nBreast Cancer.” New England Journal of Medicine 347\n(25): 1999–2009. https://doi.org/10.1056/nejmoa021967.\n\n\nWallden, Brett, James Storhoff, Torsten Nielsen, Naeem Dowidar, Carl\nSchaper, Sean Ferree, Shuzhen Liu, et al. 2015. “Development and\nVerification of the PAM50-Based Prosigna Breast Cancer Gene\nSignature Assay.” BMC Medical Genomics 8\n(1). https://doi.org/10.1186/s12920-015-0129-6.\n\n\nWishart, Gordon C, Elizabeth M Azzato, David C Greenberg, Jem Rashbass,\nOlive Kearins, Gill Lawrence, Carlos Caldas, and Paul DP Pharoah. 2010.\n“PREDICT: A New UK Prognostic Model That\nPredicts Survival Following Surgery for Invasive Breast Cancer.”\nBreast Cancer Research 12 (1). https://doi.org/10.1186/bcr2464.\n\n\nZhang, Yuqing, Giovanni Parmigiani, and W Evan Johnson. 2020.\n“ComBat-Seq: Batch Effect Adjustment for\nRNA-Seq Count Data.” NAR Genomics\nand Bioinformatics 2 (3). https://doi.org/10.1093/nargab/lqaa078.",
    "crumbs": [
      "References"
    ]
  }
]