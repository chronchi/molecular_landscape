<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>EMBER creates a unified space for independent breast cancer transcriptomic datasets enabling precision oncology. - 2&nbsp; A new framework for personalized medicine: integrating</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/validation.html" rel="next">
<link href="../chapters/surv_analysis_estrogen.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="../site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../site_libs/datatables-binding-0.28/datatables.js"></script>
<script src="../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../site_libs/dt-core-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../site_libs/dt-core-1.13.4/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../site_libs/dt-core-1.13.4/js/jquery.dataTables.min.js"></script>
<link href="../site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="../site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="../site_libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet">
<script src="../site_libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="../site_libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet">
<script src="../site_libs/selectize-0.12.0/selectize.min.js"></script>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/pca_merging.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A new framework for personalized medicine: integrating</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">EMBER creates a unified space for independent breast cancer transcriptomic datasets enabling precision oncology.</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/chronchi/molecular_landscape" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="https://twitter.com/intent/tweet?url=|url|" title="Twitter" class="quarto-navigation-tool px-1" aria-label="Twitter"><i class="bi bi-twitter"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/surv_analysis_estrogen.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Estrogen receptor status is continuous, not dichotomous</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/pca_merging.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A new framework for personalized medicine: integrating</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/validation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Validating the molecular landscape</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/scoring.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Pathway activity in a personalized context</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/risk_score.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Risk score model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/expanding_ember.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Expanding embedding and removing batch effects</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/trying.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Tests and tries</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/discussion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Discussion</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#transcriptomics-and-qpcr-normalization" id="toc-transcriptomics-and-qpcr-normalization" class="nav-link active" data-scroll-target="#transcriptomics-and-qpcr-normalization"><span class="header-section-number">2.1</span> Transcriptomics and qPCR normalization</a>
  <ul class="collapse">
  <li><a href="#selecting-stable-genes" id="toc-selecting-stable-genes" class="nav-link" data-scroll-target="#selecting-stable-genes"><span class="header-section-number">2.1.1</span> Selecting stable genes</a></li>
  <li><a href="#calculating-the-normalization" id="toc-calculating-the-normalization" class="nav-link" data-scroll-target="#calculating-the-normalization"><span class="header-section-number">2.1.2</span> Calculating the normalization</a></li>
  <li><a href="#checking-robustness-with-respect-of-number-of-stable-genes-available" id="toc-checking-robustness-with-respect-of-number-of-stable-genes-available" class="nav-link" data-scroll-target="#checking-robustness-with-respect-of-number-of-stable-genes-available"><span class="header-section-number">2.1.3</span> Checking robustness with respect of number of stable genes available</a></li>
  </ul></li>
  <li><a href="#integrating-tcga-and-metabric-using-pca" id="toc-integrating-tcga-and-metabric-using-pca" class="nav-link" data-scroll-target="#integrating-tcga-and-metabric-using-pca"><span class="header-section-number">2.2</span> Integrating TCGA and METABRIC using PCA</a></li>
  <li><a href="#the-integration-is-robust-with-respect-of-selection-of-samples" id="toc-the-integration-is-robust-with-respect-of-selection-of-samples" class="nav-link" data-scroll-target="#the-integration-is-robust-with-respect-of-selection-of-samples"><span class="header-section-number">2.3</span> The integration is robust with respect of selection of samples</a></li>
  <li><a href="#normalization-is-necessary-to-reduce-batch-effects-in-other-components" id="toc-normalization-is-necessary-to-reduce-batch-effects-in-other-components" class="nav-link" data-scroll-target="#normalization-is-necessary-to-reduce-batch-effects-in-other-components"><span class="header-section-number">2.4</span> Normalization is necessary to reduce batch effects in other components</a></li>
  <li><a href="#molecular-landscape-is-characterized-by-several-pathways" id="toc-molecular-landscape-is-characterized-by-several-pathways" class="nav-link" data-scroll-target="#molecular-landscape-is-characterized-by-several-pathways"><span class="header-section-number">2.5</span> Molecular landscape is characterized by several pathways</a></li>
  <li><a href="#tumor-purity" id="toc-tumor-purity" class="nav-link" data-scroll-target="#tumor-purity"><span class="header-section-number">2.6</span> Tumor Purity</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/chronchi/molecular_landscape/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">A new framework for personalized medicine: integrating</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In the next few chapters we will show a new framework for personalized medicine. This is motivated by the fact that we know already some patients are more sensitive to endocrine therapy than others, but we don’t know what are possible treatments. Moreover, it is very difficult to compare, molecularly, patients among themselves.</p>
<p>The PREDICT tool <span class="citation" data-cites="Wishart2010">(<a href="references.html#ref-Wishart2010" role="doc-biblioref">Wishart et al. 2010</a>)</span> provides a tool for practitioners to calculate survival risks among patients with similar clinical characteristics. This is very important as it shows how to combine data from previous patients to guide further treatments of new patients. However, no additional information is given, such as alternative pathways to target or what might be different from other patients.</p>
<p>Other tools that help in the clinics are the molecular signatures developed by companies <span class="citation" data-cites="Wallden2015 vandeVijver2002 Paik2004">(<a href="references.html#ref-Wallden2015" role="doc-biblioref">Wallden et al. 2015</a>; <a href="references.html#ref-vandeVijver2002" role="doc-biblioref">Vijver et al. 2002</a>; <a href="references.html#ref-Paik2004" role="doc-biblioref">Paik et al. 2004</a>)</span>. These signatures are intended to be used with ER+ BC patients and depending on the tool, on node negative, post-menopausal women. Based on the set of genes, a risk score is assigned or each patient. The score means if a patient would benefit from additional chemotherapy besides the usual endocrine therapy received for either 5 or 10 years. They also lack the additional information of what are possible pathways involved and alternative treatments beside chemotherapy.</p>
<p>There are a few challenges to overcome pathway analysis for patients individually and how to compare patients molecularly. There is no tool that allows to integrate patients in a continuous way. Usually integration is a one step procedure and cannot be updated. The usual tools are <span class="citation" data-cites="Risso2014 Zhang2020 Fei2018">(<a href="references.html#ref-Risso2014" role="doc-biblioref">Risso et al. 2014</a>; <a href="references.html#ref-Zhang2020" role="doc-biblioref">Zhang, Parmigiani, and Johnson 2020</a>; <a href="references.html#ref-Fei2018" role="doc-biblioref">Fei et al. 2018</a>)</span> and they do not provide batch effect removal for new samples. The only way is to re-run the procedure together with the new sample. The problem of doing this is usually you don’t have enough samples to estimate batch effects across groups and therefore correct it.</p>
<p>This chapter show how to perform PCA projection using samples from different datasets and how new samples can be introduced without retraining of the PCA. We first introduce the notion of a new normalization that depends on housekeeping genes. After using this new normalization, we proceed with PCA on a subset of two cohorts using the 1000 most variable genes. We then validate the integration with new samples from a completely different cohort.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>* The library is already synchronized with the lockfile.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    ../../results/plots/pca_merging ../../results/rds_files/pca_merging 
                               TRUE                                TRUE 
   ../../results/tables/pca_merging 
                               TRUE </code></pre>
</div>
</div>
<section id="transcriptomics-and-qpcr-normalization" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="transcriptomics-and-qpcr-normalization"><span class="header-section-number">2.1</span> Transcriptomics and qPCR normalization</h2>
<p>In this first step we introduce a new normalization. The rational is that we need a normalization procedure that is applied in a single sample only, similar to logCPM, but that can be applied to microarray too. In this case, given a set of samples, we start by ranking the genes in each sample. We then normalize the ranking to be between 0 and 1, i.e., we divide by the total number of genes available in that sample. Then, given a list of 50 stable genes across cancer <span class="citation" data-cites="Bhuva2020">(<a href="references.html#ref-Bhuva2020" role="doc-biblioref">Bhuva, Cursons, and Davis 2020</a>)</span>, we calculate the average ranking of these genes in the sample and then for each gene in the sample we divide by this average.</p>
<section id="selecting-stable-genes" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="selecting-stable-genes"><span class="header-section-number">2.1.1</span> Selecting stable genes</h3>
<p>The first step is to check what number of these 50 genes are available on TCGA and METABRIC, as these datasets will be used for training the PCA projection. The total number of available genes is 44. <a href="#fig-stable-genes">Table&nbsp;<span>2.1</span></a> shows the name of the genes available in TCGA and METABRIC.</p>
<p>Now we select the 1000 most variable genes across METABRIC and TCGA. Reducing the number of genes used when calculating the PCA helps in the future. Several publicly available datasets don’t have many genes available, therefore reducing the number of genes increases the chances of using this approach in other datasets.</p>
<p>Moreover, the use of a large number of genes is used because if some of them are not available. We show in later sections that if some number of stable genes are missing, it will not affect the normalization.</p>
<div class="cell">
<div id="fig-stable-genes" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-cba45d21eb210939e6c3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-cba45d21eb210939e6c3">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44"],["ASB7","C2orf42","CNOT4","RBM45","NRF1","ZNF143","AMMECR1L","SMARCAL1","WDR33","ZNF394","UBE3B","SFSWAP","PPHLN1","SART3","CPSF6","CELF1","IWS1","STAMBP","ERCC3","RBM22","TOR1A","CNOT2","TIAL1","HDAC3","RSRC2","DDX42","TARDBP","RNF10","SRSF1","KHDRBS1","ZNF207","DDB1","SF3B1","SF1","UBE2I","UBE2D3","RAB1A","SRSF3","SFPQ","EIF4H","PCBP1","HNRNPK","DYNLL1","HNRNPA2B1"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>genes<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"columnDefs":[{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<figcaption class="figure-caption">Figure&nbsp;2.1: (<a href="#fig-stable-genes">Table&nbsp;<span>2.1</span></a>) Available stable genes in both TCGA and METABRIC cohorts.</figcaption>
</figure>
</div>
</div>
</section>
<section id="calculating-the-normalization" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="calculating-the-normalization"><span class="header-section-number">2.1.2</span> Calculating the normalization</h3>
<p>We will create subset of the summarised experiment objects to save these information. Moreover, since a summarized experiment object is being used, we can save the new normalization in the <code>assays</code> and the average ranking scores of the housekeeping genes in the column data <code>colData</code>. This way it is very easy to retrieve the information for the patients.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-comparison-sd-cv" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-comparison-sd-cv-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.2: Comparison of coefficient of variation and standard deviation scores.</figcaption>
</figure>
</div>
</div>
</div>
<p>They are highly correlated values, so we stick to the coefficient of variation as it makes more sense in this kind of analysis.</p>
<p><a href="#fig-sd-stable-genes">Table&nbsp;<span>2.3</span></a> shows the top 1000 genes along with their standard deviation. The stable genes are also added to the list.</p>
<div class="cell">
<div id="fig-sd-stable-genes" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-ddb387e8e26f50b37c76" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ddb387e8e26f50b37c76">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.018382631544801\" data-max=\"0.368915306302523\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.028939961048932\" data-max=\"0.332844416126166\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.026797320783449\" data-max=\"0.348935799832624\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[[0.09409142381852553,0.1176935634424329,0.09480971228101942,0.1120050492734515,0.220017274674532,0.1638949407991986,0.1506277390274833,0.09629872097665969,0.09557626528412672,0.1288866641789458,0.1000359877013967,0.1607101204544812,0.1144636196727763,0.09069089908298353,0.117875812408174,0.1531060925439634,0.02432409632621264,0.1435056934541036,0.09858661412434203,0.1177822546622222,0.1001122410791405,0.1662257913407683,0.2562171880913405,0.08371932224109258,0.1099302587553717,0.1791705370299749,0.1645095616081917,0.09979773323903479,0.1269404779828023,0.1628986903746859,0.1234704908993575,0.02652340636431073,0.1102616715066932,0.09644868411359783,0.0985221102404845,0.09611814901172895,0.1119834008331968,0.1125659664815707,0.1207416897075633,0.1691214813800026,0.1263088330996051,0.1485979307205692,0.1209067270690703,0.1065522038824215,0.148841049974628,0.09504342389059441,0.1039286694543506,0.1703711224922479,0.1540342525947126,0.1039503676858751,0.1890115158119121,0.1124555722566098,0.1082498091879139,0.1258948075299861,0.1664377922365177,0.1827502730720058,0.1140712003571645,0.1132351583279202,0.03605563078770729,0.1644759984361225,0.1448646962522434,0.1385378134353889,0.1022417865463092,0.1288064049412639,0.1089014607404258,0.1495362334460811,0.1209089146847604,0.2174282518081999,0.2146364570977562,0.1334625188388989,0.09472098547789801,0.1097740351498216,0.1426276633582687,0.0951001578408045,0.1205084243366047,0.1074258700736594,0.1295915707311134,0.1627539569037692,0.1473403140360854,0.09037629415607119,0.1246497126170426,0.1115873674763983,0.1037760872812495,0.1063526927849255,0.1461722984853855,0.105161795712176,0.1004489706349908,0.1147655821150011,0.1680307146688678,0.09619688760422372,0.1533030981216523,0.1091414491584685,0.1001200476368318,0.02970072970499526,0.1127339953881799,0.1184749185081622,0.1010658931428917,0.1044838925540858,0.1363408536703294,0.1121109414594426,0.1407098109071779,0.1268103340387695,0.1247359000752625,0.129978894435638,0.1531273805579401,0.1286858350801479,0.03455399705145402,0.1185740705426447,0.1254030219352009,0.101596861781221,0.1387093617574258,0.09474275092570626,0.107689406003718,0.1060362550998071,0.1191398061754192,0.1098909216481983,0.02926205107884508,0.1064911865394206,0.1955117209862898,0.09253000395944851,0.1121409559910951,0.1153958285290558,0.1607439537658097,0.107458072143173,0.1114010731676081,0.1279794575178844,0.03684035138369772,0.1132200899522725,0.1252748810871149,0.1185467688455017,0.1404638868567708,0.1682748504392941,0.1144150582252679,0.1191292135155245,0.2194033162968295,0.1093218986288146,0.1038177082169842,0.1212785862093969,0.1115612696765348,0.1230473440493891,0.1470678051640571,0.122295764653616,0.1263870017837109,0.1010735059498781,0.09226059247984179,0.1102712095883244,0.1253230163470866,0.1303941182110746,0.1176386839412527,0.1284903255288286,0.1313551369954807,0.1509117058467009,0.1562981843562842,0.09573781494845723,0.1377458002377852,0.1396681801795317,0.1176672613583505,0.1450902288435105,0.09048293611547893,0.1046151370275484,0.1058289519280463,0.09705357527086778,0.1158696888120561,0.1655996199167736,0.2418217060369157,0.1314917625786337,0.1429803939594216,0.1121565944877875,0.2224790531635413,0.1300980154882725,0.1361590664786834,0.1167115149112386,0.101218611694772,0.09254549864461559,0.1031544888935087,0.1038199650525999,0.1077205367179034,0.09762253029315698,0.1039562081424457,0.09591963710409973,0.1326693345194186,0.1347008457957057,0.1338330454360339,0.03339540877630598,0.1936443064236346,0.1046776123830376,0.1181346066202,0.1620049786811071,0.2167432201998562,0.09533676951806327,0.1173229099361139,0.1088133924261491,0.09872340812337063,0.1765989944495963,0.2383267651640887,0.09659873234450767,0.1327034636922385,0.1362251079263554,0.09715293127286402,0.1236626701646869,0.1093938251334664,0.1613095134877674,0.1192188034363534,0.1047177491709158,0.1098711044418636,0.2157564936381217,0.161163310186792,0.1010281696403005,0.1140995405515434,0.1260547007060496,0.1163279386334519,0.1250070436422109,0.1111430165800302,0.1587341470661658,0.165444695111098,0.1259725671344637,0.1770837407880423,0.09261017170058602,0.1326868909143644,0.1172695450187024,0.09935891166914398,0.1186766899198862,0.1091898816967355,0.0226391673146897,0.1428742462279879,0.1131920048410127,0.08092597487009466,0.1136574340102804,0.2250955763247553,0.1028357944814459,0.02566606254520762,0.2160779781848303,0.2050639802488202,0.111655495190076,0.1776432082317086,0.139600160023776,0.09389010270221931,0.1331591672630705,0.1949280369177019,0.2225294561176324,0.1251738992963897,0.1600199013372412,0.1219198239544113,0.1842593978274581,0.07704716366097521,0.1437719620597399,0.02530086966309989,0.1304857270624603,0.1312818372587527,0.09947423372546561,0.147666520054188,0.126006077088509,0.1547179021134484,0.09150584628721305,0.176802151771479,0.08732387434070521,0.08719981525262434,0.1052748621288358,0.1057356897573319,0.3689153063025228,0.104331732045395,0.1397851383651699,0.02600266460562244,0.1220953198984137,0.1067421028272972,0.1149883754378315,0.126332388960205,0.03575291583390214,0.02751356169406646,0.1174102272478048,0.08907757455530968,0.1180704633138639,0.1106828576881592,0.09866728517281625,0.1428366950936685,0.1184154047333708,0.1010838773047246,0.1165297701712255,0.02318510339701407,0.1025265085314258,0.08595111218315382,0.1620862258884321,0.1118804929832166,0.1400841263008634,0.1357570818250276,0.1155683384053112,0.1134302637538799,0.1056908212615408,0.1776116103369882,0.1802797445343935,0.1014386903494574,0.1732023144973381,0.1666154143561339,0.1371758338539376,0.1023551901850896,0.1315047639974937,0.1133788629193991,0.1096875989121953,0.1305319641837607,0.1721354719692472,0.1222741763179311,0.1273958937566008,0.1154060359007238,0.1024800336204056,0.0278487878123212,0.1074083381140843,0.15957047724892,0.1245215672982167,0.1089747799642764,0.1036308234984972,0.03014866379066083,0.1185243092976806,0.104880405376708,0.1063789566964211,0.02213816594069931,0.159627837101031,0.1007804721958857,0.1174292889888988,0.1293340669843424,0.1545432529130697,0.1277525053727492,0.1691742165617031,0.1090085541856997,0.1348083010576832,0.1905255699938799,0.117547997952708,0.1063182911641736,0.1269447012023731,0.1941788864707429,0.1336838490642953,0.1009864319185669,0.1115023606409696,0.1000569083864654,0.1328428686144996,0.1377463414805917,0.1901057699238404,0.1275957265212216,0.1195736758496089,0.1173069213550137,0.1773540898146783,0.1592477135629465,0.1046831052748875,0.1632627460824836,0.1166162366960369,0.111752779932686,0.1102263208185395,0.1441091589045889,0.1432125960454344,0.1081919378548133,0.02006281181935253,0.1876050724086821,0.1382463004093661,0.1073496495904421,0.02074968016532044,0.09674248743813162,0.1163997505188497,0.08324898032910286,0.1075795845144902,0.1184428183972172,0.02222142660276202,0.08906536703650489,0.1363673503822238,0.1267420109027204,0.1014840429447829,0.08836662378731203,0.113879805032124,0.1246714525697947,0.1300365052584749,0.1155696713924006,0.1534252553266967,0.101428440260975,0.1793296805622969,0.1578654854979897,0.2340528204588195,0.1075677988358942,0.1055565400478211,0.1899244591069965,0.03158283712048329,0.1371663091303351,0.1675141265464397,0.1026861397025599,0.365027183539083,0.2099914611184077,0.1611553418663369,0.108675052015722,0.09540905892444825,0.1896542378231105,0.1291522893708825,0.1105109266627614,0.1230348014660124,0.1325223193887811,0.1172558323363141,0.1385161872157933,0.09604986831318284,0.1353061546617252,0.09276347317197496,0.1704493297735515,0.1378283333325675,0.1161628996839944,0.1536765192805309,0.1157738835683492,0.1267718187468945,0.1103974520399942,0.115078796077079,0.09230714746317632,0.09559991179088903,0.1150169752430331,0.09886072837738523,0.2452099447626128,0.1555947448172086,0.1122597258747331,0.1282939407131349,0.09836251025655027,0.1854244943418681,0.08808694624338342,0.1066626871826444,0.1357158058167573,0.1373398576101049,0.1435354742653404,0.1080827111797413,0.1336714299917185,0.1128174814128471,0.1861628220075043,0.155419226885632,0.09089683508685237,0.1411652202809067,0.1048138109219044,0.1052133987076373,0.09790009929293571,0.10930383020151,0.09509488836009473,0.2550838197614244,0.1204087863078392,0.1503259436457106,0.1480154248650673,0.1178761200188594,0.1744504580981159,0.1062939973378628,0.1271201403426829,0.1419167632229072,0.09678116268270678,0.121659227041102,0.1570761908628181,0.1095554640773713,0.09711359007902411,0.1460523610805625,0.1269068901156807,0.1541798083497682,0.09039882825965179,0.1157572779029049,0.2098136770306243,0.02837774445502916,0.1352456871726177,0.1282421295113776,0.09958419062762124,0.1504846319698503,0.1810328223519864,0.1047638803192674,0.1420069020543689,0.1093782267558431,0.1375758793288679,0.1340094899070093,0.1484582541174479,0.1172095803312781,0.1120520282831335,0.1057653656044306,0.1649961559115153,0.1209200034222454,0.152688595765257,0.1774333789076087,0.1677419830414646,0.12396726284195,0.1566876121292974,0.1483055320808807,0.1782508297244157,0.1125463707140593,0.1025113181839834,0.1152465695639047,0.09858070371116831,0.1060261069581068,0.02568518494886986,0.1416501818837035,0.1279398602047279,0.02121113598776647,0.1073649956496553,0.03076855943618718,0.0913667262655693,0.1206504763482178,0.0981012382909035,0.2286794492274588,0.1204905471245655,0.09867960401780788,0.1238351239798733,0.1206541695937868,0.1292015496733899,0.09571488961140731,0.1028301738043173,0.2093721446843518,0.1214432382360785,0.09653483017359868,0.1261965194216148,0.1444636147287965,0.1237651701012465,0.1208731887001188,0.0284572508542065,0.1173047571267864,0.1526246528410405,0.02896693749105339,0.1492095564252268,0.1610528076297492,0.1189334979928836,0.1959425717595941,0.1575218899510138,0.1087461594554505,0.1605662170504726,0.1039000791689625,0.1541104659292887,0.143941859142438,0.0988780818524891,0.0945237429190714,0.1047884515354961,0.1944728167958706,0.1171650246521921,0.1469930792271323,0.0966216509023176,0.1138481587323285,0.1442441297233221,0.1058933654789825,0.1148423707066524,0.1185889115973708,0.1082102480548253,0.1266066766023902,0.1028538063404992,0.1230923680909475,0.1231978340374688,0.1233391769007916,0.1202120155643448,0.1192026545962869,0.2269206067425157,0.1095133549001143,0.0963185958672447,0.0926196925306708,0.1478387018941694,0.1251123266797811,0.1055214243585331,0.119546508010458,0.1276071920580088,0.1435298624982988,0.08771280281199106,0.09644990921946316,0.1334065521627174,0.1484538595067492,0.2871211393821669,0.123859309155607,0.1276630242119123,0.09836080206127522,0.1042684106254736,0.1976805450697906,0.03455580841798501,0.1292135001357981,0.1346576908391545,0.1464830220858805,0.1126665666466998,0.1245686398786703,0.1078979436218622,0.1062412776243547,0.1270664406586384,0.1131244489980454,0.1131000786864972,0.09972454914439079,0.1543738762613148,0.1233032205962026,0.190972668369635,0.1422179337232608,0.101943845115809,0.1506905090416942,0.1127230373582872,0.1141930734755762,0.1768441538343333,0.1417432912016257,0.1102074829480632,0.117140795625508,0.1649343834575019,0.1725903711411621,0.09761768022476067,0.1354924082975812,0.1292958519140728,0.1342034267924269,0.1932750692170958,0.08889303757357109,0.1516790276960159,0.02555100524971294,0.1199335180645344,0.1638778273997543,0.1173542854370819,0.1100772536886251,0.118735176145076,0.1762154798386099,0.1739926215315146,0.1438454763163725,0.1085627650328553,0.03975901791292448,0.07311016758241655,0.1085363710428684,0.1045745811302139,0.1004127214655152,0.09337955596766574,0.1192492442203344,0.1047811294124312,0.2435683874327872,0.02641789069969269,0.1827854057498509,0.1088604395399872,0.1279502608257423,0.1261362732215742,0.1222723678172249,0.1327549676196393,0.1304676712377555,0.1169136666767637,0.1448067313553419,0.1225134889627465,0.1012261130315268,0.1473813221251192,0.164395512454005,0.1377840477181946,0.1765589299710968,0.111542409667105,0.1340733470285226,0.1434873508871715,0.1100627299583937,0.1153954014284145,0.1089975044343374,0.1312806170927314,0.02689195505042914,0.114817852738119,0.09745606940622328,0.1020940534981113,0.149096184641041,0.14247746291488,0.1198427564578733,0.1303688027617218,0.124300467913282,0.08858852150750599,0.1876631293246279,0.1612336984800236,0.1631259356026061,0.1140622865488832,0.1294013954227847,0.1197335162629674,0.2035065223192292,0.1228161942275894,0.1219845526861538,0.1723053202079671,0.1045013478750171,0.1498281135044735,0.1513140114123256,0.1064675882890906,0.2784580627696743,0.1164681712450207,0.09801363484588649,0.07912602699204291,0.1338901629479889,0.3327937242354163,0.1235556563743584,0.2589271516312776,0.3242440998118263,0.2119940503307642,0.1399076421441398,0.1359653140690349,0.1220688191348152,0.1093981543299632,0.1318875240298426,0.03842976500609773,0.1057392059961596,0.1662491012954526,0.1226733258848122,0.1063073382082934,0.153962649823319,0.1973830710528043,0.1257161894527648,0.1330675149360778,0.2160579437430175,0.1097346219209225,0.1604835323290002,0.1150559239034358,0.1344503682370145,0.1159688680604668,0.1231729165807331,0.1017523982726028,0.1125104574479277,0.1531148397844761,0.1328684796445125,0.1291491147635704,0.1153369199168406,0.1256993005219043,0.1718634352598662,0.1386635510090425,0.209637564428009,0.173317797890786,0.1442260056396634,0.1379240752872857,0.1547477829501652,0.02906088098202775,0.03111191204573807,0.26062562215781,0.1672887279103998,0.1028784477269073,0.1469664816590539,0.109606360012404,0.1183892309529767,0.1166411012222277,0.1870196750254901,0.1170192040744058,0.1237950524624178,0.1298274904603393,0.1889270797769731,0.1083852396426977,0.09713233903576962,0.1090335133133722,0.1624820307525514,0.1224630129403493,0.119696787005887,0.1126100113033644,0.1591630693160938,0.1817081553858615,0.1127431582761744,0.1238948176711261,0.1158886968104162,0.1188244201672561,0.1411197740697375,0.126436402846951,0.08677268271612017,0.1433933857038095,0.09318338616078681,0.1109654079604207,0.1211773031142591,0.106478535975266,0.01838263154480149,0.132045158816851,0.1282172158069134,0.1055344529789453,0.1223778120088217,0.1278991561692265,0.1301479679500526,0.1588501399204894,0.1482467940297208,0.1153264357986697,0.1309000877680563,0.102360094740222,0.1117775405144412,0.1382523580020789,0.1050208560184035,0.1549503102349843,0.1055413788060127,0.1210565009705878,0.09134477717062742,0.1224106506203086,0.09663054187239777,0.03322967928310003,0.1526334873535055,0.1354725585592678,0.1144411437825655,0.1397076640489563,0.1569041676351709,0.111827897116134,0.1492325220329523,0.1120189512283893,0.1412742380797702,0.1315621651128199,0.1199566061926431,0.1079434822436172,0.1396382519658812,0.1597283350425096,0.1229756121841994,0.1404546501006317,0.2186606291436017,0.1122054740180939,0.1599922080354076,0.1331475284118813,0.168536350796077,0.1189034995676494,0.09664744489145233,0.08926900165358219,0.03273081407628897,0.02070774957576282,0.1037863746465946,0.1050836679774141,0.1057416274659982,0.1881457070745384,0.1584251487075001,0.179854845659584,0.1289882112193273,0.1635936411176998,0.1390099299185885,0.1263732165454766,0.1131109881346475,0.1719271834557799,0.1122758073770425,0.119715051094239,0.1034058701831709,0.1716192857879763,0.1435706932166534,0.1242562762907969,0.03201185320940513,0.1127885207266086,0.148435551705584,0.1233803915819096,0.1303656556429413,0.1111624717340987,0.1021672625140396,0.09965185743926533,0.09705803112980523,0.09968287556483302,0.2578998856214721,0.1301862797888903,0.2528990883760407,0.1327982427154244,0.1289001029055158,0.1731824943594279,0.1206383996265268,0.1619366526817067,0.102762455338942,0.1044443067843856,0.1127760078368421,0.2185469739068743,0.2242603262147407,0.109182396853238,0.1058511949235103,0.03124910467289222,0.1217003134608197,0.1255498969703603,0.1168461988213193,0.08236838265678081,0.08745956636003925,0.1429066454701882,0.2024057830024004,0.1043564744913857,0.1143056267144317,0.1787642814133722,0.1383966059629298,0.1042119897681247,0.1531103289267126,0.1472887585266267,0.1437580597801283,0.227956655454659,0.1289532362721083,0.1319664217772438,0.1416002216684333,0.1522253835341643,0.1837140946349125,0.09497264024842635,0.2192304644799103,0.2707827270602784,0.1085861213851297,0.1205995497254635,0.1636776691785285,0.1240765751124581,0.118174972758321,0.1484557882036678,0.1319199468988102,0.1204834526977057,0.159088514764416,0.1838511496813192,0.2200543472299365,0.1556296773316797,0.1350899653277766,0.1491821219074538,0.1202096137491775,0.1834919520712569,0.1080361206044933,0.1187031052749422,0.1188528005438795,0.1059913529887888,0.1798154792148933,0.09635565120572789,0.1266354321723737,0.1089736389544454,0.1148495231421292,0.1113677961686406,0.1200478211311911,0.1345585819513101,0.1088430284777429,0.1039345000957489,0.1652918654073577,0.1638431548369109,0.1057568586853552,0.1585863372670949,0.162970184965483,0.1224291914930438,0.1165592899378639,0.1524714973707738,0.101876177256425,0.1594620389123908,0.1351120176851595,0.09808939269263918,0.196399035376597,0.1100290028123868,0.17035517314858,0.1228116473454221,0.1340566771478494,0.1150382044579029,0.09932907418267185,0.1068567376913415,0.09136376595041665,0.1014022184910813,0.102660497694999,0.1056615602404904,0.1006523920157333,0.1863459612818847,0.1509696406335446,0.1000589154166058,0.1539089472826406,0.1425391009520752,0.1075814685581907,0.1173782699052615,0.04697425503766327,0.1022763315572813,0.1894143466503611,0.1259597400771771,0.1593011556936736,0.1071315034294681,0.1371903111596044,0.1068144008210408,0.09777974496340175,0.1250781348521534,0.1350793766569433,0.2207837896270365,0.1495536362812845,0.1273830719623383,0.1509993239632003,0.1263801763949451,0.137459803968229,0.1213773333027348,0.1166485927906417,0.1443701524241262,0.1075872505283537,0.1370385535813288,0.1165554356235407,0.2663265457110244,0.09936401125912446,0.1774409198837665,0.09817800306635682,0.2269573672946041,0.1063594246958755,0.2747764594502013,0.1894089862587428,0.1505318798744205,0.1524297921491508,0.1024478674416898,0.1252958710529037,0.1165986011138724,0.1159560054923277,0.1167717198889442,0.1516447849379428,0.09507887674487125,0.1552722622163956,0.1402755316746072,0.1082929452157201,0.1414135787247668,0.1356083222063814,0.1283856320613884,0.1494639815193144,0.2325188818886366,0.04467607422183516,0.1711654253058249,0.1861556120552187,0.1384522286483679,0.1036973957812061,0.1757580831568738,0.1436311834990095,0.1231844206115966,0.136034172815872,0.1371857384633448,0.1189756164420961,0.1102147860918646,0.1464161277446684,0.1299559751885168,0.1117625000538879,0.1028621899379763,0.1513419358129553,0.1069375941254457,0.1524165616924112,0.1159983402848973,0.1151100128130115,0.1308968164253195,0.1170355924762701,0.1760457049581214,0.102927710479972,0.1125238252119285,0.0975819027713601,0.1205197755667324,0.0319333778583423,0.1168776058677039,0.1086758231069146,0.1141185348373991,0.1730199136394695,0.1598111673405929,0.09466135533733812,0.09089167129311446,0.2302920808370979,0.1289963420379673,0.1073895752491398,0.2046713286232323,0.1053816277778685,0.07029003489819635,0.1208614181583426,0.1429414553154117,0.1050345002239964,0.1352344274926571,0.1409001631911556,0.2077331697114485,0.1057400297919548,0.1019886181491111,0.1823960790653079,0.140565306430686,0.184612020075795,0.1239578957175577,0.1008054014487992,0.1776826321923101,0.1078853822136591,0.09860948283659587,0.1095990315437494,0.1125764944232531,0.1704404102787773,0.1109319053873638,0.1842664340186368,0.1691123214214218,0.1921298260875249,0.1680398902195956,0.1155388327579146,0.1129487941584645,0.1034996346558388,0.1201140936420851,0.1220040608691019,0.1328544406361791,0.1428018845161565,0.1177109233244734,0.124636547249607,0.1023073958579957,0.1740720216259195,0.1047847642868017,0.2044440612939896,0.1639427074834127,0.11946591317954],[0.1167041435304317,0.1105446088752121,0.1016476274663383,0.110244627728233,0.2219128633443597,0.126197600942318,0.134363774303815,0.112832290494509,0.1133294253935536,0.1490672203803743,0.1225401607344725,0.1530257356528203,0.1438351671633344,0.1051751363320525,0.1086707057696966,0.1059394242311008,0.03142890065838603,0.1198628659158764,0.1211422853208177,0.09533895739115236,0.1588458488536966,0.1036304066857293,0.2641453335168931,0.1143403961541698,0.1201800678215836,0.1184157175511122,0.09413136577230342,0.1016781659326484,0.1136744275599147,0.1334662603882634,0.1193841632809281,0.05063285347703211,0.09549437763111485,0.1084755893892106,0.1195264658777979,0.1073035159404098,0.1273172834817874,0.1089937196536753,0.1427378586976816,0.08864686070703284,0.1220696461225888,0.1354060020774329,0.1120264691292627,0.09793300340330732,0.1273072285932334,0.1016933120968327,0.1205699735736706,0.1156493791696942,0.1396104362655915,0.1068400676064091,0.1782662406062899,0.1088794968710036,0.1386396921566111,0.1141001613087562,0.1394843166376734,0.1833831950021808,0.0939581979448296,0.08249225706096221,0.04515445047424437,0.1703703223596038,0.07710521523149018,0.1157188546626256,0.1108091888375755,0.1082517815710702,0.1265393313084742,0.1366444729853312,0.1224503554011347,0.142022951561239,0.1751099734409513,0.08407341492309278,0.1147080426961206,0.119778872370917,0.1092821262283748,0.1132041484407617,0.1241519500969896,0.09949203577850706,0.08496592195328379,0.1536362050624671,0.1482592927378864,0.1062156842664543,0.1078684853504997,0.1198348269060262,0.1183810168562085,0.1023233032396787,0.09560351015746608,0.1122700417117864,0.09652854310987267,0.09949146521252043,0.1705354222963699,0.1059515246885813,0.1552279214331643,0.1183335767921564,0.1127112061545424,0.03464393415788947,0.1142079490560484,0.1366815676714499,0.1189802722014456,0.1065339158856147,0.105448011303086,0.1135582850874995,0.1211252135107279,0.1338034158117002,0.08325188619925276,0.1285334739213615,0.07353397967778534,0.1111728664988087,0.03867474187679914,0.08071068920617305,0.07532270646721906,0.09405929334843582,0.1033289345202468,0.1012839413619354,0.106836587046523,0.1064469523237846,0.1057746986875562,0.103863967893358,0.03193956489211341,0.09422041827773919,0.176055693122801,0.1035483080489218,0.1153826870332908,0.1006397593259939,0.1224729470151265,0.113641757929335,0.09163578857617016,0.1054588131127442,0.0412726888723292,0.1286655429755564,0.08085965814038412,0.1423388446851362,0.1844752632268914,0.132962822507797,0.08819360893442361,0.1257078113343481,0.2224348521903071,0.1079817249742155,0.09658838846763547,0.1131003352840014,0.1104758683914639,0.1331294643354652,0.1328030488331408,0.07549412504429738,0.1290812504365839,0.1093761020534671,0.1154184435387099,0.09780251127771239,0.0898934918393486,0.1142303332630811,0.09789694278416294,0.1426644901455652,0.138475801986354,0.1632737809738266,0.08554987608967285,0.1161743778149519,0.09227148709024743,0.1141932198105187,0.1062713542275334,0.1340937367485384,0.1063836677996006,0.1131151688703691,0.105738151755836,0.1002335970185961,0.1065774276813602,0.166703387627197,0.2308120445074921,0.1120873469157457,0.08623355762328348,0.08932803615515747,0.0515368719130033,0.1132065075337585,0.119022849925763,0.1336322946908746,0.1092844145815942,0.1172864204666581,0.1012960556695178,0.1277720067290513,0.113201062613602,0.1213692669907341,0.1048700835291065,0.1045387311520479,0.100469401118603,0.1556785725311643,0.1129967959878967,0.03794054638937568,0.115182432796615,0.120800095708289,0.09419453557052829,0.1454763045852653,0.1033215280523707,0.1058268005476868,0.1186668298072533,0.1226149114029047,0.09945542048062858,0.1920481233890124,0.2284115802139096,0.1118341647475288,0.1551695013778915,0.103657703629775,0.1106889822558839,0.1166517056181972,0.1297499418547756,0.07973065109788005,0.1136552809881697,0.1231434077273797,0.1034112762857635,0.1898335899904814,0.150142504686612,0.09929219319471003,0.0883358603091685,0.1051144548202364,0.09320037596476551,0.1254387528832266,0.09640687115443296,0.1551490212879233,0.1373355571818301,0.1214197974873583,0.08545433473585931,0.1131320010634625,0.07527151736860636,0.1082247540083736,0.1129639728459956,0.1215512699475863,0.1100576393253762,0.03095547425220959,0.1588943774678143,0.08765222423611188,0.1219923164959972,0.1032914347476873,0.1900740048579794,0.1040333392529385,0.1097415531201155,0.145502403221709,0.170240160988856,0.1157252375036199,0.1804049688743645,0.1582371996851705,0.1263779495827023,0.1480199929372353,0.1967302657561882,0.1323481633505731,0.08883034599207189,0.1629164787503148,0.1244567265527222,0.1274687381795399,0.1329832621125603,0.122929024806283,0.04326142860446622,0.1456255676133492,0.1094721332132207,0.1218639884353747,0.08459502715215335,0.1211809747390653,0.1464562583316451,0.1047222085478251,0.1718064826347908,0.1117986507966979,0.1133768721663548,0.09335103380796801,0.09441729193318998,0.289257879707473,0.09532597585010638,0.1347066917878703,0.04565914741861835,0.1159522511930291,0.1035676410483783,0.1054664446560719,0.1050471323968581,0.04423861134270849,0.03481370746485884,0.1152344062856918,0.1108847750996086,0.1221538259003017,0.1299819748977588,0.1153325960518868,0.1100086973817994,0.1352062001700901,0.1028476405044573,0.08051369772126482,0.04959141732759553,0.1081270752282713,0.1229696661086137,0.05294328135602001,0.1219886836971461,0.1511477147463735,0.1270338503017927,0.1113649691810775,0.1370249379390207,0.1133957445781608,0.1739017843988149,0.1791203990404405,0.09533952729651485,0.1981735353188557,0.1573514626491532,0.1072667005621275,0.1076897574914916,0.1116345746997809,0.1156483782745288,0.09485368431891095,0.08746679520156014,0.1560533622408671,0.148665595433161,0.1437917054309061,0.1062732545940415,0.09904034518285793,0.06043947923749651,0.1247160664462229,0.1490533868160208,0.1189809347075364,0.112540259089275,0.113602753287581,0.03721764263800516,0.08586889563362057,0.1037657089095467,0.1232612274021292,0.04408477200988918,0.1287273694112764,0.1080258080230974,0.1283078701725179,0.1261217925952736,0.1541914806903619,0.1389638651236496,0.0360822998148246,0.102972244516136,0.108467105923666,0.1620932761914508,0.1360487231474201,0.09863948003139254,0.134068540346957,0.160364577260938,0.08233951944363452,0.1049036285370888,0.1234768117274855,0.1116242964455867,0.1274508942288121,0.1770303164904238,0.1975336530546393,0.1148940479341175,0.129826205353007,0.1132881882481195,0.1696801786119629,0.1194633871282602,0.13280347413669,0.05547045763215246,0.1276612220653108,0.09011267118660606,0.1156097913139489,0.141880356805558,0.1287823639329016,0.1035570742135819,0.05189382994178498,0.1418869993060196,0.1462186476703535,0.1043945254645362,0.03876585993295772,0.1056644435824601,0.1132773279752152,0.1385348481395345,0.09301336159294001,0.1164443027928674,0.07196139449529788,0.1268837932701485,0.1350497691869581,0.08822555207408496,0.1103549114932969,0.1266969470484936,0.09594487391297074,0.1273838387609584,0.1192379348555355,0.105678029850401,0.1713945078262654,0.09976281916011627,0.1148013755582167,0.1399991312076703,0.2104787691833249,0.1063458226600418,0.1092927206628507,0.06426493068429544,0.0494033214763077,0.1408353051681873,0.1452895327043048,0.1026390731785088,0.3328444161261651,0.1991358771984391,0.1444773553998116,0.1201265888801902,0.1317785363347463,0.198443837282427,0.08614983771723464,0.09305627221713043,0.1051790066771737,0.1597210198954847,0.09120175625786205,0.1486322983759803,0.1048995647448458,0.1282900318556762,0.1081285185804036,0.1338576685733101,0.1289130007098654,0.09274360479307266,0.1379690912739441,0.1154393728256441,0.1187432489363431,0.1166261760300514,0.1270732429635457,0.1041941422207331,0.1046969903951289,0.1169494679630195,0.1011006831554367,0.2199650194451538,0.1460216749959261,0.1145613112768727,0.1135766462187539,0.1003470358129733,0.1626671377710693,0.1172907841324617,0.09027933472047259,0.06014526725947253,0.1258580661589623,0.1081408479573849,0.1020340127737583,0.1037427880904001,0.1296918185293939,0.1601580723988833,0.1428254999492196,0.1073898458093406,0.1582428258563341,0.1136490752914613,0.1125507909349039,0.09768691009678754,0.1236046902758019,0.1163128306029434,0.2495348948789647,0.1021690620592998,0.094183962372222,0.12926776106826,0.1093047992703439,0.1486852007834955,0.1221281878310257,0.1091373611634377,0.1416180545373614,0.1052130601885393,0.09218797056054058,0.1459089301871177,0.1207460123141517,0.1454016396790049,0.1400230424107877,0.107274331519985,0.1631623012399397,0.1223296162395554,0.263789365036306,0.2144083004211961,0.04281865648391264,0.1225788247742185,0.07700712462132854,0.1165038459936708,0.1299929513572689,0.1805414315880047,0.09622567938080941,0.1553297137340977,0.1011105967971917,0.139401004387695,0.1166393652457359,0.1226986337912398,0.09066315386990334,0.09942324048485512,0.09145129466286187,0.1386966349964265,0.1173464690660075,0.1280906659316879,0.1778053506185461,0.1324808186041135,0.1049913748360678,0.1584242194634097,0.1519149720757047,0.1680981458959237,0.1221077867240578,0.1171003806426868,0.1077927527919766,0.1006778153491418,0.09872515285978818,0.03674757718887137,0.1010275306109994,0.08122699968109311,0.05421031854546356,0.1248718387550206,0.03825334302180491,0.1055926958797462,0.1327802786541516,0.1234330423340642,0.1705658600402764,0.08092937536684358,0.1068947715588835,0.1143095178576979,0.1203040735493287,0.1410549814744255,0.1086906312286192,0.09844436958333842,0.2125468301268895,0.08161289625383893,0.1009299451779446,0.1292695150351515,0.1489892398723351,0.113438014373522,0.1328838037892592,0.03933347067091689,0.1043003143674926,0.1277163780851694,0.03709833090838899,0.1387237615708773,0.1569764017938092,0.115665795344992,0.2070883653147174,0.09966852120246256,0.1079215324356607,0.156254944697754,0.1051853578187143,0.1238358408078194,0.1090395871195507,0.1261146682204998,0.1202050515848667,0.09613378429258959,0.09168437614551568,0.146082340408016,0.1185603979130628,0.1086932824144708,0.1109659592966718,0.1231089013265112,0.09849927040004536,0.1150313038539368,0.1759244597309783,0.09806082396081078,0.1178015716996582,0.1258541899658902,0.1693215889130435,0.08230349029330392,0.0899126988010099,0.1430641971831387,0.1110893825561044,0.1665801540688012,0.09698097715748662,0.136201894357175,0.1085333085148055,0.1365969292468313,0.07403063965280327,0.1216791057385377,0.1238590042459121,0.09020369021620833,0.1601338405852549,0.1109963185061602,0.11077900691118,0.1455873293822632,0.126118739007164,0.2642987648970235,0.1190742068358724,0.09263384910654485,0.1113591256899686,0.1087159312351768,0.1814060185648763,0.04935691329453684,0.112362282279901,0.1223708275382662,0.1329588824443092,0.1162003932590293,0.07775728785530589,0.09861879958025475,0.09421235678803816,0.09894980380115231,0.1017080584934817,0.1295249712914869,0.1036452847679137,0.1433220333074368,0.1055730063174821,0.1895024457655062,0.1334628216819152,0.1120793718708557,0.1390148246585846,0.1186848314625733,0.1089566607086402,0.1346435156205402,0.1392470980269682,0.1058090567553502,0.1224987840920449,0.1243952438668579,0.1532930888328443,0.1017902186165688,0.1112040881864343,0.1412072944954582,0.12468315987603,0.06391374861266046,0.1218956899730372,0.1478784342499432,0.04474942835006398,0.08172823962430277,0.1044516118374612,0.1044850693031915,0.1078369868359626,0.1075325410092815,0.1283009405241209,0.1498860521081903,0.07571086996481573,0.1131570299197554,0.05289789433867698,0.1471437664200195,0.1065642020688593,0.09675615328324171,0.1152440892618797,0.1106753031124157,0.1058485946068646,0.09788536713594512,0.2218427037324842,0.05768527515754046,0.1570208366589822,0.1100149590827756,0.08273839639707746,0.1225125265521328,0.1679445796972256,0.1083621590006158,0.1370667170574963,0.1025832640332697,0.1474393791089933,0.09354749125962949,0.09960082998464688,0.1165560175265118,0.1331507445874681,0.0657461921251503,0.1506157101592994,0.117360571094267,0.1389671841141842,0.1335176850313465,0.1066379807152786,0.09722073928145754,0.09627013437129647,0.08138317261665023,0.03693003331594012,0.09462122980490506,0.1100072939927215,0.1184013762741819,0.1697310399861461,0.1160305430254569,0.09141431437874031,0.131906874434441,0.1000786644655431,0.1199331957270326,0.1800961820344107,0.07202450439497295,0.1510182901512684,0.1199171271778368,0.117557953658406,0.08770797419782765,0.1441785595304331,0.1281157150567238,0.1206905113464834,0.176720768983018,0.09117777672255439,0.1600663214173497,0.1710520353421427,0.1223253556002527,0.2674703201720697,0.09788822733855657,0.1121287381809193,0.1419300761059282,0.09859485844082251,0.2786488654675746,0.08999082345532332,0.2085993576239103,0.3020128094161432,0.1226917335318742,0.1088792448983379,0.1119903430052906,0.1204233057107365,0.1051485905009006,0.1486163445342045,0.03993244534265354,0.09374456166801752,0.133535119543841,0.1084017196123262,0.1315300386086116,0.1532268803020632,0.1447807096269198,0.1307618633282251,0.1224052358175999,0.1360466737410578,0.1002682865519475,0.03865048864391751,0.1223162568200346,0.1354820197803106,0.108159294690631,0.1299430387746494,0.1064455553549114,0.1135451698794915,0.1434695284590279,0.1251090494535956,0.1465249223909748,0.1239217686589957,0.07014110818929921,0.159924094368163,0.1172807398711704,0.1908954400495535,0.178705023621853,0.1141868902752303,0.1368317432189036,0.1535523887129346,0.03697856654141157,0.03522451686859602,0.2679901343848802,0.1497676901706315,0.113950253818433,0.1502181755009729,0.09146788118533848,0.0853918162432087,0.1150450771194048,0.1793731239695866,0.1263925556040666,0.0936518120459946,0.1084527242668613,0.1659181335727317,0.1114295171492121,0.1004338497041372,0.09458333747111412,0.1037201497214573,0.1169503391877028,0.1052093375792827,0.1144416111807507,0.1365612898065564,0.14393755446106,0.105447099356851,0.1219061053186823,0.08143075034706979,0.09470130951653268,0.1305533958468596,0.1453883980005722,0.1200356650718521,0.1032292755505183,0.1492904211511431,0.122450663393664,0.1313530884354639,0.1471977761431103,0.04917239977401359,0.1248670902035026,0.1093461175567033,0.1052749894513562,0.1165535780836026,0.127207416406801,0.1241694661714282,0.156594133541345,0.05232864213411276,0.08506681898123195,0.1118720256707901,0.1110084798186406,0.09617480302674344,0.1169704919727621,0.1122781450829995,0.1366752663041204,0.09709928729101386,0.1019723124756321,0.1109431036162459,0.1109797021633422,0.1098675176477502,0.04288358444766426,0.1498537280852288,0.1332627617493204,0.08543284159840704,0.1103384877008726,0.1684512537846592,0.1184887789251788,0.145244726847803,0.1184166212274684,0.1152681860511089,0.1214800269097149,0.1007080758973073,0.09088210031541839,0.06283427440930271,0.1617551578114936,0.1023329385318049,0.08404375278500879,0.2174055138948954,0.1005608431010007,0.1114581872729513,0.1369885086442811,0.1356531834786513,0.1094087276035538,0.1070433853204284,0.1150466910031843,0.06646485814555585,0.04851637547905416,0.1060543525672887,0.09856308561991967,0.101444306472288,0.1853907423685244,0.1512706957694493,0.1447503361743064,0.1090586733894591,0.1550875935071668,0.125217283533282,0.1239608836530506,0.1103105121295196,0.1350134962704715,0.1053491222526883,0.1030871816147355,0.09772853970337127,0.1713985995691616,0.1579827007062812,0.1337040496714018,0.03141251207617755,0.1085145124349192,0.1181270203754034,0.1033169815081267,0.1422326356696695,0.09574484278624272,0.1128037750209239,0.1160037438125061,0.1017461588829849,0.1137413267615767,0.2090106496063726,0.1659162424501191,0.2261005100416716,0.1331331935932561,0.1182117046165441,0.1727732660035448,0.08774173421463341,0.1746267664990994,0.1159092247295664,0.0931237909557897,0.09726055446520231,0.2361304197946792,0.2260318850669772,0.1275009318489889,0.1155464108763213,0.03133455171062847,0.1131662225637722,0.1232055103569039,0.1133917747646388,0.1171529361798701,0.1235714581838168,0.1027423693291637,0.1715632241241308,0.1021081270062877,0.09222649414917246,0.1727742038634199,0.1400970660083233,0.1223841208677649,0.0767774893597222,0.09394427805494382,0.08325888579442341,0.2119261475964369,0.08688623718061708,0.08785683310345978,0.09345035020991317,0.07340734086892471,0.1339120092815969,0.1031249381494606,0.186198769744152,0.2343952787802661,0.09200547463971835,0.07759375873270853,0.1540277963180996,0.1203634097131022,0.1085223672031177,0.1595745738620427,0.1347667593307913,0.1058226539895533,0.1477035764393291,0.1114208005292176,0.2302804227962868,0.1347009165226932,0.0931010398242495,0.1423823412184092,0.1082980165425977,0.1190450243522379,0.09427807752553893,0.09201815198486728,0.08891613709903542,0.09903293804068536,0.04559732982990457,0.109206563492861,0.1049349791677523,0.105595810466408,0.1311935265421386,0.08837266865305576,0.09665076710687445,0.1187191784325275,0.1177997841625704,0.1670657014520297,0.08707294154290537,0.08643501686413087,0.09801824277234469,0.1647262624657229,0.1573878985172499,0.1172522250253484,0.1258619040826452,0.1423820492950817,0.1291335182502014,0.1089148816574615,0.1001848054718956,0.1179189811335219,0.06847333790106706,0.119016649390583,0.1593563055299895,0.1425585587540147,0.09150697569911631,0.09782622318142919,0.1164943466633246,0.09974105298288401,0.1103610364937146,0.09828693377358083,0.0980650223826066,0.09551003505941272,0.1041201615634561,0.1626823942565493,0.05066978768760664,0.1100216566093281,0.1042065403673446,0.07380013537768169,0.1130463656734804,0.1072834486927851,0.04357308340596209,0.1044579849318102,0.2281787649688849,0.1027150492532676,0.1294599793926464,0.09382857491826509,0.1212087673352383,0.09602411615857791,0.1048650226532629,0.08885005385209749,0.1340314435139632,0.2052173946911013,0.1259198063049141,0.1038647709744042,0.1424025450799614,0.07214992926063082,0.1484773597412822,0.1178221931931067,0.1088677245616452,0.1424359319937352,0.1144841727332958,0.05884520261229811,0.126019783643735,0.1929957300291587,0.107431233817323,0.1466594461112273,0.1034718926873446,0.2236083231694488,0.09736998493511935,0.2099867062703719,0.1903900106050926,0.0838474546116898,0.1181703284016161,0.1013662397980639,0.1146687481919546,0.1066074985912143,0.113995127458517,0.09848846634953434,0.1403589783584502,0.1015478985560924,0.08310921477609511,0.1492378991081989,0.08829859943269314,0.1028608086134178,0.1320283508426071,0.07251552712615698,0.1334329734342364,0.2301539392970554,0.1643656641718109,0.1537387350567896,0.1721639984174176,0.1288772045737116,0.1063739262639024,0.176442180401403,0.1193317149886128,0.1019270606621566,0.09919920550700784,0.1340178914437965,0.08795152176759281,0.1115134366091764,0.1212452071874588,0.1077028350114336,0.0924743564025963,0.1260199207185701,0.125654321392126,0.1003203583684124,0.17552457081652,0.09380099173314115,0.08690586943016911,0.1249723447922487,0.1003341195550167,0.1430971132348708,0.104992744307312,0.1248138640296242,0.1037531187217893,0.1133921877230555,0.03866097424004163,0.1057834706080325,0.08718405836001628,0.09061020030079429,0.1321168680177122,0.08715552323559791,0.1030486352735452,0.1054502021326689,0.2085058523016127,0.1201831850971547,0.09731616225321095,0.1571030740322824,0.1030202018079937,0.2460135846473104,0.1201480313419391,0.1275283382621145,0.1151442342689556,0.1014088776069915,0.1303688197363788,0.1979272717642757,0.1326141799867376,0.1114958746378823,0.1451189848242616,0.1220864829258703,0.1678998904706764,0.07530994434372575,0.110713209535647,0.02893996104893231,0.1075675247001923,0.1150964239341265,0.1105645841094863,0.1195081022184032,0.1576017556354371,0.08670988028997369,0.0723160728697135,0.1826172791758198,0.1052460989442658,0.1534163355360311,0.08577482955336924,0.1026285444064581,0.1082832393433666,0.1108352737082306,0.1185492329614675,0.1335907667064583,0.1379052268056769,0.1316494613397304,0.1284686168927762,0.1028761827640287,0.1825442644096057,0.1084006330979956,0.1790138596463577,0.1244194357572335,0.1273890194835962],[0.1053977836744786,0.1141190861588225,0.09822866987367887,0.1111248385008423,0.2209650690094458,0.1450462708707583,0.1424957566656491,0.1045655057355844,0.1044528453388402,0.13897694227966,0.1112880742179346,0.1568679280536508,0.1291493934180553,0.09793301770751803,0.1132732590889353,0.1295227583875321,0.02787649849229933,0.13168427968499,0.1098644497225798,0.1065606060266873,0.1294790449664185,0.1349280990132488,0.2601812608041168,0.09902985919763117,0.1150551632884776,0.1487931272905436,0.1293204636902476,0.1007379495858416,0.1203074527713585,0.1481824753814746,0.1214273270901428,0.03857812992067142,0.102878024568904,0.1024621367514042,0.1090242880591412,0.1017108324760694,0.1196503421574921,0.110779843067623,0.1317397742026224,0.1288841710435177,0.1241892396110969,0.142001966399001,0.1164665980991665,0.1022426036428644,0.1380741392839307,0.09836836799371357,0.1122493215140106,0.143010250830971,0.1468223444301521,0.1053952176461421,0.183638878209101,0.1106675345638067,0.1234447506722625,0.1199974844193712,0.1529610544370956,0.1830667340370933,0.104014699150997,0.09786370769444119,0.04060504063097584,0.1674231603978631,0.1109849557418668,0.1271283340490072,0.1065254876919424,0.1185290932561671,0.11772039602445,0.1430903532157061,0.1216796350429475,0.1797256016847195,0.1948732152693538,0.1087679668809958,0.1047145140870093,0.1147764537603693,0.1259548947933217,0.1041521531407831,0.1223301872167972,0.1034589529260832,0.1072787463421986,0.1581950809831181,0.147799803386986,0.09829598921126276,0.1162590989837712,0.1157110971912122,0.111078552068729,0.1043379980123021,0.1208879043214258,0.1087159187119812,0.09848875687243173,0.1071285236637608,0.1692830684826188,0.1010742061464025,0.1542655097774083,0.1137375129753125,0.1064156268956871,0.03217233193144236,0.1134709722221141,0.1275782430898061,0.1100230826721686,0.1055089042198502,0.1208944324867077,0.1128346132734711,0.1309175122089529,0.1303068749252349,0.1039938931372576,0.1292561841784997,0.1133306801178627,0.1199293507894783,0.03661436946412658,0.0996423798744089,0.10036286420121,0.09782807756482842,0.1210191481388363,0.09801334614382085,0.1072629965251205,0.1062416037117958,0.1124572524314877,0.1068774447707782,0.03060080798547924,0.1003558024085799,0.1857837070545454,0.09803915600418517,0.113761821512193,0.1080177939275248,0.141608450390468,0.110549915036254,0.1015184308718891,0.1167191353153143,0.03905652012801346,0.1209428164639145,0.1030672696137495,0.1304428067653189,0.1624695750418311,0.1506188364735456,0.1013043335798458,0.1224185124249363,0.2209190842435683,0.108651811801515,0.1002030483423098,0.1171894607466991,0.1110185690339994,0.1280884041924271,0.139935426998599,0.0988949448489567,0.1277341261101474,0.1052248040016726,0.1038395180092759,0.1040368604330184,0.1076082540932176,0.1223122257370779,0.1077678133627078,0.1355774078371969,0.1349154694909173,0.1570927434102637,0.1209240302229785,0.1059560963817046,0.1150086436640163,0.1269306999950252,0.111969307792942,0.1395919827960244,0.09843330195753977,0.1088651529489587,0.1057835518419412,0.09864358614473194,0.1112235582467082,0.1661515037719853,0.2363168752722039,0.1217895547471897,0.1146069757913525,0.1007423153214725,0.1370079625382723,0.1216522615110155,0.1275909582022232,0.1251719048010566,0.1052515131381831,0.1049159595556368,0.1022252722815133,0.1157959858908256,0.1104607996657527,0.1094958986419455,0.1044131458357761,0.1002291841280738,0.1165693678190108,0.145189709163435,0.1234149207119653,0.03566797758284083,0.1544133696101248,0.1127388540456633,0.1061645710953641,0.1537406416331862,0.1600323741261135,0.100581785032875,0.1179948698716836,0.1157141519145269,0.09908941430199961,0.1843235589193044,0.2333691726889991,0.1042164485460182,0.143936482535065,0.1199414057780652,0.103920956764374,0.120157187891442,0.119571883494121,0.1205200822928237,0.1164370422122616,0.1139305784491478,0.1066411903638136,0.2027950418143016,0.155652907436702,0.1001601814175053,0.1012177004303559,0.115584577763143,0.1047641572991087,0.1252228982627187,0.1037749438672316,0.1569415841770445,0.151390126146464,0.123696182310911,0.1312690377619508,0.1028710863820243,0.1039792041414854,0.112747149513538,0.1061614422575698,0.1201139799337363,0.1096237605110559,0.02679732078344964,0.1508843118479011,0.1004221145385623,0.1014591456830459,0.1084744343789839,0.2075847905913673,0.1034345668671922,0.06770380783266158,0.1807901907032697,0.1876520706188381,0.1136903663468479,0.1790240885530366,0.1489186798544732,0.1101340261424608,0.1405895801001529,0.1958291513369451,0.1774388097341027,0.1070021226442308,0.161468190043778,0.1231882752535667,0.155864068003499,0.1050152128867678,0.1333504934330114,0.03428114913378306,0.1380556473379048,0.1203769852359867,0.1106691110804202,0.1161307736031707,0.1235935259137872,0.1505870802225467,0.09811402741751905,0.1743043172031349,0.09956126256870157,0.1002883437094896,0.09931294796840193,0.1000764908452609,0.3290865930049979,0.09982885394775071,0.1372459150765201,0.0358309060121204,0.1190237855457214,0.1051548719378378,0.1102274100469517,0.1156897606785315,0.03999576358830531,0.03116363457946265,0.1163223167667483,0.09998117482745915,0.1201121446070828,0.120332416292959,0.1069999406123515,0.1264226962377339,0.1268108024517304,0.101965758904591,0.09852173394624517,0.0363882603623048,0.1053267918798486,0.1044603891458838,0.1075147536222261,0.1169345883401814,0.1456159205236185,0.1313954660634102,0.1134666537931944,0.1252276008464503,0.1095432829198508,0.1757566973679015,0.179700071787417,0.09838910882298615,0.1856879249080969,0.1619834385026435,0.1222212672080326,0.1050224738382906,0.1215696693486373,0.1145136205969639,0.1022706416155531,0.1089993796926604,0.1640944171050572,0.1354698858755461,0.1355937995937535,0.1108396452473826,0.1007601894016318,0.04414413352490885,0.1160622022801536,0.1543119320324704,0.1217512510028766,0.1107575195267757,0.1086167883930391,0.033683153214333,0.1021966024656506,0.1043230571431274,0.1148200920492752,0.03311146897529425,0.1441776032561537,0.1044031401094915,0.1228685795807083,0.127727929789808,0.1543673668017158,0.1333581852481994,0.1026282581882639,0.1059903993509179,0.1216377034906746,0.1763094230926653,0.126798360550064,0.1024788855977831,0.1305066207746651,0.1772717318658405,0.1080116842539649,0.1029450302278278,0.1174895861842276,0.105840602416026,0.1301468814216558,0.1573883289855078,0.1938197114892398,0.1212448872276696,0.1246999406013079,0.1152975548015666,0.1735171342133206,0.1393555503456033,0.1187432897057887,0.109366601857318,0.1221387293806739,0.100932725559646,0.1129180560662442,0.1429947578550735,0.135997479989168,0.1058745060341976,0.03597832088056876,0.1647460358573509,0.1422324740398598,0.1058720875274892,0.02975777004913908,0.1012034655102959,0.1148385392470324,0.1108919142343187,0.1002964730537151,0.1174435605950423,0.04709141054902995,0.1079745801533267,0.1357085597845909,0.1074837814884027,0.1059194772190399,0.1075317854179028,0.1049123394725474,0.1260276456653765,0.1246372200570052,0.1106238506214008,0.162409881576481,0.1005956297105457,0.1470655280602568,0.14893230835283,0.2222657948210722,0.106956810747968,0.1074246303553359,0.127094694895646,0.04049307929839549,0.1390008071492612,0.1564018296253722,0.1026626064405344,0.348935799832624,0.2045636691584234,0.1528163486330743,0.1144008204479561,0.1135937976295973,0.1940490375527688,0.1076510635440586,0.1017835994399459,0.1141069040715931,0.1461216696421329,0.104228794297088,0.1435742427958868,0.1004747165290143,0.1317980932587007,0.1004459958761893,0.1521534991734308,0.1333706670212164,0.1044532522385335,0.1458228052772375,0.1156066281969966,0.1227575338416188,0.1135118140350228,0.1210760195203124,0.0982506448419547,0.100148451093009,0.1159832216030263,0.09998070576641094,0.2325874821038833,0.1508082099065673,0.1134105185758029,0.1209352934659444,0.09935477303476178,0.1740458160564687,0.1026888651879226,0.09847101095155847,0.0979305365381149,0.1315989618845336,0.1258381611113626,0.1050583619767498,0.1187071090410593,0.1212546499711205,0.1731604472031938,0.1491223634174259,0.0991433404480965,0.1497040230686204,0.1092314431066829,0.1088820948212706,0.09779350469486162,0.116454260238656,0.1057038594815191,0.2523093573201945,0.1112889241835695,0.1222549530089663,0.1386415929666636,0.1135904596446016,0.1615678294408057,0.1142110925844443,0.1181287507530603,0.1417674088801343,0.1009971114356231,0.1069235988008213,0.1514925605249679,0.1151507381957615,0.1212576148790145,0.1430377017456751,0.1170906108178328,0.1586710547948539,0.1063642222496036,0.1897733214696055,0.2121109887259102,0.0355982004694709,0.1289122559734181,0.1026246270663531,0.108044018310646,0.1402387916635596,0.1807871269699955,0.1004947798500384,0.1486683078942333,0.1052444117765174,0.1384884418582814,0.1253244275763726,0.1355784439543438,0.1039363671005907,0.1057376343839943,0.09860833013364623,0.1518463954539709,0.1191332362441264,0.1403896308484724,0.1776193647630774,0.1501114008227891,0.1144793188390089,0.1575559157963536,0.1501102520782927,0.1731744878101697,0.1173270787190586,0.1098058494133351,0.1115196611779407,0.09962925953015506,0.1023756299089475,0.03121638106887062,0.1213388562473514,0.1045834299429105,0.03771072726661501,0.116118417202338,0.03451095122899604,0.09847971107265777,0.1267153775011847,0.1107671403124838,0.1996226546338676,0.1007099612457045,0.1027871877883457,0.1190723209187856,0.1204791215715578,0.1351282655739077,0.1022027604200133,0.1006372716938279,0.2109594874056206,0.1015280672449587,0.09873238767577167,0.1277330172283831,0.1467264273005658,0.1186015922373843,0.1268784962446891,0.0338953607625617,0.1108025357471395,0.140170515463105,0.03303263419972119,0.1439666589980521,0.1590146047117792,0.1172996466689378,0.2015154685371557,0.1285952055767382,0.1083338459455556,0.1584105808741133,0.1045427184938384,0.138973153368554,0.1264907231309944,0.1124963750364945,0.107364397251969,0.1004611179140428,0.1430785964706932,0.131623682530104,0.1327767385700976,0.1026574666583942,0.1124070590145002,0.1336765155249166,0.1021963179395139,0.1149368372802946,0.1472566856641745,0.103135536007818,0.1222041241510242,0.1143539981531947,0.1462069785019955,0.1027506621653864,0.1066259378509007,0.1316381063737417,0.1151460185761956,0.1967503804056585,0.1032471660288005,0.1162602451122099,0.1005765005227381,0.1422178155705004,0.09957148316629218,0.1136002650485354,0.1217027561281851,0.1089054411371086,0.1518318515417769,0.09935456065907561,0.1036144580653216,0.1394969407724903,0.1372862992569566,0.2757099521395953,0.1214667579957397,0.1101484366592286,0.1048599638756219,0.1064921709303252,0.1895432818173334,0.04195636085626092,0.1207878912078496,0.1285142591887104,0.1397209522650948,0.1144334799528645,0.1011629638669881,0.1032583716010585,0.1002268172061964,0.1130081222298954,0.1074162537457635,0.121312524988992,0.1016849169561523,0.1488479547843758,0.1144381134568424,0.1902375570675706,0.137840377702588,0.1070116084933323,0.1448526668501394,0.1157039344104302,0.1115748670921082,0.1557438347274367,0.1404951946142969,0.1080082698517067,0.1198197898587765,0.14466481366218,0.1629417299870032,0.09970394942066475,0.1233482482420077,0.1352515732047656,0.1294432933342284,0.1285944089148781,0.1053943637733042,0.1497787309729796,0.03515021679988846,0.1008308788444186,0.1341647196186078,0.1109196773701367,0.1089571202622938,0.1131338585771788,0.1522582101813654,0.1619393368198524,0.1097781731405941,0.1108598974763053,0.04632845612580073,0.110126967001218,0.1075502865558638,0.1006653672067278,0.1078284053636974,0.1020274295400407,0.1125489194135995,0.1013332482741881,0.2327055455826357,0.04205158292861658,0.1699031212044165,0.1094376993113814,0.1053443286114099,0.1243243998868535,0.1451084737572252,0.1205585633101275,0.1337671941476259,0.1097484653550167,0.1461230552321676,0.108030490111188,0.1004134715080868,0.1319686698258155,0.1487731285207365,0.1017651199216725,0.1635873200651981,0.114451490380686,0.1365202655713534,0.1385025179592591,0.1083503553368362,0.106308070354936,0.1026338194028169,0.1063318948546908,0.03191099418318463,0.104719541271512,0.1037316816994724,0.1102477148861466,0.1594136123135936,0.1292540029701685,0.1056285354183068,0.1311378385980814,0.1121895661894125,0.1042608586172693,0.1838796556795193,0.1166291014374982,0.1570721128769372,0.11698970686336,0.1234796745405953,0.1037207452303975,0.1738425409248311,0.1254659546421566,0.1213375320163186,0.1745130445954925,0.09783956229878574,0.1549472174609116,0.1611830233772342,0.1143964719446716,0.272964191470872,0.1071781992917886,0.1050711865134029,0.1105280515489855,0.1162425106944057,0.3057212948514955,0.1067732399148409,0.233763254627594,0.3131284546139848,0.1673428919313192,0.1243934435212389,0.1239778285371628,0.1212460624227759,0.1072733724154319,0.1402519342820235,0.03918110517437563,0.09974188383208854,0.1498921104196468,0.1155375227485692,0.1189186884084525,0.1535947650626911,0.171081890339862,0.128239026390495,0.1277363753768389,0.1760523087420376,0.105001454236435,0.09956701048645887,0.1186860903617352,0.1349661940086626,0.1120640813755489,0.1265579776776912,0.1040989768137571,0.1130278136637096,0.148292184121752,0.1289887645490541,0.1378370185772726,0.1196293442879182,0.09792020435560178,0.1658937648140146,0.1279721454401065,0.2002665022387812,0.1760114107563195,0.1292064479574469,0.1373779092530946,0.1541500858315499,0.03301972376171966,0.03316821445716704,0.2643078782713451,0.1585282090405156,0.1084143507726702,0.1485923285800134,0.1005371205988712,0.1018905235980927,0.1158430891708163,0.1831963994975384,0.1217058798392362,0.1087234322542062,0.1191401073636003,0.1774226066748524,0.1099073783959549,0.09878309436995343,0.1018084253922431,0.1331010902370044,0.1197066760640261,0.1124530622925849,0.1135258112420576,0.1478621795613251,0.1628228549234608,0.1090951288165127,0.1229004614949042,0.098659723578743,0.1067628648418944,0.1358365849582985,0.1359124004237616,0.1034041738939861,0.1233113306271639,0.121236903655965,0.1167080356770424,0.1262651957748615,0.1268381560591881,0.03377751565940754,0.1284561245101768,0.1187816666818083,0.1054047212151507,0.1194656950462122,0.1275532862880138,0.1271587170607404,0.1577221367309172,0.1002877180819168,0.1001966273899508,0.1213860567194232,0.1066842872794313,0.1039761717705923,0.1276114249874205,0.1086495005507015,0.1458127882695524,0.1013203330485133,0.11151440672311,0.1011439403934367,0.1166951763918254,0.103249029760074,0.03805663186538214,0.1512436077193671,0.1343676601542941,0.09993699269048625,0.1250230758749145,0.162677710709915,0.1151583380206564,0.1472386244403777,0.1152177862279289,0.1282712120654395,0.1265210960112674,0.1103323410449752,0.09941279127951778,0.101236263187592,0.1607417464270016,0.1126542753580022,0.1122492014428202,0.2180330715192485,0.1063831585595473,0.1357251976541794,0.1350680185280812,0.1520947671373641,0.1141561135856016,0.1018454151059404,0.1021578463283832,0.04959783611092241,0.03461206252740849,0.1049203636069417,0.1018233767986669,0.1035929669691431,0.1867682247215314,0.1548479222384747,0.1623025909169452,0.1190234423043932,0.1593406173124333,0.1321136067259353,0.1251670500992636,0.1117107501320835,0.1534703398631257,0.1088124648148654,0.1114011163544873,0.1005672049432711,0.171508942678569,0.1507766969614673,0.1289801629810993,0.03171218264279134,0.1106515165807639,0.1332812860404937,0.1133486865450181,0.1362991456563054,0.1034536572601707,0.1074855187674818,0.1078278006258857,0.09940209500639507,0.1067121011632048,0.2334552676139224,0.1480512611195047,0.2394997992088561,0.1329657181543402,0.12355590376103,0.1729778801814863,0.1041900669205801,0.1682817095904031,0.1093358400342542,0.09878404887008765,0.1050182811510222,0.2273386968507768,0.225146105640859,0.1183416643511134,0.1106988028999158,0.03129182819176034,0.117433268012296,0.1243777036636321,0.1151189867929791,0.09976065941832543,0.105515512271928,0.1228245073996759,0.1869845035632656,0.1032323007488367,0.1032660604318021,0.1757692426383961,0.1392468359856265,0.1132980553179448,0.1149439091432174,0.1206165182907853,0.1135084727872759,0.219941401525548,0.1079197367263627,0.1099116274403518,0.1175252859391732,0.1128163622015445,0.1588130519582547,0.09904878919894347,0.2027146171120311,0.2525890029202723,0.100295798012424,0.09909665422908601,0.1588527327483141,0.1222199924127801,0.1133486699807194,0.1540151810328552,0.1333433531148007,0.1131530533436295,0.1533960456018726,0.1476359751052684,0.2251673850131116,0.1451652969271865,0.114095502576013,0.1457822315629315,0.1142538151458876,0.1512684882117474,0.1011570990650161,0.1053606286299048,0.1038844688214575,0.1025121455147371,0.1127064045223989,0.1027811073492945,0.115785205670063,0.1072847247104267,0.1230215248421339,0.09987023241084816,0.1083492941190328,0.1266388801919188,0.1133214063201567,0.1355001007738893,0.1261824034751315,0.1251390858505209,0.1018875507288499,0.1616562998664089,0.1601790417413665,0.1198407082591961,0.1212105970102545,0.1474267733329278,0.1155048477533132,0.1341884602849261,0.1176484115785275,0.1080041869130806,0.132436186638832,0.1145228261014849,0.1648557393392847,0.1326851030497185,0.1127818264234828,0.1064322138196661,0.1079117104229982,0.1032988953371128,0.1008624012220656,0.09984457613233108,0.1003627600388028,0.1005857976499515,0.1023862767895947,0.174514177769217,0.1008197141605756,0.105040286012967,0.1290577438249926,0.1081696181648785,0.1103139171158356,0.1123308592990233,0.04527366922181268,0.1033671582445458,0.208796555809623,0.1143373946652223,0.14438056754316,0.1004800391738666,0.1291995392474213,0.1014192584898094,0.1013223838083323,0.1069640943521254,0.1345554100854532,0.2130005921590689,0.1377367212930993,0.1156239214683712,0.1467009345215809,0.09926505282778794,0.1429685818547556,0.1195997632479208,0.1127581586761434,0.1434030422089307,0.1110357116308247,0.09794187809681344,0.1212876096336379,0.2296611378700916,0.1033976225382237,0.1620501829974969,0.1008249478768507,0.2252828452320265,0.1018647048154974,0.2423815828602866,0.1898994984319177,0.1171896672430552,0.1353000602753835,0.1019070536198768,0.1199823096224291,0.1116030498525433,0.1149755664754223,0.1076300931192393,0.1460018816481965,0.09831338765048181,0.1191907384962453,0.144756715391403,0.09829577232420661,0.1221371936690923,0.1338183365244943,0.1004505795937727,0.1414484774767754,0.231336410592846,0.1045208691968231,0.1624520801813072,0.1791598052363182,0.1336647166110397,0.1050356610225542,0.1761001317791384,0.1314814492438111,0.1125557406368766,0.1176166891614399,0.1356018149535707,0.1034635691048444,0.1108641113505205,0.1338306674660636,0.1188294050999752,0.1021184282282421,0.1144410553282732,0.1384981286025407,0.103628976246929,0.1639705662544656,0.1048996660090192,0.1010079411215903,0.1279345806087841,0.1086848560156434,0.1595714090964961,0.103960227393642,0.1186688446207764,0.1006675107465747,0.116955981644894,0.03529717604919197,0.1113305382378682,0.09792994073346542,0.1023643675690967,0.1525683908285909,0.1234833452880954,0.09885499530544165,0.09817093671289168,0.2193989665693553,0.124589763567561,0.1023528687511754,0.1808872013277574,0.1042009147929311,0.1581518097727534,0.1205047247501408,0.1352348967887631,0.110089367246476,0.1183216525498243,0.1356344914637672,0.2028302207378621,0.1191771048893462,0.1067422463934967,0.1637575319447848,0.1313258946782782,0.1762559552732357,0.0996339200306417,0.1057593054922231,0.1033112966206212,0.1077264534569257,0.1068529533853612,0.1100818078266179,0.1160422983208281,0.1640210829571072,0.09882089283866877,0.1282912534441751,0.1758648002986208,0.1486879625158953,0.1607281128778134,0.1006568311556419,0.1077886692824613,0.1058914369996027,0.1154746836751578,0.1202766469152847,0.1332226036713187,0.1403535556609167,0.1246801923321019,0.1265525820711916,0.1025917893110122,0.1783081430177626,0.1065926986923987,0.1917289604701737,0.1441810716203231,0.1234274663315681],["CFH","TMEM176A","DBNDD1","TFPI","SLC7A2","HSPB6","PDK4","TMEM98","TMEM132A","CX3CL1","TNFRSF12A","CD79B","MGST1","NFIX","IL32","MAPK8IP2","ZNF207","FMO1","SYT7","ANLN","DCN","SEMA3B","LTF","ELOVL5","GPRC5A","IL20RA","CNTN1","SNAI2","RUNX3","PLEKHB1","FHL1","RNF10","RRAGD","HSD17B6","HMGB3","VCAN","CDH1","RAB27B","TNC","BARX2","GPM6B","COL9A2","KITLG","EPN3","ELN","DKK3","NFE2L3","PTGER3","LAMA3","OPN3","FOXC1","CYFIP2","IL17RB","GYG2","LAMC2","COL11A1","BCAT1","SPAG4","SFSWAP","CDH3","DGAT2","CA11","LIMCH1","ATP2C2","SLC12A2","EYA2","FAR2","BCAS1","CHI3L2","NTN1","MYLK","GSTO2","ME1","ISOC1","PFKP","TRO","PRR11","REEP1","TGFBR3","PFN2","ST6GALNAC2","TRIP13","CYBRD1","HMMR","SIDT1","ST6GAL1","TEAD2","ATP2A3","CA12","MGLL","NTN4","SEMA3C","MOCOS","SART3","ACACB","GPC4","RAP1GAP","UBE2T","CST7","FAP","EDN1","ITM2A","CDC14A","CEACAM1","LIPE","MOXD1","CNOT4","NDC80","PTPRC","CADPS2","C1QTNF3","EPB41L3","SERTAD4","FAT1","GSTP1","EPDR1","RBM22","NOX4","PTHLH","TFAP2C","AURKA","PIR","SULT2B1","TPX2","SMOX","CPXM1","DYNLL1","OAS1","BIRC5","RGS1","LYZ","CHRD","KIF4A","SEL1L3","ESR1","TMEM101","CCDC80","SLC7A8","SLC22A17","SEMA6A","PHGDH","UNC13D","CRAT","SORBS1","DSP","SCD","PRTFDC1","H2AFY2","PALM","MMP11","SUSD2","SEC14L2","GGT1","KDELR3","RAB36","TIMP3","BIK","RASD2","SYNGR1","PYGL","CDKN3","SIX4","EFS","MMP9","EEF1A2","ISM1","PLCB4","PXMP4","WFDC2","PPP1R16B","FAM83D","SRPX","SMARCA1","PIM2","SRPX2","SYTL4","TNFSF13B","ACP5","CORO1A","CRISPLD2","HAGHL","SLC7A5","METRN","UBE2I","TOX3","XYLT1","PYCARD","SYT17","TMC5","HOMER2","SGK3","PDGFRL","BRF2","CA2","SFRP1","LAPTM4B","PLAT","GDAP1","NDRG1","NCALD","TUSC3","KCNN4","MAP4K1","CD37","RASAL3","CD79A","NKG7","ETFB","MEIS3","CNFN","CLEC11A","CAPS","PLEKHA4","COMP","HPN","CDK6","PTN","CAV2","WNT2","LFNG","CPVL","COBL","SERPINE1","NRF1","SFRP4","MEST","TSPAN13","RARRES2","AGR2","GLI3","EIF4H","SLC1A1","OGN","ECM2","PTGDS","GATA3","CXCL12","SPOCK2","DNAJC12","KRT23","RNF43","RASD1","CCL2","SLC16A6","PMP22","ALDOC","UBE2D3","TBC1D9","INPP4B","CPE","SOD3","TRIM2","GLRB","UGDH","CRYAB","CTSC","MS4A6A","CCND1","IL10RA","SCGB2A2","SLC35F2","CD69","RSRC2","FOXM1","RAD51AP1","OAS2","MGP","CNOT2","CPSF6","CDCA3","CHPT1","ENO2","LDHB","COL12A1","GCNT2","TPD52L1","NCOA7","UST","SRSF3","CAP2","PERP","MDFI","SMOC2","ENPP5","GHR","KIF20A","MRPS30","LOX","GZMK","THBS4","PRLR","STC2","RBP1","WNT5A","C3orf14","C3orf52","PODXL2","VIPR1","CYTIP","REEP6","EFEMP1","IGFBP2","IGFBP5","EFHD1","SF3B1","FHL2","MLPH","QPCT","PLEK","RND3","C2orf42","EPHA4","GPX7","KIAA1324","SFPQ","FBXO2","C1orf21","WLS","RGS2","CD2","CD48","PADI2","MFAP2","RGS4","IGSF21","GBP1","CDK18","CDC20","TSPAN1","F3","MAN1C1","NEK2","CENPF","MYB","SPP1","RARRES1","CSF3R","IFIT3","IFIT2","PPP1R3C","HOXB3","DUSP1","MSX2","EGR1","PLS1","GLT8D2","SOCS2","DUSP4","EPHX2","TARDBP","CRISPLD1","RDH10","MAPK8IP1","KHDRBS1","TNFSF10","CPXM2","CXCR4","SASH3","FMOD","HNRNPA2B1","ARL4A","RAMP3","TWIST1","PLAU","SRGN","CHST3","EGR2","ATP7B","ARHGAP9","COL10A1","TNFAIP6","G0S2","RAB38","SLPI","PREX1","BCAS4","KCNK15","STAMBP","F13A1","SPDEF","RAB17","SCGB1D2","MT1G","BMP4","SOX9","C3","FOSB","SDCBP2","ID1","HCST","IFI6","DLGAP5","HSPA2","EVI2A","AIF1L","ARMCX1","OMD","FGD3","PKMYT1","FBXL16","TUBA4A","TNFRSF19","FGL2","SGCE","CASD1","ZFP36","RASL11B","RAC2","KRT17","LRRC17","CGNL1","LRRC6","ADCY4","FOXA1","RNASE1","CDKN1C","SHC2","GAMT","CNN1","APOC1","GADD45G","BST2","GDF15","OLFM1","COL5A1","ASS1","GINS2","ANO1","MAP1B","TOP2A","STARD3","PPP1R1B","KHDRBS3","RAI2","MATN3","PPARG","RAMP1","ITGB4","XAF1","MATN2","ALOX5AP","WASF3","DCLK1","EPSTI1","POSTN","BEX2","RARRES3","MYH11","ACTR3B","VAV3","VTCN1","PPHLN1","RSAD2","CMPK2","IL6ST","FST","GRP","DOCK2","RERG","CDCA8","CYP2J2","DSC2","DTNA","FHOD3","PDGFRA","SLC37A2","FAM189A2","TBX3","OASL","CD36","EHF","TROAP","KRT7","PKIB","KCNK1","FAM129A","ITM2C","SERPINE2","CYP27A1","SPRY2","SRSF1","RTP4","IL1RN","WDR33","KLF4","TOR1A","ANGPTL2","ENPP2","MYC","CCL21","GMPR","IER3","SYTL2","RAB30","GGH","SULF1","DDX60","MMP7","TMPRSS13","NUSAP1","ITGA11","IFI44L","IFI44","CYP1B1","RAB1A","CEP55","AOX1","SMARCAL1","SLC40A1","CILP","PDE5A","CXCL9","ANXA3","LEF1","ERP27","PRICKLE1","CD27","RBP5","PHLDA1","LUM","CSAD","TTC6","IGF1R","HAPLN3","CDH11","IRF8","SKAP1","ARSG","IMPA2","SLC39A6","SLC16A3","PMAIP1","ERBB2","GRB7","MISP3","CBLC","PRKACB","KIF2C","CYP4B1","LMO4","CELSR2","ATP1B1","DPT","NUF2","RGS5","CRABP2","RORC","ECM1","CGN","CTSK","ANXA9","SUSD4","S100A8","ETNK2","PTPN7","SFXN5","THNSL2","AFF3","AMMECR1L","SPAG16","HES6","NFKBIZ","COL8A1","BOC","EAF2","SLIT2","SCD5","CCNA2","SFRP2","SRD5A1","GZMA","IQGAP2","CXCL14","PLA2G7","TNFRSF21","EGFR","CDCA5","TMEM47","GPC3","SYBU","VLDLR","NFIB","CDKN2A","NTRK2","UGCG","ASTN2","PTGES","FAM171A1","ST8SIA6","ADD3","ADM","CELF1","SESN3","GLB1L2","FADS1","MPZL2","TM7SF2","MMP3","LYPD6B","ADRA2A","ITPR1","UBE3B","NDUFC2","ME3","CCDC3","QDPR","ACSL1","SERP2","PARP8","GFRA1","TIAL1","HSPB8","SETBP1","TCF7L1","SPOCK1","GJA1","ANKRD22","NR4A2","CMTM7","CD8A","PID1","CABYR","ABI3BP","UCHL1","TNIK","GBP5","PDLIM3","SORBS2","CXADR","BTG3","ADAMTS1","APCDD1","PPM1J","RBM45","VSIG4","FZD7","RMND1","PSD3","KCNMA1","BATF","TSPAN7","RAB11FIP1","FBXO32","SUSD3","IL34","KIT","CCNB2","MX1","KRTCAP3","CLSTN2","COLEC12","HIST1H2BD","HIST1H4H","GDPD5","LAD1","STC1","RCAN1","CLIC6","CBR3","BTG2","C1R","TPPP3","PIP","CCDC117","TFF3","TFF1","TMPRSS3","RSPH1","PDE9A","C9orf116","TLCD1","AZGP1","ZNF394","RECQL4","DMKN","COX7A1","PGAP3","ZG16B","PDZK1IP1","AK4","RBP7","AKR7A3","PDPN","UBXN10","CAMK2N1","ALPL","HENMT1","GBP4","AGL","VCAM1","VANGL2","KLHDC9","ATF3","C1orf115","PKDCC","CAPN13","FRZB","ACTG2","CCDC74A","SPATA18","NOSTRIN","BNIPL","ERCC3","IWS1","S100A9","CLDN1","FBLN2","SERPINI1","PTPN13","PPM1K","PRRT3","CPA3","TM4SF18","CLEC3B","NMNAT3","DNALI1","RPL39L","SPRY1","MST1R","F2RL2","CMBL","ESM1","RHOBTB3","ERAP2","SHROOM1","PTTG1","STEAP1","CDCA7L","KIAA1324L","FABP5","FNDC1","DLC1","OSR2","CTHRC1","GEM","ALDH1A1","RASEF","HNRNPK","SVEP1","FBP1","CYBB","CLDN3","MELK","FOLR2","GJB2","TMEM63C","COMTD1","ZNF503","NDRG2","SALL2","IFI27","GPT2","CKB","C2","PLEKHF1","CYB5A","CYB5R2","CENPN","ZNF143","MFAP4","CENPV","ATF7IP2","C16orf45","ANPEP","NAV2","C15orf48","SCG5","GREM1","MS4A7","PRRX2","PRR15L","IGF2","CD3D","CDC42EP5","PPP1R14A","C19orf33","KIFC2","GGT6","KRT80","ANGPTL4","IGFBP6","TK1","ABCA3","DDB1","SF1","SCARA3","DDIT4","KCTD6","ACOX2","CX3CR1","DEGS2","DYNLRB2","IL7R","NPNT","TSPAN5","IRS1","AR","PARM1","FAM110B","AFAP1L2","CXCL10","CD52","GPR183","PCBP1","BUB1","MT1E","PCDH7","REPS2","TM4SF1","ALCAM","UBE2E3","CMTM8","CDK1","FABP4","FOS","CST1","LRRN2","GPRC5C","MZB1","NPAS2","IRX2","KCNS3","PDGFD","FPR1","KRT15","NAT1","HOPX","GPR34","HDAC3","GATM","BCL2","COL8A2","PRNP","ORMDL3","LRRC15","CALB2","ISG20","MBOAT1","TPSAB1","ARNT2","TCEAL1","CTSW","RASGRP1","RND1","CCL19","NBEA","HSPA6","ABLIM3","SYT12","SNCG","C1QA","SAA1","AGR3","LRFN4","SPTBN2","HOXB2","PODN","GOLT1A","SEZ6L2","UBE2C","CSRP2","CHST1","PHYHD1","SCUBE2","LPL","P2RY2","NR2F1","SFN","LRRN1","SPHK1","ZNF135","HSD11B2","PLA2G16","PRR15","TYMS","FZD8","ACOT4","CD163","RPP25","ZNF552","AURKB","GIMAP7","HLA-DQB1","GATA2","EGR3","FJX1","FCER1A","CITED4","SSC5D","GAS1","TSPYL5","HIST1H2AC","HIST1H2BC","TMEM64","HOXC9","HOXC10","NQO1","HIST3H2A","TMEM45A","PHLDA2","FAM89A","BACE2","B4GALNT4","C1S","EPHB3","NDN","NTM","TSKU","C1orf116","LCK","CADM1","ABAT","GPC6","TMEM119","PRR36","ASB7","MX2","SERHL2","ZNF703","TMPRSS2","ACOT1","ALDH1A3","SLIT3","PROS1","BEX5","PDE4B","NELL2","ZBTB7C","SLC24A3","INPP5J","SOCS1","MUC1","AHNAK2","NDUFA4L2","IFIT1","EVI2B","RTN4RL1","IRS2","KRT5","WWOX","EDARADD","THBS2","CYP4X1","LILRB4","KRT14","MAPT","EMID1","ESPN","ENTPD5","MT1X","GCNT1","FPR3","C11orf96","ISG15","C17orf97","THSD4","HIST1H1C","EIF4EBP1","COL14A1","COL4A5","HES4","SELL","SERPINA5","RPL14","C9orf152","APOD","PLAC9","PCDH18","MAOA","S100A14","GSPT2","SYCP2","AKR1C3","ACADSB","SLC6A9","MME","LAMA2","TLR7","HLA-DQA1","LAMB3","ACSL5","SERPINA1","STMN3","ENPP1","MFAP5","NMB","CFD","KIF13B","HIST1H2BK","PLCG2","MB","DDX42","HOXC4","MT1F","ZNF521","CES1","CD3E","PRC1","TGM2","CAPN8","CENPW","HLA-DOA","SLC44A4","HLA-F","HLA-A","GPX3","DIO2","DENND1B","CRIP1","GSTM2","UBD","ANG","STARD10","C4B","C14orf132","LTB","TWIST2","C12orf75","HLA-DQA2","KIFC1","TXNDC5","APOBEC3G","PSMB9","CFB","SCARF2","C4A","HBB","TMEM150C","TMEM158","TRNP1","CLDN23","TRIL","HOXB7","EPPK1","SPON1","CCL5","CD24","CCL4","PRAG1","FCGBP","UHRF1","DACH1","HIST1H2AE","CCL3"],["no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","yes","yes","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","yes","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","yes","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","yes","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","yes","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no","no"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>tcga<\/th>\n      <th>metabric<\/th>\n      <th>average<\/th>\n      <th>symbol<\/th>\n      <th>is_housekeeping<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"targets":0,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":1,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":2,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"className":"dt-center","targets":[0,1,2,3,4]}],"scrollX":true,"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render"],"jsHooks":[]}</script>
<figcaption class="figure-caption">Figure&nbsp;2.3: (<a href="#fig-sd-stable-genes">Table&nbsp;<span>2.3</span></a>) Standard deviation of each gene in each condition and pooled standard deviation.</figcaption>
</figure>
</div>
</div>
<p>Overall we can see that housekeeping genes have very low standard deviation across cohorts, which is good.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Total number of stable genes: 44
Total number of genes: 1044
Number of samples: 1005
Total number of stable genes: 44
Total number of genes: 1044
Number of samples: 7216
Total number of stable genes: 44
Total number of genes: 1044
Number of samples: 1868</code></pre>
</div>
</div>
<p><a href="#fig-avg-ranking-hkg">Figure&nbsp;<span>2.4</span></a> shows a histogram with the distribution of the average ranking of the housekeeping genes for each sample in each cohort.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-avg-ranking-hkg" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-avg-ranking-hkg-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption class="figure-caption">Figure&nbsp;2.4: Distribution of the average ranking of the housekeeping genes defined previously for each cohort separately.</figcaption>
</figure>
</div>
</div>
</div>
<p>The average ranking are somewhat similar. For the two experiments where there are RNA-seq samples, the distribution is the same. For METABRIC, a microarray experiment, the distribution is shifted a bit below.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-avg-ranking-hkg-wo-scanb" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-avg-ranking-hkg-wo-scanb-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;2.5: Distribution of the average ranking of the housekeeping genes defined previously for each cohort separately.</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-gene-bc-imp">Figure&nbsp;<span>2.6</span></a> shows histograms of gene expression from some important genes in breast cancer.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-gene-bc-imp" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-gene-bc-imp-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption class="figure-caption">Figure&nbsp;2.6: Distribution of the gene expression levels of ESR1 and TFF1 in each one of the cohorts</figcaption>
</figure>
</div>
</div>
</div>
<p>ESR1 and TFF1 expressions are divided across ER status, as expected.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-gene-bc-imp-wo-scanb" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-gene-bc-imp-wo-scanb-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.7: Distribution of the gene expression levels of ESR1 and TFF1 in each one of the cohorts</figcaption>
</figure>
</div>
</div>
</div>
<p>The numbers of samples available for each cohort are shown in the table below.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   cohort      Negative      Positive         Total
 METABRIC  4.3%   (429) 14.3% (1,439) 18.5% (1,868)
   SCAN-B 10.5% (1,059) 61.0% (6,157) 71.5% (7,216)
     TCGA  2.3%   (231)  7.7%   (774) 10.0% (1,005)</code></pre>
</div>
</div>
</section>
<section id="checking-robustness-with-respect-of-number-of-stable-genes-available" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="checking-robustness-with-respect-of-number-of-stable-genes-available"><span class="header-section-number">2.1.3</span> Checking robustness with respect of number of stable genes available</h3>
<p>When calculating the normalized data, a total of 44 stable genes were used. Sometimes not all of these genes are available, therefore we will calculate the normalization using random subsets of 44 stable genes with different random sizes. The sets will have a minimum of 20 genes and maximum of 44. The sampling of the set size is obtained by using a uniform distribution. We focus just on TCGA for simplicity. The correlation used in this case was the Pearson correlation.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-correlation" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-correlation-1.png" class="img-fluid figure-img" width="2016"></p>
<figcaption class="figure-caption">Figure&nbsp;2.8: Correlation distribution for different subsets of housekeeping genes (HKGs). Each different subset has a different number of HKGs.</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-correlation">Figure&nbsp;<span>2.8</span></a> shows the different distributions given the subsets of housekeeping genes. All the correlation coefficients are close to 1. This means that if a subset of housekeeping genes are missing it is fine, as the others will compensate.</p>
</section>
</section>
<section id="integrating-tcga-and-metabric-using-pca" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="integrating-tcga-and-metabric-using-pca"><span class="header-section-number">2.2</span> Integrating TCGA and METABRIC using PCA</h2>
<p>The next step is creating the framework where we can integrate any patient sample and compare each other, at least spatially. The approach is similar to some sort of unsupervised learning, where no labels or groups are specified, which is something common in algorithms for batch removal. By using PCA in some subset of TCGA and METABRIC, we should learn the idiosyncrasies of the RNA-seq and microarray technologies as well as batch effects general to datasets. Since these two cohorts are big ones, we assume that if there are common batch effects, they are represented on them.</p>
<p>The practical steps are: first subselect 1000 samples in total from METABRIC <strong>and</strong> TCGA. Train PCA using these 1000 samples. Validate the results by projecting the other samples. In the next section we show how robust the approach is when selecting the samples. In the next chapters we validate the projection in unseen cohorts.</p>
<p>Integrating as laid out here only uses molecular data, therefore patients might be close to each other but they might have very different clinical features. This should always be kept in mind.</p>
<p>The table below shows the molecular characteristics of the patients selected for the PCA training.</p>
<div class="cell">
<div class="cell-output-display">
<table class="lightable-classic table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">cohort</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">basal</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">her2</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">lumb</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">luma</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">normal</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">claudin-low</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">metabric</td>
<td style="text-align: left;">7.3% (73)</td>
<td style="text-align: left;">7.4% (74)</td>
<td style="text-align: left;">16.3% (163)</td>
<td style="text-align: left;">22.4% (224)</td>
<td style="text-align: left;">4.6% (46)</td>
<td style="text-align: left;">6.8% (68)</td>
<td style="text-align: left;">64.8% (648)</td>
</tr>
<tr class="even">
<td style="text-align: left;">tcga</td>
<td style="text-align: left;">7.0% (70)</td>
<td style="text-align: left;">2.8% (28)</td>
<td style="text-align: left;">6.1% (61)</td>
<td style="text-align: left;">17.7% (177)</td>
<td style="text-align: left;">1.6% (16)</td>
<td style="text-align: left;">0.0% (0)</td>
<td style="text-align: left;">35.2% (352)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">14.3% (143)</td>
<td style="text-align: left;">10.2% (102)</td>
<td style="text-align: left;">22.4% (224)</td>
<td style="text-align: left;">40.1% (401)</td>
<td style="text-align: left;">6.2% (62)</td>
<td style="text-align: left;">6.8% (68)</td>
<td style="text-align: left;">100.0% (1,000)</td>
</tr>
</tbody>
</table>


</div>
</div>
<p><a href="#fig-pca-embeddings">Figure&nbsp;<span>2.9</span></a> shows the embedding of the two datasets together of the 1000 samples used for training. We select several PCs of interest to show how the embedding works.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-embeddings" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-embeddings-1.png" class="img-fluid figure-img" width="1344"></p>
<figcaption class="figure-caption">Figure&nbsp;2.9: PCA projections colored by different factors and organized by different components. (A) Plot of the first two components colored by cohort. (B) Plot of the first two components colored by ER status. (C) Plot of the second and third components colored by cohort. (D) Plot of the second and third components colored by ER status. (E) Plot of the second and third components colored by PAM50. (F) Plot of the second and third components colored by INTCLUST, only METABRIC has an assigned value for this variable, NAs are TCGA samples.</figcaption>
</figure>
</div>
</div>
</div>
<p>The first three components correspond to the batch effect. The third component explains the ER status and the two cohorts are well inter mingled. When plotting the third and fourth components and coloring by the molecular subtype, we see a clear distinction, recapitulating the biology.</p>
<p>The plot below shows how the loadings of the first component are really concentrated around zero, so there are not actually specific genes that are accounting for the batch effects we see in the first component. We show latter that the genes that are the most important are the ones with high loading, so the tail of the distributions. In this sense there are really no genes in the tail of the loadings for PC1.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-loadings-pcs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-loadings-pcs-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption class="figure-caption">Figure&nbsp;2.10: Different loadings for the first 4 components.</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-pca-og">Figure&nbsp;<span>2.11</span></a> shows all the samples from TCGA and cohort projected into the molecular landscape. The samples are mixing well, the only thing is that METABRIC is a bit offset to the left bottom.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-og" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-og-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.11: Original PC3 and PC4 of all samples, including test and train samples, of TCGA and METABRIC.</figcaption>
</figure>
</div>
</div>
</div>
<p>And the first two PCs.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-pc1-pc2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-pc1-pc2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.12: Original PC1 and PC2 of all samples, including test and train samples, of TCGA and METABRIC.</figcaption>
</figure>
</div>
</div>
</div>
<p>And <a href="#fig-pca-pam50">Figure&nbsp;<span>2.13</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-pam50" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-pam50-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.13: Original PC3 and PC4 of all samples, including test and train samples, of TCGA and METABRIC.</figcaption>
</figure>
</div>
</div>
</div>
<p>In order to check if the integration made sense, it is possible to color by ER status, NPI for METABRIC samples and tumor/node stage for TCGA. To check ER signaling scores, the pathways Estrogen response early/late and <span class="math inline">\(SET_{ER/PR}\)</span> are used to color the projection.</p>
<p><a href="#fig-pca-age">Figure&nbsp;<span>2.14</span></a> shows the coloring by age.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-age" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-age-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.14: PC3 and PC4 of samples from TCGA and METABRIC colored by age.</figcaption>
</figure>
</div>
</div>
</div>
<p>Age seems to be well mixed. <a href="#fig-pca-er-status">Figure&nbsp;<span>2.15</span></a> shows the PCA colored by ER status.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-er-status" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-er-status-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.15: PC3 and PC4 of samples from TCGA and METABRIC colored by ER status.</figcaption>
</figure>
</div>
</div>
</div>
<p>It has a very good separation among the different patients. <a href="#fig-pca-npi">Figure&nbsp;<span>2.16</span></a> is the PCA embedding colored by NPI. Only METABRIC samples have this information.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-npi" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-npi-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.16: PC3 and PC4 of samples from METABRIC only colored by NPI.</figcaption>
</figure>
</div>
</div>
</div>
<p>It looks good, ER+ BC patients have lower NPI, which makes sense. <a href="#fig-pca-npi-pc3">Figure&nbsp;<span>2.17</span></a> shows then how there is barely any correlation between the different subtypes and the NPI when stratified by the molecular subtype.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-npi-pc3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-npi-pc3-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.17: PC3 and NPI correlation colored and stratified by the intrinsic molecular subtype.</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-pca-tumor-purity">Figure&nbsp;<span>2.18</span></a> shows the biplot colored by tumor purity.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-tumor-purity" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-tumor-purity-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.18: PC3 and PC4 of samples from METABRIC only colored by tumor purity.</figcaption>
</figure>
</div>
</div>
</div>
<p>The tumor purity is not a factor that is affecting the embedding as samples with low cellularity (&lt; 40% of tumor cells) and high cellularity (&gt; 70% of tumor cells) intermingle.</p>
<p>Another way to visualize is the distribution of the principal components over the tumor purity (<a href="#fig-pca-pc-by-tumor-purity">Figure&nbsp;<span>2.19</span></a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-pc-by-tumor-purity" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-pc-by-tumor-purity-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.19: PC3 and PC4 stratified by tumor purity</figcaption>
</figure>
</div>
</div>
</div>
<p>METABRIC has also inferred menopausal status for the patients, we use this information to check if there is any enrichment based on the patient menopausal status (<a href="#fig-pca-men-status">Figure&nbsp;<span>2.20</span></a>)</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-men-status" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-men-status-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.20: PC3 and PC4 of samples from METABRIC only colored by menopausal status.</figcaption>
</figure>
</div>
</div>
</div>
<p>We don’t see any difference between the two status. We proceed now with the analysis using clinical factors from TCGA.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-tumor-node" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-tumor-node-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption class="figure-caption">Figure&nbsp;2.21: PC3 and PC4 of samples from TCGA only colored by tumor stage and node stage.</figcaption>
</figure>
</div>
</div>
</div>
<p>For both tumor and node stage the samples seem to have mixed well, indicating the projection is not a function of the stages, as shown in <a href="#fig-pca-tumor-node">Figure&nbsp;<span>2.21</span></a>.</p>
<p>And finally <a href="#fig-pca-pam50-2">Figure&nbsp;<span>2.22</span></a> below shows the color by PAM50 molecular subtype.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-pam50-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-pam50-2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.22: Corrected PC3 and PC4 of samples from TCGA and METABRIC colored by PAM50 molecular subtype.</figcaption>
</figure>
</div>
</div>
</div>
<p>The molecular subtypes are projected as expected, going from left to right there are the basal-like BC patients, going to HER2 and then they are split between luminal A and B. The normal like patients are in the top and closer to the luminal A, reflecting the biology.</p>
<p>The next figures show the ER signaling measures coloring the projections.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-seterpr" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-seterpr-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.23: biplot of PC3 and PC4 of samples from TCGA and METABRIC colored by the SET ER/PR score.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-early" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-early-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.24: biplot of PC3 and PC4 of samples from TCGA and METABRIC colored by the hallmark estrogen response early.</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-late" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-late-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2.25: biplot of PC3 and PC4 of samples from TCGA and METABRIC colored by the hallmark estrogen response late</figcaption>
</figure>
</div>
</div>
</div>
<p>In all cases the mixing is relatively good. For <span class="math inline">\(SET_{ER/PR}\)</span> you have a gradient going from the right to the left, showing again that patients on the far top right probably are those patients with better prognosis.</p>
<p>And lastly we use the correlation plot available from PCAtools to check the PC correlation with all the clinical factors, we check the first 10 components as these are the ones with more variation.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-correlation-clin-pcs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-correlation-clin-pcs-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption class="figure-caption">Figure&nbsp;2.26: Pearson r-squared between clinical factors and principal components.</figcaption>
</figure>
</div>
</div>
</div>
<p>We see that the two biggest correlations is with cohort and PC1/PC2 as expected. There is a bit of correlation of NPI and PC3, since basal-like tumors have usually higher NPI scores, they are more aggressive. Also, as expected ER status has a pretty high correlation with PC3 since the basal like are on the left of the principal component and the luminal A/B are on the right region.</p>
<p>Moreover, basal-like tumors are more pure compared to the luminal A. For the luminal A subtype the amount of tumors that are high or moderate in terms of purity are balanced (around 45%). In all subtypes, the amount of samples with low tumor purity are overall low, excluding the normal-like and claudin-low.</p>
<div class="cell">
<div class="cell-output-display">
<table class="lightable-classic table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">CELLULARITY</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">basal</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">her2</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">lumb</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">luma</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">normal</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">claudin-low</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">High</td>
<td style="text-align: left;">60.5% (118)</td>
<td style="text-align: left;">59.0% (121)</td>
<td style="text-align: left;">63.1% (281)</td>
<td style="text-align: left;">47.6% (315)</td>
<td style="text-align: left;">21.9% (28)</td>
<td style="text-align: left;">33.7% (61)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Low</td>
<td style="text-align: left;">12.8% (25)</td>
<td style="text-align: left;">7.3% (15)</td>
<td style="text-align: left;">4.5% (20)</td>
<td style="text-align: left;">7.4% (49)</td>
<td style="text-align: left;">34.4% (44)</td>
<td style="text-align: left;">22.7% (41)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Moderate</td>
<td style="text-align: left;">26.7% (52)</td>
<td style="text-align: left;">33.7% (69)</td>
<td style="text-align: left;">32.4% (144)</td>
<td style="text-align: left;">45.0% (298)</td>
<td style="text-align: left;">43.8% (56)</td>
<td style="text-align: left;">43.6% (79)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">100.0% (195)</td>
<td style="text-align: left;">100.0% (205)</td>
<td style="text-align: left;">100.0% (445)</td>
<td style="text-align: left;">100.0% (662)</td>
<td style="text-align: left;">100.0% (128)</td>
<td style="text-align: left;">100.0% (181)</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Next we just show the <span class="math inline">\(r^2\)</span> pearson residuals for the SCAN-B, an external cohort.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-molsub-scanb-pearson-pcs" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-molsub-scanb-pearson-pcs-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;2.27: <strong>?(caption)</strong></figcaption>
</figure>
</div>
</div>
</div>
<p>We see that the majority of the residuals are explained in PC3 and PC4, as expected. The HER2 seems to have a similar correlation in PC3 and PC7. Below we plot only basal-like, luminal B and HER2 enriched tumor samples to compare.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="pca_merging_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In fact the difference is mainly on PC3 and not so much on PC7. It is only a subset of those samples that have lower PC7. And when we compare PC3 vs PC4.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="pca_merging_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>PC7 is not adding much in general to the separation.</p>
</section>
<section id="the-integration-is-robust-with-respect-of-selection-of-samples" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="the-integration-is-robust-with-respect-of-selection-of-samples"><span class="header-section-number">2.3</span> The integration is robust with respect of selection of samples</h2>
<p>The embedding could be due to the patients selected and samples that are close to each other in one embedding would be far away from them in another embedding. Ten random sets of 1000 patients are sampled and the embedding is calculate. A total of 10 PCA embeddings are obtained.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Seed: 0"
[1] "Seed: 20"
[1] "Seed: 40"
[1] "Seed: 60"
[1] "Seed: 80"
[1] "Seed: 100"
[1] "Seed: 120"
[1] "Seed: 140"
[1] "Seed: 160"
[1] "Seed: 180"
[1] "Seed: 200"
[1] "Seed: 220"
[1] "Seed: 240"
[1] "Seed: 260"
[1] "Seed: 280"
[1] "Seed: 300"
[1] "Seed: 320"
[1] "Seed: 340"
[1] "Seed: 360"
[1] "Seed: 380"
[1] "Seed: 400"
[1] "Seed: 420"
[1] "Seed: 440"
[1] "Seed: 460"
[1] "Seed: 480"</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-plots-pcas-random" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-plots-pcas-random-1.png" class="img-fluid figure-img" width="1344"></p>
<figcaption class="figure-caption">Figure&nbsp;2.28: Selecting a random set of 1000 patients an rerunning the pipeline to obtain other embeddings. Red color corresponds to the embedding using the new fitted PCA. Blue corresponds to the embedding of the original PCA. Each dot corresponds to a patient.</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-plots-pcas-random">Figure&nbsp;<span>2.28</span></a> shows that the embedding is invariant for rotation, translation and reflection for 4 random sets of samples coming from either METABRIC or TCGA.</p>
<p><a href="#fig-jac-index">Figure&nbsp;<span>2.29</span></a> shows the jaccard index distributions for each cohort separately when comparing the sample neighborhoods of the new embeddings with the original embedding. The jaccard index is counting the number of samples in the intersection of the neighborhoods in the original and the new embedding divided by the total number of unique samples in both neighborhoods. A high value means a good agreement with the neighborhoods.</p>
<p>A thousand samples were randomly selected from each cohort individually and the jaccard index for each new embedding was calculated.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-jac-index" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-jac-index-1.png" class="img-fluid figure-img" width="480"></p>
<figcaption class="figure-caption">Figure&nbsp;2.29: Jaccard index distribution for 1000 samples in each cohort individually. Each color corresponds to a different seed and embedding, with a total of 18 seeds.</figcaption>
</figure>
</div>
</div>
</div>
<p>And below we show the standard deviation of the average of the distributions.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  mean_of_jaccard_mean sd_of_jaccard_mean
                 &lt;dbl&gt;              &lt;dbl&gt;
1                0.747             0.0605</code></pre>
</div>
</div>
<p>This indicates a high agreement.</p>
</section>
<section id="normalization-is-necessary-to-reduce-batch-effects-in-other-components" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="normalization-is-necessary-to-reduce-batch-effects-in-other-components"><span class="header-section-number">2.4</span> Normalization is necessary to reduce batch effects in other components</h2>
<p>Since PCA is removing batch effects from the datasets, one could argue it could also remove platform dependent normalization values and therefore one would need to look only at lower principal components. In this section we show that doing the normalization is necessary to get a good integration in the datasets.</p>
<p>The idea is similar as before, but instead of performing the <em>qPCR</em>-like normalization on the datasets, one would use the logFPKM values for TCGA and median intensity for microarray. The problem with this kind of approach also includes the fact that only other samples that went through this processing could be used in the pipeline.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-no-norm" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-no-norm-1.png" class="img-fluid figure-img" width="1344"></p>
<figcaption class="figure-caption">Figure&nbsp;2.30: PCA projections colored by different factors and organized by different components. (A) Plot of the first two components colored by cohort. (B) Plot of the first two components colored by ER status. (C) Plot of the second and third components colored by cohort. (D) Plot of the second and third components colored by ER status. (E) Plot of the second and third components colored by PAM50.</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-pca-no-norm">Figure&nbsp;<span>2.30</span></a> shows the contrast with the other method including the normalization. Without the normalization, the samples from METABRIC tend to concentrate close to the center, they are not so well mixed.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-norm-no-norm" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-norm-no-norm-1.png" class="img-fluid figure-img" width="1344"></p>
<figcaption class="figure-caption">Figure&nbsp;2.31: PC3 and PC4 from all METABRIC and TCGA samples. (A) Embedding using the qPCR-like normalization. (B) Embedding using the original normalization from each dataset.</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-pca-norm-no-norm">Figure&nbsp;<span>2.31</span></a> shows side by side the differences when using the qPCR-like normalization and when not using. The left plot is using the qPCR normalization and shows how well the mixing gets, putting samples in the same scale. If the scaling in a sample level is not performed, samples do not mix well.</p>
</section>
<section id="molecular-landscape-is-characterized-by-several-pathways" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="molecular-landscape-is-characterized-by-several-pathways"><span class="header-section-number">2.5</span> Molecular landscape is characterized by several pathways</h2>
<p>Among the 1000 genes that are used when calculating the molecular landscape, several might be involved in biological process. <a href="#fig-pca-mol-land-pathways">Figure&nbsp;<span>2.32</span></a> shows that several pathways are associated with the position in the molecular landscape. Something that is particularly remarkable here is the association of the epithelial mesenchymal transition and DNA repair pathways with PC4.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-mol-land-pathways" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-mol-land-pathways-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption class="figure-caption">Figure&nbsp;2.32: Hex biplots colored by different pathways. Each hex is colored based on the average score in the hex.</figcaption>
</figure>
</div>
</div>
</div>
<p>We see that these pathways are somehow relevant to the embedding, but are they also prognostic of overall survival in the two cohorts? In the next chunks we evaluate this hypothesis. Mostly the focus is on ER+ BC patients that received some kind of hormonal therapy. As seen before, for the TCGA dataset we select ER+ BC patients that have the molecular subtype luminal A and B instead.</p>
<p>Just before moving on we plot the embedding colored by molecular subtype stratified by cohort so it can go together with a figure in the paper and it is easier to compare the pathways.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-cohorts-mol-sub-stratified" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-cohorts-mol-sub-stratified-1.png" class="img-fluid figure-img" width="1056"></p>
<figcaption class="figure-caption">Figure&nbsp;2.33: <strong>?(caption)</strong></figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-mol-land-survival" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-mol-land-survival-1.png" class="img-fluid figure-img" width="384"></p>
<figcaption class="figure-caption">Figure&nbsp;2.34: Overall survival analysis from all the three big cohorts and their scores. The formulas used were the same as for the estrogen signaling analysis.</figcaption>
</figure>
</div>
</div>
</div>
<p>We see that G2M checkpoint has hazard ratio higher than 1. The other scores are a bit more variable and can change the sign (type S error).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-pca-mol-land-survival-scanb-metabric" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pca_merging_files/figure-html/fig-pca-mol-land-survival-scanb-metabric-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;2.35: Overall survival analysis from all the three big cohorts and their scores. The formulas used were the same as for the estrogen signaling analysis.</figcaption>
</figure>
</div>
</div>
</div>
<p>Below is the table with the scores.</p>
<div class="cell">
<div class="cell-output-display">

<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-7ace19711ee8f5d95cc3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-7ace19711ee8f5d95cc3">{"x":{"filter":"top","vertical":false,"filterHTML":"<tr>\n  <td><\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"character\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.478705269324721\" data-max=\"19.4818542584735\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"0.213332989979453\" data-max=\"3.9224621675295\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"1.07418329861371\" data-max=\"96.7613272322398\" data-scale=\"14\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n  <td data-type=\"number\" style=\"vertical-align: top;\">\n    <div class=\"form-group has-feedback\" style=\"margin-bottom: auto;\">\n      <input type=\"search\" placeholder=\"All\" class=\"form-control\" style=\"width: 100%;\"/>\n      <span class=\"glyphicon glyphicon-remove-circle form-control-feedback\"><\/span>\n    <\/div>\n    <div style=\"display: none;position: absolute;width: 200px;opacity: 1\">\n      <div data-min=\"9.31551528e-07\" data-max=\"0.90823615120816\" data-scale=\"15\"><\/div>\n      <span style=\"float: left;\"><\/span>\n      <span style=\"float: right;\"><\/span>\n    <\/div>\n  <\/td>\n<\/tr>","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25"],["os","os","os","rfs","rfs","os","os","os","rfs","rfs","os","os","os","rfs","rfs","os","os","os","rfs","rfs","os","os","os","rfs","rfs"],["metabric","scanb","tcga","metabric","scanb","metabric","scanb","tcga","metabric","scanb","metabric","scanb","tcga","metabric","scanb","metabric","scanb","tcga","metabric","scanb","metabric","scanb","tcga","metabric","scanb"],["HALLMARK_ANDROGEN_RESPONSE","HALLMARK_ANDROGEN_RESPONSE","HALLMARK_ANDROGEN_RESPONSE","HALLMARK_ANDROGEN_RESPONSE","HALLMARK_ANDROGEN_RESPONSE","HALLMARK_DNA_REPAIR","HALLMARK_DNA_REPAIR","HALLMARK_DNA_REPAIR","HALLMARK_DNA_REPAIR","HALLMARK_DNA_REPAIR","HALLMARK_EPITHELIAL_MESENCHYMAL_TRANSITION","HALLMARK_EPITHELIAL_MESENCHYMAL_TRANSITION","HALLMARK_EPITHELIAL_MESENCHYMAL_TRANSITION","HALLMARK_EPITHELIAL_MESENCHYMAL_TRANSITION","HALLMARK_EPITHELIAL_MESENCHYMAL_TRANSITION","HALLMARK_G2M_CHECKPOINT","HALLMARK_G2M_CHECKPOINT","HALLMARK_G2M_CHECKPOINT","HALLMARK_G2M_CHECKPOINT","HALLMARK_G2M_CHECKPOINT","HALLMARK_PI3K_AKT_MTOR_SIGNALING","HALLMARK_PI3K_AKT_MTOR_SIGNALING","HALLMARK_PI3K_AKT_MTOR_SIGNALING","HALLMARK_PI3K_AKT_MTOR_SIGNALING","HALLMARK_PI3K_AKT_MTOR_SIGNALING"],[0.8215534292662769,1.02851117761478,1.59724278913736,0.478705269324721,3.50113760868889,1.32969095386625,1.43778525561401,0.829258877398303,2.76183250375146,1.4396468042779,0.8710675333228119,1.21525582565223,1.22612708779607,0.78752663481704,1.368144805685,1.68132262108074,1.39723959589257,2.54497265847143,2.85372679847791,5.42766951996867,2.59016282260192,1.85494040420938,1.95453557131333,4.40888072544815,19.4818542584735],[0.446926318685268,0.637682787099436,0.448864626856196,0.213332989979453,1.50422120411667,0.74417569688978,0.831170890515623,0.232642716954844,1.27802964790826,0.511957196953844,0.662808549703372,0.954178867593082,0.623636249987758,0.548983228184011,0.873194104578446,1.16643580589,0.964227033229176,1.10772343849341,1.78545663758383,2.76125957314166,1.06524741739968,0.77274559869249,0.299108938316292,1.43141775236807,3.9224621675295],[1.51020427511339,1.65887375961676,5.68363906356252,1.07418329861371,8.149043851681389,2.37588789876272,2.48712564991133,2.95590721577315,5.96834258990962,4.04835195871741,1.14476291524703,1.5477671660315,2.41068032119169,1.1297215811088,2.14364732824956,2.42349020999137,2.02470831147712,5.84702427275188,4.56116181649279,10.6688978843372,6.29801428100713,4.45269945113943,12.7719663646074,13.5797039117829,96.76132723223979],[0.526867994568006,0.90823615120816,0.469633138482829,0.07402981840853259,0.00364724263395561,0.335948839824261,0.194076902830643,0.7728084324811491,0.00976797912737329,0.489703317073717,0.32209515335252,0.114137926533503,0.554505994158537,0.194480904796802,0.171272198445889,0.00534890634661276,0.07714833923063071,0.0277342312691679,1.17223603300824e-05,9.31551528587417e-07,0.0357823669701017,0.166688040776242,0.484092023037668,0.00974207913297241,0.000282021662681064]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>type_analysis<\/th>\n      <th>cohort<\/th>\n      <th>term<\/th>\n      <th>HR<\/th>\n      <th>conf.low<\/th>\n      <th>conf.high<\/th>\n      <th>p.value<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"pageLength":20,"columnDefs":[{"targets":7,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatSignif(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":4,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":5,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"targets":6,"render":"function(data, type, row, meta) {\n    return type !== 'display' ? data : DTWidget.formatRound(data, 2, 3, \",\", \".\", null);\n  }"},{"className":"dt-right","targets":[4,5,6,7]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"orderCellsTop":true,"lengthMenu":[10,20,25,50,100]}},"evals":["options.columnDefs.0.render","options.columnDefs.1.render","options.columnDefs.2.render","options.columnDefs.3.render"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="tumor-purity" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="tumor-purity"><span class="header-section-number">2.6</span> Tumor Purity</h2>
<p>One possible problem that might arise in the analysis is the tumor purity. We showed already the molecular embedder colored by tumor purity but here we look more carefully at the relationship between PC3 and PC4 with tumor purity as made available by METABRIC.</p>
<p>We actually compare the PC3 and PC4 with tumor purity stratified by molecular subtype, as it is expected that the normal-like subtype is correlated with lower tumor purity.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="pca_merging_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="1344"></p>
</div>
</div>
<p>And when we look at all subtypes together.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="pca_merging_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Overall there is an absence of evidence that tumor purity is affecting PC3 and PC4 in a systematic way.</p>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-Bhuva2020" class="csl-entry" role="listitem">
Bhuva, Dharmesh D, Joseph Cursons, and Melissa J Davis. 2020. <span>“Stable Gene Expression for Normalisation and Single-Sample Scoring.”</span> <em>Nucleic Acids Research</em> 48 (19): e113–13. <a href="https://doi.org/10.1093/nar/gkaa802">https://doi.org/10.1093/nar/gkaa802</a>.
</div>
<div id="ref-Fei2018" class="csl-entry" role="listitem">
Fei, Teng, Tengjiao Zhang, Weiyang Shi, and Tianwei Yu. 2018. <span>“Mitigating the Adverse Impact of Batch Effects in Sample Pattern Detection.”</span> Edited by Inanc Birol. <em>Bioinformatics</em> 34 (15): 2634–41. <a href="https://doi.org/10.1093/bioinformatics/bty117">https://doi.org/10.1093/bioinformatics/bty117</a>.
</div>
<div id="ref-Paik2004" class="csl-entry" role="listitem">
Paik, Soonmyung, Steven Shak, Gong Tang, Chungyeul Kim, Joffre Baker, Maureen Cronin, Frederick L. Baehner, et al. 2004. <span>“A Multigene Assay to Predict Recurrence of Tamoxifen-Treated, Node-Negative Breast Cancer.”</span> <em>New England Journal of Medicine</em> 351 (27): 2817–26. <a href="https://doi.org/10.1056/nejmoa041588">https://doi.org/10.1056/nejmoa041588</a>.
</div>
<div id="ref-Risso2014" class="csl-entry" role="listitem">
Risso, Davide, John Ngai, Terence P Speed, and Sandrine Dudoit. 2014. <span>“Normalization of <span>RNA</span>-Seq Data Using Factor Analysis of Control Genes or Samples.”</span> <em>Nature Biotechnology</em> 32 (9): 896–902. <a href="https://doi.org/10.1038/nbt.2931">https://doi.org/10.1038/nbt.2931</a>.
</div>
<div id="ref-vandeVijver2002" class="csl-entry" role="listitem">
Vijver, Marc J. van de, Yudong D. He, Laura J. van t Veer, Hongyue Dai, Augustinus A. M. Hart, Dorien W. Voskuil, George J. Schreiber, et al. 2002. <span>“A Gene-Expression Signature as a Predictor of Survival in Breast Cancer.”</span> <em>New England Journal of Medicine</em> 347 (25): 1999–2009. <a href="https://doi.org/10.1056/nejmoa021967">https://doi.org/10.1056/nejmoa021967</a>.
</div>
<div id="ref-Wallden2015" class="csl-entry" role="listitem">
Wallden, Brett, James Storhoff, Torsten Nielsen, Naeem Dowidar, Carl Schaper, Sean Ferree, Shuzhen Liu, et al. 2015. <span>“Development and Verification of the <span>PAM</span>50-Based Prosigna Breast Cancer Gene Signature Assay.”</span> <em><span>BMC</span> Medical Genomics</em> 8 (1). <a href="https://doi.org/10.1186/s12920-015-0129-6">https://doi.org/10.1186/s12920-015-0129-6</a>.
</div>
<div id="ref-Wishart2010" class="csl-entry" role="listitem">
Wishart, Gordon C, Elizabeth M Azzato, David C Greenberg, Jem Rashbass, Olive Kearins, Gill Lawrence, Carlos Caldas, and Paul DP Pharoah. 2010. <span>“<span>PREDICT</span>: A New <span>UK</span> Prognostic Model That Predicts Survival Following Surgery for Invasive Breast Cancer.”</span> <em>Breast Cancer Research</em> 12 (1). <a href="https://doi.org/10.1186/bcr2464">https://doi.org/10.1186/bcr2464</a>.
</div>
<div id="ref-Zhang2020" class="csl-entry" role="listitem">
Zhang, Yuqing, Giovanni Parmigiani, and W Evan Johnson. 2020. <span>“<span>ComBat</span>-Seq: Batch Effect Adjustment for <span>RNA</span>-Seq Count Data.”</span> <em><span>NAR</span> Genomics and Bioinformatics</em> 2 (3). <a href="https://doi.org/10.1093/nargab/lqaa078">https://doi.org/10.1093/nargab/lqaa078</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../chapters/surv_analysis_estrogen.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Estrogen receptor status is continuous, not dichotomous</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/validation.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Validating the molecular landscape</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb7" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">  markdown: </span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">    wrap: 80</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># A new framework for personalized medicine: integrating</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>In the next few chapters we will show a new framework for personalized medicine.</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>This is motivated by the fact that we know already some patients are more</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>sensitive to endocrine therapy than others, but we don't know what are possible</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>treatments. Moreover, it is very difficult to compare, molecularly, patients</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>among themselves.</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>The PREDICT tool <span class="co">[</span><span class="ot">@Wishart2010</span><span class="co">]</span> provides a tool for practitioners to calculate</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>survival risks among patients with similar clinical characteristics. This is</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>very important as it shows how to combine data from previous patients to guide</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>further treatments of new patients. However, no additional information is given,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>such as alternative pathways to target or what might be different from other</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>patients.</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>Other tools that help in the clinics are the molecular signatures developed by</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>companies <span class="co">[</span><span class="ot">@Wallden2015; @vandeVijver2002; @Paik2004</span><span class="co">]</span>. These signatures are</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>intended to be used with ER+ BC patients and depending on the tool, on node</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>negative, post-menopausal women. Based on the set of genes, a risk score is</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>assigned or each patient. The score means if a patient would benefit from</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>additional chemotherapy besides the usual endocrine therapy received for either</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>5 or 10 years. They also lack the additional information of what are possible</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>pathways involved and alternative treatments beside chemotherapy.</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>There are a few challenges to overcome pathway analysis for patients</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>individually and how to compare patients molecularly. There is no tool that</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>allows to integrate patients in a continuous way. Usually integration is a one</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>step procedure and cannot be updated. The usual tools are [@Risso2014;</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>@Zhang2020; @Fei2018] and they do not provide batch effect removal for new</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>samples. The only way is to re-run the procedure together with the new sample.</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>The problem of doing this is usually you don't have enough samples to estimate</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>batch effects across groups and therefore correct it.</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>This chapter show how to perform PCA projection using samples from different</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>datasets and how new samples can be introduced without retraining of the PCA. We</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>first introduce the notion of a new normalization that depends on housekeeping</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>genes. After using this new normalization, we proceed with PCA on a subset of</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>two cohorts using the 1000 most variable genes. We then validate the integration</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>with new samples from a completely different cohort.</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup}</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">restore</span>()</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtext)</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PCAtools)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(singscore)</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SummarizedExperiment)</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../R/utils.R"</span>)</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../R/first_run.R"</span>)</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="co"># the following script load all data necessary to run the chunks.</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a><span class="co"># the data is generated from this quarto document itself, therefore</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a><span class="co"># if you are running this documents the first time and don't have the</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a><span class="co"># files, comment the following lines. Moreover, if this is your first</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a><span class="co"># time running the document, you should run all chunks, to generate </span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a><span class="co"># all the necessary files, if you don't have them. Once all files </span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a><span class="co"># are saved and available in the respective folder, the following</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a><span class="co"># lines can be executed. </span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (first_run){</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>    load_at_setup <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>    load_at_setup <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>name_document <span class="ot">&lt;-</span> <span class="st">"pca_merging"</span></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">"../../results/"</span>, <span class="fu">c</span>(<span class="st">"plots"</span>, <span class="st">"rds_files"</span>, <span class="st">"tables"</span>), <span class="st">"/"</span>, name_document),</span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>    dir.create,</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">showWarnings =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>    <span class="at">recursive =</span> <span class="cn">TRUE</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../R/load_rds_files.R"</span>)</span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a><span class="co"># by setting the dev to png and pdf, this saves the figures in a specific</span></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a><span class="co"># folder in both formats. moreover, since png is coming first, it shows</span></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a><span class="co"># this figure when rendering the html. What is nice about this is that it</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a><span class="co"># inherits the properties from the chunk to save the figure, so no need</span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a><span class="co"># to use ggplot2::ggsave to save the plots. this also works </span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">dev =</span> <span class="fu">c</span>(<span class="st">'png'</span>, <span class="st">'pdf'</span>))</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">bitmapType =</span> <span class="st">'cairo'</span>)</span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a><span class="fu">## Transcriptomics and qPCR normalization</span></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>In this first step we introduce a new normalization. The rational is that we</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>need a normalization procedure that is applied in a single sample only, similar</span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>to logCPM, but that can be applied to microarray too. In this case, given a set</span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>of samples, we start by ranking the genes in each sample. We then normalize the</span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>ranking to be between 0 and 1, i.e., we divide by the total number of genes</span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>available in that sample. Then, given a list of 50 stable genes across cancer</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">@Bhuva2020</span><span class="co">]</span>, we calculate the average ranking of these genes in the sample and</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>then for each gene in the sample we divide by this average.</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a><span class="fu">### Selecting stable genes</span></span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = first_run}</span></span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>datasets <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/rds_files/surv_analysis_estrogen/datasets_with_scores.rds"</span></span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>stable_genes <span class="ot">&lt;-</span> <span class="fu">intersect</span>(</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>    singscore<span class="sc">::</span><span class="fu">getStableGenes</span>(<span class="at">n_stable =</span> <span class="dv">50</span>, <span class="at">type =</span> <span class="st">"carcinoma"</span>),</span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Reduce</span>(intersect, <span class="fu">lapply</span>(datasets[<span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)], rownames))</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>    stable_genes,</span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/rds_files/pca_merging/stable_genes.rds"</span></span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>load_at_setup){</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>    datasets <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(</span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../../results/rds_files/surv_analysis_estrogen/datasets_with_scores.rds"</span></span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>    stable_genes <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(</span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../../results/rds_files/pca_merging/stable_genes.rds"</span></span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>    which_exp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(</span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../../results/rds_files/surv_analysis_estrogen/which_exp.rds"</span></span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a>The first step is to check what number of these 50 genes are available on TCGA</span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a>and METABRIC, as these datasets will be used for training the PCA projection.</span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a>The total number of available genes is <span class="in">`r length(stable_genes)`</span>.</span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Table @fig-stable-genes</span><span class="co">]</span> shows the name of the genes </span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a>available in TCGA and METABRIC.</span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a>Now we select the 1000 most variable genes across METABRIC and TCGA. Reducing</span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a>the number of genes used when calculating the PCA helps in the future. Several</span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a>publicly available datasets don't have many genes available, therefore reducing</span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a>the number of genes increases the chances of using this approach in other</span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a>datasets.</span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a>Moreover, the use of a large number of genes is used because if some of them</span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a>are not available. We show in later sections that if some number of stable</span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a>genes are missing, it will not affect the normalization. </span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-159"><a href="#cb7-159" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-stable-genes</span></span>
<span id="cb7-160"><a href="#cb7-160" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: ([Table @fig-stable-genes]) Available stable genes </span></span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a><span class="co">#|     in both TCGA and METABRIC cohorts.</span></span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">genes =</span> stable_genes),</span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculating the normalization</span></span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a>We will create subset of the summarised experiment objects to save these</span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a>information. Moreover, since a summarized experiment object is being used, we</span>
<span id="cb7-172"><a href="#cb7-172" aria-hidden="true" tabindex="-1"></a>can save the new normalization in the <span class="in">`assays`</span> and the average ranking scores of</span>
<span id="cb7-173"><a href="#cb7-173" aria-hidden="true" tabindex="-1"></a>the housekeeping genes in the column data <span class="in">`colData`</span>. This way it is very easy to</span>
<span id="cb7-174"><a href="#cb7-174" aria-hidden="true" tabindex="-1"></a>retrieve the information for the patients.</span>
<span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-178"><a href="#cb7-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-179"><a href="#cb7-179" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-comparison-sd-cv</span></span>
<span id="cb7-180"><a href="#cb7-180" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Comparison of coefficient of variation and standard deviation</span></span>
<span id="cb7-181"><a href="#cb7-181" aria-hidden="true" tabindex="-1"></a><span class="co">#|     scores. </span></span>
<span id="cb7-182"><a href="#cb7-182" aria-hidden="true" tabindex="-1"></a><span class="co"># the strategy is to calculate the standard deviation for each cohort separately</span></span>
<span id="cb7-183"><a href="#cb7-183" aria-hidden="true" tabindex="-1"></a><span class="co"># and then select the genes with the highest average standard deviation and</span></span>
<span id="cb7-184"><a href="#cb7-184" aria-hidden="true" tabindex="-1"></a><span class="co"># then we include the stable genes as well</span></span>
<span id="cb7-185"><a href="#cb7-185" aria-hidden="true" tabindex="-1"></a>common_genes <span class="ot">&lt;-</span> <span class="fu">Reduce</span>(intersect, <span class="fu">lapply</span>(datasets, rownames))</span>
<span id="cb7-186"><a href="#cb7-186" aria-hidden="true" tabindex="-1"></a>nb_tcga <span class="ot">&lt;-</span> <span class="fu">ncol</span>(datasets<span class="sc">$</span>tcga)</span>
<span id="cb7-187"><a href="#cb7-187" aria-hidden="true" tabindex="-1"></a>nb_metabric <span class="ot">&lt;-</span> <span class="fu">ncol</span>(datasets<span class="sc">$</span>metabric)</span>
<span id="cb7-188"><a href="#cb7-188" aria-hidden="true" tabindex="-1"></a>cv_genes <span class="ot">&lt;-</span> <span class="fu">mapply</span>(</span>
<span id="cb7-189"><a href="#cb7-189" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(df, assay_to_use, common_genes){</span>
<span id="cb7-190"><a href="#cb7-190" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-191"><a href="#cb7-191" aria-hidden="true" tabindex="-1"></a>        <span class="co"># select first common genes across the two cohorts, so the identified</span></span>
<span id="cb7-192"><a href="#cb7-192" aria-hidden="true" tabindex="-1"></a>        <span class="co"># genes are the same</span></span>
<span id="cb7-193"><a href="#cb7-193" aria-hidden="true" tabindex="-1"></a>        df <span class="ot">&lt;-</span> df[common_genes, ]</span>
<span id="cb7-194"><a href="#cb7-194" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-195"><a href="#cb7-195" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rowSds</span>(<span class="fu">as.matrix</span>(<span class="fu">assay</span>(df, assay_to_use)))<span class="sc">/</span></span>
<span id="cb7-196"><a href="#cb7-196" aria-hidden="true" tabindex="-1"></a>            <span class="fu">rowMeans</span>(<span class="fu">as.matrix</span>(<span class="fu">assay</span>(df, assay_to_use)))</span>
<span id="cb7-197"><a href="#cb7-197" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb7-198"><a href="#cb7-198" aria-hidden="true" tabindex="-1"></a>    <span class="at">df =</span> datasets[<span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)],</span>
<span id="cb7-199"><a href="#cb7-199" aria-hidden="true" tabindex="-1"></a>    <span class="at">assay_to_use =</span> <span class="fu">list</span>(</span>
<span id="cb7-200"><a href="#cb7-200" aria-hidden="true" tabindex="-1"></a>        <span class="at">tcga =</span> <span class="st">"vst"</span>,</span>
<span id="cb7-201"><a href="#cb7-201" aria-hidden="true" tabindex="-1"></a>        <span class="at">metabric =</span> <span class="st">"median_intensity"</span></span>
<span id="cb7-202"><a href="#cb7-202" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb7-203"><a href="#cb7-203" aria-hidden="true" tabindex="-1"></a>    <span class="at">MoreArgs =</span> <span class="fu">list</span>(<span class="at">common_genes =</span> common_genes)</span>
<span id="cb7-204"><a href="#cb7-204" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> data.frame <span class="sc">%&gt;%</span></span>
<span id="cb7-205"><a href="#cb7-205" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-206"><a href="#cb7-206" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">average =</span> <span class="fu">mean</span>(<span class="fu">c</span>(tcga, metabric))) <span class="sc">%&gt;%</span></span>
<span id="cb7-207"><a href="#cb7-207" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-208"><a href="#cb7-208" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">symbol =</span> common_genes) </span>
<span id="cb7-209"><a href="#cb7-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-210"><a href="#cb7-210" aria-hidden="true" tabindex="-1"></a>sd_genes <span class="ot">&lt;-</span> <span class="fu">mapply</span>(</span>
<span id="cb7-211"><a href="#cb7-211" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(df, assay_to_use, common_genes){</span>
<span id="cb7-212"><a href="#cb7-212" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-213"><a href="#cb7-213" aria-hidden="true" tabindex="-1"></a>        <span class="co"># select first common genes across the two cohorts, so the identified</span></span>
<span id="cb7-214"><a href="#cb7-214" aria-hidden="true" tabindex="-1"></a>        <span class="co"># genes are the same</span></span>
<span id="cb7-215"><a href="#cb7-215" aria-hidden="true" tabindex="-1"></a>        df <span class="ot">&lt;-</span> df[common_genes, ]</span>
<span id="cb7-216"><a href="#cb7-216" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-217"><a href="#cb7-217" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rowSds</span>(<span class="fu">as.matrix</span>(<span class="fu">assay</span>(df, assay_to_use)))</span>
<span id="cb7-218"><a href="#cb7-218" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb7-219"><a href="#cb7-219" aria-hidden="true" tabindex="-1"></a>    <span class="at">df =</span> datasets[<span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)],</span>
<span id="cb7-220"><a href="#cb7-220" aria-hidden="true" tabindex="-1"></a>    <span class="at">assay_to_use =</span> <span class="fu">list</span>(</span>
<span id="cb7-221"><a href="#cb7-221" aria-hidden="true" tabindex="-1"></a>        <span class="at">tcga =</span> <span class="st">"vst"</span>,</span>
<span id="cb7-222"><a href="#cb7-222" aria-hidden="true" tabindex="-1"></a>        <span class="at">metabric =</span> <span class="st">"median_intensity"</span></span>
<span id="cb7-223"><a href="#cb7-223" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb7-224"><a href="#cb7-224" aria-hidden="true" tabindex="-1"></a>    <span class="at">MoreArgs =</span> <span class="fu">list</span>(<span class="at">common_genes =</span> common_genes)</span>
<span id="cb7-225"><a href="#cb7-225" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> data.frame <span class="sc">%&gt;%</span></span>
<span id="cb7-226"><a href="#cb7-226" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-227"><a href="#cb7-227" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">average =</span> <span class="fu">sqrt</span>(</span>
<span id="cb7-228"><a href="#cb7-228" aria-hidden="true" tabindex="-1"></a>        ((nb_tcga<span class="dv">-1</span>)<span class="sc">*</span>tcga<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (nb_metabric<span class="dv">-1</span>)<span class="sc">*</span>metabric<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span></span>
<span id="cb7-229"><a href="#cb7-229" aria-hidden="true" tabindex="-1"></a>            (nb_tcga <span class="sc">+</span> nb_metabric <span class="sc">-</span> <span class="dv">2</span>) <span class="co"># this is the formula to calculate the</span></span>
<span id="cb7-230"><a href="#cb7-230" aria-hidden="true" tabindex="-1"></a>                                        <span class="co"># average for standard deviations</span></span>
<span id="cb7-231"><a href="#cb7-231" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span></span>
<span id="cb7-232"><a href="#cb7-232" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-233"><a href="#cb7-233" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">symbol =</span> common_genes) </span>
<span id="cb7-234"><a href="#cb7-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-235"><a href="#cb7-235" aria-hidden="true" tabindex="-1"></a>most_variable_genes_sd <span class="ot">&lt;-</span> sd_genes <span class="sc">%&gt;%</span> </span>
<span id="cb7-236"><a href="#cb7-236" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">order_by =</span> average) </span>
<span id="cb7-237"><a href="#cb7-237" aria-hidden="true" tabindex="-1"></a>most_variable_genes_cv <span class="ot">&lt;-</span> cv_genes <span class="sc">%&gt;%</span> </span>
<span id="cb7-238"><a href="#cb7-238" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice_max</span>(<span class="at">n =</span> <span class="dv">1000</span>, <span class="at">order_by =</span> average) </span>
<span id="cb7-239"><a href="#cb7-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-240"><a href="#cb7-240" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">inner_join</span>(cv_genes, sd_genes, <span class="at">by =</span> <span class="st">"symbol"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-241"><a href="#cb7-241" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> average.x, <span class="at">y =</span> average.y)) <span class="sc">+</span> </span>
<span id="cb7-242"><a href="#cb7-242" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb7-243"><a href="#cb7-243" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> <span class="st">"y~x"</span>) <span class="sc">+</span> </span>
<span id="cb7-244"><a href="#cb7-244" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-245"><a href="#cb7-245" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Average coefficient of variation (CV)"</span>,</span>
<span id="cb7-246"><a href="#cb7-246" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Average of standard deviation (SD)"</span>,</span>
<span id="cb7-247"><a href="#cb7-247" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Comparison of scores when selecting most variable genes"</span></span>
<span id="cb7-248"><a href="#cb7-248" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb7-249"><a href="#cb7-249" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>()</span>
<span id="cb7-250"><a href="#cb7-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-251"><a href="#cb7-251" aria-hidden="true" tabindex="-1"></a>p</span>
<span id="cb7-252"><a href="#cb7-252" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-253"><a href="#cb7-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-254"><a href="#cb7-254" aria-hidden="true" tabindex="-1"></a>They are highly correlated values, so we stick to the coefficient of </span>
<span id="cb7-255"><a href="#cb7-255" aria-hidden="true" tabindex="-1"></a>variation as it makes more sense in this kind of analysis.</span>
<span id="cb7-256"><a href="#cb7-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-259"><a href="#cb7-259" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-260"><a href="#cb7-260" aria-hidden="true" tabindex="-1"></a>most_variable_genes <span class="ot">&lt;-</span> most_variable_genes_cv</span>
<span id="cb7-261"><a href="#cb7-261" aria-hidden="true" tabindex="-1"></a>genes_for_pca <span class="ot">&lt;-</span> most_variable_genes_cv<span class="sc">$</span>symbol</span>
<span id="cb7-262"><a href="#cb7-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-263"><a href="#cb7-263" aria-hidden="true" tabindex="-1"></a>genes_for_pca <span class="ot">&lt;-</span> <span class="fu">c</span>(genes_for_pca, stable_genes) <span class="sc">%&gt;%</span> unique</span>
<span id="cb7-264"><a href="#cb7-264" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb7-265"><a href="#cb7-265" aria-hidden="true" tabindex="-1"></a>    genes_for_pca,</span>
<span id="cb7-266"><a href="#cb7-266" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/rds_files/pca_merging/genes_for_pca.rds"</span></span>
<span id="cb7-267"><a href="#cb7-267" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-268"><a href="#cb7-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-269"><a href="#cb7-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-270"><a href="#cb7-270" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">Table @fig-sd-stable-genes</span><span class="co">]</span> shows the top 1000 genes along with their standard</span>
<span id="cb7-271"><a href="#cb7-271" aria-hidden="true" tabindex="-1"></a>deviation. The stable genes are also added to the list.</span>
<span id="cb7-272"><a href="#cb7-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-275"><a href="#cb7-275" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-276"><a href="#cb7-276" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-sd-stable-genes</span></span>
<span id="cb7-277"><a href="#cb7-277" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: ([Table @fig-sd-stable-genes]) Standard deviation of each gene in</span></span>
<span id="cb7-278"><a href="#cb7-278" aria-hidden="true" tabindex="-1"></a><span class="co">#|     each condition and </span></span>
<span id="cb7-279"><a href="#cb7-279" aria-hidden="true" tabindex="-1"></a><span class="co">#|     pooled standard deviation. </span></span>
<span id="cb7-280"><a href="#cb7-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-281"><a href="#cb7-281" aria-hidden="true" tabindex="-1"></a>cv_genes <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(symbol <span class="sc">%in%</span> genes_for_pca) <span class="sc">%&gt;%</span></span>
<span id="cb7-282"><a href="#cb7-282" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb7-283"><a href="#cb7-283" aria-hidden="true" tabindex="-1"></a>        <span class="at">is_housekeeping =</span> <span class="fu">ifelse</span>(symbol <span class="sc">%in%</span> stable_genes, <span class="st">"yes"</span>, <span class="st">"no"</span>)</span>
<span id="cb7-284"><a href="#cb7-284" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-285"><a href="#cb7-285" aria-hidden="true" tabindex="-1"></a>    DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb7-286"><a href="#cb7-286" aria-hidden="true" tabindex="-1"></a>        <span class="at">rownames =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-287"><a href="#cb7-287" aria-hidden="true" tabindex="-1"></a>        <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb7-288"><a href="#cb7-288" aria-hidden="true" tabindex="-1"></a>            <span class="at">columnDefs =</span> <span class="fu">list</span>(</span>
<span id="cb7-289"><a href="#cb7-289" aria-hidden="true" tabindex="-1"></a>                <span class="fu">list</span>(<span class="at">className =</span> <span class="st">'dt-center'</span>, <span class="at">targets =</span> (<span class="dv">0</span><span class="sc">:</span><span class="fu">ncol</span>(sd_genes)))</span>
<span id="cb7-290"><a href="#cb7-290" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb7-291"><a href="#cb7-291" aria-hidden="true" tabindex="-1"></a>            <span class="at">scrollX =</span> <span class="cn">TRUE</span></span>
<span id="cb7-292"><a href="#cb7-292" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb7-293"><a href="#cb7-293" aria-hidden="true" tabindex="-1"></a>        <span class="at">filter =</span> <span class="st">'top'</span></span>
<span id="cb7-294"><a href="#cb7-294" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-295"><a href="#cb7-295" aria-hidden="true" tabindex="-1"></a>    DT<span class="sc">::</span><span class="fu">formatRound</span>(<span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>, <span class="st">"average"</span>))</span>
<span id="cb7-296"><a href="#cb7-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-297"><a href="#cb7-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-298"><a href="#cb7-298" aria-hidden="true" tabindex="-1"></a>Overall we can see that housekeeping genes have very low standard deviation</span>
<span id="cb7-299"><a href="#cb7-299" aria-hidden="true" tabindex="-1"></a>across cohorts, which is good.</span>
<span id="cb7-300"><a href="#cb7-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-301"><a href="#cb7-301" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = first_run}</span></span>
<span id="cb7-302"><a href="#cb7-302" aria-hidden="true" tabindex="-1"></a>datasets_normalized <span class="ot">&lt;-</span> <span class="fu">mapply</span>(</span>
<span id="cb7-303"><a href="#cb7-303" aria-hidden="true" tabindex="-1"></a>    get_final_ranking_values,</span>
<span id="cb7-304"><a href="#cb7-304" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_exp =</span> datasets,</span>
<span id="cb7-305"><a href="#cb7-305" aria-hidden="true" tabindex="-1"></a>    <span class="at">assay_to_use =</span> which_exp,</span>
<span id="cb7-306"><a href="#cb7-306" aria-hidden="true" tabindex="-1"></a>    <span class="at">MoreArgs =</span> <span class="fu">list</span>(</span>
<span id="cb7-307"><a href="#cb7-307" aria-hidden="true" tabindex="-1"></a>        <span class="at">stable_genes =</span> stable_genes,</span>
<span id="cb7-308"><a href="#cb7-308" aria-hidden="true" tabindex="-1"></a>        <span class="at">most_variable_genes =</span> <span class="fu">setdiff</span>(genes_for_pca, stable_genes)</span>
<span id="cb7-309"><a href="#cb7-309" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb7-310"><a href="#cb7-310" aria-hidden="true" tabindex="-1"></a>    <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-311"><a href="#cb7-311" aria-hidden="true" tabindex="-1"></a>    <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span></span>
<span id="cb7-312"><a href="#cb7-312" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-313"><a href="#cb7-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-314"><a href="#cb7-314" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb7-315"><a href="#cb7-315" aria-hidden="true" tabindex="-1"></a>    datasets_normalized,</span>
<span id="cb7-316"><a href="#cb7-316" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/rds_files/pca_merging/datasets_normalized.rds"</span></span>
<span id="cb7-317"><a href="#cb7-317" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-318"><a href="#cb7-318" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-319"><a href="#cb7-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-322"><a href="#cb7-322" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-323"><a href="#cb7-323" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>load_at_setup){</span>
<span id="cb7-324"><a href="#cb7-324" aria-hidden="true" tabindex="-1"></a>    datasets_normalized <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(</span>
<span id="cb7-325"><a href="#cb7-325" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../../results/rds_files/pca_merging/datasets_normalized.rds"</span></span>
<span id="cb7-326"><a href="#cb7-326" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-327"><a href="#cb7-327" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-328"><a href="#cb7-328" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-329"><a href="#cb7-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-330"><a href="#cb7-330" aria-hidden="true" tabindex="-1"></a>@fig-avg-ranking-hkg shows a histogram with</span>
<span id="cb7-331"><a href="#cb7-331" aria-hidden="true" tabindex="-1"></a>the distribution of the average ranking of the</span>
<span id="cb7-332"><a href="#cb7-332" aria-hidden="true" tabindex="-1"></a>housekeeping genes for each sample in each cohort.</span>
<span id="cb7-333"><a href="#cb7-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-334"><a href="#cb7-334" aria-hidden="true" tabindex="-1"></a><span class="in">```{r avg-rankings-hkg, fig.height=4, fig.width=10}</span></span>
<span id="cb7-335"><a href="#cb7-335" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-avg-ranking-hkg</span></span>
<span id="cb7-336"><a href="#cb7-336" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Distribution of the average ranking of the housekeeping genes</span></span>
<span id="cb7-337"><a href="#cb7-337" aria-hidden="true" tabindex="-1"></a><span class="co">#|     defined previously for each cohort separately.</span></span>
<span id="cb7-338"><a href="#cb7-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-339"><a href="#cb7-339" aria-hidden="true" tabindex="-1"></a>avg_rankings <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb7-340"><a href="#cb7-340" aria-hidden="true" tabindex="-1"></a>    datasets_normalized, </span>
<span id="cb7-341"><a href="#cb7-341" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) <span class="fu">colData</span>(x) <span class="sc">%&gt;%</span> data.frame <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(avg_ranking)</span>
<span id="cb7-342"><a href="#cb7-342" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"cohort"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-343"><a href="#cb7-343" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cohort =</span> <span class="fu">toupper</span>(cohort))</span>
<span id="cb7-344"><a href="#cb7-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-345"><a href="#cb7-345" aria-hidden="true" tabindex="-1"></a>avg_rankings <span class="sc">%&gt;%</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb7-346"><a href="#cb7-346" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> avg_ranking, <span class="at">fill =</span> cohort)</span>
<span id="cb7-347"><a href="#cb7-347" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> </span>
<span id="cb7-348"><a href="#cb7-348" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb7-349"><a href="#cb7-349" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-350"><a href="#cb7-350" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Average ranking of 44 stable genes"</span>,</span>
<span id="cb7-351"><a href="#cb7-351" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb7-352"><a href="#cb7-352" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"Cohort"</span></span>
<span id="cb7-353"><a href="#cb7-353" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb7-354"><a href="#cb7-354" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb7-355"><a href="#cb7-355" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span>
<span id="cb7-356"><a href="#cb7-356" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-357"><a href="#cb7-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-358"><a href="#cb7-358" aria-hidden="true" tabindex="-1"></a>The average ranking are somewhat similar. For the two experiments where there</span>
<span id="cb7-359"><a href="#cb7-359" aria-hidden="true" tabindex="-1"></a>are RNA-seq samples, the distribution is the same. For METABRIC, a microarray</span>
<span id="cb7-360"><a href="#cb7-360" aria-hidden="true" tabindex="-1"></a>experiment, the distribution is shifted a bit below.</span>
<span id="cb7-361"><a href="#cb7-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-362"><a href="#cb7-362" aria-hidden="true" tabindex="-1"></a><span class="in">```{r avg-rankings-hkg, fig.height=4, fig.width=8}</span></span>
<span id="cb7-363"><a href="#cb7-363" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-avg-ranking-hkg-wo-scanb</span></span>
<span id="cb7-364"><a href="#cb7-364" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Distribution of the average ranking of the housekeeping genes</span></span>
<span id="cb7-365"><a href="#cb7-365" aria-hidden="true" tabindex="-1"></a><span class="co">#|     defined previously for each cohort separately.</span></span>
<span id="cb7-366"><a href="#cb7-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-367"><a href="#cb7-367" aria-hidden="true" tabindex="-1"></a>avg_rankings <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb7-368"><a href="#cb7-368" aria-hidden="true" tabindex="-1"></a>    datasets_normalized, </span>
<span id="cb7-369"><a href="#cb7-369" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) <span class="fu">colData</span>(x) <span class="sc">%&gt;%</span> data.frame <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(avg_ranking)</span>
<span id="cb7-370"><a href="#cb7-370" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"cohort"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-371"><a href="#cb7-371" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cohort =</span> <span class="fu">toupper</span>(cohort))</span>
<span id="cb7-372"><a href="#cb7-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-373"><a href="#cb7-373" aria-hidden="true" tabindex="-1"></a>avg_rankings <span class="sc">%&gt;%</span> </span>
<span id="cb7-374"><a href="#cb7-374" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">!=</span> <span class="st">"SCANB"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-375"><a href="#cb7-375" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb7-376"><a href="#cb7-376" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">x =</span> avg_ranking, <span class="at">fill =</span> cohort)</span>
<span id="cb7-377"><a href="#cb7-377" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb7-378"><a href="#cb7-378" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb7-379"><a href="#cb7-379" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-380"><a href="#cb7-380" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="st">"Average ranking of 44 stable genes"</span>,</span>
<span id="cb7-381"><a href="#cb7-381" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb7-382"><a href="#cb7-382" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"Cohort"</span></span>
<span id="cb7-383"><a href="#cb7-383" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span> </span>
<span id="cb7-384"><a href="#cb7-384" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>cohort, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb7-385"><a href="#cb7-385" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span>
<span id="cb7-386"><a href="#cb7-386" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-387"><a href="#cb7-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-388"><a href="#cb7-388" aria-hidden="true" tabindex="-1"></a>@fig-gene-bc-imp shows histograms of gene expression from some</span>
<span id="cb7-389"><a href="#cb7-389" aria-hidden="true" tabindex="-1"></a>important genes in</span>
<span id="cb7-390"><a href="#cb7-390" aria-hidden="true" tabindex="-1"></a>breast cancer.</span>
<span id="cb7-391"><a href="#cb7-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-392"><a href="#cb7-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 9, fig.height=6}</span></span>
<span id="cb7-393"><a href="#cb7-393" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-gene-bc-imp</span></span>
<span id="cb7-394"><a href="#cb7-394" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Distribution of the gene expression levels of ESR1 and TFF1</span></span>
<span id="cb7-395"><a href="#cb7-395" aria-hidden="true" tabindex="-1"></a><span class="co">#|     in each one of the cohorts</span></span>
<span id="cb7-396"><a href="#cb7-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-397"><a href="#cb7-397" aria-hidden="true" tabindex="-1"></a>genes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"TFF1"</span>, <span class="st">"ESR1"</span>)</span>
<span id="cb7-398"><a href="#cb7-398" aria-hidden="true" tabindex="-1"></a>col_data_genes <span class="ot">&lt;-</span> <span class="fu">mapply</span>(</span>
<span id="cb7-399"><a href="#cb7-399" aria-hidden="true" tabindex="-1"></a>    get_gene_col_data,</span>
<span id="cb7-400"><a href="#cb7-400" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_exp =</span> datasets_normalized,</span>
<span id="cb7-401"><a href="#cb7-401" aria-hidden="true" tabindex="-1"></a>    <span class="at">assay_to_use =</span> <span class="st">"avg_ranking"</span>,</span>
<span id="cb7-402"><a href="#cb7-402" aria-hidden="true" tabindex="-1"></a>    <span class="at">MoreArgs =</span> <span class="fu">list</span>(<span class="at">genes =</span> genes),</span>
<span id="cb7-403"><a href="#cb7-403" aria-hidden="true" tabindex="-1"></a>    <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-404"><a href="#cb7-404" aria-hidden="true" tabindex="-1"></a>    <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span></span>
<span id="cb7-405"><a href="#cb7-405" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-406"><a href="#cb7-406" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"cohort"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-407"><a href="#cb7-407" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cohort =</span> <span class="fu">toupper</span>(cohort)) <span class="sc">%&gt;%</span></span>
<span id="cb7-408"><a href="#cb7-408" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cohort =</span> <span class="fu">ifelse</span>(</span>
<span id="cb7-409"><a href="#cb7-409" aria-hidden="true" tabindex="-1"></a>        cohort <span class="sc">==</span> <span class="st">"SCANB"</span>,</span>
<span id="cb7-410"><a href="#cb7-410" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SCAN-B"</span>,</span>
<span id="cb7-411"><a href="#cb7-411" aria-hidden="true" tabindex="-1"></a>        cohort</span>
<span id="cb7-412"><a href="#cb7-412" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span></span>
<span id="cb7-413"><a href="#cb7-413" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">er_status =</span> <span class="fu">ifelse</span>(</span>
<span id="cb7-414"><a href="#cb7-414" aria-hidden="true" tabindex="-1"></a>        er_status <span class="sc">==</span> <span class="st">"pos"</span>,</span>
<span id="cb7-415"><a href="#cb7-415" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Positive"</span>,</span>
<span id="cb7-416"><a href="#cb7-416" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(</span>
<span id="cb7-417"><a href="#cb7-417" aria-hidden="true" tabindex="-1"></a>            er_status <span class="sc">==</span> <span class="st">"neg"</span>,</span>
<span id="cb7-418"><a href="#cb7-418" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Negative"</span>,</span>
<span id="cb7-419"><a href="#cb7-419" aria-hidden="true" tabindex="-1"></a>            <span class="cn">NA</span></span>
<span id="cb7-420"><a href="#cb7-420" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-421"><a href="#cb7-421" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span></span>
<span id="cb7-422"><a href="#cb7-422" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb7-423"><a href="#cb7-423" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> <span class="fu">all_of</span>(genes),</span>
<span id="cb7-424"><a href="#cb7-424" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"gene"</span>,</span>
<span id="cb7-425"><a href="#cb7-425" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">"avg_ranking_genes"</span></span>
<span id="cb7-426"><a href="#cb7-426" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-427"><a href="#cb7-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-428"><a href="#cb7-428" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb7-429"><a href="#cb7-429" aria-hidden="true" tabindex="-1"></a>    col_data_genes,</span>
<span id="cb7-430"><a href="#cb7-430" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> avg_ranking_genes, <span class="at">fill =</span> er_status)</span>
<span id="cb7-431"><a href="#cb7-431" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> </span>
<span id="cb7-432"><a href="#cb7-432" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb7-433"><a href="#cb7-433" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(cohort<span class="sc">~</span>gene, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb7-434"><a href="#cb7-434" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-435"><a href="#cb7-435" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Normalized expression levels"</span>,</span>
<span id="cb7-436"><a href="#cb7-436" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb7-437"><a href="#cb7-437" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"ER IHC"</span></span>
<span id="cb7-438"><a href="#cb7-438" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb7-439"><a href="#cb7-439" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span>
<span id="cb7-440"><a href="#cb7-440" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-441"><a href="#cb7-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-442"><a href="#cb7-442" aria-hidden="true" tabindex="-1"></a>ESR1 and TFF1 expressions are divided across ER status, as expected.</span>
<span id="cb7-443"><a href="#cb7-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-444"><a href="#cb7-444" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 7, fig.height=5}</span></span>
<span id="cb7-445"><a href="#cb7-445" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-gene-bc-imp-wo-scanb</span></span>
<span id="cb7-446"><a href="#cb7-446" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Distribution of the gene expression levels of ESR1 and TFF1</span></span>
<span id="cb7-447"><a href="#cb7-447" aria-hidden="true" tabindex="-1"></a><span class="co">#|     in each one of the cohorts</span></span>
<span id="cb7-448"><a href="#cb7-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-449"><a href="#cb7-449" aria-hidden="true" tabindex="-1"></a>genes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"TFF1"</span>, <span class="st">"ESR1"</span>)</span>
<span id="cb7-450"><a href="#cb7-450" aria-hidden="true" tabindex="-1"></a>col_data_genes <span class="ot">&lt;-</span> <span class="fu">mapply</span>(</span>
<span id="cb7-451"><a href="#cb7-451" aria-hidden="true" tabindex="-1"></a>    get_gene_col_data,</span>
<span id="cb7-452"><a href="#cb7-452" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_exp =</span> datasets_normalized,</span>
<span id="cb7-453"><a href="#cb7-453" aria-hidden="true" tabindex="-1"></a>    <span class="at">assay_to_use =</span> <span class="st">"avg_ranking"</span>,</span>
<span id="cb7-454"><a href="#cb7-454" aria-hidden="true" tabindex="-1"></a>    <span class="at">MoreArgs =</span> <span class="fu">list</span>(<span class="at">genes =</span> genes),</span>
<span id="cb7-455"><a href="#cb7-455" aria-hidden="true" tabindex="-1"></a>    <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-456"><a href="#cb7-456" aria-hidden="true" tabindex="-1"></a>    <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span></span>
<span id="cb7-457"><a href="#cb7-457" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-458"><a href="#cb7-458" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"cohort"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-459"><a href="#cb7-459" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cohort =</span> <span class="fu">toupper</span>(cohort)) <span class="sc">%&gt;%</span></span>
<span id="cb7-460"><a href="#cb7-460" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">cohort =</span> <span class="fu">ifelse</span>(</span>
<span id="cb7-461"><a href="#cb7-461" aria-hidden="true" tabindex="-1"></a>        cohort <span class="sc">==</span> <span class="st">"SCANB"</span>,</span>
<span id="cb7-462"><a href="#cb7-462" aria-hidden="true" tabindex="-1"></a>        <span class="st">"SCAN-B"</span>,</span>
<span id="cb7-463"><a href="#cb7-463" aria-hidden="true" tabindex="-1"></a>        cohort</span>
<span id="cb7-464"><a href="#cb7-464" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span></span>
<span id="cb7-465"><a href="#cb7-465" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">er_status =</span> <span class="fu">ifelse</span>(</span>
<span id="cb7-466"><a href="#cb7-466" aria-hidden="true" tabindex="-1"></a>        er_status <span class="sc">==</span> <span class="st">"pos"</span>,</span>
<span id="cb7-467"><a href="#cb7-467" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Positive"</span>,</span>
<span id="cb7-468"><a href="#cb7-468" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(</span>
<span id="cb7-469"><a href="#cb7-469" aria-hidden="true" tabindex="-1"></a>            er_status <span class="sc">==</span> <span class="st">"neg"</span>,</span>
<span id="cb7-470"><a href="#cb7-470" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Negative"</span>,</span>
<span id="cb7-471"><a href="#cb7-471" aria-hidden="true" tabindex="-1"></a>            <span class="cn">NA</span></span>
<span id="cb7-472"><a href="#cb7-472" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-473"><a href="#cb7-473" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span></span>
<span id="cb7-474"><a href="#cb7-474" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb7-475"><a href="#cb7-475" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> <span class="fu">all_of</span>(genes),</span>
<span id="cb7-476"><a href="#cb7-476" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"gene"</span>,</span>
<span id="cb7-477"><a href="#cb7-477" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">"avg_ranking_genes"</span></span>
<span id="cb7-478"><a href="#cb7-478" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-479"><a href="#cb7-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-480"><a href="#cb7-480" aria-hidden="true" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb7-481"><a href="#cb7-481" aria-hidden="true" tabindex="-1"></a>    col_data_genes <span class="sc">%&gt;%</span></span>
<span id="cb7-482"><a href="#cb7-482" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">!=</span> <span class="st">"SCAN-B"</span>),</span>
<span id="cb7-483"><a href="#cb7-483" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> avg_ranking_genes, <span class="at">fill =</span> er_status)</span>
<span id="cb7-484"><a href="#cb7-484" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> </span>
<span id="cb7-485"><a href="#cb7-485" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span> </span>
<span id="cb7-486"><a href="#cb7-486" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(cohort<span class="sc">~</span>gene, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb7-487"><a href="#cb7-487" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-488"><a href="#cb7-488" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Normalized expression levels"</span>,</span>
<span id="cb7-489"><a href="#cb7-489" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb7-490"><a href="#cb7-490" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"ER IHC"</span></span>
<span id="cb7-491"><a href="#cb7-491" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb7-492"><a href="#cb7-492" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>)</span>
<span id="cb7-493"><a href="#cb7-493" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-494"><a href="#cb7-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-495"><a href="#cb7-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-496"><a href="#cb7-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-497"><a href="#cb7-497" aria-hidden="true" tabindex="-1"></a>The numbers of samples available for each cohort are shown in the table</span>
<span id="cb7-498"><a href="#cb7-498" aria-hidden="true" tabindex="-1"></a>below.</span>
<span id="cb7-499"><a href="#cb7-499" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-502"><a href="#cb7-502" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-503"><a href="#cb7-503" aria-hidden="true" tabindex="-1"></a>col_data_genes <span class="sc">%&gt;%</span></span>
<span id="cb7-504"><a href="#cb7-504" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb7-505"><a href="#cb7-505" aria-hidden="true" tabindex="-1"></a>        <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"sample_name"</span>, <span class="st">"cohort"</span>, <span class="st">"er_status"</span>),</span>
<span id="cb7-506"><a href="#cb7-506" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_from =</span> <span class="st">"gene"</span>,</span>
<span id="cb7-507"><a href="#cb7-507" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_from =</span> <span class="st">"avg_ranking_genes"</span></span>
<span id="cb7-508"><a href="#cb7-508" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-509"><a href="#cb7-509" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">tabyl</span>(cohort, er_status) <span class="sc">%&gt;%</span></span>
<span id="cb7-510"><a href="#cb7-510" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">adorn_totals</span>(<span class="st">"col"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-511"><a href="#cb7-511" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">adorn_percentages</span>(<span class="st">"all"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-512"><a href="#cb7-512" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">adorn_pct_formatting</span>(<span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-513"><a href="#cb7-513" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">adorn_ns</span>()</span>
<span id="cb7-514"><a href="#cb7-514" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-515"><a href="#cb7-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-516"><a href="#cb7-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-517"><a href="#cb7-517" aria-hidden="true" tabindex="-1"></a><span class="fu">### Checking robustness with respect of number of stable genes available</span></span>
<span id="cb7-518"><a href="#cb7-518" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-519"><a href="#cb7-519" aria-hidden="true" tabindex="-1"></a>When calculating the normalized data, a total of 44 stable genes were</span>
<span id="cb7-520"><a href="#cb7-520" aria-hidden="true" tabindex="-1"></a>used. Sometimes not all of these genes are available, therefore we will</span>
<span id="cb7-521"><a href="#cb7-521" aria-hidden="true" tabindex="-1"></a>calculate the normalization using random subsets of 44 stable genes with</span>
<span id="cb7-522"><a href="#cb7-522" aria-hidden="true" tabindex="-1"></a>different random sizes. The sets will have a minimum of 20 genes and maximum of</span>
<span id="cb7-523"><a href="#cb7-523" aria-hidden="true" tabindex="-1"></a><span class="ss">44. </span>The sampling of the set size is obtained by using a uniform distribution. We</span>
<span id="cb7-524"><a href="#cb7-524" aria-hidden="true" tabindex="-1"></a>focus just on TCGA for simplicity. The correlation used in this case</span>
<span id="cb7-525"><a href="#cb7-525" aria-hidden="true" tabindex="-1"></a>was the Pearson correlation.</span>
<span id="cb7-526"><a href="#cb7-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-527"><a href="#cb7-527" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = first_run}</span></span>
<span id="cb7-528"><a href="#cb7-528" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">02943</span>)</span>
<span id="cb7-529"><a href="#cb7-529" aria-hidden="true" tabindex="-1"></a>sizes_sets <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">runif</span>(<span class="dv">10</span>, <span class="at">min =</span> <span class="dv">20</span>, <span class="at">max =</span> <span class="dv">44</span>))</span>
<span id="cb7-530"><a href="#cb7-530" aria-hidden="true" tabindex="-1"></a>random_subsets <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb7-531"><a href="#cb7-531" aria-hidden="true" tabindex="-1"></a>    sizes_sets,</span>
<span id="cb7-532"><a href="#cb7-532" aria-hidden="true" tabindex="-1"></a>    sample,</span>
<span id="cb7-533"><a href="#cb7-533" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> stable_genes,</span>
<span id="cb7-534"><a href="#cb7-534" aria-hidden="true" tabindex="-1"></a>    <span class="at">replace =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-535"><a href="#cb7-535" aria-hidden="true" tabindex="-1"></a>    <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb7-536"><a href="#cb7-536" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-537"><a href="#cb7-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-538"><a href="#cb7-538" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(random_subsets, <span class="st">"../../results/rds_files/pca_merging/random_subsets.rds"</span>)</span>
<span id="cb7-539"><a href="#cb7-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-540"><a href="#cb7-540" aria-hidden="true" tabindex="-1"></a>random_normalization <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">mclapply</span>(</span>
<span id="cb7-541"><a href="#cb7-541" aria-hidden="true" tabindex="-1"></a>    random_subsets,</span>
<span id="cb7-542"><a href="#cb7-542" aria-hidden="true" tabindex="-1"></a>    get_final_ranking_values,</span>
<span id="cb7-543"><a href="#cb7-543" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_exp =</span> datasets<span class="sc">$</span>tcga,</span>
<span id="cb7-544"><a href="#cb7-544" aria-hidden="true" tabindex="-1"></a>    <span class="at">assay_to_use =</span> which_exp<span class="sc">$</span>tcga,</span>
<span id="cb7-545"><a href="#cb7-545" aria-hidden="true" tabindex="-1"></a>    <span class="at">most_variable_genes =</span> <span class="fu">setdiff</span>(genes_for_pca, stable_genes),</span>
<span id="cb7-546"><a href="#cb7-546" aria-hidden="true" tabindex="-1"></a>    <span class="at">mc.cores =</span> <span class="dv">10</span></span>
<span id="cb7-547"><a href="#cb7-547" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-548"><a href="#cb7-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-549"><a href="#cb7-549" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb7-550"><a href="#cb7-550" aria-hidden="true" tabindex="-1"></a>    random_normalization, </span>
<span id="cb7-551"><a href="#cb7-551" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/rds_files/pca_merging/random_normalization.rds"</span></span>
<span id="cb7-552"><a href="#cb7-552" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-553"><a href="#cb7-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-554"><a href="#cb7-554" aria-hidden="true" tabindex="-1"></a><span class="co"># fetch the average ranking for each calculation. we will plot the scores</span></span>
<span id="cb7-555"><a href="#cb7-555" aria-hidden="true" tabindex="-1"></a><span class="co"># for some genes and calculate correlation for all genes as well. </span></span>
<span id="cb7-556"><a href="#cb7-556" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation is calculate by using the original list with 44 genes</span></span>
<span id="cb7-557"><a href="#cb7-557" aria-hidden="true" tabindex="-1"></a>avg_ranking_random <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb7-558"><a href="#cb7-558" aria-hidden="true" tabindex="-1"></a>    random_normalization,</span>
<span id="cb7-559"><a href="#cb7-559" aria-hidden="true" tabindex="-1"></a>    assay,</span>
<span id="cb7-560"><a href="#cb7-560" aria-hidden="true" tabindex="-1"></a>    <span class="at">i =</span> <span class="st">"avg_ranking"</span></span>
<span id="cb7-561"><a href="#cb7-561" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-562"><a href="#cb7-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-563"><a href="#cb7-563" aria-hidden="true" tabindex="-1"></a>correlation_scores <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb7-564"><a href="#cb7-564" aria-hidden="true" tabindex="-1"></a>    avg_ranking_random,</span>
<span id="cb7-565"><a href="#cb7-565" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(df, og_sum_exp, most_variable_genes){</span>
<span id="cb7-566"><a href="#cb7-566" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sapply</span>(</span>
<span id="cb7-567"><a href="#cb7-567" aria-hidden="true" tabindex="-1"></a>            most_variable_genes,</span>
<span id="cb7-568"><a href="#cb7-568" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(gene, df, og_values){</span>
<span id="cb7-569"><a href="#cb7-569" aria-hidden="true" tabindex="-1"></a>                <span class="fu">cor</span>(df[gene, ], og_values[gene, ])</span>
<span id="cb7-570"><a href="#cb7-570" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb7-571"><a href="#cb7-571" aria-hidden="true" tabindex="-1"></a>            <span class="at">df =</span> df,</span>
<span id="cb7-572"><a href="#cb7-572" aria-hidden="true" tabindex="-1"></a>            <span class="at">og_values =</span> <span class="fu">assay</span>(og_sum_exp, <span class="st">"avg_ranking"</span>)</span>
<span id="cb7-573"><a href="#cb7-573" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-574"><a href="#cb7-574" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb7-575"><a href="#cb7-575" aria-hidden="true" tabindex="-1"></a>    <span class="at">og_sum_exp =</span> datasets_normalized<span class="sc">$</span>tcga,</span>
<span id="cb7-576"><a href="#cb7-576" aria-hidden="true" tabindex="-1"></a>    <span class="at">most_variable_genes =</span> <span class="fu">setdiff</span>(genes_for_pca, stable_genes)</span>
<span id="cb7-577"><a href="#cb7-577" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> <span class="st">`</span><span class="at">names&lt;-</span><span class="st">`</span>(</span>
<span id="cb7-578"><a href="#cb7-578" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="st">"nb_genes_"</span>, <span class="fu">sapply</span>(random_subsets, length))</span>
<span id="cb7-579"><a href="#cb7-579" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-580"><a href="#cb7-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-581"><a href="#cb7-581" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb7-582"><a href="#cb7-582" aria-hidden="true" tabindex="-1"></a>    correlation_scores,</span>
<span id="cb7-583"><a href="#cb7-583" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/rds_files/pca_merging/correlation_scores.rds"</span></span>
<span id="cb7-584"><a href="#cb7-584" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-585"><a href="#cb7-585" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-586"><a href="#cb7-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-589"><a href="#cb7-589" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-590"><a href="#cb7-590" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>load_at_setup){</span>
<span id="cb7-591"><a href="#cb7-591" aria-hidden="true" tabindex="-1"></a>    correlation_scores <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(</span>
<span id="cb7-592"><a href="#cb7-592" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../../results/rds_files/pca_merging/correlation_scores.rds"</span></span>
<span id="cb7-593"><a href="#cb7-593" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-594"><a href="#cb7-594" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-595"><a href="#cb7-595" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-596"><a href="#cb7-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-597"><a href="#cb7-597" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=21, fig.height=12}</span></span>
<span id="cb7-598"><a href="#cb7-598" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-correlation</span></span>
<span id="cb7-599"><a href="#cb7-599" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Correlation distribution for different subsets of housekeeping</span></span>
<span id="cb7-600"><a href="#cb7-600" aria-hidden="true" tabindex="-1"></a><span class="co">#|     genes (HKGs). Each different subset has a different number of HKGs.</span></span>
<span id="cb7-601"><a href="#cb7-601" aria-hidden="true" tabindex="-1"></a>correlation_df <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb7-602"><a href="#cb7-602" aria-hidden="true" tabindex="-1"></a>    correlation_scores,</span>
<span id="cb7-603"><a href="#cb7-603" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) <span class="fu">data.frame</span>(<span class="at">correlation =</span> x, <span class="at">gene =</span> <span class="fu">names</span>(x), <span class="at">row.names =</span> <span class="cn">NULL</span>)</span>
<span id="cb7-604"><a href="#cb7-604" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"nb_genes"</span>)</span>
<span id="cb7-605"><a href="#cb7-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-606"><a href="#cb7-606" aria-hidden="true" tabindex="-1"></a>correlation_df <span class="sc">%&gt;%</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb7-607"><a href="#cb7-607" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> correlation) </span>
<span id="cb7-608"><a href="#cb7-608" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> </span>
<span id="cb7-609"><a href="#cb7-609" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb7-610"><a href="#cb7-610" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-611"><a href="#cb7-611" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Correlation"</span>, </span>
<span id="cb7-612"><a href="#cb7-612" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-613"><a href="#cb7-613" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Correlation distribution for different"</span>,</span>
<span id="cb7-614"><a href="#cb7-614" aria-hidden="true" tabindex="-1"></a>            <span class="st">" subsets of the housekeeping genes"</span></span>
<span id="cb7-615"><a href="#cb7-615" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-616"><a href="#cb7-616" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb7-617"><a href="#cb7-617" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>nb_genes) <span class="sc">+</span> </span>
<span id="cb7-618"><a href="#cb7-618" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb7-619"><a href="#cb7-619" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="st">"lines"</span>))</span>
<span id="cb7-620"><a href="#cb7-620" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-621"><a href="#cb7-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-622"><a href="#cb7-622" aria-hidden="true" tabindex="-1"></a>@fig-correlation shows the different distributions given the subsets of</span>
<span id="cb7-623"><a href="#cb7-623" aria-hidden="true" tabindex="-1"></a>housekeeping genes. All the correlation coefficients are close to 1. This means</span>
<span id="cb7-624"><a href="#cb7-624" aria-hidden="true" tabindex="-1"></a>that if a subset of housekeeping genes are missing it is fine, as the others</span>
<span id="cb7-625"><a href="#cb7-625" aria-hidden="true" tabindex="-1"></a>will compensate.</span>
<span id="cb7-626"><a href="#cb7-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-627"><a href="#cb7-627" aria-hidden="true" tabindex="-1"></a><span class="fu">## Integrating TCGA and METABRIC using PCA</span></span>
<span id="cb7-628"><a href="#cb7-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-629"><a href="#cb7-629" aria-hidden="true" tabindex="-1"></a>The next step is creating the framework where we can integrate any patient</span>
<span id="cb7-630"><a href="#cb7-630" aria-hidden="true" tabindex="-1"></a>sample and compare each other, at least spatially. The approach is similar to</span>
<span id="cb7-631"><a href="#cb7-631" aria-hidden="true" tabindex="-1"></a>some sort of unsupervised learning, where no labels or groups are specified,</span>
<span id="cb7-632"><a href="#cb7-632" aria-hidden="true" tabindex="-1"></a>which is something common in algorithms for batch removal. By using PCA in some</span>
<span id="cb7-633"><a href="#cb7-633" aria-hidden="true" tabindex="-1"></a>subset of TCGA and METABRIC, we should learn the idiosyncrasies of the RNA-seq</span>
<span id="cb7-634"><a href="#cb7-634" aria-hidden="true" tabindex="-1"></a>and microarray technologies as well as batch effects general to datasets. Since</span>
<span id="cb7-635"><a href="#cb7-635" aria-hidden="true" tabindex="-1"></a>these two cohorts are big ones, we assume that if there are common batch</span>
<span id="cb7-636"><a href="#cb7-636" aria-hidden="true" tabindex="-1"></a>effects, they are represented on them.</span>
<span id="cb7-637"><a href="#cb7-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-638"><a href="#cb7-638" aria-hidden="true" tabindex="-1"></a>The practical steps are: first subselect 1000 samples in total from METABRIC</span>
<span id="cb7-639"><a href="#cb7-639" aria-hidden="true" tabindex="-1"></a>**and** TCGA. Train PCA using these 1000 samples. Validate the results by</span>
<span id="cb7-640"><a href="#cb7-640" aria-hidden="true" tabindex="-1"></a>projecting the other samples. In the next section we show how robust the</span>
<span id="cb7-641"><a href="#cb7-641" aria-hidden="true" tabindex="-1"></a>approach is when selecting the samples. In the next chapters we validate the</span>
<span id="cb7-642"><a href="#cb7-642" aria-hidden="true" tabindex="-1"></a>projection in unseen cohorts.</span>
<span id="cb7-643"><a href="#cb7-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-644"><a href="#cb7-644" aria-hidden="true" tabindex="-1"></a>Integrating as laid out here only uses molecular data, therefore patients might</span>
<span id="cb7-645"><a href="#cb7-645" aria-hidden="true" tabindex="-1"></a>be close to each other but they might have very different clinical features.</span>
<span id="cb7-646"><a href="#cb7-646" aria-hidden="true" tabindex="-1"></a>This should always be kept in mind.</span>
<span id="cb7-647"><a href="#cb7-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-650"><a href="#cb7-650" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-651"><a href="#cb7-651" aria-hidden="true" tabindex="-1"></a><span class="co"># we start by selecting the patients that will be used in the training </span></span>
<span id="cb7-652"><a href="#cb7-652" aria-hidden="true" tabindex="-1"></a><span class="co"># set. </span></span>
<span id="cb7-653"><a href="#cb7-653" aria-hidden="true" tabindex="-1"></a>merged_col_data <span class="ot">&lt;-</span> <span class="fu">lapply</span>(datasets_normalized, colData) <span class="sc">%&gt;%</span> </span>
<span id="cb7-654"><a href="#cb7-654" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(., data.frame) <span class="sc">%&gt;%</span></span>
<span id="cb7-655"><a href="#cb7-655" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"cohort"</span>)</span>
<span id="cb7-656"><a href="#cb7-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-657"><a href="#cb7-657" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb7-658"><a href="#cb7-658" aria-hidden="true" tabindex="-1"></a>    merged_col_data,</span>
<span id="cb7-659"><a href="#cb7-659" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/rds_files/pca_merging/merged_col_data.rds"</span></span>
<span id="cb7-660"><a href="#cb7-660" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-661"><a href="#cb7-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-662"><a href="#cb7-662" aria-hidden="true" tabindex="-1"></a>which_cohorts_training <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)</span>
<span id="cb7-663"><a href="#cb7-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-664"><a href="#cb7-664" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb7-665"><a href="#cb7-665" aria-hidden="true" tabindex="-1"></a>    which_cohorts_training,</span>
<span id="cb7-666"><a href="#cb7-666" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/rds_files/pca_merging/which_cohorts_training.rds"</span></span>
<span id="cb7-667"><a href="#cb7-667" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-668"><a href="#cb7-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-669"><a href="#cb7-669" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">132904</span>)</span>
<span id="cb7-670"><a href="#cb7-670" aria-hidden="true" tabindex="-1"></a>samples_for_training <span class="ot">&lt;-</span> merged_col_data <span class="sc">%&gt;%</span></span>
<span id="cb7-671"><a href="#cb7-671" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> which_cohorts_training) <span class="sc">%&gt;%</span></span>
<span id="cb7-672"><a href="#cb7-672" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(sample_name) <span class="sc">%&gt;%</span></span>
<span id="cb7-673"><a href="#cb7-673" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample</span>(., <span class="at">size =</span> <span class="dv">1000</span>)</span>
<span id="cb7-674"><a href="#cb7-674" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-675"><a href="#cb7-675" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-676"><a href="#cb7-676" aria-hidden="true" tabindex="-1"></a>The table below shows the molecular characteristics of the patients selected for</span>
<span id="cb7-677"><a href="#cb7-677" aria-hidden="true" tabindex="-1"></a>the PCA training.</span>
<span id="cb7-678"><a href="#cb7-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-681"><a href="#cb7-681" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-682"><a href="#cb7-682" aria-hidden="true" tabindex="-1"></a>merged_col_data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb7-683"><a href="#cb7-683" aria-hidden="true" tabindex="-1"></a>    sample_name <span class="sc">%in%</span> samples_for_training</span>
<span id="cb7-684"><a href="#cb7-684" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-685"><a href="#cb7-685" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">tabyl</span>(cohort, pam50) <span class="sc">%&gt;%</span> </span>
<span id="cb7-686"><a href="#cb7-686" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">adorn_totals</span>(<span class="fu">c</span>(<span class="st">"row"</span>, <span class="st">"col"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-687"><a href="#cb7-687" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">adorn_percentages</span>(<span class="st">"all"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-688"><a href="#cb7-688" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">adorn_pct_formatting</span>(<span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-689"><a href="#cb7-689" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">adorn_ns</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-690"><a href="#cb7-690" aria-hidden="true" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-691"><a href="#cb7-691" aria-hidden="true" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_classic</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>)</span>
<span id="cb7-692"><a href="#cb7-692" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-693"><a href="#cb7-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-694"><a href="#cb7-694" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = first_run}</span></span>
<span id="cb7-695"><a href="#cb7-695" aria-hidden="true" tabindex="-1"></a>training_set <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb7-696"><a href="#cb7-696" aria-hidden="true" tabindex="-1"></a>    datasets_normalized[which_cohorts_training], </span>
<span id="cb7-697"><a href="#cb7-697" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(sum_exp, i, genes_for_pca) </span>
<span id="cb7-698"><a href="#cb7-698" aria-hidden="true" tabindex="-1"></a>        <span class="fu">assay</span>(sum_exp[genes_for_pca, ], <span class="at">i =</span> i) <span class="sc">%&gt;%</span> </span>
<span id="cb7-699"><a href="#cb7-699" aria-hidden="true" tabindex="-1"></a>        <span class="fu">data.frame</span>(<span class="at">check.names =</span> <span class="cn">FALSE</span>), </span>
<span id="cb7-700"><a href="#cb7-700" aria-hidden="true" tabindex="-1"></a>    <span class="at">i =</span> <span class="st">"avg_ranking"</span>,</span>
<span id="cb7-701"><a href="#cb7-701" aria-hidden="true" tabindex="-1"></a>    <span class="at">genes_for_pca =</span> genes_for_pca</span>
<span id="cb7-702"><a href="#cb7-702" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-703"><a href="#cb7-703" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-704"><a href="#cb7-704" aria-hidden="true" tabindex="-1"></a>    .[, samples_for_training]</span>
<span id="cb7-705"><a href="#cb7-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-706"><a href="#cb7-706" aria-hidden="true" tabindex="-1"></a>pca_fit <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">pca</span>(</span>
<span id="cb7-707"><a href="#cb7-707" aria-hidden="true" tabindex="-1"></a>    training_set,</span>
<span id="cb7-708"><a href="#cb7-708" aria-hidden="true" tabindex="-1"></a>    <span class="at">metadata =</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb7-709"><a href="#cb7-709" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lapply</span>(</span>
<span id="cb7-710"><a href="#cb7-710" aria-hidden="true" tabindex="-1"></a>            datasets_normalized[which_cohorts_training],</span>
<span id="cb7-711"><a href="#cb7-711" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(df){</span>
<span id="cb7-712"><a href="#cb7-712" aria-hidden="true" tabindex="-1"></a>                <span class="fu">colData</span>(df) <span class="sc">%&gt;%</span> data.frame <span class="sc">%&gt;%</span></span>
<span id="cb7-713"><a href="#cb7-713" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">filter</span>(sample_name <span class="sc">%in%</span> <span class="fu">colnames</span>(training_set))</span>
<span id="cb7-714"><a href="#cb7-714" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb7-715"><a href="#cb7-715" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb7-716"><a href="#cb7-716" aria-hidden="true" tabindex="-1"></a>        <span class="at">.id =</span> <span class="st">"cohort"</span></span>
<span id="cb7-717"><a href="#cb7-717" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> .[<span class="fu">colnames</span>(training_set), ],</span>
<span id="cb7-718"><a href="#cb7-718" aria-hidden="true" tabindex="-1"></a>    <span class="at">center =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-719"><a href="#cb7-719" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> <span class="cn">FALSE</span></span>
<span id="cb7-720"><a href="#cb7-720" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-721"><a href="#cb7-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-722"><a href="#cb7-722" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb7-723"><a href="#cb7-723" aria-hidden="true" tabindex="-1"></a>    pca_fit,</span>
<span id="cb7-724"><a href="#cb7-724" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/rds_files/pca_merging/pca_fit.rds"</span></span>
<span id="cb7-725"><a href="#cb7-725" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-726"><a href="#cb7-726" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-727"><a href="#cb7-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-730"><a href="#cb7-730" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-731"><a href="#cb7-731" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>load_at_setup){</span>
<span id="cb7-732"><a href="#cb7-732" aria-hidden="true" tabindex="-1"></a>    pca_fit <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(</span>
<span id="cb7-733"><a href="#cb7-733" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../../results/rds_files/pca_merging/pca_fit.rds"</span></span>
<span id="cb7-734"><a href="#cb7-734" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-735"><a href="#cb7-735" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-736"><a href="#cb7-736" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-737"><a href="#cb7-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-738"><a href="#cb7-738" aria-hidden="true" tabindex="-1"></a>@fig-pca-embeddings shows the embedding of the two datasets together of the</span>
<span id="cb7-739"><a href="#cb7-739" aria-hidden="true" tabindex="-1"></a>1000 samples used for training. We select several PCs of interest to show how</span>
<span id="cb7-740"><a href="#cb7-740" aria-hidden="true" tabindex="-1"></a>the embedding works.</span>
<span id="cb7-741"><a href="#cb7-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-742"><a href="#cb7-742" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=14, fig.height=16}</span></span>
<span id="cb7-743"><a href="#cb7-743" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-embeddings</span></span>
<span id="cb7-744"><a href="#cb7-744" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: PCA projections colored by different factors and organized</span></span>
<span id="cb7-745"><a href="#cb7-745" aria-hidden="true" tabindex="-1"></a><span class="co">#|    by different components. (A) Plot of the first two components colored</span></span>
<span id="cb7-746"><a href="#cb7-746" aria-hidden="true" tabindex="-1"></a><span class="co">#|    by cohort. (B) Plot of the first two components colored by ER status.</span></span>
<span id="cb7-747"><a href="#cb7-747" aria-hidden="true" tabindex="-1"></a><span class="co">#|    (C) Plot of the second and third components colored by cohort. </span></span>
<span id="cb7-748"><a href="#cb7-748" aria-hidden="true" tabindex="-1"></a><span class="co">#|    (D) Plot of the second and third components colored by ER status.</span></span>
<span id="cb7-749"><a href="#cb7-749" aria-hidden="true" tabindex="-1"></a><span class="co">#|    (E) Plot of the second and third components colored by PAM50.</span></span>
<span id="cb7-750"><a href="#cb7-750" aria-hidden="true" tabindex="-1"></a><span class="co">#|    (F) Plot of the second and third components colored by INTCLUST, only</span></span>
<span id="cb7-751"><a href="#cb7-751" aria-hidden="true" tabindex="-1"></a><span class="co">#|    METABRIC has an assigned value for this variable, NAs are TCGA samples.</span></span>
<span id="cb7-752"><a href="#cb7-752" aria-hidden="true" tabindex="-1"></a>plots_pca_fit <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb7-753"><a href="#cb7-753" aria-hidden="true" tabindex="-1"></a>point_size <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb7-754"><a href="#cb7-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-755"><a href="#cb7-755" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc1_pc2_cohort <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(</span>
<span id="cb7-756"><a href="#cb7-756" aria-hidden="true" tabindex="-1"></a>    pca_fit,</span>
<span id="cb7-757"><a href="#cb7-757" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">"cohort"</span>,</span>
<span id="cb7-758"><a href="#cb7-758" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-759"><a href="#cb7-759" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">"right"</span>,</span>
<span id="cb7-760"><a href="#cb7-760" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC1"</span>,</span>
<span id="cb7-761"><a href="#cb7-761" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC2"</span>,</span>
<span id="cb7-762"><a href="#cb7-762" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"First two components colored by cohort"</span>,</span>
<span id="cb7-763"><a href="#cb7-763" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Only 1000 training samples"</span>,</span>
<span id="cb7-764"><a href="#cb7-764" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> point_size</span>
<span id="cb7-765"><a href="#cb7-765" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-766"><a href="#cb7-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-767"><a href="#cb7-767" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc1_pc2_er_status <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(</span>
<span id="cb7-768"><a href="#cb7-768" aria-hidden="true" tabindex="-1"></a>    pca_fit,</span>
<span id="cb7-769"><a href="#cb7-769" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">"er_status"</span>,</span>
<span id="cb7-770"><a href="#cb7-770" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-771"><a href="#cb7-771" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">"right"</span>,</span>
<span id="cb7-772"><a href="#cb7-772" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC1"</span>,</span>
<span id="cb7-773"><a href="#cb7-773" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC2"</span>,</span>
<span id="cb7-774"><a href="#cb7-774" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"First two components colored by ER status"</span>,</span>
<span id="cb7-775"><a href="#cb7-775" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Only 1000 training samples"</span>,</span>
<span id="cb7-776"><a href="#cb7-776" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> point_size</span>
<span id="cb7-777"><a href="#cb7-777" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-778"><a href="#cb7-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-779"><a href="#cb7-779" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc2_pc3_cohort <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(</span>
<span id="cb7-780"><a href="#cb7-780" aria-hidden="true" tabindex="-1"></a>    pca_fit,</span>
<span id="cb7-781"><a href="#cb7-781" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">"cohort"</span>,</span>
<span id="cb7-782"><a href="#cb7-782" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-783"><a href="#cb7-783" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">"right"</span>,</span>
<span id="cb7-784"><a href="#cb7-784" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC2"</span>,</span>
<span id="cb7-785"><a href="#cb7-785" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-786"><a href="#cb7-786" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Second and third components colored by cohort"</span>,</span>
<span id="cb7-787"><a href="#cb7-787" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Only 1000 training samples"</span>,</span>
<span id="cb7-788"><a href="#cb7-788" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> point_size</span>
<span id="cb7-789"><a href="#cb7-789" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-790"><a href="#cb7-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-791"><a href="#cb7-791" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc2_pc3_er_status <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(</span>
<span id="cb7-792"><a href="#cb7-792" aria-hidden="true" tabindex="-1"></a>    pca_fit,</span>
<span id="cb7-793"><a href="#cb7-793" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">"er_status"</span>,</span>
<span id="cb7-794"><a href="#cb7-794" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-795"><a href="#cb7-795" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">"right"</span>,</span>
<span id="cb7-796"><a href="#cb7-796" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC2"</span>,</span>
<span id="cb7-797"><a href="#cb7-797" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-798"><a href="#cb7-798" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Second and third components colored by ER status"</span>,</span>
<span id="cb7-799"><a href="#cb7-799" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Only 1000 training samples"</span>,</span>
<span id="cb7-800"><a href="#cb7-800" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> point_size</span>
<span id="cb7-801"><a href="#cb7-801" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-802"><a href="#cb7-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-803"><a href="#cb7-803" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc2_pc3_pam50 <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(</span>
<span id="cb7-804"><a href="#cb7-804" aria-hidden="true" tabindex="-1"></a>    pca_fit,</span>
<span id="cb7-805"><a href="#cb7-805" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">"pam50"</span>,</span>
<span id="cb7-806"><a href="#cb7-806" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-807"><a href="#cb7-807" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">"right"</span>,</span>
<span id="cb7-808"><a href="#cb7-808" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC2"</span>,</span>
<span id="cb7-809"><a href="#cb7-809" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-810"><a href="#cb7-810" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Second and third components colored by PAM50"</span>,</span>
<span id="cb7-811"><a href="#cb7-811" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Only 1000 training samples"</span>,</span>
<span id="cb7-812"><a href="#cb7-812" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> point_size</span>
<span id="cb7-813"><a href="#cb7-813" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-814"><a href="#cb7-814" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc2_pc3_pam50 <span class="ot">&lt;-</span> plots_pca_fit<span class="sc">$</span>pc2_pc3_pam50 <span class="sc">+</span></span>
<span id="cb7-815"><a href="#cb7-815" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">get_colors_pam50</span>(pca_fit<span class="sc">$</span>metadata))</span>
<span id="cb7-816"><a href="#cb7-816" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-817"><a href="#cb7-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-818"><a href="#cb7-818" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc2_pc3_intclust <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(</span>
<span id="cb7-819"><a href="#cb7-819" aria-hidden="true" tabindex="-1"></a>    pca_fit,</span>
<span id="cb7-820"><a href="#cb7-820" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">"INTCLUST"</span>,</span>
<span id="cb7-821"><a href="#cb7-821" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-822"><a href="#cb7-822" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">"right"</span>,</span>
<span id="cb7-823"><a href="#cb7-823" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC2"</span>,</span>
<span id="cb7-824"><a href="#cb7-824" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-825"><a href="#cb7-825" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Second and third components colored by INTCLUST"</span>,</span>
<span id="cb7-826"><a href="#cb7-826" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Only 1000 training samples"</span>,</span>
<span id="cb7-827"><a href="#cb7-827" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> point_size</span>
<span id="cb7-828"><a href="#cb7-828" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-829"><a href="#cb7-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-830"><a href="#cb7-830" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc3_pc4_pam50 <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(</span>
<span id="cb7-831"><a href="#cb7-831" aria-hidden="true" tabindex="-1"></a>    pca_fit,</span>
<span id="cb7-832"><a href="#cb7-832" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">"pam50"</span>,</span>
<span id="cb7-833"><a href="#cb7-833" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-834"><a href="#cb7-834" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">"right"</span>,</span>
<span id="cb7-835"><a href="#cb7-835" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-836"><a href="#cb7-836" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-837"><a href="#cb7-837" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Third and fourth components colored by PAM50"</span>,</span>
<span id="cb7-838"><a href="#cb7-838" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Only 1000 training samples"</span>,</span>
<span id="cb7-839"><a href="#cb7-839" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> point_size</span>
<span id="cb7-840"><a href="#cb7-840" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb7-841"><a href="#cb7-841" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc3_pc4_pam50 <span class="ot">&lt;-</span> plots_pca_fit<span class="sc">$</span>pc3_pc4_pam50 <span class="sc">+</span></span>
<span id="cb7-842"><a href="#cb7-842" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">get_colors_pam50</span>(pca_fit<span class="sc">$</span>metadata))</span>
<span id="cb7-843"><a href="#cb7-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-844"><a href="#cb7-844" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc3_pc4_cohort <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(</span>
<span id="cb7-845"><a href="#cb7-845" aria-hidden="true" tabindex="-1"></a>    pca_fit,</span>
<span id="cb7-846"><a href="#cb7-846" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">"cohort"</span>,</span>
<span id="cb7-847"><a href="#cb7-847" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-848"><a href="#cb7-848" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">"right"</span>,</span>
<span id="cb7-849"><a href="#cb7-849" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-850"><a href="#cb7-850" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-851"><a href="#cb7-851" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Third and fourth components colored by cohort"</span>,</span>
<span id="cb7-852"><a href="#cb7-852" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Only 1000 training samples"</span>,</span>
<span id="cb7-853"><a href="#cb7-853" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> point_size</span>
<span id="cb7-854"><a href="#cb7-854" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-855"><a href="#cb7-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-856"><a href="#cb7-856" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> plots_pca_fit, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">labels =</span> <span class="st">"AUTO"</span>)</span>
<span id="cb7-857"><a href="#cb7-857" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-858"><a href="#cb7-858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-859"><a href="#cb7-859" aria-hidden="true" tabindex="-1"></a>The first three components correspond to the batch effect. The third component</span>
<span id="cb7-860"><a href="#cb7-860" aria-hidden="true" tabindex="-1"></a>explains the ER status and the two cohorts are well inter mingled. When plotting</span>
<span id="cb7-861"><a href="#cb7-861" aria-hidden="true" tabindex="-1"></a>the third and fourth components and coloring by the molecular subtype, we see a</span>
<span id="cb7-862"><a href="#cb7-862" aria-hidden="true" tabindex="-1"></a>clear distinction, recapitulating the biology.</span>
<span id="cb7-863"><a href="#cb7-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-864"><a href="#cb7-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-865"><a href="#cb7-865" aria-hidden="true" tabindex="-1"></a>The plot below shows how the loadings of the first component are really</span>
<span id="cb7-866"><a href="#cb7-866" aria-hidden="true" tabindex="-1"></a>concentrated around zero, so there are not actually specific genes that</span>
<span id="cb7-867"><a href="#cb7-867" aria-hidden="true" tabindex="-1"></a>are accounting for the batch effects we see in the first component. We show </span>
<span id="cb7-868"><a href="#cb7-868" aria-hidden="true" tabindex="-1"></a>latter that the genes that are the most important are the ones with high loading,</span>
<span id="cb7-869"><a href="#cb7-869" aria-hidden="true" tabindex="-1"></a>so the tail of the distributions. In this sense there are really no genes </span>
<span id="cb7-870"><a href="#cb7-870" aria-hidden="true" tabindex="-1"></a>in the tail of the loadings for PC1. </span>
<span id="cb7-871"><a href="#cb7-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-872"><a href="#cb7-872" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=10, fig.height=7}</span></span>
<span id="cb7-873"><a href="#cb7-873" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-loadings-pcs</span></span>
<span id="cb7-874"><a href="#cb7-874" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Different loadings for the first 4 components. </span></span>
<span id="cb7-875"><a href="#cb7-875" aria-hidden="true" tabindex="-1"></a>pca_fit<span class="sc">$</span>loadings <span class="sc">%&gt;%</span></span>
<span id="cb7-876"><a href="#cb7-876" aria-hidden="true" tabindex="-1"></a>    data.frame <span class="sc">%&gt;%</span></span>
<span id="cb7-877"><a href="#cb7-877" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(PC1, PC2, PC3, PC4) <span class="sc">%&gt;%</span></span>
<span id="cb7-878"><a href="#cb7-878" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb7-879"><a href="#cb7-879" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> <span class="fu">c</span>(PC1, PC2, PC3, PC4),</span>
<span id="cb7-880"><a href="#cb7-880" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"component"</span>, </span>
<span id="cb7-881"><a href="#cb7-881" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">"loadings"</span></span>
<span id="cb7-882"><a href="#cb7-882" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-883"><a href="#cb7-883" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb7-884"><a href="#cb7-884" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">abs</span>(loadings))</span>
<span id="cb7-885"><a href="#cb7-885" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb7-886"><a href="#cb7-886" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb7-887"><a href="#cb7-887" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>component) <span class="sc">+</span> </span>
<span id="cb7-888"><a href="#cb7-888" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-889"><a href="#cb7-889" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"Histogram of the loadings from the first four components"</span></span>
<span id="cb7-890"><a href="#cb7-890" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb7-891"><a href="#cb7-891" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb7-892"><a href="#cb7-892" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>()</span>
<span id="cb7-893"><a href="#cb7-893" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-894"><a href="#cb7-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-895"><a href="#cb7-895" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = first_run}</span></span>
<span id="cb7-896"><a href="#cb7-896" aria-hidden="true" tabindex="-1"></a>datasets_pca_coordinates <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb7-897"><a href="#cb7-897" aria-hidden="true" tabindex="-1"></a>    datasets_normalized,</span>
<span id="cb7-898"><a href="#cb7-898" aria-hidden="true" tabindex="-1"></a>    get_pca_coordinates,</span>
<span id="cb7-899"><a href="#cb7-899" aria-hidden="true" tabindex="-1"></a>    <span class="at">pca_fit =</span> pca_fit</span>
<span id="cb7-900"><a href="#cb7-900" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-901"><a href="#cb7-901" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-902"><a href="#cb7-902" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb7-903"><a href="#cb7-903" aria-hidden="true" tabindex="-1"></a>    datasets_pca_coordinates,</span>
<span id="cb7-904"><a href="#cb7-904" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/rds_files/pca_merging/datasets_pca_coordinates.rds"</span></span>
<span id="cb7-905"><a href="#cb7-905" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-906"><a href="#cb7-906" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-907"><a href="#cb7-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-910"><a href="#cb7-910" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-911"><a href="#cb7-911" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span>load_at_setup){</span>
<span id="cb7-912"><a href="#cb7-912" aria-hidden="true" tabindex="-1"></a>    datasets_pca_coordinates <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(</span>
<span id="cb7-913"><a href="#cb7-913" aria-hidden="true" tabindex="-1"></a>        <span class="st">"../../results/rds_files/pca_merging/datasets_pca_coordinates.rds"</span></span>
<span id="cb7-914"><a href="#cb7-914" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-915"><a href="#cb7-915" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-916"><a href="#cb7-916" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-917"><a href="#cb7-917" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-918"><a href="#cb7-918" aria-hidden="true" tabindex="-1"></a>@fig-pca-og shows all the samples from TCGA and cohort projected into the</span>
<span id="cb7-919"><a href="#cb7-919" aria-hidden="true" tabindex="-1"></a>molecular landscape. The samples are mixing well, the only thing is that</span>
<span id="cb7-920"><a href="#cb7-920" aria-hidden="true" tabindex="-1"></a>METABRIC is a bit offset to the left bottom.</span>
<span id="cb7-921"><a href="#cb7-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-922"><a href="#cb7-922" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = first_run}</span></span>
<span id="cb7-923"><a href="#cb7-923" aria-hidden="true" tabindex="-1"></a>df_pca_coordinates <span class="ot">&lt;-</span> datasets_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-924"><a href="#cb7-924" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, .) <span class="sc">%&gt;%</span></span>
<span id="cb7-925"><a href="#cb7-925" aria-hidden="true" tabindex="-1"></a>    data.frame <span class="sc">%&gt;%</span> </span>
<span id="cb7-926"><a href="#cb7-926" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_name"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-927"><a href="#cb7-927" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb7-928"><a href="#cb7-928" aria-hidden="true" tabindex="-1"></a>        .,</span>
<span id="cb7-929"><a href="#cb7-929" aria-hidden="true" tabindex="-1"></a>        merged_col_data,</span>
<span id="cb7-930"><a href="#cb7-930" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="st">"sample_name"</span></span>
<span id="cb7-931"><a href="#cb7-931" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-932"><a href="#cb7-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-933"><a href="#cb7-933" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb7-934"><a href="#cb7-934" aria-hidden="true" tabindex="-1"></a>    df_pca_coordinates,</span>
<span id="cb7-935"><a href="#cb7-935" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/rds_files/pca_merging/df_pca_coordinates.rds"</span></span>
<span id="cb7-936"><a href="#cb7-936" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-937"><a href="#cb7-937" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-938"><a href="#cb7-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-941"><a href="#cb7-941" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-942"><a href="#cb7-942" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-og</span></span>
<span id="cb7-943"><a href="#cb7-943" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Original PC3 and PC4 of all samples, including test and </span></span>
<span id="cb7-944"><a href="#cb7-944" aria-hidden="true" tabindex="-1"></a><span class="co">#|     train samples, of TCGA and METABRIC.</span></span>
<span id="cb7-945"><a href="#cb7-945" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pca_coordinates</span>(</span>
<span id="cb7-946"><a href="#cb7-946" aria-hidden="true" tabindex="-1"></a>    df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-947"><a href="#cb7-947" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-948"><a href="#cb7-948" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())),</span>
<span id="cb7-949"><a href="#cb7-949" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"cohort"</span>,</span>
<span id="cb7-950"><a href="#cb7-950" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-951"><a href="#cb7-951" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-952"><a href="#cb7-952" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb7-953"><a href="#cb7-953" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb7-954"><a href="#cb7-954" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-955"><a href="#cb7-955" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Embedding of all samples from TCGA"</span>,</span>
<span id="cb7-956"><a href="#cb7-956" aria-hidden="true" tabindex="-1"></a>        <span class="st">" and METABRIC"</span></span>
<span id="cb7-957"><a href="#cb7-957" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-958"><a href="#cb7-958" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> </span>
<span id="cb7-959"><a href="#cb7-959" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-960"><a href="#cb7-960" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-961"><a href="#cb7-961" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>()</span>
<span id="cb7-962"><a href="#cb7-962" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-963"><a href="#cb7-963" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-964"><a href="#cb7-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-965"><a href="#cb7-965" aria-hidden="true" tabindex="-1"></a>And the first two PCs.</span>
<span id="cb7-966"><a href="#cb7-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-969"><a href="#cb7-969" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-970"><a href="#cb7-970" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-pc1-pc2</span></span>
<span id="cb7-971"><a href="#cb7-971" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Original PC1 and PC2 of all samples, including test and </span></span>
<span id="cb7-972"><a href="#cb7-972" aria-hidden="true" tabindex="-1"></a><span class="co">#|     train samples, of TCGA and METABRIC.</span></span>
<span id="cb7-973"><a href="#cb7-973" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pca_coordinates</span>(</span>
<span id="cb7-974"><a href="#cb7-974" aria-hidden="true" tabindex="-1"></a>    df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-975"><a href="#cb7-975" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-976"><a href="#cb7-976" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())),</span>
<span id="cb7-977"><a href="#cb7-977" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"cohort"</span>,</span>
<span id="cb7-978"><a href="#cb7-978" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC1"</span>,</span>
<span id="cb7-979"><a href="#cb7-979" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC2"</span>,</span>
<span id="cb7-980"><a href="#cb7-980" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb7-981"><a href="#cb7-981" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb7-982"><a href="#cb7-982" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-983"><a href="#cb7-983" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Embedding of all samples from TCGA"</span>,</span>
<span id="cb7-984"><a href="#cb7-984" aria-hidden="true" tabindex="-1"></a>        <span class="st">" and METABRIC"</span></span>
<span id="cb7-985"><a href="#cb7-985" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-986"><a href="#cb7-986" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> </span>
<span id="cb7-987"><a href="#cb7-987" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-988"><a href="#cb7-988" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-989"><a href="#cb7-989" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>()</span>
<span id="cb7-990"><a href="#cb7-990" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-991"><a href="#cb7-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-992"><a href="#cb7-992" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-993"><a href="#cb7-993" aria-hidden="true" tabindex="-1"></a>And @fig-pca-pam50.</span>
<span id="cb7-994"><a href="#cb7-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-997"><a href="#cb7-997" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-998"><a href="#cb7-998" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-pam50</span></span>
<span id="cb7-999"><a href="#cb7-999" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Original PC3 and PC4 of all samples, including test and </span></span>
<span id="cb7-1000"><a href="#cb7-1000" aria-hidden="true" tabindex="-1"></a><span class="co">#|     train samples, of TCGA and METABRIC.</span></span>
<span id="cb7-1001"><a href="#cb7-1001" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-1002"><a href="#cb7-1002" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-1003"><a href="#cb7-1003" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb7-1004"><a href="#cb7-1004" aria-hidden="true" tabindex="-1"></a>            pam50 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"basal"</span>, <span class="st">"her2"</span>, <span class="st">"lumb"</span>, <span class="st">"luma"</span>, <span class="st">"normal"</span>)</span>
<span id="cb7-1005"><a href="#cb7-1005" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb7-1006"><a href="#cb7-1006" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()))</span>
<span id="cb7-1007"><a href="#cb7-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1008"><a href="#cb7-1008" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pca_coordinates</span>(</span>
<span id="cb7-1009"><a href="#cb7-1009" aria-hidden="true" tabindex="-1"></a>    df,</span>
<span id="cb7-1010"><a href="#cb7-1010" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"pam50"</span>,</span>
<span id="cb7-1011"><a href="#cb7-1011" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-1012"><a href="#cb7-1012" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-1013"><a href="#cb7-1013" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb7-1014"><a href="#cb7-1014" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb7-1015"><a href="#cb7-1015" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-1016"><a href="#cb7-1016" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Embedding of all samples from TCGA"</span>,</span>
<span id="cb7-1017"><a href="#cb7-1017" aria-hidden="true" tabindex="-1"></a>        <span class="st">" and METABRIC"</span></span>
<span id="cb7-1018"><a href="#cb7-1018" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-1019"><a href="#cb7-1019" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> </span>
<span id="cb7-1020"><a href="#cb7-1020" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"PAM50"</span>) <span class="sc">+</span></span>
<span id="cb7-1021"><a href="#cb7-1021" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1022"><a href="#cb7-1022" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">get_colors_pam50</span>(df)) <span class="sc">+</span></span>
<span id="cb7-1023"><a href="#cb7-1023" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-1024"><a href="#cb7-1024" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>()</span>
<span id="cb7-1025"><a href="#cb7-1025" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1026"><a href="#cb7-1026" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1027"><a href="#cb7-1027" aria-hidden="true" tabindex="-1"></a>In order to check if the integration made sense, it is possible to color by ER</span>
<span id="cb7-1028"><a href="#cb7-1028" aria-hidden="true" tabindex="-1"></a>status, NPI for METABRIC samples and tumor/node stage for TCGA. To check ER</span>
<span id="cb7-1029"><a href="#cb7-1029" aria-hidden="true" tabindex="-1"></a>signaling scores, the pathways Estrogen response early/late and $SET_{ER/PR}$</span>
<span id="cb7-1030"><a href="#cb7-1030" aria-hidden="true" tabindex="-1"></a>are used to color the projection.</span>
<span id="cb7-1031"><a href="#cb7-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1032"><a href="#cb7-1032" aria-hidden="true" tabindex="-1"></a>@fig-pca-age shows the coloring by age.</span>
<span id="cb7-1033"><a href="#cb7-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1036"><a href="#cb7-1036" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-1037"><a href="#cb7-1037" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-age</span></span>
<span id="cb7-1038"><a href="#cb7-1038" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: PC3 and PC4 of samples from TCGA and METABRIC</span></span>
<span id="cb7-1039"><a href="#cb7-1039" aria-hidden="true" tabindex="-1"></a><span class="co">#|     colored by age.</span></span>
<span id="cb7-1040"><a href="#cb7-1040" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pca_coordinates</span>(</span>
<span id="cb7-1041"><a href="#cb7-1041" aria-hidden="true" tabindex="-1"></a>    df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-1042"><a href="#cb7-1042" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)),</span>
<span id="cb7-1043"><a href="#cb7-1043" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"age"</span>,</span>
<span id="cb7-1044"><a href="#cb7-1044" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-1045"><a href="#cb7-1045" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-1046"><a href="#cb7-1046" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb7-1047"><a href="#cb7-1047" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb7-1048"><a href="#cb7-1048" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-1049"><a href="#cb7-1049" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Embedding of all samples from TCGA"</span>,</span>
<span id="cb7-1050"><a href="#cb7-1050" aria-hidden="true" tabindex="-1"></a>        <span class="st">" and METABRIC"</span></span>
<span id="cb7-1051"><a href="#cb7-1051" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-1052"><a href="#cb7-1052" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb7-1053"><a href="#cb7-1053" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Age"</span>) <span class="sc">+</span></span>
<span id="cb7-1054"><a href="#cb7-1054" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1055"><a href="#cb7-1055" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>()</span>
<span id="cb7-1056"><a href="#cb7-1056" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1057"><a href="#cb7-1057" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1058"><a href="#cb7-1058" aria-hidden="true" tabindex="-1"></a>Age seems to be well mixed. @fig-pca-er-status shows the</span>
<span id="cb7-1059"><a href="#cb7-1059" aria-hidden="true" tabindex="-1"></a>PCA colored by ER status.</span>
<span id="cb7-1060"><a href="#cb7-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1063"><a href="#cb7-1063" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-1064"><a href="#cb7-1064" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-er-status</span></span>
<span id="cb7-1065"><a href="#cb7-1065" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: PC3 and PC4 of samples from TCGA and METABRIC</span></span>
<span id="cb7-1066"><a href="#cb7-1066" aria-hidden="true" tabindex="-1"></a><span class="co">#|     colored by ER status.</span></span>
<span id="cb7-1067"><a href="#cb7-1067" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pca_coordinates</span>(</span>
<span id="cb7-1068"><a href="#cb7-1068" aria-hidden="true" tabindex="-1"></a>    df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-1069"><a href="#cb7-1069" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)),</span>
<span id="cb7-1070"><a href="#cb7-1070" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"er_status"</span>,</span>
<span id="cb7-1071"><a href="#cb7-1071" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-1072"><a href="#cb7-1072" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-1073"><a href="#cb7-1073" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb7-1074"><a href="#cb7-1074" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb7-1075"><a href="#cb7-1075" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-1076"><a href="#cb7-1076" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Embedding of all samples from TCGA"</span>,</span>
<span id="cb7-1077"><a href="#cb7-1077" aria-hidden="true" tabindex="-1"></a>        <span class="st">" and METABRIC"</span></span>
<span id="cb7-1078"><a href="#cb7-1078" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-1079"><a href="#cb7-1079" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb7-1080"><a href="#cb7-1080" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"ER IHC"</span>) <span class="sc">+</span></span>
<span id="cb7-1081"><a href="#cb7-1081" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1082"><a href="#cb7-1082" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-1083"><a href="#cb7-1083" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>()</span>
<span id="cb7-1084"><a href="#cb7-1084" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1085"><a href="#cb7-1085" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1086"><a href="#cb7-1086" aria-hidden="true" tabindex="-1"></a>It has a very good separation among the different patients.</span>
<span id="cb7-1087"><a href="#cb7-1087" aria-hidden="true" tabindex="-1"></a>@fig-pca-npi is the PCA embedding colored by NPI. Only METABRIC samples</span>
<span id="cb7-1088"><a href="#cb7-1088" aria-hidden="true" tabindex="-1"></a>have this information.</span>
<span id="cb7-1089"><a href="#cb7-1089" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1092"><a href="#cb7-1092" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-1093"><a href="#cb7-1093" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-npi</span></span>
<span id="cb7-1094"><a href="#cb7-1094" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: PC3 and PC4 of samples from METABRIC only</span></span>
<span id="cb7-1095"><a href="#cb7-1095" aria-hidden="true" tabindex="-1"></a><span class="co">#|     colored by NPI.</span></span>
<span id="cb7-1096"><a href="#cb7-1096" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pca_coordinates</span>(</span>
<span id="cb7-1097"><a href="#cb7-1097" aria-hidden="true" tabindex="-1"></a>    df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-1098"><a href="#cb7-1098" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"metabric"</span>)),</span>
<span id="cb7-1099"><a href="#cb7-1099" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"npi"</span>,</span>
<span id="cb7-1100"><a href="#cb7-1100" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-1101"><a href="#cb7-1101" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-1102"><a href="#cb7-1102" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb7-1103"><a href="#cb7-1103" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb7-1104"><a href="#cb7-1104" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-1105"><a href="#cb7-1105" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Embedding of all samples from METABRIC"</span></span>
<span id="cb7-1106"><a href="#cb7-1106" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-1107"><a href="#cb7-1107" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_c</span>(<span class="at">na.value =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb7-1108"><a href="#cb7-1108" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"NPI"</span>) <span class="sc">+</span> </span>
<span id="cb7-1109"><a href="#cb7-1109" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1110"><a href="#cb7-1110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>()</span>
<span id="cb7-1111"><a href="#cb7-1111" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1112"><a href="#cb7-1112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1113"><a href="#cb7-1113" aria-hidden="true" tabindex="-1"></a>It looks good, ER+ BC patients have lower NPI, which makes sense. </span>
<span id="cb7-1114"><a href="#cb7-1114" aria-hidden="true" tabindex="-1"></a>@fig-pca-npi-pc3 shows then how there is barely any correlation</span>
<span id="cb7-1115"><a href="#cb7-1115" aria-hidden="true" tabindex="-1"></a>between the different subtypes and the NPI when stratified by the</span>
<span id="cb7-1116"><a href="#cb7-1116" aria-hidden="true" tabindex="-1"></a>molecular subtype.</span>
<span id="cb7-1117"><a href="#cb7-1117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1120"><a href="#cb7-1120" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-1121"><a href="#cb7-1121" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-npi-pc3</span></span>
<span id="cb7-1122"><a href="#cb7-1122" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: PC3 and NPI correlation colored and stratified by</span></span>
<span id="cb7-1123"><a href="#cb7-1123" aria-hidden="true" tabindex="-1"></a><span class="co">#|     the intrinsic molecular subtype.</span></span>
<span id="cb7-1124"><a href="#cb7-1124" aria-hidden="true" tabindex="-1"></a>df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-1125"><a href="#cb7-1125" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"metabric"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-1126"><a href="#cb7-1126" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> npi, <span class="at">y =</span> PC3, <span class="at">color =</span> pam50)) <span class="sc">+</span> </span>
<span id="cb7-1127"><a href="#cb7-1127" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb7-1128"><a href="#cb7-1128" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>) <span class="sc">+</span></span>
<span id="cb7-1129"><a href="#cb7-1129" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>pam50) <span class="sc">+</span></span>
<span id="cb7-1130"><a href="#cb7-1130" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"PAM50"</span>, <span class="at">x =</span> <span class="st">"NPI"</span>) <span class="sc">+</span> </span>
<span id="cb7-1131"><a href="#cb7-1131" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1132"><a href="#cb7-1132" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>()</span>
<span id="cb7-1133"><a href="#cb7-1133" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1134"><a href="#cb7-1134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1135"><a href="#cb7-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1136"><a href="#cb7-1136" aria-hidden="true" tabindex="-1"></a>@fig-pca-tumor-purity shows the biplot colored by tumor purity.</span>
<span id="cb7-1137"><a href="#cb7-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1140"><a href="#cb7-1140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-1141"><a href="#cb7-1141" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-tumor-purity</span></span>
<span id="cb7-1142"><a href="#cb7-1142" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: PC3 and PC4 of samples from METABRIC only</span></span>
<span id="cb7-1143"><a href="#cb7-1143" aria-hidden="true" tabindex="-1"></a><span class="co">#|     colored by tumor purity.</span></span>
<span id="cb7-1144"><a href="#cb7-1144" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pca_coordinates</span>(</span>
<span id="cb7-1145"><a href="#cb7-1145" aria-hidden="true" tabindex="-1"></a>    df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-1146"><a href="#cb7-1146" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"metabric"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-1147"><a href="#cb7-1147" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(CELLULARITY <span class="sc">!=</span> <span class="st">""</span>),</span>
<span id="cb7-1148"><a href="#cb7-1148" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"CELLULARITY"</span>,</span>
<span id="cb7-1149"><a href="#cb7-1149" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-1150"><a href="#cb7-1150" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-1151"><a href="#cb7-1151" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb7-1152"><a href="#cb7-1152" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb7-1153"><a href="#cb7-1153" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-1154"><a href="#cb7-1154" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Embedding of all samples from METABRIC"</span></span>
<span id="cb7-1155"><a href="#cb7-1155" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-1156"><a href="#cb7-1156" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">na.value =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb7-1157"><a href="#cb7-1157" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Tumor purity"</span>) <span class="sc">+</span> </span>
<span id="cb7-1158"><a href="#cb7-1158" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1159"><a href="#cb7-1159" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-1160"><a href="#cb7-1160" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>()</span>
<span id="cb7-1161"><a href="#cb7-1161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1162"><a href="#cb7-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1163"><a href="#cb7-1163" aria-hidden="true" tabindex="-1"></a>The tumor purity is not a factor that is affecting the embedding as samples</span>
<span id="cb7-1164"><a href="#cb7-1164" aria-hidden="true" tabindex="-1"></a>with low cellularity (&lt; 40% of tumor cells) and high cellularity</span>
<span id="cb7-1165"><a href="#cb7-1165" aria-hidden="true" tabindex="-1"></a>(&gt; 70% of tumor cells) intermingle. </span>
<span id="cb7-1166"><a href="#cb7-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1167"><a href="#cb7-1167" aria-hidden="true" tabindex="-1"></a>Another way to visualize is the distribution of the principal components</span>
<span id="cb7-1168"><a href="#cb7-1168" aria-hidden="true" tabindex="-1"></a>over the tumor purity (@fig-pca-pc-by-tumor-purity).</span>
<span id="cb7-1169"><a href="#cb7-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1172"><a href="#cb7-1172" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-1173"><a href="#cb7-1173" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-pc-by-tumor-purity</span></span>
<span id="cb7-1174"><a href="#cb7-1174" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: PC3 and PC4 stratified by tumor purity</span></span>
<span id="cb7-1175"><a href="#cb7-1175" aria-hidden="true" tabindex="-1"></a>df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-1176"><a href="#cb7-1176" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"metabric"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-1177"><a href="#cb7-1177" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(CELLULARITY <span class="sc">!=</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-1178"><a href="#cb7-1178" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb7-1179"><a href="#cb7-1179" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> <span class="fu">c</span>(PC3, PC4),</span>
<span id="cb7-1180"><a href="#cb7-1180" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"PC"</span>,</span>
<span id="cb7-1181"><a href="#cb7-1181" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">"score"</span></span>
<span id="cb7-1182"><a href="#cb7-1182" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-1183"><a href="#cb7-1183" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> score, <span class="at">fill =</span> CELLULARITY)) <span class="sc">+</span> </span>
<span id="cb7-1184"><a href="#cb7-1184" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb7-1185"><a href="#cb7-1185" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>PC) <span class="sc">+</span> </span>
<span id="cb7-1186"><a href="#cb7-1186" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Principal component"</span>, <span class="at">y =</span> <span class="st">"Density"</span>) <span class="sc">+</span> </span>
<span id="cb7-1187"><a href="#cb7-1187" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1188"><a href="#cb7-1188" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-1189"><a href="#cb7-1189" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>()</span>
<span id="cb7-1190"><a href="#cb7-1190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1191"><a href="#cb7-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1192"><a href="#cb7-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1193"><a href="#cb7-1193" aria-hidden="true" tabindex="-1"></a>METABRIC has also inferred menopausal status for the patients, we use</span>
<span id="cb7-1194"><a href="#cb7-1194" aria-hidden="true" tabindex="-1"></a>this information to check if there is any enrichment based on the </span>
<span id="cb7-1195"><a href="#cb7-1195" aria-hidden="true" tabindex="-1"></a>patient menopausal status (@fig-pca-men-status)</span>
<span id="cb7-1196"><a href="#cb7-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1199"><a href="#cb7-1199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-1200"><a href="#cb7-1200" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-men-status</span></span>
<span id="cb7-1201"><a href="#cb7-1201" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: PC3 and PC4 of samples from METABRIC only</span></span>
<span id="cb7-1202"><a href="#cb7-1202" aria-hidden="true" tabindex="-1"></a><span class="co">#|     colored by menopausal status.</span></span>
<span id="cb7-1203"><a href="#cb7-1203" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pca_coordinates</span>(</span>
<span id="cb7-1204"><a href="#cb7-1204" aria-hidden="true" tabindex="-1"></a>    df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-1205"><a href="#cb7-1205" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"metabric"</span>)),</span>
<span id="cb7-1206"><a href="#cb7-1206" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"INFERRED_MENOPAUSAL_STATE"</span>,</span>
<span id="cb7-1207"><a href="#cb7-1207" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-1208"><a href="#cb7-1208" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-1209"><a href="#cb7-1209" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb7-1210"><a href="#cb7-1210" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb7-1211"><a href="#cb7-1211" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-1212"><a href="#cb7-1212" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Embedding of all samples from METABRIC"</span></span>
<span id="cb7-1213"><a href="#cb7-1213" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-1214"><a href="#cb7-1214" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>(<span class="at">na.value =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb7-1215"><a href="#cb7-1215" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Menopausal</span><span class="sc">\n</span><span class="st">status"</span>) <span class="sc">+</span> </span>
<span id="cb7-1216"><a href="#cb7-1216" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1217"><a href="#cb7-1217" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-1218"><a href="#cb7-1218" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>()</span>
<span id="cb7-1219"><a href="#cb7-1219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1220"><a href="#cb7-1220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1221"><a href="#cb7-1221" aria-hidden="true" tabindex="-1"></a>We don't see any difference between the two status. We proceed now with </span>
<span id="cb7-1222"><a href="#cb7-1222" aria-hidden="true" tabindex="-1"></a>the analysis using clinical factors from TCGA.</span>
<span id="cb7-1223"><a href="#cb7-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1224"><a href="#cb7-1224" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=12, fig.height=4}</span></span>
<span id="cb7-1225"><a href="#cb7-1225" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-tumor-node</span></span>
<span id="cb7-1226"><a href="#cb7-1226" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: PC3 and PC4 of samples from TCGA only</span></span>
<span id="cb7-1227"><a href="#cb7-1227" aria-hidden="true" tabindex="-1"></a><span class="co">#|     colored by tumor stage and node stage.</span></span>
<span id="cb7-1228"><a href="#cb7-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1229"><a href="#cb7-1229" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot_pca_coordinates</span>(</span>
<span id="cb7-1230"><a href="#cb7-1230" aria-hidden="true" tabindex="-1"></a>    df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-1231"><a href="#cb7-1231" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tcga"</span>)),</span>
<span id="cb7-1232"><a href="#cb7-1232" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"tumor_stage"</span>,</span>
<span id="cb7-1233"><a href="#cb7-1233" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-1234"><a href="#cb7-1234" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-1235"><a href="#cb7-1235" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb7-1236"><a href="#cb7-1236" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb7-1237"><a href="#cb7-1237" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-1238"><a href="#cb7-1238" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Embedding of all samples from TCGA"</span></span>
<span id="cb7-1239"><a href="#cb7-1239" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-1240"><a href="#cb7-1240" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb7-1241"><a href="#cb7-1241" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb7-1242"><a href="#cb7-1242" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Tumor</span><span class="sc">\n</span><span class="st">stage"</span>) <span class="sc">+</span></span>
<span id="cb7-1243"><a href="#cb7-1243" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1244"><a href="#cb7-1244" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-1245"><a href="#cb7-1245" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>()</span>
<span id="cb7-1246"><a href="#cb7-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1247"><a href="#cb7-1247" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">plot_pca_coordinates</span>(</span>
<span id="cb7-1248"><a href="#cb7-1248" aria-hidden="true" tabindex="-1"></a>    df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-1249"><a href="#cb7-1249" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tcga"</span>)),</span>
<span id="cb7-1250"><a href="#cb7-1250" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"node_stage"</span>,</span>
<span id="cb7-1251"><a href="#cb7-1251" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-1252"><a href="#cb7-1252" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-1253"><a href="#cb7-1253" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb7-1254"><a href="#cb7-1254" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb7-1255"><a href="#cb7-1255" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-1256"><a href="#cb7-1256" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Embedding of all samples from TCGA"</span></span>
<span id="cb7-1257"><a href="#cb7-1257" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-1258"><a href="#cb7-1258" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb7-1259"><a href="#cb7-1259" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb7-1260"><a href="#cb7-1260" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Node</span><span class="sc">\n</span><span class="st">stage"</span>) <span class="sc">+</span></span>
<span id="cb7-1261"><a href="#cb7-1261" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1262"><a href="#cb7-1262" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-1263"><a href="#cb7-1263" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>()</span>
<span id="cb7-1264"><a href="#cb7-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1265"><a href="#cb7-1265" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb7-1266"><a href="#cb7-1266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1267"><a href="#cb7-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1268"><a href="#cb7-1268" aria-hidden="true" tabindex="-1"></a>For both tumor and node stage the samples seem to have mixed well, indicating</span>
<span id="cb7-1269"><a href="#cb7-1269" aria-hidden="true" tabindex="-1"></a>the projection is not a function of the stages, as shown in </span>
<span id="cb7-1270"><a href="#cb7-1270" aria-hidden="true" tabindex="-1"></a>@fig-pca-tumor-node.</span>
<span id="cb7-1271"><a href="#cb7-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1272"><a href="#cb7-1272" aria-hidden="true" tabindex="-1"></a>And finally @fig-pca-pam50-2 below shows the color by PAM50 molecular</span>
<span id="cb7-1273"><a href="#cb7-1273" aria-hidden="true" tabindex="-1"></a>subtype.</span>
<span id="cb7-1274"><a href="#cb7-1274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1277"><a href="#cb7-1277" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-1278"><a href="#cb7-1278" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-pam50-2</span></span>
<span id="cb7-1279"><a href="#cb7-1279" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Corrected PC3 and PC4 of samples from TCGA and METABRIC</span></span>
<span id="cb7-1280"><a href="#cb7-1280" aria-hidden="true" tabindex="-1"></a><span class="co">#|     colored by PAM50 molecular subtype.</span></span>
<span id="cb7-1281"><a href="#cb7-1281" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-1282"><a href="#cb7-1282" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-1283"><a href="#cb7-1283" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span>(pam50 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"claudin-low"</span>, <span class="st">"nc"</span>)))</span>
<span id="cb7-1284"><a href="#cb7-1284" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pca_coordinates</span>(</span>
<span id="cb7-1285"><a href="#cb7-1285" aria-hidden="true" tabindex="-1"></a>    df,</span>
<span id="cb7-1286"><a href="#cb7-1286" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"pam50"</span>,</span>
<span id="cb7-1287"><a href="#cb7-1287" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-1288"><a href="#cb7-1288" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-1289"><a href="#cb7-1289" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb7-1290"><a href="#cb7-1290" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb7-1291"><a href="#cb7-1291" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-1292"><a href="#cb7-1292" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Embedding of all samples from TCGA and METABRIC"</span></span>
<span id="cb7-1293"><a href="#cb7-1293" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-1294"><a href="#cb7-1294" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb7-1295"><a href="#cb7-1295" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb7-1296"><a href="#cb7-1296" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"PAM50"</span>) <span class="sc">+</span> </span>
<span id="cb7-1297"><a href="#cb7-1297" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1298"><a href="#cb7-1298" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">get_colors_pam50</span>(df)) <span class="sc">+</span></span>
<span id="cb7-1299"><a href="#cb7-1299" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-1300"><a href="#cb7-1300" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>()</span>
<span id="cb7-1301"><a href="#cb7-1301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1302"><a href="#cb7-1302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1303"><a href="#cb7-1303" aria-hidden="true" tabindex="-1"></a>The molecular subtypes are projected as expected, going from left to right there</span>
<span id="cb7-1304"><a href="#cb7-1304" aria-hidden="true" tabindex="-1"></a>are the basal-like BC patients, going to HER2 and then they are split between</span>
<span id="cb7-1305"><a href="#cb7-1305" aria-hidden="true" tabindex="-1"></a>luminal A and B. The normal like patients are in the top and closer to the</span>
<span id="cb7-1306"><a href="#cb7-1306" aria-hidden="true" tabindex="-1"></a>luminal A, reflecting the biology.</span>
<span id="cb7-1307"><a href="#cb7-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1308"><a href="#cb7-1308" aria-hidden="true" tabindex="-1"></a>The next figures show the ER signaling measures coloring the projections.</span>
<span id="cb7-1309"><a href="#cb7-1309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1312"><a href="#cb7-1312" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-1313"><a href="#cb7-1313" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-seterpr</span></span>
<span id="cb7-1314"><a href="#cb7-1314" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: biplot of PC3 and PC4 of samples from TCGA and METABRIC</span></span>
<span id="cb7-1315"><a href="#cb7-1315" aria-hidden="true" tabindex="-1"></a><span class="co">#|     colored by the SET ER/PR score.</span></span>
<span id="cb7-1316"><a href="#cb7-1316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1317"><a href="#cb7-1317" aria-hidden="true" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="st">"SET_ERPR"</span></span>
<span id="cb7-1318"><a href="#cb7-1318" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">"PC3"</span></span>
<span id="cb7-1319"><a href="#cb7-1319" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="st">"PC4"</span></span>
<span id="cb7-1320"><a href="#cb7-1320" aria-hidden="true" tabindex="-1"></a>size <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-1321"><a href="#cb7-1321" aria-hidden="true" tabindex="-1"></a>base_size <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb7-1322"><a href="#cb7-1322" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="st">"Embedding of all samples from TCGA and METABRIC"</span></span>
<span id="cb7-1323"><a href="#cb7-1323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1324"><a href="#cb7-1324" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-1325"><a href="#cb7-1325" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-1326"><a href="#cb7-1326" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes_string</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">z =</span> color)) <span class="sc">+</span> </span>
<span id="cb7-1327"><a href="#cb7-1327" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">stat_summary_hex</span>(<span class="at">bins =</span> <span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb7-1328"><a href="#cb7-1328" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb7-1329"><a href="#cb7-1329" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-1330"><a href="#cb7-1330" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> title,</span>
<span id="cb7-1331"><a href="#cb7-1331" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="fu">expression</span>(SET[ER<span class="sc">/</span>PR])</span>
<span id="cb7-1332"><a href="#cb7-1332" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span> </span>
<span id="cb7-1333"><a href="#cb7-1333" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1334"><a href="#cb7-1334" aria-hidden="true" tabindex="-1"></a>        <span class="fu">change_plot_aes_point</span>() </span>
<span id="cb7-1335"><a href="#cb7-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1336"><a href="#cb7-1336" aria-hidden="true" tabindex="-1"></a>p1</span>
<span id="cb7-1337"><a href="#cb7-1337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1338"><a href="#cb7-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1341"><a href="#cb7-1341" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-1342"><a href="#cb7-1342" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-early</span></span>
<span id="cb7-1343"><a href="#cb7-1343" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: biplot of PC3 and PC4 of samples from TCGA and METABRIC</span></span>
<span id="cb7-1344"><a href="#cb7-1344" aria-hidden="true" tabindex="-1"></a><span class="co">#|     colored by the hallmark estrogen response early.</span></span>
<span id="cb7-1345"><a href="#cb7-1345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1346"><a href="#cb7-1346" aria-hidden="true" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="st">"HALLMARK_ESTROGEN_RESPONSE_EARLY"</span></span>
<span id="cb7-1347"><a href="#cb7-1347" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">"PC3"</span></span>
<span id="cb7-1348"><a href="#cb7-1348" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="st">"PC4"</span></span>
<span id="cb7-1349"><a href="#cb7-1349" aria-hidden="true" tabindex="-1"></a>size <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-1350"><a href="#cb7-1350" aria-hidden="true" tabindex="-1"></a>base_size <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb7-1351"><a href="#cb7-1351" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="st">"Embedding of all samples from TCGA and METABRIC"</span></span>
<span id="cb7-1352"><a href="#cb7-1352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1353"><a href="#cb7-1353" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-1354"><a href="#cb7-1354" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-1355"><a href="#cb7-1355" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes_string</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">z =</span> color)) <span class="sc">+</span> </span>
<span id="cb7-1356"><a href="#cb7-1356" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">stat_summary_hex</span>(<span class="at">bins =</span> <span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb7-1357"><a href="#cb7-1357" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb7-1358"><a href="#cb7-1358" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-1359"><a href="#cb7-1359" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> title,</span>
<span id="cb7-1360"><a href="#cb7-1360" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"Estrogen</span><span class="sc">\n</span><span class="st">early"</span></span>
<span id="cb7-1361"><a href="#cb7-1361" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span> </span>
<span id="cb7-1362"><a href="#cb7-1362" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1363"><a href="#cb7-1363" aria-hidden="true" tabindex="-1"></a>        <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-1364"><a href="#cb7-1364" aria-hidden="true" tabindex="-1"></a>        <span class="fu">change_guides_point</span>()</span>
<span id="cb7-1365"><a href="#cb7-1365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1366"><a href="#cb7-1366" aria-hidden="true" tabindex="-1"></a>p1</span>
<span id="cb7-1367"><a href="#cb7-1367" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1368"><a href="#cb7-1368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1371"><a href="#cb7-1371" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-1372"><a href="#cb7-1372" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-late</span></span>
<span id="cb7-1373"><a href="#cb7-1373" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: biplot of PC3 and PC4 of samples from TCGA and METABRIC</span></span>
<span id="cb7-1374"><a href="#cb7-1374" aria-hidden="true" tabindex="-1"></a><span class="co">#|     colored by the hallmark estrogen response late</span></span>
<span id="cb7-1375"><a href="#cb7-1375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1376"><a href="#cb7-1376" aria-hidden="true" tabindex="-1"></a>color <span class="ot">&lt;-</span> <span class="st">"HALLMARK_ESTROGEN_RESPONSE_LATE"</span></span>
<span id="cb7-1377"><a href="#cb7-1377" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">"PC3"</span></span>
<span id="cb7-1378"><a href="#cb7-1378" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="st">"PC4"</span></span>
<span id="cb7-1379"><a href="#cb7-1379" aria-hidden="true" tabindex="-1"></a>size <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-1380"><a href="#cb7-1380" aria-hidden="true" tabindex="-1"></a>base_size <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb7-1381"><a href="#cb7-1381" aria-hidden="true" tabindex="-1"></a>title <span class="ot">&lt;-</span> <span class="st">"Embedding of all samples from TCGA and METABRIC"</span></span>
<span id="cb7-1382"><a href="#cb7-1382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1383"><a href="#cb7-1383" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-1384"><a href="#cb7-1384" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-1385"><a href="#cb7-1385" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes_string</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">z =</span> color)) <span class="sc">+</span> </span>
<span id="cb7-1386"><a href="#cb7-1386" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">stat_summary_hex</span>(<span class="at">bins =</span> <span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb7-1387"><a href="#cb7-1387" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb7-1388"><a href="#cb7-1388" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-1389"><a href="#cb7-1389" aria-hidden="true" tabindex="-1"></a>            <span class="at">title =</span> title,</span>
<span id="cb7-1390"><a href="#cb7-1390" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"Estrogen</span><span class="sc">\n</span><span class="st">late"</span></span>
<span id="cb7-1391"><a href="#cb7-1391" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span> </span>
<span id="cb7-1392"><a href="#cb7-1392" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1393"><a href="#cb7-1393" aria-hidden="true" tabindex="-1"></a>        <span class="fu">change_plot_aes_point</span>() </span>
<span id="cb7-1394"><a href="#cb7-1394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1395"><a href="#cb7-1395" aria-hidden="true" tabindex="-1"></a>p1</span>
<span id="cb7-1396"><a href="#cb7-1396" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1397"><a href="#cb7-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1398"><a href="#cb7-1398" aria-hidden="true" tabindex="-1"></a>In all cases the mixing is relatively good. For $SET_{ER/PR}$ you have a</span>
<span id="cb7-1399"><a href="#cb7-1399" aria-hidden="true" tabindex="-1"></a>gradient going from the right to the left, showing again that</span>
<span id="cb7-1400"><a href="#cb7-1400" aria-hidden="true" tabindex="-1"></a>patients on the far top right probably are those patients with better prognosis.</span>
<span id="cb7-1401"><a href="#cb7-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1402"><a href="#cb7-1402" aria-hidden="true" tabindex="-1"></a>And lastly we use the correlation plot available from PCAtools to check the</span>
<span id="cb7-1403"><a href="#cb7-1403" aria-hidden="true" tabindex="-1"></a>PC correlation with all the clinical factors, we check the first 10 components</span>
<span id="cb7-1404"><a href="#cb7-1404" aria-hidden="true" tabindex="-1"></a>as these are the ones with more variation.</span>
<span id="cb7-1405"><a href="#cb7-1405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1406"><a href="#cb7-1406" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=12, fig.height=6}</span></span>
<span id="cb7-1407"><a href="#cb7-1407" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-correlation-clin-pcs</span></span>
<span id="cb7-1408"><a href="#cb7-1408" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Pearson r-squared between clinical factors and principal components.</span></span>
<span id="cb7-1409"><a href="#cb7-1409" aria-hidden="true" tabindex="-1"></a>pca_fit<span class="sc">$</span>metadata<span class="sc">$</span><span class="st">`</span><span class="at">Cohort</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb7-1410"><a href="#cb7-1410" aria-hidden="true" tabindex="-1"></a>    pca_fit<span class="sc">$</span>metadata<span class="sc">$</span>cohort, </span>
<span id="cb7-1411"><a href="#cb7-1411" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)</span>
<span id="cb7-1412"><a href="#cb7-1412" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-1413"><a href="#cb7-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1414"><a href="#cb7-1414" aria-hidden="true" tabindex="-1"></a>pca_fit<span class="sc">$</span>metadata<span class="sc">$</span><span class="st">`</span><span class="at">Inferred Menopausal State</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb7-1415"><a href="#cb7-1415" aria-hidden="true" tabindex="-1"></a>    pca_fit<span class="sc">$</span>metadata<span class="sc">$</span>INFERRED_MENOPAUSAL_STATE, </span>
<span id="cb7-1416"><a href="#cb7-1416" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Pre"</span>, <span class="st">"Post"</span>)</span>
<span id="cb7-1417"><a href="#cb7-1417" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-1418"><a href="#cb7-1418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1419"><a href="#cb7-1419" aria-hidden="true" tabindex="-1"></a>pca_fit<span class="sc">$</span>metadata<span class="sc">$</span><span class="st">`</span><span class="at">Node Stage</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb7-1420"><a href="#cb7-1420" aria-hidden="true" tabindex="-1"></a>    pca_fit<span class="sc">$</span>metadata<span class="sc">$</span>node_stage,</span>
<span id="cb7-1421"><a href="#cb7-1421" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"N0"</span>, <span class="st">"N1"</span>, <span class="st">"N2"</span>, <span class="st">"N3"</span>, <span class="st">"NX"</span>)</span>
<span id="cb7-1422"><a href="#cb7-1422" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-1423"><a href="#cb7-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1424"><a href="#cb7-1424" aria-hidden="true" tabindex="-1"></a>pca_fit<span class="sc">$</span>metadata<span class="sc">$</span><span class="st">`</span><span class="at">Tumor Purity</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb7-1425"><a href="#cb7-1425" aria-hidden="true" tabindex="-1"></a>    <span class="fu">factor</span>(</span>
<span id="cb7-1426"><a href="#cb7-1426" aria-hidden="true" tabindex="-1"></a>        pca_fit<span class="sc">$</span>metadata<span class="sc">$</span>CELLULARITY,</span>
<span id="cb7-1427"><a href="#cb7-1427" aria-hidden="true" tabindex="-1"></a>        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>)</span>
<span id="cb7-1428"><a href="#cb7-1428" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">==</span> <span class="st">"High"</span>,</span>
<span id="cb7-1429"><a href="#cb7-1429" aria-hidden="true" tabindex="-1"></a>    <span class="st">"High"</span>,</span>
<span id="cb7-1430"><a href="#cb7-1430" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Low"</span></span>
<span id="cb7-1431"><a href="#cb7-1431" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-1432"><a href="#cb7-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1433"><a href="#cb7-1433" aria-hidden="true" tabindex="-1"></a>pca_fit<span class="sc">$</span>metadata<span class="sc">$</span><span class="st">`</span><span class="at">ER status</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">factor</span>(</span>
<span id="cb7-1434"><a href="#cb7-1434" aria-hidden="true" tabindex="-1"></a>    pca_fit<span class="sc">$</span>metadata<span class="sc">$</span>er_status,</span>
<span id="cb7-1435"><a href="#cb7-1435" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"neg"</span>, <span class="st">"pos"</span>)</span>
<span id="cb7-1436"><a href="#cb7-1436" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-1437"><a href="#cb7-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1438"><a href="#cb7-1438" aria-hidden="true" tabindex="-1"></a>pca_fit<span class="sc">$</span>metadata<span class="sc">$</span>NPI <span class="ot">&lt;-</span> pca_fit<span class="sc">$</span>metadata<span class="sc">$</span>npi</span>
<span id="cb7-1439"><a href="#cb7-1439" aria-hidden="true" tabindex="-1"></a>pca_fit<span class="sc">$</span>metadata<span class="sc">$</span>Age <span class="ot">&lt;-</span> pca_fit<span class="sc">$</span>metadata<span class="sc">$</span>age</span>
<span id="cb7-1440"><a href="#cb7-1440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1441"><a href="#cb7-1441" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb7-1442"><a href="#cb7-1442" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(grDevices)</span>
<span id="cb7-1443"><a href="#cb7-1443" aria-hidden="true" tabindex="-1"></a>eigencorplot <span class="ot">&lt;-</span> <span class="cf">function</span> (pcaobj, <span class="at">components =</span> <span class="fu">getComponents</span>(pcaobj, <span class="fu">seq_len</span>(<span class="dv">10</span>)), </span>
<span id="cb7-1444"><a href="#cb7-1444" aria-hidden="true" tabindex="-1"></a>    metavars, <span class="at">titleX =</span> <span class="st">""</span>, <span class="at">cexTitleX =</span> <span class="dv">1</span>, <span class="at">rotTitleX =</span> <span class="dv">0</span>, <span class="at">colTitleX =</span> <span class="st">"black"</span>, </span>
<span id="cb7-1445"><a href="#cb7-1445" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontTitleX =</span> <span class="dv">2</span>, <span class="at">titleY =</span> <span class="st">""</span>, <span class="at">cexTitleY =</span> <span class="dv">1</span>, <span class="at">rotTitleY =</span> <span class="dv">0</span>, </span>
<span id="cb7-1446"><a href="#cb7-1446" aria-hidden="true" tabindex="-1"></a>    <span class="at">colTitleY =</span> <span class="st">"black"</span>, <span class="at">fontTitleY =</span> <span class="dv">2</span>, <span class="at">cexLabX =</span> <span class="dv">1</span>, <span class="at">rotLabX =</span> <span class="dv">0</span>, </span>
<span id="cb7-1447"><a href="#cb7-1447" aria-hidden="true" tabindex="-1"></a>    <span class="at">colLabX =</span> <span class="st">"black"</span>, <span class="at">fontLabX =</span> <span class="dv">2</span>, <span class="at">cexLabY =</span> <span class="dv">1</span>, <span class="at">rotLabY =</span> <span class="dv">0</span>, </span>
<span id="cb7-1448"><a href="#cb7-1448" aria-hidden="true" tabindex="-1"></a>    <span class="at">colLabY =</span> <span class="st">"black"</span>, <span class="at">fontLabY =</span> <span class="dv">2</span>, <span class="at">posLab =</span> <span class="st">"bottomleft"</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue4"</span>, </span>
<span id="cb7-1449"><a href="#cb7-1449" aria-hidden="true" tabindex="-1"></a>        <span class="st">"blue3"</span>, <span class="st">"blue2"</span>, <span class="st">"blue1"</span>, <span class="st">"white"</span>, <span class="st">"red1"</span>, <span class="st">"red2"</span>, <span class="st">"red3"</span>, </span>
<span id="cb7-1450"><a href="#cb7-1450" aria-hidden="true" tabindex="-1"></a>        <span class="st">"red4"</span>), <span class="at">posColKey =</span> <span class="st">"right"</span>, <span class="at">cexLabColKey =</span> <span class="dv">1</span>, <span class="at">cexCorval =</span> <span class="dv">1</span>, </span>
<span id="cb7-1451"><a href="#cb7-1451" aria-hidden="true" tabindex="-1"></a>    <span class="at">colCorval =</span> <span class="st">"black"</span>, <span class="at">fontCorval =</span> <span class="dv">1</span>, <span class="at">scale =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">""</span>, </span>
<span id="cb7-1452"><a href="#cb7-1452" aria-hidden="true" tabindex="-1"></a>    <span class="at">cexMain =</span> <span class="dv">2</span>, <span class="at">rotMain =</span> <span class="dv">0</span>, <span class="at">colMain =</span> <span class="st">"black"</span>, <span class="at">fontMain =</span> <span class="dv">2</span>, </span>
<span id="cb7-1453"><a href="#cb7-1453" aria-hidden="true" tabindex="-1"></a>    <span class="at">corFUN =</span> <span class="st">"pearson"</span>, <span class="at">corUSE =</span> <span class="st">"pairwise.complete.obs"</span>, <span class="at">corMultipleTestCorrection =</span> <span class="st">"none"</span>, </span>
<span id="cb7-1454"><a href="#cb7-1454" aria-hidden="true" tabindex="-1"></a>    <span class="at">signifSymbols =</span> <span class="fu">c</span>(<span class="st">"***"</span>, <span class="st">"**"</span>, <span class="st">"*"</span>, <span class="st">""</span>), <span class="at">signifCutpoints =</span> <span class="fu">c</span>(<span class="dv">0</span>, </span>
<span id="cb7-1455"><a href="#cb7-1455" aria-hidden="true" tabindex="-1"></a>        <span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.05</span>, <span class="dv">1</span>), <span class="at">colFrame =</span> <span class="st">"white"</span>, <span class="at">plotRsquared =</span> <span class="cn">FALSE</span>, </span>
<span id="cb7-1456"><a href="#cb7-1456" aria-hidden="true" tabindex="-1"></a>    <span class="at">returnPlot =</span> <span class="cn">TRUE</span>) </span>
<span id="cb7-1457"><a href="#cb7-1457" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb7-1458"><a href="#cb7-1458" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> pcaobj<span class="sc">$</span>rotated</span>
<span id="cb7-1459"><a href="#cb7-1459" aria-hidden="true" tabindex="-1"></a>    metadata <span class="ot">&lt;-</span> pcaobj<span class="sc">$</span>metadata</span>
<span id="cb7-1460"><a href="#cb7-1460" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(components))) {</span>
<span id="cb7-1461"><a href="#cb7-1461" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(data[, components[i]])) {</span>
<span id="cb7-1462"><a href="#cb7-1462" aria-hidden="true" tabindex="-1"></a>            <span class="fu">warning</span>(components[i], <span class="st">" is not numeric - please check the source data"</span>, </span>
<span id="cb7-1463"><a href="#cb7-1463" aria-hidden="true" tabindex="-1"></a>                <span class="st">" as everything will be converted to a matrix"</span>)</span>
<span id="cb7-1464"><a href="#cb7-1464" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-1465"><a href="#cb7-1465" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1466"><a href="#cb7-1466" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(metavars))) {</span>
<span id="cb7-1467"><a href="#cb7-1467" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.numeric</span>(metadata[, metavars[i]])) {</span>
<span id="cb7-1468"><a href="#cb7-1468" aria-hidden="true" tabindex="-1"></a>            <span class="fu">warning</span>(metavars[i], <span class="st">" is not numeric - please check the source data"</span>, </span>
<span id="cb7-1469"><a href="#cb7-1469" aria-hidden="true" tabindex="-1"></a>                <span class="st">" as non-numeric variables will be coerced to numeric"</span>)</span>
<span id="cb7-1470"><a href="#cb7-1470" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-1471"><a href="#cb7-1471" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1472"><a href="#cb7-1472" aria-hidden="true" tabindex="-1"></a>    xvals <span class="ot">&lt;-</span> <span class="fu">data.matrix</span>(data[, <span class="fu">which</span>(<span class="fu">colnames</span>(data) <span class="sc">%in%</span> components), </span>
<span id="cb7-1473"><a href="#cb7-1473" aria-hidden="true" tabindex="-1"></a>        <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb7-1474"><a href="#cb7-1474" aria-hidden="true" tabindex="-1"></a>    yvals <span class="ot">&lt;-</span> metadata[, <span class="fu">which</span>(<span class="fu">colnames</span>(metadata) <span class="sc">%in%</span> metavars), </span>
<span id="cb7-1475"><a href="#cb7-1475" aria-hidden="true" tabindex="-1"></a>        drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb7-1476"><a href="#cb7-1476" aria-hidden="true" tabindex="-1"></a>    chararcter_columns <span class="ot">=</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(yvals, is.numeric))</span>
<span id="cb7-1477"><a href="#cb7-1477" aria-hidden="true" tabindex="-1"></a>    chararcter_columns <span class="ot">=</span> <span class="sc">!</span>chararcter_columns</span>
<span id="cb7-1478"><a href="#cb7-1478" aria-hidden="true" tabindex="-1"></a>    chararcter_columns <span class="ot">=</span> <span class="fu">names</span>(<span class="fu">which</span>(chararcter_columns))</span>
<span id="cb7-1479"><a href="#cb7-1479" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (c <span class="cf">in</span> chararcter_columns) {</span>
<span id="cb7-1480"><a href="#cb7-1480" aria-hidden="true" tabindex="-1"></a>        yvals[, <span class="fu">eval</span>(<span class="fu">quote</span>(c))] <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(yvals[, </span>
<span id="cb7-1481"><a href="#cb7-1481" aria-hidden="true" tabindex="-1"></a>            <span class="fu">eval</span>(<span class="fu">quote</span>(c))]))</span>
<span id="cb7-1482"><a href="#cb7-1482" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1483"><a href="#cb7-1483" aria-hidden="true" tabindex="-1"></a>    yvals <span class="ot">&lt;-</span> <span class="fu">data.matrix</span>(yvals)</span>
<span id="cb7-1484"><a href="#cb7-1484" aria-hidden="true" tabindex="-1"></a>    corvals <span class="ot">&lt;-</span> <span class="fu">cor</span>(xvals, yvals, <span class="at">use =</span> corUSE, <span class="at">method =</span> corFUN)</span>
<span id="cb7-1485"><a href="#cb7-1485" aria-hidden="true" tabindex="-1"></a>    N <span class="ot">&lt;-</span> <span class="fu">ncol</span>(xvals) <span class="sc">*</span> <span class="fu">ncol</span>(yvals)</span>
<span id="cb7-1486"><a href="#cb7-1486" aria-hidden="true" tabindex="-1"></a>    pvals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pval =</span> <span class="fu">numeric</span>(N), <span class="at">i =</span> <span class="fu">numeric</span>(N), <span class="at">j =</span> <span class="fu">numeric</span>(N))</span>
<span id="cb7-1487"><a href="#cb7-1487" aria-hidden="true" tabindex="-1"></a>    k <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-1488"><a href="#cb7-1488" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">ncol</span>(xvals))) {</span>
<span id="cb7-1489"><a href="#cb7-1489" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">ncol</span>(yvals))) {</span>
<span id="cb7-1490"><a href="#cb7-1490" aria-hidden="true" tabindex="-1"></a>            k <span class="ot">&lt;-</span> k <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb7-1491"><a href="#cb7-1491" aria-hidden="true" tabindex="-1"></a>            pvals[k, <span class="st">"pval"</span>] <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(xvals[, i], yvals[, </span>
<span id="cb7-1492"><a href="#cb7-1492" aria-hidden="true" tabindex="-1"></a>                j], <span class="at">use =</span> corUSE, <span class="at">method =</span> corFUN)<span class="sc">$</span>p.value</span>
<span id="cb7-1493"><a href="#cb7-1493" aria-hidden="true" tabindex="-1"></a>            pvals[k, <span class="st">"i"</span>] <span class="ot">&lt;-</span> <span class="fu">colnames</span>(xvals)[i]</span>
<span id="cb7-1494"><a href="#cb7-1494" aria-hidden="true" tabindex="-1"></a>            pvals[k, <span class="st">"j"</span>] <span class="ot">&lt;-</span> <span class="fu">colnames</span>(yvals)[j]</span>
<span id="cb7-1495"><a href="#cb7-1495" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-1496"><a href="#cb7-1496" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1497"><a href="#cb7-1497" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (corMultipleTestCorrection <span class="sc">!=</span> <span class="st">"none"</span>) {</span>
<span id="cb7-1498"><a href="#cb7-1498" aria-hidden="true" tabindex="-1"></a>        pvals<span class="sc">$</span>pval <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(pvals<span class="sc">$</span>pval, <span class="at">method =</span> corMultipleTestCorrection)</span>
<span id="cb7-1499"><a href="#cb7-1499" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1500"><a href="#cb7-1500" aria-hidden="true" tabindex="-1"></a>    pvals <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">dcast</span>(pvals, i <span class="sc">~</span> j, <span class="at">value.var =</span> <span class="st">"pval"</span>)</span>
<span id="cb7-1501"><a href="#cb7-1501" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(pvals) <span class="ot">&lt;-</span> pvals<span class="sc">$</span>i</span>
<span id="cb7-1502"><a href="#cb7-1502" aria-hidden="true" tabindex="-1"></a>    pvals<span class="sc">$</span>i <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-1503"><a href="#cb7-1503" aria-hidden="true" tabindex="-1"></a>    pvals <span class="ot">&lt;-</span> pvals[<span class="fu">match</span>(<span class="fu">rownames</span>(corvals), <span class="fu">rownames</span>(pvals)), </span>
<span id="cb7-1504"><a href="#cb7-1504" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb7-1505"><a href="#cb7-1505" aria-hidden="true" tabindex="-1"></a>    pvals <span class="ot">&lt;-</span> pvals[<span class="fu">colnames</span>(corvals)]</span>
<span id="cb7-1506"><a href="#cb7-1506" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (plotRsquared <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb7-1507"><a href="#cb7-1507" aria-hidden="true" tabindex="-1"></a>        corvals <span class="ot">&lt;-</span> corvals<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb7-1508"><a href="#cb7-1508" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1509"><a href="#cb7-1509" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (scale <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">&amp;&amp;</span> plotRsquared <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb7-1510"><a href="#cb7-1510" aria-hidden="true" tabindex="-1"></a>        iUpperRange <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-1511"><a href="#cb7-1511" aria-hidden="true" tabindex="-1"></a>        iLowerRange <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-1512"><a href="#cb7-1512" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1513"><a href="#cb7-1513" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (scale <span class="sc">==</span> <span class="cn">FALSE</span> <span class="sc">&amp;&amp;</span> plotRsquared <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb7-1514"><a href="#cb7-1514" aria-hidden="true" tabindex="-1"></a>        iUpperRange <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-1515"><a href="#cb7-1515" aria-hidden="true" tabindex="-1"></a>        iLowerRange <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb7-1516"><a href="#cb7-1516" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1517"><a href="#cb7-1517" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (scale <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb7-1518"><a href="#cb7-1518" aria-hidden="true" tabindex="-1"></a>        max <span class="ot">&lt;-</span> <span class="fu">max</span>(corvals)</span>
<span id="cb7-1519"><a href="#cb7-1519" aria-hidden="true" tabindex="-1"></a>        min <span class="ot">&lt;-</span> <span class="fu">min</span>(corvals)</span>
<span id="cb7-1520"><a href="#cb7-1520" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">abs</span>(max) <span class="sc">&gt;</span> <span class="fu">abs</span>(min)) {</span>
<span id="cb7-1521"><a href="#cb7-1521" aria-hidden="true" tabindex="-1"></a>            iUpperRange <span class="ot">&lt;-</span> max <span class="sc">+</span> <span class="fl">0.01</span></span>
<span id="cb7-1522"><a href="#cb7-1522" aria-hidden="true" tabindex="-1"></a>            iLowerRange <span class="ot">&lt;-</span> (max <span class="sc">*</span> (<span class="sc">-</span><span class="dv">1</span>)) <span class="sc">-</span> <span class="fl">0.01</span></span>
<span id="cb7-1523"><a href="#cb7-1523" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-1524"><a href="#cb7-1524" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> {</span>
<span id="cb7-1525"><a href="#cb7-1525" aria-hidden="true" tabindex="-1"></a>            iUpperRange <span class="ot">&lt;-</span> <span class="fu">abs</span>(min) <span class="sc">+</span> <span class="fl">0.01</span></span>
<span id="cb7-1526"><a href="#cb7-1526" aria-hidden="true" tabindex="-1"></a>            iLowerRange <span class="ot">&lt;-</span> min <span class="sc">-</span> <span class="fl">0.01</span></span>
<span id="cb7-1527"><a href="#cb7-1527" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-1528"><a href="#cb7-1528" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (plotRsquared <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb7-1529"><a href="#cb7-1529" aria-hidden="true" tabindex="-1"></a>            iUpperRange <span class="ot">&lt;-</span> max <span class="sc">+</span> <span class="fl">0.1</span></span>
<span id="cb7-1530"><a href="#cb7-1530" aria-hidden="true" tabindex="-1"></a>            iLowerRange <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb7-1531"><a href="#cb7-1531" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-1532"><a href="#cb7-1532" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1533"><a href="#cb7-1533" aria-hidden="true" tabindex="-1"></a>    cols <span class="ot">&lt;-</span> <span class="fu">colorRampPalette</span>(col)</span>
<span id="cb7-1534"><a href="#cb7-1534" aria-hidden="true" tabindex="-1"></a>    signif <span class="ot">&lt;-</span> corvals</span>
<span id="cb7-1535"><a href="#cb7-1535" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">ncol</span>(pvals))) {</span>
<span id="cb7-1536"><a href="#cb7-1536" aria-hidden="true" tabindex="-1"></a>        signif[, i] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">symnum</span>(</span>
<span id="cb7-1537"><a href="#cb7-1537" aria-hidden="true" tabindex="-1"></a>            pvals[, i], </span>
<span id="cb7-1538"><a href="#cb7-1538" aria-hidden="true" tabindex="-1"></a>            <span class="at">corr =</span> <span class="cn">FALSE</span>, </span>
<span id="cb7-1539"><a href="#cb7-1539" aria-hidden="true" tabindex="-1"></a>            <span class="at">na =</span> <span class="cn">FALSE</span>, </span>
<span id="cb7-1540"><a href="#cb7-1540" aria-hidden="true" tabindex="-1"></a>            <span class="at">cutpoints =</span> signifCutpoints, </span>
<span id="cb7-1541"><a href="#cb7-1541" aria-hidden="true" tabindex="-1"></a>            <span class="at">symbols =</span> signifSymbols</span>
<span id="cb7-1542"><a href="#cb7-1542" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb7-1543"><a href="#cb7-1543" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1544"><a href="#cb7-1544" aria-hidden="true" tabindex="-1"></a>    plotLabels <span class="ot">&lt;-</span> corvals</span>
<span id="cb7-1545"><a href="#cb7-1545" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(corvals))) {</span>
<span id="cb7-1546"><a href="#cb7-1546" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">ncol</span>(corvals))) {</span>
<span id="cb7-1547"><a href="#cb7-1547" aria-hidden="true" tabindex="-1"></a>            plotLabels[i, j] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">round</span>(corvals[i, j], <span class="dv">2</span>))</span>
<span id="cb7-1548"><a href="#cb7-1548" aria-hidden="true" tabindex="-1"></a>            <span class="co"># remove the stars from the plot</span></span>
<span id="cb7-1549"><a href="#cb7-1549" aria-hidden="true" tabindex="-1"></a>            <span class="co">#, #signif[i, j], sep = "")</span></span>
<span id="cb7-1550"><a href="#cb7-1550" aria-hidden="true" tabindex="-1"></a>            <span class="fu">colnames</span>(plotLabels)[j] <span class="ot">&lt;-</span> <span class="fu">colnames</span>(corvals)[j]</span>
<span id="cb7-1551"><a href="#cb7-1551" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-1552"><a href="#cb7-1552" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rownames</span>(plotLabels)[i] <span class="ot">&lt;-</span> <span class="fu">rownames</span>(corvals)[i]</span>
<span id="cb7-1553"><a href="#cb7-1553" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1554"><a href="#cb7-1554" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (posLab <span class="sc">==</span> <span class="st">"bottomleft"</span>) {</span>
<span id="cb7-1555"><a href="#cb7-1555" aria-hidden="true" tabindex="-1"></a>        posLab <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb7-1556"><a href="#cb7-1556" aria-hidden="true" tabindex="-1"></a>        axisTicks <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb7-1557"><a href="#cb7-1557" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1558"><a href="#cb7-1558" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (posLab <span class="sc">==</span> <span class="st">"topright"</span>) {</span>
<span id="cb7-1559"><a href="#cb7-1559" aria-hidden="true" tabindex="-1"></a>        posLab <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb7-1560"><a href="#cb7-1560" aria-hidden="true" tabindex="-1"></a>        axisTicks <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb7-1561"><a href="#cb7-1561" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1562"><a href="#cb7-1562" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (posLab <span class="sc">==</span> <span class="st">"all"</span>) {</span>
<span id="cb7-1563"><a href="#cb7-1563" aria-hidden="true" tabindex="-1"></a>        posLab <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb7-1564"><a href="#cb7-1564" aria-hidden="true" tabindex="-1"></a>        axisTicks <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb7-1565"><a href="#cb7-1565" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1566"><a href="#cb7-1566" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (posLab <span class="sc">==</span> <span class="st">"none"</span>) {</span>
<span id="cb7-1567"><a href="#cb7-1567" aria-hidden="true" tabindex="-1"></a>        posLab <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb7-1568"><a href="#cb7-1568" aria-hidden="true" tabindex="-1"></a>        axisTicks <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb7-1569"><a href="#cb7-1569" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1570"><a href="#cb7-1570" aria-hidden="true" tabindex="-1"></a>    labels <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, z, ...) {</span>
<span id="cb7-1571"><a href="#cb7-1571" aria-hidden="true" tabindex="-1"></a>        <span class="fu">panel.levelplot</span>(x, y, z, ...)</span>
<span id="cb7-1572"><a href="#cb7-1572" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ltext</span>(x, y, <span class="at">labels =</span> plotLabels, <span class="at">cex =</span> cexCorval, <span class="at">col =</span> colCorval, </span>
<span id="cb7-1573"><a href="#cb7-1573" aria-hidden="true" tabindex="-1"></a>            <span class="at">font =</span> fontCorval)</span>
<span id="cb7-1574"><a href="#cb7-1574" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1575"><a href="#cb7-1575" aria-hidden="true" tabindex="-1"></a>    l <span class="ot">&lt;-</span> <span class="fu">levelplot</span>(<span class="fu">data.matrix</span>(corvals), <span class="at">xlab =</span> <span class="fu">list</span>(<span class="at">label =</span> titleX, </span>
<span id="cb7-1576"><a href="#cb7-1576" aria-hidden="true" tabindex="-1"></a>        <span class="at">cex =</span> cexTitleX, <span class="at">rot =</span> rotTitleX, <span class="at">col =</span> colTitleX, <span class="at">font =</span> fontTitleX), </span>
<span id="cb7-1577"><a href="#cb7-1577" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab =</span> <span class="fu">list</span>(<span class="at">label =</span> titleY, <span class="at">cex =</span> cexTitleY, <span class="at">rot =</span> rotTitleY, </span>
<span id="cb7-1578"><a href="#cb7-1578" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> colTitleY, <span class="at">font =</span> fontTitleY), <span class="at">panel =</span> labels, </span>
<span id="cb7-1579"><a href="#cb7-1579" aria-hidden="true" tabindex="-1"></a>        <span class="at">pretty =</span> <span class="cn">TRUE</span>, <span class="at">par.settings =</span> <span class="fu">list</span>(<span class="at">panel.background =</span> <span class="fu">list</span>(<span class="at">col =</span> colFrame)), </span>
<span id="cb7-1580"><a href="#cb7-1580" aria-hidden="true" tabindex="-1"></a>        <span class="at">scales =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">list</span>(<span class="at">cex =</span> cexLabX, <span class="at">rot =</span> rotLabX, </span>
<span id="cb7-1581"><a href="#cb7-1581" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> colLabX, <span class="at">font =</span> fontLabX), <span class="at">y =</span> <span class="fu">list</span>(<span class="at">cex =</span> cexLabY, </span>
<span id="cb7-1582"><a href="#cb7-1582" aria-hidden="true" tabindex="-1"></a>            <span class="at">rot =</span> rotLabY, <span class="at">col =</span> colLabY, <span class="at">font =</span> fontLabY), <span class="at">tck =</span> axisTicks, </span>
<span id="cb7-1583"><a href="#cb7-1583" aria-hidden="true" tabindex="-1"></a>            <span class="at">alternating =</span> posLab), <span class="at">aspect =</span> <span class="st">"fill"</span>, <span class="at">col.regions =</span> cols, </span>
<span id="cb7-1584"><a href="#cb7-1584" aria-hidden="true" tabindex="-1"></a>        <span class="at">cuts =</span> <span class="dv">100</span>, <span class="at">at =</span> <span class="fu">seq</span>(iLowerRange, iUpperRange, <span class="fl">0.01</span>), </span>
<span id="cb7-1585"><a href="#cb7-1585" aria-hidden="true" tabindex="-1"></a>        <span class="at">main =</span> <span class="fu">list</span>(<span class="at">label =</span> main, <span class="at">cex =</span> cexMain, <span class="at">rot =</span> rotMain, </span>
<span id="cb7-1586"><a href="#cb7-1586" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> colMain, <span class="at">font =</span> fontMain), <span class="at">colorkey =</span> <span class="fu">list</span>(<span class="at">space =</span> posColKey, </span>
<span id="cb7-1587"><a href="#cb7-1587" aria-hidden="true" tabindex="-1"></a>            <span class="at">labels =</span> <span class="fu">list</span>(<span class="at">cex =</span> cexLabColKey)))</span>
<span id="cb7-1588"><a href="#cb7-1588" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (returnPlot <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb7-1589"><a href="#cb7-1589" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(l)</span>
<span id="cb7-1590"><a href="#cb7-1590" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1591"><a href="#cb7-1591" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (returnPlot <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb7-1592"><a href="#cb7-1592" aria-hidden="true" tabindex="-1"></a>        l</span>
<span id="cb7-1593"><a href="#cb7-1593" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-1594"><a href="#cb7-1594" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-1595"><a href="#cb7-1595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1596"><a href="#cb7-1596" aria-hidden="true" tabindex="-1"></a><span class="fu">eigencorplot</span>(</span>
<span id="cb7-1597"><a href="#cb7-1597" aria-hidden="true" tabindex="-1"></a>    pca_fit,</span>
<span id="cb7-1598"><a href="#cb7-1598" aria-hidden="true" tabindex="-1"></a>    <span class="at">components =</span> <span class="fu">getComponents</span>(pca_fit, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb7-1599"><a href="#cb7-1599" aria-hidden="true" tabindex="-1"></a>    <span class="at">metavars =</span> <span class="fu">c</span>(</span>
<span id="cb7-1600"><a href="#cb7-1600" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Cohort"</span>, <span class="st">"Node Stage"</span>, <span class="st">"NPI"</span>,</span>
<span id="cb7-1601"><a href="#cb7-1601" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Inferred Menopausal State"</span>, <span class="st">"Tumor Purity"</span>, </span>
<span id="cb7-1602"><a href="#cb7-1602" aria-hidden="true" tabindex="-1"></a>        <span class="st">"ER status"</span>, <span class="st">"Age"</span></span>
<span id="cb7-1603"><a href="#cb7-1603" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb7-1604"><a href="#cb7-1604" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'white'</span>, <span class="st">'cornsilk1'</span>, <span class="st">'gold'</span>, <span class="st">'forestgreen'</span>, <span class="st">'darkgreen'</span>),</span>
<span id="cb7-1605"><a href="#cb7-1605" aria-hidden="true" tabindex="-1"></a>    <span class="at">cexCorval =</span> <span class="fl">1.2</span>,</span>
<span id="cb7-1606"><a href="#cb7-1606" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontCorval =</span> <span class="dv">2</span>,</span>
<span id="cb7-1607"><a href="#cb7-1607" aria-hidden="true" tabindex="-1"></a>    <span class="at">rotLabX =</span> <span class="dv">45</span>,</span>
<span id="cb7-1608"><a href="#cb7-1608" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-1609"><a href="#cb7-1609" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="fu">bquote</span>(Principal <span class="sc">~</span> component <span class="sc">~</span> Pearson <span class="sc">~</span> r<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb7-1610"><a href="#cb7-1610" aria-hidden="true" tabindex="-1"></a>    <span class="at">plotRsquared =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-1611"><a href="#cb7-1611" aria-hidden="true" tabindex="-1"></a>    <span class="at">corFUN =</span> <span class="st">'pearson'</span>,</span>
<span id="cb7-1612"><a href="#cb7-1612" aria-hidden="true" tabindex="-1"></a>    <span class="at">corMultipleTestCorrection =</span> <span class="st">'BH'</span></span>
<span id="cb7-1613"><a href="#cb7-1613" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-1614"><a href="#cb7-1614" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1615"><a href="#cb7-1615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1616"><a href="#cb7-1616" aria-hidden="true" tabindex="-1"></a>We see that the two biggest correlations is with cohort and PC1/PC2 as </span>
<span id="cb7-1617"><a href="#cb7-1617" aria-hidden="true" tabindex="-1"></a>expected. There is a bit of correlation of NPI and PC3, since basal-like</span>
<span id="cb7-1618"><a href="#cb7-1618" aria-hidden="true" tabindex="-1"></a>tumors have usually higher NPI scores, they are more aggressive. Also,</span>
<span id="cb7-1619"><a href="#cb7-1619" aria-hidden="true" tabindex="-1"></a>as expected ER status has a pretty high correlation with PC3 since</span>
<span id="cb7-1620"><a href="#cb7-1620" aria-hidden="true" tabindex="-1"></a>the basal like are on the left of the principal component and the luminal A/B</span>
<span id="cb7-1621"><a href="#cb7-1621" aria-hidden="true" tabindex="-1"></a>are on the right region.</span>
<span id="cb7-1622"><a href="#cb7-1622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1623"><a href="#cb7-1623" aria-hidden="true" tabindex="-1"></a>Moreover, basal-like tumors are more pure compared to the luminal A.</span>
<span id="cb7-1624"><a href="#cb7-1624" aria-hidden="true" tabindex="-1"></a>For the luminal A subtype the amount of tumors that are high or moderate</span>
<span id="cb7-1625"><a href="#cb7-1625" aria-hidden="true" tabindex="-1"></a>in terms of purity are balanced (around 45%). In all subtypes, the amount of</span>
<span id="cb7-1626"><a href="#cb7-1626" aria-hidden="true" tabindex="-1"></a>samples with low tumor purity are overall low, excluding the normal-like and</span>
<span id="cb7-1627"><a href="#cb7-1627" aria-hidden="true" tabindex="-1"></a>claudin-low.</span>
<span id="cb7-1628"><a href="#cb7-1628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1631"><a href="#cb7-1631" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-1632"><a href="#cb7-1632" aria-hidden="true" tabindex="-1"></a>df_pca_coordinates <span class="sc">%&gt;%</span></span>
<span id="cb7-1633"><a href="#cb7-1633" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(CELLULARITY) <span class="sc">&amp;</span> CELLULARITY <span class="sc">!=</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-1634"><a href="#cb7-1634" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">tabyl</span>(CELLULARITY, pam50) <span class="sc">%&gt;%</span></span>
<span id="cb7-1635"><a href="#cb7-1635" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">adorn_totals</span>(<span class="st">"row"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-1636"><a href="#cb7-1636" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">adorn_percentages</span>(<span class="st">"col"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-1637"><a href="#cb7-1637" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">adorn_pct_formatting</span>(<span class="at">digits =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-1638"><a href="#cb7-1638" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">adorn_ns</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-1639"><a href="#cb7-1639" aria-hidden="true" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kbl</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-1640"><a href="#cb7-1640" aria-hidden="true" tabindex="-1"></a>    kableExtra<span class="sc">::</span><span class="fu">kable_classic</span>()</span>
<span id="cb7-1641"><a href="#cb7-1641" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1642"><a href="#cb7-1642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1643"><a href="#cb7-1643" aria-hidden="true" tabindex="-1"></a>Next we just show the $r^2$ pearson residuals for the SCAN-B, an external</span>
<span id="cb7-1644"><a href="#cb7-1644" aria-hidden="true" tabindex="-1"></a>cohort.</span>
<span id="cb7-1645"><a href="#cb7-1645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1646"><a href="#cb7-1646" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=8, fig.height=4}</span></span>
<span id="cb7-1647"><a href="#cb7-1647" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-molsub-scanb-pearson-pcs</span></span>
<span id="cb7-1648"><a href="#cb7-1648" aria-hidden="true" tabindex="-1"></a>molecular_subtypes <span class="ot">&lt;-</span> <span class="fu">levels</span>(pca_fit<span class="sc">$</span>metadata<span class="sc">$</span>pam50) <span class="sc">%&gt;%</span></span>
<span id="cb7-1649"><a href="#cb7-1649" aria-hidden="true" tabindex="-1"></a>    .[. <span class="sc">!=</span> <span class="st">"claudin-low"</span>]</span>
<span id="cb7-1650"><a href="#cb7-1650" aria-hidden="true" tabindex="-1"></a>pca_fit_cor_plot <span class="ot">&lt;-</span> pca_fit</span>
<span id="cb7-1651"><a href="#cb7-1651" aria-hidden="true" tabindex="-1"></a>which_cohorts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"scanb"</span>)</span>
<span id="cb7-1652"><a href="#cb7-1652" aria-hidden="true" tabindex="-1"></a>pca_fit_cor_plot<span class="sc">$</span>rotated <span class="ot">&lt;-</span> df_pca_coordinates <span class="sc">%&gt;%</span></span>
<span id="cb7-1653"><a href="#cb7-1653" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> which_cohorts) <span class="sc">%&gt;%</span></span>
<span id="cb7-1654"><a href="#cb7-1654" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>)))</span>
<span id="cb7-1655"><a href="#cb7-1655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1656"><a href="#cb7-1656" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(pca_fit_cor_plot<span class="sc">$</span>rotated) <span class="ot">&lt;-</span> df_pca_coordinates <span class="sc">%&gt;%</span></span>
<span id="cb7-1657"><a href="#cb7-1657" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> which_cohorts) <span class="sc">%&gt;%</span></span>
<span id="cb7-1658"><a href="#cb7-1658" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(sample_name)</span>
<span id="cb7-1659"><a href="#cb7-1659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1660"><a href="#cb7-1660" aria-hidden="true" tabindex="-1"></a>pca_fit_cor_plot<span class="sc">$</span>metadata <span class="ot">&lt;-</span> df_pca_coordinates <span class="sc">%&gt;%</span></span>
<span id="cb7-1661"><a href="#cb7-1661" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> which_cohorts)</span>
<span id="cb7-1662"><a href="#cb7-1662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1663"><a href="#cb7-1663" aria-hidden="true" tabindex="-1"></a>pca_fit_cor_plot<span class="sc">$</span>metadata <span class="ot">&lt;-</span> pca_fit_cor_plot<span class="sc">$</span>metadata <span class="sc">%&gt;%</span></span>
<span id="cb7-1664"><a href="#cb7-1664" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">value =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-1665"><a href="#cb7-1665" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb7-1666"><a href="#cb7-1666" aria-hidden="true" tabindex="-1"></a>        <span class="at">id_cols =</span> dplyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="fu">setdiff</span>(<span class="fu">colnames</span>(.), <span class="fu">c</span>(<span class="st">"pam50"</span>))),</span>
<span id="cb7-1667"><a href="#cb7-1667" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_from =</span> <span class="st">"pam50"</span>,</span>
<span id="cb7-1668"><a href="#cb7-1668" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_from =</span> <span class="st">"pam50"</span>,</span>
<span id="cb7-1669"><a href="#cb7-1669" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_fn =</span> \(x) <span class="fu">as.double</span>(<span class="fu">length</span>(x)),</span>
<span id="cb7-1670"><a href="#cb7-1670" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_fill =</span> <span class="sc">-</span><span class="fl">1.</span></span>
<span id="cb7-1671"><a href="#cb7-1671" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-1672"><a href="#cb7-1672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1673"><a href="#cb7-1673" aria-hidden="true" tabindex="-1"></a><span class="fu">eigencorplot</span>(</span>
<span id="cb7-1674"><a href="#cb7-1674" aria-hidden="true" tabindex="-1"></a>    pca_fit_cor_plot,</span>
<span id="cb7-1675"><a href="#cb7-1675" aria-hidden="true" tabindex="-1"></a>    <span class="at">components =</span> <span class="fu">getComponents</span>(pca_fit_cor_plot, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>),</span>
<span id="cb7-1676"><a href="#cb7-1676" aria-hidden="true" tabindex="-1"></a>    <span class="at">metavars =</span> molecular_subtypes,</span>
<span id="cb7-1677"><a href="#cb7-1677" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="fu">c</span>(<span class="st">'white'</span>, <span class="st">'cornsilk1'</span>, <span class="st">'gold'</span>, <span class="st">'forestgreen'</span>, <span class="st">'darkgreen'</span>),</span>
<span id="cb7-1678"><a href="#cb7-1678" aria-hidden="true" tabindex="-1"></a>    <span class="at">cexCorval =</span> <span class="fl">1.2</span>,</span>
<span id="cb7-1679"><a href="#cb7-1679" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontCorval =</span> <span class="dv">2</span>,</span>
<span id="cb7-1680"><a href="#cb7-1680" aria-hidden="true" tabindex="-1"></a>    <span class="at">rotLabX =</span> <span class="dv">45</span>,</span>
<span id="cb7-1681"><a href="#cb7-1681" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-1682"><a href="#cb7-1682" aria-hidden="true" tabindex="-1"></a>    <span class="at">main =</span> <span class="fu">bquote</span>(Principal <span class="sc">~</span> component <span class="sc">~</span> Pearson <span class="sc">~</span> r<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb7-1683"><a href="#cb7-1683" aria-hidden="true" tabindex="-1"></a>    <span class="at">plotRsquared =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-1684"><a href="#cb7-1684" aria-hidden="true" tabindex="-1"></a>    <span class="at">corFUN =</span> <span class="st">'pearson'</span>,</span>
<span id="cb7-1685"><a href="#cb7-1685" aria-hidden="true" tabindex="-1"></a>    <span class="at">corMultipleTestCorrection =</span> <span class="st">'BH'</span></span>
<span id="cb7-1686"><a href="#cb7-1686" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-1687"><a href="#cb7-1687" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1688"><a href="#cb7-1688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1689"><a href="#cb7-1689" aria-hidden="true" tabindex="-1"></a>We see that the majority of the residuals are explained in PC3 and PC4, as</span>
<span id="cb7-1690"><a href="#cb7-1690" aria-hidden="true" tabindex="-1"></a>expected. The HER2 seems to have a similar correlation in PC3 and PC7.</span>
<span id="cb7-1691"><a href="#cb7-1691" aria-hidden="true" tabindex="-1"></a>Below we plot only basal-like, luminal B and HER2 enriched </span>
<span id="cb7-1692"><a href="#cb7-1692" aria-hidden="true" tabindex="-1"></a>tumor samples to compare.</span>
<span id="cb7-1693"><a href="#cb7-1693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1696"><a href="#cb7-1696" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-1697"><a href="#cb7-1697" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-1698"><a href="#cb7-1698" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(sample_name <span class="sc">%in%</span> <span class="fu">rownames</span>(pca_fit_cor_plot<span class="sc">$</span>rotated)) <span class="sc">%&gt;%</span></span>
<span id="cb7-1699"><a href="#cb7-1699" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())) <span class="sc">%&gt;%</span></span>
<span id="cb7-1700"><a href="#cb7-1700" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(pam50 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"her2"</span>, <span class="st">"basal"</span>, <span class="st">"lumb"</span>))</span>
<span id="cb7-1701"><a href="#cb7-1701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1702"><a href="#cb7-1702" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pca_coordinates</span>(</span>
<span id="cb7-1703"><a href="#cb7-1703" aria-hidden="true" tabindex="-1"></a>    df,</span>
<span id="cb7-1704"><a href="#cb7-1704" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"pam50"</span>,</span>
<span id="cb7-1705"><a href="#cb7-1705" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-1706"><a href="#cb7-1706" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC7"</span>,</span>
<span id="cb7-1707"><a href="#cb7-1707" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb7-1708"><a href="#cb7-1708" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb7-1709"><a href="#cb7-1709" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-1710"><a href="#cb7-1710" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Embedding of all samples from SCAN-B"</span></span>
<span id="cb7-1711"><a href="#cb7-1711" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-1712"><a href="#cb7-1712" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb7-1713"><a href="#cb7-1713" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb7-1714"><a href="#cb7-1714" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Molecular</span><span class="sc">\n</span><span class="st">subtype"</span>) <span class="sc">+</span> </span>
<span id="cb7-1715"><a href="#cb7-1715" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1716"><a href="#cb7-1716" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-1717"><a href="#cb7-1717" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>()</span>
<span id="cb7-1718"><a href="#cb7-1718" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1719"><a href="#cb7-1719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1720"><a href="#cb7-1720" aria-hidden="true" tabindex="-1"></a>In fact the difference is mainly on PC3 and not so much on PC7. It is only</span>
<span id="cb7-1721"><a href="#cb7-1721" aria-hidden="true" tabindex="-1"></a>a subset of those samples that have lower PC7. And when</span>
<span id="cb7-1722"><a href="#cb7-1722" aria-hidden="true" tabindex="-1"></a>we compare PC3 vs PC4.</span>
<span id="cb7-1723"><a href="#cb7-1723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1726"><a href="#cb7-1726" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-1727"><a href="#cb7-1727" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_pca_coordinates</span>(</span>
<span id="cb7-1728"><a href="#cb7-1728" aria-hidden="true" tabindex="-1"></a>    df,</span>
<span id="cb7-1729"><a href="#cb7-1729" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"pam50"</span>,</span>
<span id="cb7-1730"><a href="#cb7-1730" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-1731"><a href="#cb7-1731" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-1732"><a href="#cb7-1732" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb7-1733"><a href="#cb7-1733" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb7-1734"><a href="#cb7-1734" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-1735"><a href="#cb7-1735" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Embedding of all samples from SCAN-B"</span></span>
<span id="cb7-1736"><a href="#cb7-1736" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-1737"><a href="#cb7-1737" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb7-1738"><a href="#cb7-1738" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb7-1739"><a href="#cb7-1739" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Molecular</span><span class="sc">\n</span><span class="st">subtype"</span>) <span class="sc">+</span> </span>
<span id="cb7-1740"><a href="#cb7-1740" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-1741"><a href="#cb7-1741" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-1742"><a href="#cb7-1742" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>()</span>
<span id="cb7-1743"><a href="#cb7-1743" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1744"><a href="#cb7-1744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1745"><a href="#cb7-1745" aria-hidden="true" tabindex="-1"></a>PC7 is not adding much in general to the separation.</span>
<span id="cb7-1746"><a href="#cb7-1746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1747"><a href="#cb7-1747" aria-hidden="true" tabindex="-1"></a><span class="fu">## The integration is robust with respect of selection of samples</span></span>
<span id="cb7-1748"><a href="#cb7-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1749"><a href="#cb7-1749" aria-hidden="true" tabindex="-1"></a>The embedding could be due to the patients selected and samples that are close</span>
<span id="cb7-1750"><a href="#cb7-1750" aria-hidden="true" tabindex="-1"></a>to each other in one embedding would be far away from them in another embedding.</span>
<span id="cb7-1751"><a href="#cb7-1751" aria-hidden="true" tabindex="-1"></a>Ten random sets of 1000 patients are sampled and the embedding is calculate. A</span>
<span id="cb7-1752"><a href="#cb7-1752" aria-hidden="true" tabindex="-1"></a>total of 10 PCA embeddings are obtained.</span>
<span id="cb7-1753"><a href="#cb7-1753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1754"><a href="#cb7-1754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1755"><a href="#cb7-1755" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, warning = FALSE, eval = first_run}</span></span>
<span id="cb7-1756"><a href="#cb7-1756" aria-hidden="true" tabindex="-1"></a>seeds <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">499</span>, <span class="at">by =</span> <span class="dv">20</span>)</span>
<span id="cb7-1757"><a href="#cb7-1757" aria-hidden="true" tabindex="-1"></a>new_pcas <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb7-1758"><a href="#cb7-1758" aria-hidden="true" tabindex="-1"></a>    seeds, </span>
<span id="cb7-1759"><a href="#cb7-1759" aria-hidden="true" tabindex="-1"></a>    get_new_pca, </span>
<span id="cb7-1760"><a href="#cb7-1760" aria-hidden="true" tabindex="-1"></a>    <span class="at">datasets_normalized =</span> datasets_normalized,</span>
<span id="cb7-1761"><a href="#cb7-1761" aria-hidden="true" tabindex="-1"></a>    <span class="at">merged_col_data =</span> merged_col_data,</span>
<span id="cb7-1762"><a href="#cb7-1762" aria-hidden="true" tabindex="-1"></a>    <span class="at">which_cohorts_training =</span> which_cohorts_training</span>
<span id="cb7-1763"><a href="#cb7-1763" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-1764"><a href="#cb7-1764" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(new_pcas) <span class="ot">&lt;-</span> <span class="fu">as.character</span>(seeds)</span>
<span id="cb7-1765"><a href="#cb7-1765" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb7-1766"><a href="#cb7-1766" aria-hidden="true" tabindex="-1"></a>    new_pcas,</span>
<span id="cb7-1767"><a href="#cb7-1767" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/rds_files/pca_merging/new_pcas.rds"</span></span>
<span id="cb7-1768"><a href="#cb7-1768" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-1769"><a href="#cb7-1769" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1770"><a href="#cb7-1770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1773"><a href="#cb7-1773" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-1774"><a href="#cb7-1774" aria-hidden="true" tabindex="-1"></a><span class="co"># plot PCA of random 50 samples using the new and original embeddings.</span></span>
<span id="cb7-1775"><a href="#cb7-1775" aria-hidden="true" tabindex="-1"></a>plot_pcas_together <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb7-1776"><a href="#cb7-1776" aria-hidden="true" tabindex="-1"></a>    new_pca_results, </span>
<span id="cb7-1777"><a href="#cb7-1777" aria-hidden="true" tabindex="-1"></a>    which_seed, </span>
<span id="cb7-1778"><a href="#cb7-1778" aria-hidden="true" tabindex="-1"></a>    test_og_pca, </span>
<span id="cb7-1779"><a href="#cb7-1779" aria-hidden="true" tabindex="-1"></a>    seed_nb,</span>
<span id="cb7-1780"><a href="#cb7-1780" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-1781"><a href="#cb7-1781" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-1782"><a href="#cb7-1782" aria-hidden="true" tabindex="-1"></a>    <span class="at">size_point =</span> <span class="dv">3</span>,</span>
<span id="cb7-1783"><a href="#cb7-1783" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">30</span>,</span>
<span id="cb7-1784"><a href="#cb7-1784" aria-hidden="true" tabindex="-1"></a>    <span class="at">nb_samples =</span> <span class="dv">50</span></span>
<span id="cb7-1785"><a href="#cb7-1785" aria-hidden="true" tabindex="-1"></a>){</span>
<span id="cb7-1786"><a href="#cb7-1786" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-1787"><a href="#cb7-1787" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(seed_nb)</span>
<span id="cb7-1788"><a href="#cb7-1788" aria-hidden="true" tabindex="-1"></a>    random_samples <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="at">x =</span> test_og_pca<span class="sc">$</span>sample_name, <span class="at">size =</span> nb_samples)</span>
<span id="cb7-1789"><a href="#cb7-1789" aria-hidden="true" tabindex="-1"></a>    new_pca_results <span class="ot">&lt;-</span> new_pca_results[[which_seed]]<span class="sc">$</span>test <span class="sc">%&gt;%</span></span>
<span id="cb7-1790"><a href="#cb7-1790" aria-hidden="true" tabindex="-1"></a>        <span class="fu">do.call</span>(rbind, .)</span>
<span id="cb7-1791"><a href="#cb7-1791" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-1792"><a href="#cb7-1792" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb7-1793"><a href="#cb7-1793" aria-hidden="true" tabindex="-1"></a>        <span class="st">"og_pca"</span> <span class="ot">=</span> test_og_pca[random_samples, <span class="fu">c</span>(<span class="st">"PC3"</span>, <span class="st">"PC4"</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb7-1794"><a href="#cb7-1794" aria-hidden="true" tabindex="-1"></a>            data.frame <span class="sc">%&gt;%</span></span>
<span id="cb7-1795"><a href="#cb7-1795" aria-hidden="true" tabindex="-1"></a>            tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_name"</span>),</span>
<span id="cb7-1796"><a href="#cb7-1796" aria-hidden="true" tabindex="-1"></a>        <span class="st">"new_pca"</span> <span class="ot">=</span> new_pca_results[random_samples, <span class="fu">c</span>(<span class="st">"PC3"</span>, <span class="st">"PC4"</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb7-1797"><a href="#cb7-1797" aria-hidden="true" tabindex="-1"></a>            data.frame <span class="sc">%&gt;%</span></span>
<span id="cb7-1798"><a href="#cb7-1798" aria-hidden="true" tabindex="-1"></a>            tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_name"</span>)</span>
<span id="cb7-1799"><a href="#cb7-1799" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb7-1800"><a href="#cb7-1800" aria-hidden="true" tabindex="-1"></a>        <span class="at">.id =</span> <span class="st">"type_data"</span></span>
<span id="cb7-1801"><a href="#cb7-1801" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-1802"><a href="#cb7-1802" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes_string</span>(</span>
<span id="cb7-1803"><a href="#cb7-1803" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> x, </span>
<span id="cb7-1804"><a href="#cb7-1804" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> y, </span>
<span id="cb7-1805"><a href="#cb7-1805" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"type_data"</span>, </span>
<span id="cb7-1806"><a href="#cb7-1806" aria-hidden="true" tabindex="-1"></a>            <span class="at">group =</span> <span class="st">"sample_name"</span></span>
<span id="cb7-1807"><a href="#cb7-1807" aria-hidden="true" tabindex="-1"></a>        )) <span class="sc">+</span> </span>
<span id="cb7-1808"><a href="#cb7-1808" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">size =</span> size_point) <span class="sc">+</span> </span>
<span id="cb7-1809"><a href="#cb7-1809" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span> </span>
<span id="cb7-1810"><a href="#cb7-1810" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste0</span>(<span class="st">"Seed nb: "</span>, which_seed)) <span class="sc">+</span> </span>
<span id="cb7-1811"><a href="#cb7-1811" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> base_size) <span class="sc">+</span> </span>
<span id="cb7-1812"><a href="#cb7-1812" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ggplot2::theme(legend.position = c(0.2, 0.7)) +</span></span>
<span id="cb7-1813"><a href="#cb7-1813" aria-hidden="true" tabindex="-1"></a>        ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb7-1814"><a href="#cb7-1814" aria-hidden="true" tabindex="-1"></a>        <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-1815"><a href="#cb7-1815" aria-hidden="true" tabindex="-1"></a>        <span class="fu">change_guides_point</span>()</span>
<span id="cb7-1816"><a href="#cb7-1816" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-1817"><a href="#cb7-1817" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1818"><a href="#cb7-1818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1819"><a href="#cb7-1819" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plots-pcas-random, fig.width=14, fig.height=10}</span></span>
<span id="cb7-1820"><a href="#cb7-1820" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-plots-pcas-random</span></span>
<span id="cb7-1821"><a href="#cb7-1821" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Selecting a random set of 1000 patients an rerunning the pipeline</span></span>
<span id="cb7-1822"><a href="#cb7-1822" aria-hidden="true" tabindex="-1"></a><span class="co">#|     to obtain other embeddings. Red color corresponds to the embedding using</span></span>
<span id="cb7-1823"><a href="#cb7-1823" aria-hidden="true" tabindex="-1"></a><span class="co">#|     the new fitted PCA. Blue corresponds to the embedding of the original</span></span>
<span id="cb7-1824"><a href="#cb7-1824" aria-hidden="true" tabindex="-1"></a><span class="co">#|     PCA. Each dot corresponds to a patient.  </span></span>
<span id="cb7-1825"><a href="#cb7-1825" aria-hidden="true" tabindex="-1"></a>plots_new_pcas <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb7-1826"><a href="#cb7-1826" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(new_pcas),</span>
<span id="cb7-1827"><a href="#cb7-1827" aria-hidden="true" tabindex="-1"></a>    plot_pcas_together,</span>
<span id="cb7-1828"><a href="#cb7-1828" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_pca_results =</span> new_pcas,</span>
<span id="cb7-1829"><a href="#cb7-1829" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_og_pca =</span> df_pca_coordinates <span class="sc">%&gt;%</span></span>
<span id="cb7-1830"><a href="#cb7-1830" aria-hidden="true" tabindex="-1"></a>        <span class="st">`</span><span class="at">rownames&lt;-</span><span class="st">`</span>(df_pca_coordinates<span class="sc">$</span>sample_name),</span>
<span id="cb7-1831"><a href="#cb7-1831" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed_nb =</span> <span class="dv">0923</span>, </span>
<span id="cb7-1832"><a href="#cb7-1832" aria-hidden="true" tabindex="-1"></a>    <span class="at">size_point =</span> <span class="dv">3</span>,</span>
<span id="cb7-1833"><a href="#cb7-1833" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">20</span>,</span>
<span id="cb7-1834"><a href="#cb7-1834" aria-hidden="true" tabindex="-1"></a>    <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-1835"><a href="#cb7-1835" aria-hidden="true" tabindex="-1"></a>    <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb7-1836"><a href="#cb7-1836" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-1837"><a href="#cb7-1837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1838"><a href="#cb7-1838" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">0823</span>)</span>
<span id="cb7-1839"><a href="#cb7-1839" aria-hidden="true" tabindex="-1"></a>plots_new_pcas_all <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(</span>
<span id="cb7-1840"><a href="#cb7-1840" aria-hidden="true" tabindex="-1"></a>    <span class="at">plotlist =</span> plots_new_pcas[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>, <span class="dv">4</span>) <span class="sc">%&gt;%</span> .[<span class="fu">order</span>(.)]], </span>
<span id="cb7-1841"><a href="#cb7-1841" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb7-1842"><a href="#cb7-1842" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-1843"><a href="#cb7-1843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1844"><a href="#cb7-1844" aria-hidden="true" tabindex="-1"></a>title_new_pcas <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb7-1845"><a href="#cb7-1845" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-1846"><a href="#cb7-1846" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-1847"><a href="#cb7-1847" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Original embedding in &lt;span style='color:#00BFC4;'&gt;"</span>,</span>
<span id="cb7-1848"><a href="#cb7-1848" aria-hidden="true" tabindex="-1"></a>            <span class="st">"blue&lt;/span&gt; and new embedding in &lt;span style='color:"</span>,</span>
<span id="cb7-1849"><a href="#cb7-1849" aria-hidden="true" tabindex="-1"></a>            <span class="st">"#F8766D;'&gt;red&lt;/span&gt;"</span></span>
<span id="cb7-1850"><a href="#cb7-1850" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-1851"><a href="#cb7-1851" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb7-1852"><a href="#cb7-1852" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb7-1853"><a href="#cb7-1853" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb7-1854"><a href="#cb7-1854" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_markdown</span>()</span>
<span id="cb7-1855"><a href="#cb7-1855" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb7-1856"><a href="#cb7-1856" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>()</span>
<span id="cb7-1857"><a href="#cb7-1857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1858"><a href="#cb7-1858" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1859"><a href="#cb7-1859" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(</span>
<span id="cb7-1860"><a href="#cb7-1860" aria-hidden="true" tabindex="-1"></a>    title_new_pcas, </span>
<span id="cb7-1861"><a href="#cb7-1861" aria-hidden="true" tabindex="-1"></a>    plots_new_pcas_all, </span>
<span id="cb7-1862"><a href="#cb7-1862" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">1</span>, </span>
<span id="cb7-1863"><a href="#cb7-1863" aria-hidden="true" tabindex="-1"></a>    <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="fl">0.12</span>, <span class="dv">1</span>)</span>
<span id="cb7-1864"><a href="#cb7-1864" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-1865"><a href="#cb7-1865" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1866"><a href="#cb7-1866" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1867"><a href="#cb7-1867" aria-hidden="true" tabindex="-1"></a>@fig-plots-pcas-random shows that the embedding is invariant for rotation,</span>
<span id="cb7-1868"><a href="#cb7-1868" aria-hidden="true" tabindex="-1"></a>translation and reflection for 4 random sets of samples coming</span>
<span id="cb7-1869"><a href="#cb7-1869" aria-hidden="true" tabindex="-1"></a>from either METABRIC or TCGA.</span>
<span id="cb7-1870"><a href="#cb7-1870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1871"><a href="#cb7-1871" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = first_run}</span></span>
<span id="cb7-1872"><a href="#cb7-1872" aria-hidden="true" tabindex="-1"></a>jaccard_indices <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb7-1873"><a href="#cb7-1873" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"metabric"</span>, <span class="st">"tcga"</span>), </span>
<span id="cb7-1874"><a href="#cb7-1874" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(which_cohort, nb_samples){</span>
<span id="cb7-1875"><a href="#cb7-1875" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1876"><a href="#cb7-1876" aria-hidden="true" tabindex="-1"></a>        <span class="co"># set the dataframe to be used</span></span>
<span id="cb7-1877"><a href="#cb7-1877" aria-hidden="true" tabindex="-1"></a>        df_jaccard <span class="ot">&lt;-</span> datasets_pca_coordinates[[which_cohort]]</span>
<span id="cb7-1878"><a href="#cb7-1878" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1879"><a href="#cb7-1879" aria-hidden="true" tabindex="-1"></a>        <span class="co"># use same seed for sampling to reproduce these results</span></span>
<span id="cb7-1880"><a href="#cb7-1880" aria-hidden="true" tabindex="-1"></a>        <span class="fu">set.seed</span>(<span class="dv">213</span>)</span>
<span id="cb7-1881"><a href="#cb7-1881" aria-hidden="true" tabindex="-1"></a>        sample_names <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">rownames</span>(df_jaccard), <span class="at">size =</span> nb_samples)</span>
<span id="cb7-1882"><a href="#cb7-1882" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1883"><a href="#cb7-1883" aria-hidden="true" tabindex="-1"></a>        <span class="co"># calculate the jaccard index. notice here we are using</span></span>
<span id="cb7-1884"><a href="#cb7-1884" aria-hidden="true" tabindex="-1"></a>        <span class="co"># a single seed only and a fixed radius. we iterate </span></span>
<span id="cb7-1885"><a href="#cb7-1885" aria-hidden="true" tabindex="-1"></a>        <span class="co"># this process with different seeds</span></span>
<span id="cb7-1886"><a href="#cb7-1886" aria-hidden="true" tabindex="-1"></a>        jaccard_index_neighbors <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">mclapply</span>(</span>
<span id="cb7-1887"><a href="#cb7-1887" aria-hidden="true" tabindex="-1"></a>            sample_names,</span>
<span id="cb7-1888"><a href="#cb7-1888" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(sample_name, radius, which_seed, which_cohort){</span>
<span id="cb7-1889"><a href="#cb7-1889" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-1890"><a href="#cb7-1890" aria-hidden="true" tabindex="-1"></a>                <span class="co"># samples in original embedding</span></span>
<span id="cb7-1891"><a href="#cb7-1891" aria-hidden="true" tabindex="-1"></a>                components_sample <span class="ot">&lt;-</span> df_jaccard[sample_name, <span class="fu">c</span>(<span class="st">"PC3"</span>, <span class="st">"PC4"</span>)] </span>
<span id="cb7-1892"><a href="#cb7-1892" aria-hidden="true" tabindex="-1"></a>                samples_neighborhood_og <span class="ot">&lt;-</span> <span class="fu">get_samples_neighborhood</span>(</span>
<span id="cb7-1893"><a href="#cb7-1893" aria-hidden="true" tabindex="-1"></a>                    components_sample,</span>
<span id="cb7-1894"><a href="#cb7-1894" aria-hidden="true" tabindex="-1"></a>                    sample_name,</span>
<span id="cb7-1895"><a href="#cb7-1895" aria-hidden="true" tabindex="-1"></a>                    <span class="at">radius =</span> radius,</span>
<span id="cb7-1896"><a href="#cb7-1896" aria-hidden="true" tabindex="-1"></a>                    <span class="at">df_pca =</span> df_jaccard <span class="sc">%&gt;%</span></span>
<span id="cb7-1897"><a href="#cb7-1897" aria-hidden="true" tabindex="-1"></a>                        data.frame <span class="sc">%&gt;%</span></span>
<span id="cb7-1898"><a href="#cb7-1898" aria-hidden="true" tabindex="-1"></a>                        tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_name"</span>)</span>
<span id="cb7-1899"><a href="#cb7-1899" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb7-1900"><a href="#cb7-1900" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1901"><a href="#cb7-1901" aria-hidden="true" tabindex="-1"></a>                <span class="co"># get samples in new embedding</span></span>
<span id="cb7-1902"><a href="#cb7-1902" aria-hidden="true" tabindex="-1"></a>                samples_neighborhood_new <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb7-1903"><a href="#cb7-1903" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">names</span>(new_pcas),</span>
<span id="cb7-1904"><a href="#cb7-1904" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">function</span>(which_seed){</span>
<span id="cb7-1905"><a href="#cb7-1905" aria-hidden="true" tabindex="-1"></a>                        components_sample <span class="ot">&lt;-</span> </span>
<span id="cb7-1906"><a href="#cb7-1906" aria-hidden="true" tabindex="-1"></a>                            new_pcas[[which_seed]]<span class="sc">$</span>test[[which_cohort]][</span>
<span id="cb7-1907"><a href="#cb7-1907" aria-hidden="true" tabindex="-1"></a>                                sample_name, </span>
<span id="cb7-1908"><a href="#cb7-1908" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">c</span>(<span class="st">"PC3"</span>, <span class="st">"PC4"</span>)</span>
<span id="cb7-1909"><a href="#cb7-1909" aria-hidden="true" tabindex="-1"></a>                            ] </span>
<span id="cb7-1910"><a href="#cb7-1910" aria-hidden="true" tabindex="-1"></a>                        samples_neighborhood_new <span class="ot">&lt;-</span> <span class="fu">get_samples_neighborhood</span>(</span>
<span id="cb7-1911"><a href="#cb7-1911" aria-hidden="true" tabindex="-1"></a>                            components_sample,</span>
<span id="cb7-1912"><a href="#cb7-1912" aria-hidden="true" tabindex="-1"></a>                            sample_name,</span>
<span id="cb7-1913"><a href="#cb7-1913" aria-hidden="true" tabindex="-1"></a>                            <span class="at">radius =</span> radius,</span>
<span id="cb7-1914"><a href="#cb7-1914" aria-hidden="true" tabindex="-1"></a>                            <span class="at">df_pca =</span> </span>
<span id="cb7-1915"><a href="#cb7-1915" aria-hidden="true" tabindex="-1"></a>                                new_pcas[[which_seed]]<span class="sc">$</span>test[[which_cohort]] <span class="sc">%&gt;%</span></span>
<span id="cb7-1916"><a href="#cb7-1916" aria-hidden="true" tabindex="-1"></a>                                data.frame <span class="sc">%&gt;%</span></span>
<span id="cb7-1917"><a href="#cb7-1917" aria-hidden="true" tabindex="-1"></a>                                tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_name"</span>)</span>
<span id="cb7-1918"><a href="#cb7-1918" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb7-1919"><a href="#cb7-1919" aria-hidden="true" tabindex="-1"></a>                                </span>
<span id="cb7-1920"><a href="#cb7-1920" aria-hidden="true" tabindex="-1"></a>                    },</span>
<span id="cb7-1921"><a href="#cb7-1921" aria-hidden="true" tabindex="-1"></a>                    <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-1922"><a href="#cb7-1922" aria-hidden="true" tabindex="-1"></a>                    <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb7-1923"><a href="#cb7-1923" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb7-1924"><a href="#cb7-1924" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1925"><a href="#cb7-1925" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-1926"><a href="#cb7-1926" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sapply</span>(</span>
<span id="cb7-1927"><a href="#cb7-1927" aria-hidden="true" tabindex="-1"></a>                    samples_neighborhood_new,</span>
<span id="cb7-1928"><a href="#cb7-1928" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">function</span>(neighborhood_new){</span>
<span id="cb7-1929"><a href="#cb7-1929" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb7-1930"><a href="#cb7-1930" aria-hidden="true" tabindex="-1"></a>                        <span class="co"># calculate the jaccard indices for all seeds</span></span>
<span id="cb7-1931"><a href="#cb7-1931" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">length</span>(<span class="fu">intersect</span>(</span>
<span id="cb7-1932"><a href="#cb7-1932" aria-hidden="true" tabindex="-1"></a>                            samples_neighborhood_og<span class="sc">$</span>samples,</span>
<span id="cb7-1933"><a href="#cb7-1933" aria-hidden="true" tabindex="-1"></a>                            neighborhood_new<span class="sc">$</span>samples</span>
<span id="cb7-1934"><a href="#cb7-1934" aria-hidden="true" tabindex="-1"></a>                        )) <span class="sc">/</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">c</span>(</span>
<span id="cb7-1935"><a href="#cb7-1935" aria-hidden="true" tabindex="-1"></a>                            samples_neighborhood_og<span class="sc">$</span>samples,</span>
<span id="cb7-1936"><a href="#cb7-1936" aria-hidden="true" tabindex="-1"></a>                            neighborhood_new<span class="sc">$</span>samples</span>
<span id="cb7-1937"><a href="#cb7-1937" aria-hidden="true" tabindex="-1"></a>                        ))) <span class="sc">%&gt;%</span></span>
<span id="cb7-1938"><a href="#cb7-1938" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">data.frame</span>(<span class="at">jaccard =</span> .)</span>
<span id="cb7-1939"><a href="#cb7-1939" aria-hidden="true" tabindex="-1"></a>                    },</span>
<span id="cb7-1940"><a href="#cb7-1940" aria-hidden="true" tabindex="-1"></a>                    <span class="at">simplify =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-1941"><a href="#cb7-1941" aria-hidden="true" tabindex="-1"></a>                    <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span></span>
<span id="cb7-1942"><a href="#cb7-1942" aria-hidden="true" tabindex="-1"></a>                ) <span class="sc">%&gt;%</span></span>
<span id="cb7-1943"><a href="#cb7-1943" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(., <span class="at">.id =</span> <span class="st">"which_seed"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-1944"><a href="#cb7-1944" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">sample_name =</span> sample_name)</span>
<span id="cb7-1945"><a href="#cb7-1945" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb7-1946"><a href="#cb7-1946" aria-hidden="true" tabindex="-1"></a>            <span class="at">radius =</span> <span class="dv">1</span>,</span>
<span id="cb7-1947"><a href="#cb7-1947" aria-hidden="true" tabindex="-1"></a>            <span class="at">which_seed =</span> <span class="st">"0"</span>,</span>
<span id="cb7-1948"><a href="#cb7-1948" aria-hidden="true" tabindex="-1"></a>            <span class="at">which_cohort =</span> which_cohort,</span>
<span id="cb7-1949"><a href="#cb7-1949" aria-hidden="true" tabindex="-1"></a>            <span class="at">mc.cores =</span> <span class="dv">5</span></span>
<span id="cb7-1950"><a href="#cb7-1950" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span></span>
<span id="cb7-1951"><a href="#cb7-1951" aria-hidden="true" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb7-1952"><a href="#cb7-1952" aria-hidden="true" tabindex="-1"></a>    }, </span>
<span id="cb7-1953"><a href="#cb7-1953" aria-hidden="true" tabindex="-1"></a>    <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span>, </span>
<span id="cb7-1954"><a href="#cb7-1954" aria-hidden="true" tabindex="-1"></a>    <span class="at">simplify =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-1955"><a href="#cb7-1955" aria-hidden="true" tabindex="-1"></a>    <span class="at">nb_samples =</span> <span class="dv">1000</span></span>
<span id="cb7-1956"><a href="#cb7-1956" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb7-1957"><a href="#cb7-1957" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(., <span class="at">.id =</span> <span class="st">"cohort"</span>)</span>
<span id="cb7-1958"><a href="#cb7-1958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1959"><a href="#cb7-1959" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb7-1960"><a href="#cb7-1960" aria-hidden="true" tabindex="-1"></a>    jaccard_indices,</span>
<span id="cb7-1961"><a href="#cb7-1961" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/rds_files/pca_merging/jaccard_indices.rds"</span></span>
<span id="cb7-1962"><a href="#cb7-1962" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-1963"><a href="#cb7-1963" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-1964"><a href="#cb7-1964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1965"><a href="#cb7-1965" aria-hidden="true" tabindex="-1"></a>@fig-jac-index shows the jaccard index distributions for each cohort</span>
<span id="cb7-1966"><a href="#cb7-1966" aria-hidden="true" tabindex="-1"></a>separately when comparing the sample neighborhoods of</span>
<span id="cb7-1967"><a href="#cb7-1967" aria-hidden="true" tabindex="-1"></a>the new embeddings with the</span>
<span id="cb7-1968"><a href="#cb7-1968" aria-hidden="true" tabindex="-1"></a>original embedding. The jaccard index is counting the </span>
<span id="cb7-1969"><a href="#cb7-1969" aria-hidden="true" tabindex="-1"></a>number of samples in the intersection of the neighborhoods in the original</span>
<span id="cb7-1970"><a href="#cb7-1970" aria-hidden="true" tabindex="-1"></a>and the new embedding divided by the total number of unique samples in both</span>
<span id="cb7-1971"><a href="#cb7-1971" aria-hidden="true" tabindex="-1"></a>neighborhoods. A high value means a good agreement with the </span>
<span id="cb7-1972"><a href="#cb7-1972" aria-hidden="true" tabindex="-1"></a>neighborhoods. </span>
<span id="cb7-1973"><a href="#cb7-1973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1974"><a href="#cb7-1974" aria-hidden="true" tabindex="-1"></a>A thousand samples were randomly selected from each</span>
<span id="cb7-1975"><a href="#cb7-1975" aria-hidden="true" tabindex="-1"></a>cohort individually and the jaccard index for each new embedding was </span>
<span id="cb7-1976"><a href="#cb7-1976" aria-hidden="true" tabindex="-1"></a>calculated.</span>
<span id="cb7-1977"><a href="#cb7-1977" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-1978"><a href="#cb7-1978" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=5, fig.height=6}</span></span>
<span id="cb7-1979"><a href="#cb7-1979" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-jac-index</span></span>
<span id="cb7-1980"><a href="#cb7-1980" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Jaccard index distribution for 1000 samples in each cohort</span></span>
<span id="cb7-1981"><a href="#cb7-1981" aria-hidden="true" tabindex="-1"></a><span class="co">#|     individually. Each color corresponds to a different seed and </span></span>
<span id="cb7-1982"><a href="#cb7-1982" aria-hidden="true" tabindex="-1"></a><span class="co">#|     embedding, with a total of 18 seeds.</span></span>
<span id="cb7-1983"><a href="#cb7-1983" aria-hidden="true" tabindex="-1"></a>jaccard_indices <span class="sc">%&gt;%</span> </span>
<span id="cb7-1984"><a href="#cb7-1984" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-1985"><a href="#cb7-1985" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> jaccard, <span class="at">fill =</span> which_seed)) <span class="sc">+</span> </span>
<span id="cb7-1986"><a href="#cb7-1986" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb7-1987"><a href="#cb7-1987" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(</span>
<span id="cb7-1988"><a href="#cb7-1988" aria-hidden="true" tabindex="-1"></a>        <span class="sc">~</span>cohort, </span>
<span id="cb7-1989"><a href="#cb7-1989" aria-hidden="true" tabindex="-1"></a>        <span class="at">scales =</span> <span class="st">"free_y"</span>, </span>
<span id="cb7-1990"><a href="#cb7-1990" aria-hidden="true" tabindex="-1"></a>        <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb7-1991"><a href="#cb7-1991" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(</span>
<span id="cb7-1992"><a href="#cb7-1992" aria-hidden="true" tabindex="-1"></a>            <span class="st">"tcga"</span> <span class="ot">=</span> <span class="st">"TCGA"</span>,</span>
<span id="cb7-1993"><a href="#cb7-1993" aria-hidden="true" tabindex="-1"></a>            <span class="st">"metabric"</span> <span class="ot">=</span> <span class="st">"METABRIC"</span></span>
<span id="cb7-1994"><a href="#cb7-1994" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb7-1995"><a href="#cb7-1995" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb7-1996"><a href="#cb7-1996" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-1997"><a href="#cb7-1997" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Jaccard Index"</span>,</span>
<span id="cb7-1998"><a href="#cb7-1998" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"Density"</span>,</span>
<span id="cb7-1999"><a href="#cb7-1999" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-2000"><a href="#cb7-2000" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Comparison of neighborhoods</span><span class="sc">\n</span><span class="st">for 1000 samples"</span></span>
<span id="cb7-2001"><a href="#cb7-2001" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb7-2002"><a href="#cb7-2002" aria-hidden="true" tabindex="-1"></a>        <span class="at">caption =</span> <span class="st">"Neighborhood with radius 1"</span></span>
<span id="cb7-2003"><a href="#cb7-2003" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb7-2004"><a href="#cb7-2004" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-2005"><a href="#cb7-2005" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb7-2006"><a href="#cb7-2006" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-2007"><a href="#cb7-2007" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>()</span>
<span id="cb7-2008"><a href="#cb7-2008" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-2009"><a href="#cb7-2009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2010"><a href="#cb7-2010" aria-hidden="true" tabindex="-1"></a>And below we show the standard deviation of the average of the distributions.</span>
<span id="cb7-2011"><a href="#cb7-2011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2014"><a href="#cb7-2014" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-2015"><a href="#cb7-2015" aria-hidden="true" tabindex="-1"></a>jaccard_indices <span class="sc">%&gt;%</span></span>
<span id="cb7-2016"><a href="#cb7-2016" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(jaccard)) <span class="sc">%&gt;%</span></span>
<span id="cb7-2017"><a href="#cb7-2017" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(which_seed) <span class="sc">%&gt;%</span></span>
<span id="cb7-2018"><a href="#cb7-2018" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb7-2019"><a href="#cb7-2019" aria-hidden="true" tabindex="-1"></a>        <span class="at">jaccard_mean =</span> <span class="fu">mean</span>(jaccard)</span>
<span id="cb7-2020"><a href="#cb7-2020" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-2021"><a href="#cb7-2021" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-2022"><a href="#cb7-2022" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb7-2023"><a href="#cb7-2023" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_of_jaccard_mean =</span> <span class="fu">mean</span>(jaccard_mean),</span>
<span id="cb7-2024"><a href="#cb7-2024" aria-hidden="true" tabindex="-1"></a>        <span class="at">sd_of_jaccard_mean =</span> <span class="fu">sd</span>(jaccard_mean)</span>
<span id="cb7-2025"><a href="#cb7-2025" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-2026"><a href="#cb7-2026" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-2027"><a href="#cb7-2027" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2028"><a href="#cb7-2028" aria-hidden="true" tabindex="-1"></a>This indicates a high agreement.</span>
<span id="cb7-2029"><a href="#cb7-2029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2030"><a href="#cb7-2030" aria-hidden="true" tabindex="-1"></a><span class="fu">## Normalization is necessary to reduce batch effects in other components</span></span>
<span id="cb7-2031"><a href="#cb7-2031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2032"><a href="#cb7-2032" aria-hidden="true" tabindex="-1"></a>Since PCA is removing batch effects from the datasets, one could argue it could</span>
<span id="cb7-2033"><a href="#cb7-2033" aria-hidden="true" tabindex="-1"></a>also remove platform dependent normalization values and therefore one would need</span>
<span id="cb7-2034"><a href="#cb7-2034" aria-hidden="true" tabindex="-1"></a>to look only at lower principal components. In this section we show that doing</span>
<span id="cb7-2035"><a href="#cb7-2035" aria-hidden="true" tabindex="-1"></a>the normalization is necessary to get a good integration in the datasets.</span>
<span id="cb7-2036"><a href="#cb7-2036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2037"><a href="#cb7-2037" aria-hidden="true" tabindex="-1"></a>The idea is similar as before, but instead of performing the *qPCR*-like</span>
<span id="cb7-2038"><a href="#cb7-2038" aria-hidden="true" tabindex="-1"></a>normalization on the datasets, one would use the logFPKM values for TCGA and</span>
<span id="cb7-2039"><a href="#cb7-2039" aria-hidden="true" tabindex="-1"></a>median intensity for microarray. The problem with this kind of approach also</span>
<span id="cb7-2040"><a href="#cb7-2040" aria-hidden="true" tabindex="-1"></a>includes the fact that only other samples that went through this processing</span>
<span id="cb7-2041"><a href="#cb7-2041" aria-hidden="true" tabindex="-1"></a>could be used in the pipeline.</span>
<span id="cb7-2042"><a href="#cb7-2042" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2045"><a href="#cb7-2045" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-2046"><a href="#cb7-2046" aria-hidden="true" tabindex="-1"></a>training_set <span class="ot">&lt;-</span> <span class="fu">mapply</span>( </span>
<span id="cb7-2047"><a href="#cb7-2047" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(sum_exp, i, genes_for_pca){</span>
<span id="cb7-2048"><a href="#cb7-2048" aria-hidden="true" tabindex="-1"></a>        <span class="fu">assay</span>(sum_exp[genes_for_pca, ], <span class="at">i =</span> i) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2049"><a href="#cb7-2049" aria-hidden="true" tabindex="-1"></a>            <span class="fu">data.frame</span>(<span class="at">check.names =</span> <span class="cn">FALSE</span>)    </span>
<span id="cb7-2050"><a href="#cb7-2050" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb7-2051"><a href="#cb7-2051" aria-hidden="true" tabindex="-1"></a>    datasets_normalized[which_cohorts_training],</span>
<span id="cb7-2052"><a href="#cb7-2052" aria-hidden="true" tabindex="-1"></a>    <span class="at">i =</span> which_exp[which_cohorts_training],</span>
<span id="cb7-2053"><a href="#cb7-2053" aria-hidden="true" tabindex="-1"></a>    <span class="at">MoreArgs =</span> <span class="fu">list</span>(<span class="at">genes_for_pca =</span> genes_for_pca),</span>
<span id="cb7-2054"><a href="#cb7-2054" aria-hidden="true" tabindex="-1"></a>    <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-2055"><a href="#cb7-2055" aria-hidden="true" tabindex="-1"></a>    <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span></span>
<span id="cb7-2056"><a href="#cb7-2056" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2057"><a href="#cb7-2057" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_cols</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-2058"><a href="#cb7-2058" aria-hidden="true" tabindex="-1"></a>    .[, samples_for_training]</span>
<span id="cb7-2059"><a href="#cb7-2059" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2060"><a href="#cb7-2060" aria-hidden="true" tabindex="-1"></a>pca_fit_no_norm <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">pca</span>(</span>
<span id="cb7-2061"><a href="#cb7-2061" aria-hidden="true" tabindex="-1"></a>    training_set,</span>
<span id="cb7-2062"><a href="#cb7-2062" aria-hidden="true" tabindex="-1"></a>    <span class="at">metadata =</span> merged_col_data <span class="sc">%&gt;%</span> </span>
<span id="cb7-2063"><a href="#cb7-2063" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(sample_name <span class="sc">%in%</span> <span class="fu">colnames</span>(training_set)) <span class="sc">%&gt;%</span></span>
<span id="cb7-2064"><a href="#cb7-2064" aria-hidden="true" tabindex="-1"></a>        .[<span class="fu">colnames</span>(training_set), ],</span>
<span id="cb7-2065"><a href="#cb7-2065" aria-hidden="true" tabindex="-1"></a>    <span class="at">center =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-2066"><a href="#cb7-2066" aria-hidden="true" tabindex="-1"></a>    <span class="at">scale =</span> <span class="cn">FALSE</span></span>
<span id="cb7-2067"><a href="#cb7-2067" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2068"><a href="#cb7-2068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2069"><a href="#cb7-2069" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb7-2070"><a href="#cb7-2070" aria-hidden="true" tabindex="-1"></a>    pca_fit_no_norm,</span>
<span id="cb7-2071"><a href="#cb7-2071" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/rds_files/pca_merging/pca_fit_no_norm.rds"</span></span>
<span id="cb7-2072"><a href="#cb7-2072" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2073"><a href="#cb7-2073" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-2074"><a href="#cb7-2074" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2075"><a href="#cb7-2075" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pca-no-norm, fig.width=14, fig.height=16}</span></span>
<span id="cb7-2076"><a href="#cb7-2076" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-no-norm</span></span>
<span id="cb7-2077"><a href="#cb7-2077" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: PCA projections colored by different factors and organized</span></span>
<span id="cb7-2078"><a href="#cb7-2078" aria-hidden="true" tabindex="-1"></a><span class="co">#|    by different components. (A) Plot of the first two components colored</span></span>
<span id="cb7-2079"><a href="#cb7-2079" aria-hidden="true" tabindex="-1"></a><span class="co">#|    by cohort. (B) Plot of the first two components colored by ER status.</span></span>
<span id="cb7-2080"><a href="#cb7-2080" aria-hidden="true" tabindex="-1"></a><span class="co">#|    (C) Plot of the second and third components colored by cohort. </span></span>
<span id="cb7-2081"><a href="#cb7-2081" aria-hidden="true" tabindex="-1"></a><span class="co">#|    (D) Plot of the second and third components colored by ER status.</span></span>
<span id="cb7-2082"><a href="#cb7-2082" aria-hidden="true" tabindex="-1"></a><span class="co">#|    (E) Plot of the second and third components colored by PAM50.</span></span>
<span id="cb7-2083"><a href="#cb7-2083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2084"><a href="#cb7-2084" aria-hidden="true" tabindex="-1"></a>plots_pca_fit <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb7-2085"><a href="#cb7-2085" aria-hidden="true" tabindex="-1"></a>point_size <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb7-2086"><a href="#cb7-2086" aria-hidden="true" tabindex="-1"></a>which_pca_fit <span class="ot">&lt;-</span> pca_fit_no_norm</span>
<span id="cb7-2087"><a href="#cb7-2087" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc1_pc2_cohort <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(</span>
<span id="cb7-2088"><a href="#cb7-2088" aria-hidden="true" tabindex="-1"></a>    pca_fit_no_norm,</span>
<span id="cb7-2089"><a href="#cb7-2089" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">"cohort"</span>,</span>
<span id="cb7-2090"><a href="#cb7-2090" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-2091"><a href="#cb7-2091" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">"right"</span>,</span>
<span id="cb7-2092"><a href="#cb7-2092" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC1"</span>,</span>
<span id="cb7-2093"><a href="#cb7-2093" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC2"</span>,</span>
<span id="cb7-2094"><a href="#cb7-2094" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"First two components colored by cohort"</span>,</span>
<span id="cb7-2095"><a href="#cb7-2095" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Only 1000 training samples, no qPCR normalization"</span>,</span>
<span id="cb7-2096"><a href="#cb7-2096" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> point_size</span>
<span id="cb7-2097"><a href="#cb7-2097" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2098"><a href="#cb7-2098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2099"><a href="#cb7-2099" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc1_pc2_er_status <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(</span>
<span id="cb7-2100"><a href="#cb7-2100" aria-hidden="true" tabindex="-1"></a>    pca_fit_no_norm,</span>
<span id="cb7-2101"><a href="#cb7-2101" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">"er_status"</span>,</span>
<span id="cb7-2102"><a href="#cb7-2102" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-2103"><a href="#cb7-2103" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">"right"</span>,</span>
<span id="cb7-2104"><a href="#cb7-2104" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC1"</span>,</span>
<span id="cb7-2105"><a href="#cb7-2105" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC2"</span>,</span>
<span id="cb7-2106"><a href="#cb7-2106" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"First two components colored by ER status"</span>,</span>
<span id="cb7-2107"><a href="#cb7-2107" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Only 1000 training samples"</span>,</span>
<span id="cb7-2108"><a href="#cb7-2108" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> point_size</span>
<span id="cb7-2109"><a href="#cb7-2109" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2110"><a href="#cb7-2110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2111"><a href="#cb7-2111" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc2_pc3_cohort <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(</span>
<span id="cb7-2112"><a href="#cb7-2112" aria-hidden="true" tabindex="-1"></a>    pca_fit_no_norm,</span>
<span id="cb7-2113"><a href="#cb7-2113" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">"cohort"</span>,</span>
<span id="cb7-2114"><a href="#cb7-2114" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-2115"><a href="#cb7-2115" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">"right"</span>,</span>
<span id="cb7-2116"><a href="#cb7-2116" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC2"</span>,</span>
<span id="cb7-2117"><a href="#cb7-2117" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-2118"><a href="#cb7-2118" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Second and third components colored by cohort"</span>,</span>
<span id="cb7-2119"><a href="#cb7-2119" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Only 1000 training samples"</span>,</span>
<span id="cb7-2120"><a href="#cb7-2120" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> point_size</span>
<span id="cb7-2121"><a href="#cb7-2121" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2122"><a href="#cb7-2122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2123"><a href="#cb7-2123" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc2_pc3_er_status <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(</span>
<span id="cb7-2124"><a href="#cb7-2124" aria-hidden="true" tabindex="-1"></a>    pca_fit_no_norm,</span>
<span id="cb7-2125"><a href="#cb7-2125" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">"er_status"</span>,</span>
<span id="cb7-2126"><a href="#cb7-2126" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-2127"><a href="#cb7-2127" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">"right"</span>,</span>
<span id="cb7-2128"><a href="#cb7-2128" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC2"</span>,</span>
<span id="cb7-2129"><a href="#cb7-2129" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-2130"><a href="#cb7-2130" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Second and third components colored by ER status"</span>,</span>
<span id="cb7-2131"><a href="#cb7-2131" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Only 1000 training samples"</span>,</span>
<span id="cb7-2132"><a href="#cb7-2132" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> point_size</span>
<span id="cb7-2133"><a href="#cb7-2133" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2134"><a href="#cb7-2134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2135"><a href="#cb7-2135" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc2_pc3_pam50 <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(</span>
<span id="cb7-2136"><a href="#cb7-2136" aria-hidden="true" tabindex="-1"></a>    pca_fit_no_norm,</span>
<span id="cb7-2137"><a href="#cb7-2137" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">"pam50"</span>,</span>
<span id="cb7-2138"><a href="#cb7-2138" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-2139"><a href="#cb7-2139" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">"right"</span>,</span>
<span id="cb7-2140"><a href="#cb7-2140" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC2"</span>,</span>
<span id="cb7-2141"><a href="#cb7-2141" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-2142"><a href="#cb7-2142" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Second and third components colored by PAM50"</span>,</span>
<span id="cb7-2143"><a href="#cb7-2143" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Only 1000 training samples"</span>,</span>
<span id="cb7-2144"><a href="#cb7-2144" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> point_size</span>
<span id="cb7-2145"><a href="#cb7-2145" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2146"><a href="#cb7-2146" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc2_pc3_pam50 <span class="ot">&lt;-</span> plots_pca_fit<span class="sc">$</span>pc2_pc3_pam50 <span class="sc">+</span></span>
<span id="cb7-2147"><a href="#cb7-2147" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(</span>
<span id="cb7-2148"><a href="#cb7-2148" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> <span class="fu">get_colors_pam50</span>(pca_fit_no_norm<span class="sc">$</span>metadata)</span>
<span id="cb7-2149"><a href="#cb7-2149" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb7-2150"><a href="#cb7-2150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2151"><a href="#cb7-2151" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc3_pc4_pam50 <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(</span>
<span id="cb7-2152"><a href="#cb7-2152" aria-hidden="true" tabindex="-1"></a>    pca_fit_no_norm,</span>
<span id="cb7-2153"><a href="#cb7-2153" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">"pam50"</span>,</span>
<span id="cb7-2154"><a href="#cb7-2154" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-2155"><a href="#cb7-2155" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">"right"</span>,</span>
<span id="cb7-2156"><a href="#cb7-2156" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-2157"><a href="#cb7-2157" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-2158"><a href="#cb7-2158" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Third and fourth components colored by PAM50"</span>,</span>
<span id="cb7-2159"><a href="#cb7-2159" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Only 1000 training samples"</span>,</span>
<span id="cb7-2160"><a href="#cb7-2160" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> point_size</span>
<span id="cb7-2161"><a href="#cb7-2161" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> </span>
<span id="cb7-2162"><a href="#cb7-2162" aria-hidden="true" tabindex="-1"></a>    plots_pca_fit<span class="sc">$</span>pc3_pc4_pam50 <span class="sc">+</span></span>
<span id="cb7-2163"><a href="#cb7-2163" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(</span>
<span id="cb7-2164"><a href="#cb7-2164" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> <span class="fu">get_colors_pam50</span>(pca_fit_no_norm<span class="sc">$</span>metadata)</span>
<span id="cb7-2165"><a href="#cb7-2165" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb7-2166"><a href="#cb7-2166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2167"><a href="#cb7-2167" aria-hidden="true" tabindex="-1"></a>plots_pca_fit<span class="sc">$</span>pc3_pc4_cohort <span class="ot">&lt;-</span> PCAtools<span class="sc">::</span><span class="fu">biplot</span>(</span>
<span id="cb7-2168"><a href="#cb7-2168" aria-hidden="true" tabindex="-1"></a>    pca_fit_no_norm,</span>
<span id="cb7-2169"><a href="#cb7-2169" aria-hidden="true" tabindex="-1"></a>    <span class="at">colby =</span> <span class="st">"cohort"</span>,</span>
<span id="cb7-2170"><a href="#cb7-2170" aria-hidden="true" tabindex="-1"></a>    <span class="at">lab =</span> <span class="cn">NULL</span>, </span>
<span id="cb7-2171"><a href="#cb7-2171" aria-hidden="true" tabindex="-1"></a>    <span class="at">legendPosition =</span> <span class="st">"right"</span>,</span>
<span id="cb7-2172"><a href="#cb7-2172" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-2173"><a href="#cb7-2173" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-2174"><a href="#cb7-2174" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Third and fourth components colored by cohort"</span>,</span>
<span id="cb7-2175"><a href="#cb7-2175" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Only 1000 training samples"</span>,</span>
<span id="cb7-2176"><a href="#cb7-2176" aria-hidden="true" tabindex="-1"></a>    <span class="at">pointSize =</span> point_size</span>
<span id="cb7-2177"><a href="#cb7-2177" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2178"><a href="#cb7-2178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2179"><a href="#cb7-2179" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> plots_pca_fit, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">labels =</span> <span class="st">"AUTO"</span>)</span>
<span id="cb7-2180"><a href="#cb7-2180" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-2181"><a href="#cb7-2181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2182"><a href="#cb7-2182" aria-hidden="true" tabindex="-1"></a>@fig-pca-no-norm shows the contrast with the other method including the</span>
<span id="cb7-2183"><a href="#cb7-2183" aria-hidden="true" tabindex="-1"></a>normalization. Without the normalization, the samples from METABRIC tend to</span>
<span id="cb7-2184"><a href="#cb7-2184" aria-hidden="true" tabindex="-1"></a>concentrate close to the center, they are not so well mixed. </span>
<span id="cb7-2185"><a href="#cb7-2185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2188"><a href="#cb7-2188" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-2189"><a href="#cb7-2189" aria-hidden="true" tabindex="-1"></a>datasets_pca_coordinates_no_norm <span class="ot">&lt;-</span> <span class="fu">mapply</span>(</span>
<span id="cb7-2190"><a href="#cb7-2190" aria-hidden="true" tabindex="-1"></a>    get_pca_coordinates,</span>
<span id="cb7-2191"><a href="#cb7-2191" aria-hidden="true" tabindex="-1"></a>    datasets_normalized,</span>
<span id="cb7-2192"><a href="#cb7-2192" aria-hidden="true" tabindex="-1"></a>    <span class="at">which_exp =</span> which_exp,</span>
<span id="cb7-2193"><a href="#cb7-2193" aria-hidden="true" tabindex="-1"></a>    <span class="at">MoreArgs =</span> <span class="fu">list</span>(<span class="at">pca_fit =</span> pca_fit_no_norm)</span>
<span id="cb7-2194"><a href="#cb7-2194" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2195"><a href="#cb7-2195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2196"><a href="#cb7-2196" aria-hidden="true" tabindex="-1"></a>df_pca_coordinates_og_no_norm <span class="ot">&lt;-</span> datasets_pca_coordinates_no_norm <span class="sc">%&gt;%</span> </span>
<span id="cb7-2197"><a href="#cb7-2197" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, .) <span class="sc">%&gt;%</span></span>
<span id="cb7-2198"><a href="#cb7-2198" aria-hidden="true" tabindex="-1"></a>    data.frame <span class="sc">%&gt;%</span> </span>
<span id="cb7-2199"><a href="#cb7-2199" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"sample_name"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-2200"><a href="#cb7-2200" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb7-2201"><a href="#cb7-2201" aria-hidden="true" tabindex="-1"></a>        .,</span>
<span id="cb7-2202"><a href="#cb7-2202" aria-hidden="true" tabindex="-1"></a>        merged_col_data,</span>
<span id="cb7-2203"><a href="#cb7-2203" aria-hidden="true" tabindex="-1"></a>        <span class="at">by =</span> <span class="st">"sample_name"</span></span>
<span id="cb7-2204"><a href="#cb7-2204" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-2205"><a href="#cb7-2205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2206"><a href="#cb7-2206" aria-hidden="true" tabindex="-1"></a>plot_corrected <span class="ot">&lt;-</span> <span class="fu">plot_pca_coordinates</span>(</span>
<span id="cb7-2207"><a href="#cb7-2207" aria-hidden="true" tabindex="-1"></a>    df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-2208"><a href="#cb7-2208" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-2209"><a href="#cb7-2209" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())),</span>
<span id="cb7-2210"><a href="#cb7-2210" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"cohort"</span>,</span>
<span id="cb7-2211"><a href="#cb7-2211" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-2212"><a href="#cb7-2212" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-2213"><a href="#cb7-2213" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb7-2214"><a href="#cb7-2214" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb7-2215"><a href="#cb7-2215" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-2216"><a href="#cb7-2216" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Embedding of all samples from TCGA"</span>,</span>
<span id="cb7-2217"><a href="#cb7-2217" aria-hidden="true" tabindex="-1"></a>        <span class="st">" and METABRIC</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb7-2218"><a href="#cb7-2218" aria-hidden="true" tabindex="-1"></a>        <span class="st">"qPCR-like normalization performed in the samples"</span></span>
<span id="cb7-2219"><a href="#cb7-2219" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-2220"><a href="#cb7-2220" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> </span>
<span id="cb7-2221"><a href="#cb7-2221" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-2222"><a href="#cb7-2222" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-2223"><a href="#cb7-2223" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>()</span>
<span id="cb7-2224"><a href="#cb7-2224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2225"><a href="#cb7-2225" aria-hidden="true" tabindex="-1"></a>plot_no_norm <span class="ot">&lt;-</span> <span class="fu">plot_pca_coordinates</span>(</span>
<span id="cb7-2226"><a href="#cb7-2226" aria-hidden="true" tabindex="-1"></a>    df_pca_coordinates_og_no_norm <span class="sc">%&gt;%</span> </span>
<span id="cb7-2227"><a href="#cb7-2227" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-2228"><a href="#cb7-2228" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())),</span>
<span id="cb7-2229"><a href="#cb7-2229" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"cohort"</span>,</span>
<span id="cb7-2230"><a href="#cb7-2230" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"PC3"</span>,</span>
<span id="cb7-2231"><a href="#cb7-2231" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"PC4"</span>,</span>
<span id="cb7-2232"><a href="#cb7-2232" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb7-2233"><a href="#cb7-2233" aria-hidden="true" tabindex="-1"></a>    <span class="at">base_size =</span> <span class="dv">10</span>,</span>
<span id="cb7-2234"><a href="#cb7-2234" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-2235"><a href="#cb7-2235" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Embedding of all samples from TCGA"</span>,</span>
<span id="cb7-2236"><a href="#cb7-2236" aria-hidden="true" tabindex="-1"></a>        <span class="st">" and METABRIC</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb7-2237"><a href="#cb7-2237" aria-hidden="true" tabindex="-1"></a>        <span class="st">"No qPCR-like normalization performed in the samples"</span></span>
<span id="cb7-2238"><a href="#cb7-2238" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-2239"><a href="#cb7-2239" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span> </span>
<span id="cb7-2240"><a href="#cb7-2240" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb7-2241"><a href="#cb7-2241" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() <span class="sc">+</span></span>
<span id="cb7-2242"><a href="#cb7-2242" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>()</span>
<span id="cb7-2243"><a href="#cb7-2243" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-2244"><a href="#cb7-2244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2245"><a href="#cb7-2245" aria-hidden="true" tabindex="-1"></a><span class="in">```{r pca-norm-no-norm, fig.width=14, fig.height=6}</span></span>
<span id="cb7-2246"><a href="#cb7-2246" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-norm-no-norm</span></span>
<span id="cb7-2247"><a href="#cb7-2247" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: PC3 and PC4 from all METABRIC and TCGA samples. (A) Embedding</span></span>
<span id="cb7-2248"><a href="#cb7-2248" aria-hidden="true" tabindex="-1"></a><span class="co">#|     using the qPCR-like normalization. (B) Embedding using the original</span></span>
<span id="cb7-2249"><a href="#cb7-2249" aria-hidden="true" tabindex="-1"></a><span class="co">#|     normalization from each dataset.</span></span>
<span id="cb7-2250"><a href="#cb7-2250" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(</span>
<span id="cb7-2251"><a href="#cb7-2251" aria-hidden="true" tabindex="-1"></a>    plot_corrected,</span>
<span id="cb7-2252"><a href="#cb7-2252" aria-hidden="true" tabindex="-1"></a>    plot_no_norm</span>
<span id="cb7-2253"><a href="#cb7-2253" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2254"><a href="#cb7-2254" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-2255"><a href="#cb7-2255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2256"><a href="#cb7-2256" aria-hidden="true" tabindex="-1"></a>@fig-pca-norm-no-norm shows side by side the differences when using the</span>
<span id="cb7-2257"><a href="#cb7-2257" aria-hidden="true" tabindex="-1"></a>qPCR-like normalization and when not using. The left plot is using the qPCR</span>
<span id="cb7-2258"><a href="#cb7-2258" aria-hidden="true" tabindex="-1"></a>normalization and shows how well the mixing gets, putting samples in the same</span>
<span id="cb7-2259"><a href="#cb7-2259" aria-hidden="true" tabindex="-1"></a>scale. If the scaling in a sample level is not performed, samples do not mix</span>
<span id="cb7-2260"><a href="#cb7-2260" aria-hidden="true" tabindex="-1"></a>well.</span>
<span id="cb7-2261"><a href="#cb7-2261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2262"><a href="#cb7-2262" aria-hidden="true" tabindex="-1"></a><span class="fu">## Molecular landscape is characterized by several pathways</span></span>
<span id="cb7-2263"><a href="#cb7-2263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2264"><a href="#cb7-2264" aria-hidden="true" tabindex="-1"></a>Among the 1000 genes that are used when calculating the molecular landscape,</span>
<span id="cb7-2265"><a href="#cb7-2265" aria-hidden="true" tabindex="-1"></a>several might be involved in biological process. @fig-pca-mol-land-pathways</span>
<span id="cb7-2266"><a href="#cb7-2266" aria-hidden="true" tabindex="-1"></a>shows that several pathways are associated with the position in the </span>
<span id="cb7-2267"><a href="#cb7-2267" aria-hidden="true" tabindex="-1"></a>molecular landscape. Something that is particularly remarkable here is the </span>
<span id="cb7-2268"><a href="#cb7-2268" aria-hidden="true" tabindex="-1"></a>association of the epithelial mesenchymal transition and DNA repair</span>
<span id="cb7-2269"><a href="#cb7-2269" aria-hidden="true" tabindex="-1"></a>pathways with PC4. </span>
<span id="cb7-2270"><a href="#cb7-2270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2271"><a href="#cb7-2271" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 10, fig.height=30}</span></span>
<span id="cb7-2272"><a href="#cb7-2272" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-mol-land-pathways</span></span>
<span id="cb7-2273"><a href="#cb7-2273" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Hex biplots colored by different pathways. Each hex is colored</span></span>
<span id="cb7-2274"><a href="#cb7-2274" aria-hidden="true" tabindex="-1"></a><span class="co">#|     based on the average score in the hex.</span></span>
<span id="cb7-2275"><a href="#cb7-2275" aria-hidden="true" tabindex="-1"></a>pathway_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb7-2276"><a href="#cb7-2276" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_ESTROGEN_RESPONSE_EARLY"</span> <span class="ot">=</span> <span class="st">"Estrogen Early"</span>, </span>
<span id="cb7-2277"><a href="#cb7-2277" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_G2M_CHECKPOINT"</span> <span class="ot">=</span> <span class="st">"G2M"</span>,</span>
<span id="cb7-2278"><a href="#cb7-2278" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_EPITHELIAL_MESENCHYMAL_TRANSITION"</span> <span class="ot">=</span> <span class="st">"EMT"</span>,</span>
<span id="cb7-2279"><a href="#cb7-2279" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SET_ERPR"</span> <span class="ot">=</span> <span class="st">"SET ER/PR"</span>,</span>
<span id="cb7-2280"><a href="#cb7-2280" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_DNA_REPAIR"</span> <span class="ot">=</span> <span class="st">"DNA Repair"</span>,</span>
<span id="cb7-2281"><a href="#cb7-2281" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_ANDROGEN_RESPONSE"</span> <span class="ot">=</span> <span class="st">"Androgen Response"</span>,</span>
<span id="cb7-2282"><a href="#cb7-2282" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_PI3K_AKT_MTOR_SIGNALING"</span> <span class="ot">=</span> <span class="st">"PI3K AKT MTOR Signaling"</span>,</span>
<span id="cb7-2283"><a href="#cb7-2283" aria-hidden="true" tabindex="-1"></a>    <span class="st">"random_200"</span> <span class="ot">=</span> <span class="st">"Random 200 genes"</span></span>
<span id="cb7-2284"><a href="#cb7-2284" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2285"><a href="#cb7-2285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2286"><a href="#cb7-2286" aria-hidden="true" tabindex="-1"></a>plots_pathways <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb7-2287"><a href="#cb7-2287" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(pathway_names), </span>
<span id="cb7-2288"><a href="#cb7-2288" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(pathway, df_pca_coordinates){</span>
<span id="cb7-2289"><a href="#cb7-2289" aria-hidden="true" tabindex="-1"></a>        color <span class="ot">&lt;-</span> pathway</span>
<span id="cb7-2290"><a href="#cb7-2290" aria-hidden="true" tabindex="-1"></a>        x <span class="ot">&lt;-</span> <span class="st">"PC3"</span></span>
<span id="cb7-2291"><a href="#cb7-2291" aria-hidden="true" tabindex="-1"></a>        y <span class="ot">&lt;-</span> <span class="st">"PC4"</span></span>
<span id="cb7-2292"><a href="#cb7-2292" aria-hidden="true" tabindex="-1"></a>        size <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb7-2293"><a href="#cb7-2293" aria-hidden="true" tabindex="-1"></a>        base_size <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb7-2294"><a href="#cb7-2294" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb7-2295"><a href="#cb7-2295" aria-hidden="true" tabindex="-1"></a>        p1 <span class="ot">&lt;-</span> df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-2296"><a href="#cb7-2296" aria-hidden="true" tabindex="-1"></a>            ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes_string</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">z =</span> color)) <span class="sc">+</span> </span>
<span id="cb7-2297"><a href="#cb7-2297" aria-hidden="true" tabindex="-1"></a>                ggplot2<span class="sc">::</span><span class="fu">stat_summary_hex</span>(<span class="at">bins =</span> <span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb7-2298"><a href="#cb7-2298" aria-hidden="true" tabindex="-1"></a>                ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb7-2299"><a href="#cb7-2299" aria-hidden="true" tabindex="-1"></a>                ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(</span>
<span id="cb7-2300"><a href="#cb7-2300" aria-hidden="true" tabindex="-1"></a>                    <span class="sc">~</span>cohort,</span>
<span id="cb7-2301"><a href="#cb7-2301" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(</span>
<span id="cb7-2302"><a href="#cb7-2302" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"tcga"</span> <span class="ot">=</span> <span class="st">"TCGA"</span>,</span>
<span id="cb7-2303"><a href="#cb7-2303" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"metabric"</span> <span class="ot">=</span> <span class="st">"METABRIC"</span>,</span>
<span id="cb7-2304"><a href="#cb7-2304" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"scanb"</span> <span class="ot">=</span> <span class="st">"SCAN-B"</span></span>
<span id="cb7-2305"><a href="#cb7-2305" aria-hidden="true" tabindex="-1"></a>                    ))</span>
<span id="cb7-2306"><a href="#cb7-2306" aria-hidden="true" tabindex="-1"></a>                ) <span class="sc">+</span> </span>
<span id="cb7-2307"><a href="#cb7-2307" aria-hidden="true" tabindex="-1"></a>                ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-2308"><a href="#cb7-2308" aria-hidden="true" tabindex="-1"></a>                    <span class="at">title =</span> pathway_names[color],</span>
<span id="cb7-2309"><a href="#cb7-2309" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> <span class="st">"Score"</span></span>
<span id="cb7-2310"><a href="#cb7-2310" aria-hidden="true" tabindex="-1"></a>                ) <span class="sc">+</span> </span>
<span id="cb7-2311"><a href="#cb7-2311" aria-hidden="true" tabindex="-1"></a>                ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> base_size) <span class="sc">+</span> </span>
<span id="cb7-2312"><a href="#cb7-2312" aria-hidden="true" tabindex="-1"></a>                <span class="fu">change_plot_aes_point</span>()</span>
<span id="cb7-2313"><a href="#cb7-2313" aria-hidden="true" tabindex="-1"></a>    }, </span>
<span id="cb7-2314"><a href="#cb7-2314" aria-hidden="true" tabindex="-1"></a>    <span class="at">df_pca_coordinates =</span> df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-2315"><a href="#cb7-2315" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>, <span class="st">"scanb"</span>)),</span>
<span id="cb7-2316"><a href="#cb7-2316" aria-hidden="true" tabindex="-1"></a>    <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span>, </span>
<span id="cb7-2317"><a href="#cb7-2317" aria-hidden="true" tabindex="-1"></a>    <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb7-2318"><a href="#cb7-2318" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2319"><a href="#cb7-2319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2320"><a href="#cb7-2320" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(</span>
<span id="cb7-2321"><a href="#cb7-2321" aria-hidden="true" tabindex="-1"></a>    <span class="at">plotlist =</span> plots_pathways,</span>
<span id="cb7-2322"><a href="#cb7-2322" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">1</span></span>
<span id="cb7-2323"><a href="#cb7-2323" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2324"><a href="#cb7-2324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-2325"><a href="#cb7-2325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2326"><a href="#cb7-2326" aria-hidden="true" tabindex="-1"></a>We see that these pathways are somehow relevant to the embedding, but are they</span>
<span id="cb7-2327"><a href="#cb7-2327" aria-hidden="true" tabindex="-1"></a>also prognostic of overall survival in the two cohorts? In the next chunks</span>
<span id="cb7-2328"><a href="#cb7-2328" aria-hidden="true" tabindex="-1"></a>we evaluate this hypothesis. Mostly the focus is on ER+ BC patients that</span>
<span id="cb7-2329"><a href="#cb7-2329" aria-hidden="true" tabindex="-1"></a>received some kind of hormonal therapy. As seen before, for the TCGA</span>
<span id="cb7-2330"><a href="#cb7-2330" aria-hidden="true" tabindex="-1"></a>dataset we select ER+ BC patients that have the molecular subtype luminal</span>
<span id="cb7-2331"><a href="#cb7-2331" aria-hidden="true" tabindex="-1"></a>A and B instead. </span>
<span id="cb7-2332"><a href="#cb7-2332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2333"><a href="#cb7-2333" aria-hidden="true" tabindex="-1"></a>Just before moving on we plot the embedding colored by molecular subtype</span>
<span id="cb7-2334"><a href="#cb7-2334" aria-hidden="true" tabindex="-1"></a>stratified by cohort so it can go together with a figure in the paper and it</span>
<span id="cb7-2335"><a href="#cb7-2335" aria-hidden="true" tabindex="-1"></a>is easier to compare the pathways.</span>
<span id="cb7-2336"><a href="#cb7-2336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2337"><a href="#cb7-2337" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=11, fig.height=4}</span></span>
<span id="cb7-2338"><a href="#cb7-2338" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-cohorts-mol-sub-stratified</span></span>
<span id="cb7-2339"><a href="#cb7-2339" aria-hidden="true" tabindex="-1"></a>sub_df <span class="ot">&lt;-</span> df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-2340"><a href="#cb7-2340" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(cohort <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"tcga"</span>, <span class="st">"metabric"</span>, <span class="st">"scanb"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-2341"><a href="#cb7-2341" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(pam50 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"luma"</span>, <span class="st">"lumb"</span>, <span class="st">"basal"</span>, <span class="st">"her2"</span>, <span class="st">"normal"</span>))</span>
<span id="cb7-2342"><a href="#cb7-2342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2343"><a href="#cb7-2343" aria-hidden="true" tabindex="-1"></a>sub_df <span class="sc">%&gt;%</span></span>
<span id="cb7-2344"><a href="#cb7-2344" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb7-2345"><a href="#cb7-2345" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> PC3,</span>
<span id="cb7-2346"><a href="#cb7-2346" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> PC4,</span>
<span id="cb7-2347"><a href="#cb7-2347" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> pam50</span>
<span id="cb7-2348"><a href="#cb7-2348" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span> </span>
<span id="cb7-2349"><a href="#cb7-2349" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb7-2350"><a href="#cb7-2350" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(</span>
<span id="cb7-2351"><a href="#cb7-2351" aria-hidden="true" tabindex="-1"></a>        <span class="at">values =</span> <span class="fu">get_colors_pam50</span>(sub_df), </span>
<span id="cb7-2352"><a href="#cb7-2352" aria-hidden="true" tabindex="-1"></a>        <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Basal-like"</span>, <span class="st">"HER2-enriched"</span>, </span>
<span id="cb7-2353"><a href="#cb7-2353" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"LumB"</span>, <span class="st">"LumA"</span>, <span class="st">"Normal-like"</span>)</span>
<span id="cb7-2354"><a href="#cb7-2354" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb7-2355"><a href="#cb7-2355" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-2356"><a href="#cb7-2356" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"Molecular</span><span class="sc">\n</span><span class="st">subtype"</span></span>
<span id="cb7-2357"><a href="#cb7-2357" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb7-2358"><a href="#cb7-2358" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(</span>
<span id="cb7-2359"><a href="#cb7-2359" aria-hidden="true" tabindex="-1"></a>        <span class="sc">~</span> cohort,</span>
<span id="cb7-2360"><a href="#cb7-2360" aria-hidden="true" tabindex="-1"></a>        <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(</span>
<span id="cb7-2361"><a href="#cb7-2361" aria-hidden="true" tabindex="-1"></a>            <span class="st">"tcga"</span> <span class="ot">=</span> <span class="st">"TCGA"</span>,</span>
<span id="cb7-2362"><a href="#cb7-2362" aria-hidden="true" tabindex="-1"></a>            <span class="st">"metabric"</span> <span class="ot">=</span> <span class="st">"METABRIC"</span>,</span>
<span id="cb7-2363"><a href="#cb7-2363" aria-hidden="true" tabindex="-1"></a>            <span class="st">"scanb"</span> <span class="ot">=</span> <span class="st">"SCAN-B"</span></span>
<span id="cb7-2364"><a href="#cb7-2364" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb7-2365"><a href="#cb7-2365" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb7-2366"><a href="#cb7-2366" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span> </span>
<span id="cb7-2367"><a href="#cb7-2367" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>() <span class="sc">+</span> </span>
<span id="cb7-2368"><a href="#cb7-2368" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>() </span>
<span id="cb7-2369"><a href="#cb7-2369" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-2370"><a href="#cb7-2370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2371"><a href="#cb7-2371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2372"><a href="#cb7-2372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = first_run}</span></span>
<span id="cb7-2373"><a href="#cb7-2373" aria-hidden="true" tabindex="-1"></a>tcga_samples <span class="ot">&lt;-</span> <span class="fu">colData</span>(datasets<span class="sc">$</span>tcga) <span class="sc">%&gt;%</span> data.frame <span class="sc">%&gt;%</span></span>
<span id="cb7-2374"><a href="#cb7-2374" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb7-2375"><a href="#cb7-2375" aria-hidden="true" tabindex="-1"></a>        pam50 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"luma"</span>, <span class="st">"lumb"</span>) <span class="sc">&amp;</span></span>
<span id="cb7-2376"><a href="#cb7-2376" aria-hidden="true" tabindex="-1"></a>        node_stage <span class="sc">!=</span> <span class="st">"NX"</span> <span class="sc">&amp;</span></span>
<span id="cb7-2377"><a href="#cb7-2377" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span>(tumor_stage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"stage_iv"</span>, <span class="st">"na"</span>)) <span class="sc">&amp;</span> </span>
<span id="cb7-2378"><a href="#cb7-2378" aria-hidden="true" tabindex="-1"></a>        er_status <span class="sc">==</span> <span class="st">"pos"</span></span>
<span id="cb7-2379"><a href="#cb7-2379" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2380"><a href="#cb7-2380" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(sample_name)</span>
<span id="cb7-2381"><a href="#cb7-2381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2382"><a href="#cb7-2382" aria-hidden="true" tabindex="-1"></a>tcga_samples <span class="ot">&lt;-</span> df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-2383"><a href="#cb7-2383" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(sample_name <span class="sc">%in%</span> tcga_samples <span class="sc">&amp;</span> PC3 <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-2384"><a href="#cb7-2384" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(sample_name)</span>
<span id="cb7-2385"><a href="#cb7-2385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2386"><a href="#cb7-2386" aria-hidden="true" tabindex="-1"></a>scanb_samples <span class="ot">&lt;-</span> <span class="fu">colData</span>(datasets<span class="sc">$</span>scanb) <span class="sc">%&gt;%</span> data.frame <span class="sc">%&gt;%</span></span>
<span id="cb7-2387"><a href="#cb7-2387" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb7-2388"><a href="#cb7-2388" aria-hidden="true" tabindex="-1"></a>        node_stage <span class="sc">!=</span> <span class="st">"NX"</span> <span class="sc">&amp;</span></span>
<span id="cb7-2389"><a href="#cb7-2389" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!</span>(tumor_stage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"T4"</span>, <span class="st">"Tis"</span>, <span class="st">"TX"</span>)) <span class="sc">&amp;</span> </span>
<span id="cb7-2390"><a href="#cb7-2390" aria-hidden="true" tabindex="-1"></a>        er_status <span class="sc">==</span> <span class="st">"pos"</span> <span class="sc">&amp;</span> </span>
<span id="cb7-2391"><a href="#cb7-2391" aria-hidden="true" tabindex="-1"></a>        TreatGroup <span class="sc">==</span> <span class="st">"Endo"</span></span>
<span id="cb7-2392"><a href="#cb7-2392" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2393"><a href="#cb7-2393" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(sample_name)</span>
<span id="cb7-2394"><a href="#cb7-2394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2395"><a href="#cb7-2395" aria-hidden="true" tabindex="-1"></a>scanb_samples <span class="ot">&lt;-</span> df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-2396"><a href="#cb7-2396" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(sample_name <span class="sc">%in%</span> scanb_samples <span class="sc">&amp;</span> PC3 <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-2397"><a href="#cb7-2397" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(sample_name)</span>
<span id="cb7-2398"><a href="#cb7-2398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2399"><a href="#cb7-2399" aria-hidden="true" tabindex="-1"></a>metabric_samples <span class="ot">&lt;-</span> <span class="fu">colData</span>(datasets<span class="sc">$</span>metabric) <span class="sc">%&gt;%</span> data.frame <span class="sc">%&gt;%</span></span>
<span id="cb7-2400"><a href="#cb7-2400" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb7-2401"><a href="#cb7-2401" aria-hidden="true" tabindex="-1"></a>        CHEMOTHERAPY <span class="sc">==</span> <span class="st">"NO"</span> <span class="sc">&amp;</span></span>
<span id="cb7-2402"><a href="#cb7-2402" aria-hidden="true" tabindex="-1"></a>        er_status <span class="sc">==</span> <span class="st">"pos"</span> <span class="sc">&amp;</span> </span>
<span id="cb7-2403"><a href="#cb7-2403" aria-hidden="true" tabindex="-1"></a>        HORMONE_THERAPY <span class="sc">==</span> <span class="st">"YES"</span></span>
<span id="cb7-2404"><a href="#cb7-2404" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2405"><a href="#cb7-2405" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(sample_name)</span>
<span id="cb7-2406"><a href="#cb7-2406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2407"><a href="#cb7-2407" aria-hidden="true" tabindex="-1"></a>metabric_samples <span class="ot">&lt;-</span> df_pca_coordinates <span class="sc">%&gt;%</span> </span>
<span id="cb7-2408"><a href="#cb7-2408" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(sample_name <span class="sc">%in%</span> metabric_samples <span class="sc">&amp;</span> PC3 <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-2409"><a href="#cb7-2409" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(sample_name)</span>
<span id="cb7-2410"><a href="#cb7-2410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2411"><a href="#cb7-2411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2412"><a href="#cb7-2412" aria-hidden="true" tabindex="-1"></a>formulas_survival <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb7-2413"><a href="#cb7-2413" aria-hidden="true" tabindex="-1"></a>    <span class="st">"os_tcga"</span> <span class="ot">=</span> <span class="st">"Surv(os_months, os_status) ~ age + node_stage + tumor_stage"</span>,</span>
<span id="cb7-2414"><a href="#cb7-2414" aria-hidden="true" tabindex="-1"></a>    <span class="st">"os_scanb"</span> <span class="ot">=</span> <span class="st">"Surv(os_months, os_status) ~ age + node_stage + tumor_stage"</span>,</span>
<span id="cb7-2415"><a href="#cb7-2415" aria-hidden="true" tabindex="-1"></a>    <span class="st">"os_metabric"</span> <span class="ot">=</span> <span class="st">"Surv(os_months, os_status) ~ age + npi"</span>,</span>
<span id="cb7-2416"><a href="#cb7-2416" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rfs_metabric"</span> <span class="ot">=</span> <span class="st">"Surv(rfs_months, rfs_status) ~ age + npi"</span>,</span>
<span id="cb7-2417"><a href="#cb7-2417" aria-hidden="true" tabindex="-1"></a>    <span class="st">"rfs_scanb"</span> <span class="ot">=</span> <span class="st">"Surv(rfs_months, rfs_status) ~ age + node_stage + tumor_stage"</span></span>
<span id="cb7-2418"><a href="#cb7-2418" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2419"><a href="#cb7-2419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2420"><a href="#cb7-2420" aria-hidden="true" tabindex="-1"></a>type_survival <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"os"</span>, <span class="st">"rfs"</span>)</span>
<span id="cb7-2421"><a href="#cb7-2421" aria-hidden="true" tabindex="-1"></a>which_scores <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb7-2422"><a href="#cb7-2422" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_G2M_CHECKPOINT"</span>,</span>
<span id="cb7-2423"><a href="#cb7-2423" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_EPITHELIAL_MESENCHYMAL_TRANSITION"</span>,</span>
<span id="cb7-2424"><a href="#cb7-2424" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_DNA_REPAIR"</span>,</span>
<span id="cb7-2425"><a href="#cb7-2425" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_ANDROGEN_RESPONSE"</span>,</span>
<span id="cb7-2426"><a href="#cb7-2426" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_PI3K_AKT_MTOR_SIGNALING"</span></span>
<span id="cb7-2427"><a href="#cb7-2427" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2428"><a href="#cb7-2428" aria-hidden="true" tabindex="-1"></a>survival_results <span class="ot">&lt;-</span> <span class="fu">sapply</span>(</span>
<span id="cb7-2429"><a href="#cb7-2429" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"os"</span>, <span class="st">"rfs"</span>),</span>
<span id="cb7-2430"><a href="#cb7-2430" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(type_analysis, datasets, name_scores, formulas){</span>
<span id="cb7-2431"><a href="#cb7-2431" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mapply</span>(</span>
<span id="cb7-2432"><a href="#cb7-2432" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(</span>
<span id="cb7-2433"><a href="#cb7-2433" aria-hidden="true" tabindex="-1"></a>                dataset, name_dataset, name_scores, formulas, type_analysis</span>
<span id="cb7-2434"><a href="#cb7-2434" aria-hidden="true" tabindex="-1"></a>            ){</span>
<span id="cb7-2435"><a href="#cb7-2435" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2436"><a href="#cb7-2436" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (type_analysis <span class="sc">==</span> <span class="st">"rfs"</span> <span class="sc">&amp;</span> name_dataset <span class="sc">==</span> <span class="st">"tcga"</span>){</span>
<span id="cb7-2437"><a href="#cb7-2437" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">return</span>()</span>
<span id="cb7-2438"><a href="#cb7-2438" aria-hidden="true" tabindex="-1"></a>                } <span class="cf">else</span> { </span>
<span id="cb7-2439"><a href="#cb7-2439" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2440"><a href="#cb7-2440" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">sapply</span>(</span>
<span id="cb7-2441"><a href="#cb7-2441" aria-hidden="true" tabindex="-1"></a>                        name_scores,</span>
<span id="cb7-2442"><a href="#cb7-2442" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">function</span>(name_score, col_data, formula){</span>
<span id="cb7-2443"><a href="#cb7-2443" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb7-2444"><a href="#cb7-2444" aria-hidden="true" tabindex="-1"></a>                            survival<span class="sc">::</span><span class="fu">coxph</span>(</span>
<span id="cb7-2445"><a href="#cb7-2445" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">as.formula</span>(</span>
<span id="cb7-2446"><a href="#cb7-2446" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">paste</span>(formula, name_score, <span class="at">sep =</span> <span class="st">"+"</span>)</span>
<span id="cb7-2447"><a href="#cb7-2447" aria-hidden="true" tabindex="-1"></a>                                ),</span>
<span id="cb7-2448"><a href="#cb7-2448" aria-hidden="true" tabindex="-1"></a>                                <span class="at">data =</span> col_data, </span>
<span id="cb7-2449"><a href="#cb7-2449" aria-hidden="true" tabindex="-1"></a>                                <span class="at">y =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-2450"><a href="#cb7-2450" aria-hidden="true" tabindex="-1"></a>                                <span class="at">x =</span> <span class="cn">FALSE</span></span>
<span id="cb7-2451"><a href="#cb7-2451" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb7-2452"><a href="#cb7-2452" aria-hidden="true" tabindex="-1"></a>                        },</span>
<span id="cb7-2453"><a href="#cb7-2453" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col_data =</span> <span class="fu">colData</span>(dataset),</span>
<span id="cb7-2454"><a href="#cb7-2454" aria-hidden="true" tabindex="-1"></a>                        <span class="at">formula =</span> formulas[</span>
<span id="cb7-2455"><a href="#cb7-2455" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">grepl</span>(</span>
<span id="cb7-2456"><a href="#cb7-2456" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">paste</span>(type_analysis, name_dataset, <span class="at">sep =</span> <span class="st">"_"</span>),</span>
<span id="cb7-2457"><a href="#cb7-2457" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">names</span>(formulas)</span>
<span id="cb7-2458"><a href="#cb7-2458" aria-hidden="true" tabindex="-1"></a>                            )</span>
<span id="cb7-2459"><a href="#cb7-2459" aria-hidden="true" tabindex="-1"></a>                        ],</span>
<span id="cb7-2460"><a href="#cb7-2460" aria-hidden="true" tabindex="-1"></a>                        <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-2461"><a href="#cb7-2461" aria-hidden="true" tabindex="-1"></a>                        <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb7-2462"><a href="#cb7-2462" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb7-2463"><a href="#cb7-2463" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb7-2464"><a href="#cb7-2464" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb7-2465"><a href="#cb7-2465" aria-hidden="true" tabindex="-1"></a>            <span class="at">dataset =</span> datasets,</span>
<span id="cb7-2466"><a href="#cb7-2466" aria-hidden="true" tabindex="-1"></a>            <span class="at">name_dataset =</span> <span class="fu">names</span>(datasets),</span>
<span id="cb7-2467"><a href="#cb7-2467" aria-hidden="true" tabindex="-1"></a>            <span class="at">MoreArgs =</span> <span class="fu">list</span>(</span>
<span id="cb7-2468"><a href="#cb7-2468" aria-hidden="true" tabindex="-1"></a>                <span class="at">formulas =</span> formulas, <span class="at">name_scores =</span> name_scores,</span>
<span id="cb7-2469"><a href="#cb7-2469" aria-hidden="true" tabindex="-1"></a>                <span class="at">type_analysis =</span> type_analysis</span>
<span id="cb7-2470"><a href="#cb7-2470" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb7-2471"><a href="#cb7-2471" aria-hidden="true" tabindex="-1"></a>            <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-2472"><a href="#cb7-2472" aria-hidden="true" tabindex="-1"></a>            <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span></span>
<span id="cb7-2473"><a href="#cb7-2473" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-2474"><a href="#cb7-2474" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb7-2475"><a href="#cb7-2475" aria-hidden="true" tabindex="-1"></a>    <span class="at">datasets =</span> <span class="fu">mapply</span>(</span>
<span id="cb7-2476"><a href="#cb7-2476" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(dataset, patients) dataset[, patients],</span>
<span id="cb7-2477"><a href="#cb7-2477" aria-hidden="true" tabindex="-1"></a>        <span class="at">dataset =</span> datasets,</span>
<span id="cb7-2478"><a href="#cb7-2478" aria-hidden="true" tabindex="-1"></a>        <span class="at">patients =</span> <span class="fu">list</span>(tcga_samples, scanb_samples, metabric_samples),</span>
<span id="cb7-2479"><a href="#cb7-2479" aria-hidden="true" tabindex="-1"></a>        <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-2480"><a href="#cb7-2480" aria-hidden="true" tabindex="-1"></a>        <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span></span>
<span id="cb7-2481"><a href="#cb7-2481" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb7-2482"><a href="#cb7-2482" aria-hidden="true" tabindex="-1"></a>    <span class="at">name_scores =</span> which_scores,</span>
<span id="cb7-2483"><a href="#cb7-2483" aria-hidden="true" tabindex="-1"></a>    <span class="at">formulas =</span> formulas_survival,</span>
<span id="cb7-2484"><a href="#cb7-2484" aria-hidden="true" tabindex="-1"></a>    <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-2485"><a href="#cb7-2485" aria-hidden="true" tabindex="-1"></a>    <span class="at">simplify =</span> <span class="cn">FALSE</span></span>
<span id="cb7-2486"><a href="#cb7-2486" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2487"><a href="#cb7-2487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2488"><a href="#cb7-2488" aria-hidden="true" tabindex="-1"></a>survival_results<span class="sc">$</span>rfs <span class="ot">&lt;-</span> survival_results<span class="sc">$</span>rfs[</span>
<span id="cb7-2489"><a href="#cb7-2489" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">sapply</span>(survival_results<span class="sc">$</span>rfs, is.null)</span>
<span id="cb7-2490"><a href="#cb7-2490" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-2491"><a href="#cb7-2491" aria-hidden="true" tabindex="-1"></a>survival_results<span class="sc">$</span>rfs<span class="sc">$</span>metabric <span class="ot">&lt;-</span> survival_results<span class="sc">$</span>rfs<span class="sc">$</span>metabric[</span>
<span id="cb7-2492"><a href="#cb7-2492" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">sapply</span>(survival_results<span class="sc">$</span>rfs<span class="sc">$</span>metabric, is.null)</span>
<span id="cb7-2493"><a href="#cb7-2493" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-2494"><a href="#cb7-2494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2495"><a href="#cb7-2495" aria-hidden="true" tabindex="-1"></a>survival_results<span class="sc">$</span>os <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">discard</span>(</span>
<span id="cb7-2496"><a href="#cb7-2496" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb7-2497"><a href="#cb7-2497" aria-hidden="true" tabindex="-1"></a>        survival_results<span class="sc">$</span>os, </span>
<span id="cb7-2498"><a href="#cb7-2498" aria-hidden="true" tabindex="-1"></a>        <span class="sc">~</span> purrr<span class="sc">::</span><span class="fu">discard</span>(.x, is.null),</span>
<span id="cb7-2499"><a href="#cb7-2499" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb7-2500"><a href="#cb7-2500" aria-hidden="true" tabindex="-1"></a>    is.null</span>
<span id="cb7-2501"><a href="#cb7-2501" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2502"><a href="#cb7-2502" aria-hidden="true" tabindex="-1"></a><span class="co"># we cannot simply save the models as each model has some </span></span>
<span id="cb7-2503"><a href="#cb7-2503" aria-hidden="true" tabindex="-1"></a><span class="co"># environment variables, which adds up to over 20GB. </span></span>
<span id="cb7-2504"><a href="#cb7-2504" aria-hidden="true" tabindex="-1"></a><span class="co"># check this stack exchange thread to read more on it:</span></span>
<span id="cb7-2505"><a href="#cb7-2505" aria-hidden="true" tabindex="-1"></a><span class="co"># https://stackoverflow.com/questions/42230920/saverds-inflating-size-of-object/52372480</span></span>
<span id="cb7-2506"><a href="#cb7-2506" aria-hidden="true" tabindex="-1"></a><span class="co"># the solution is to basically clear the environment from the terms </span></span>
<span id="cb7-2507"><a href="#cb7-2507" aria-hidden="true" tabindex="-1"></a><span class="co"># object. since it is pretty fast to run the survival analysis</span></span>
<span id="cb7-2508"><a href="#cb7-2508" aria-hidden="true" tabindex="-1"></a><span class="co"># we will not save the objects.</span></span>
<span id="cb7-2509"><a href="#cb7-2509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2510"><a href="#cb7-2510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2511"><a href="#cb7-2511" aria-hidden="true" tabindex="-1"></a><span class="co"># we now proceed to prepare the plots. since the survival result is </span></span>
<span id="cb7-2512"><a href="#cb7-2512" aria-hidden="true" tabindex="-1"></a><span class="co"># actually a large file, it is best to do all the plottings, save</span></span>
<span id="cb7-2513"><a href="#cb7-2513" aria-hidden="true" tabindex="-1"></a><span class="co"># them in other rds/pdf files and then use on the quarto markdown.</span></span>
<span id="cb7-2514"><a href="#cb7-2514" aria-hidden="true" tabindex="-1"></a><span class="co"># otherwise it is too slow to render the book. </span></span>
<span id="cb7-2515"><a href="#cb7-2515" aria-hidden="true" tabindex="-1"></a><span class="co"># the same is true for the statistics and coefficients available.</span></span>
<span id="cb7-2516"><a href="#cb7-2516" aria-hidden="true" tabindex="-1"></a>names_signatures <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb7-2517"><a href="#cb7-2517" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_G2M_CHECKPOINT"</span> <span class="ot">=</span> <span class="st">"G2M checkpoint"</span>,</span>
<span id="cb7-2518"><a href="#cb7-2518" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_EPITHELIAL_MESENCHYMAL_TRANSITION"</span> <span class="ot">=</span> <span class="st">"EMT"</span>,</span>
<span id="cb7-2519"><a href="#cb7-2519" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_DNA_REPAIR"</span> <span class="ot">=</span> <span class="st">"DNA repair"</span>,</span>
<span id="cb7-2520"><a href="#cb7-2520" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_ANDROGEN_RESPONSE"</span> <span class="ot">=</span> <span class="st">"Androgen response"</span>,</span>
<span id="cb7-2521"><a href="#cb7-2521" aria-hidden="true" tabindex="-1"></a>    <span class="st">"HALLMARK_PI3K_AKT_MTOR_SIGNALING"</span> <span class="ot">=</span> <span class="st">"PI3K AKT MTOR signaling"</span></span>
<span id="cb7-2522"><a href="#cb7-2522" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2523"><a href="#cb7-2523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2524"><a href="#cb7-2524" aria-hidden="true" tabindex="-1"></a>names_coefficients <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-2525"><a href="#cb7-2525" aria-hidden="true" tabindex="-1"></a>    <span class="at">metabric =</span> <span class="fu">c</span>(</span>
<span id="cb7-2526"><a href="#cb7-2526" aria-hidden="true" tabindex="-1"></a>        <span class="st">"age"</span> <span class="ot">=</span> <span class="st">"Age"</span>, </span>
<span id="cb7-2527"><a href="#cb7-2527" aria-hidden="true" tabindex="-1"></a>        <span class="st">"npi"</span> <span class="ot">=</span> <span class="st">"NPI"</span>, </span>
<span id="cb7-2528"><a href="#cb7-2528" aria-hidden="true" tabindex="-1"></a>        names_signatures</span>
<span id="cb7-2529"><a href="#cb7-2529" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb7-2530"><a href="#cb7-2530" aria-hidden="true" tabindex="-1"></a>    <span class="at">scanb =</span> <span class="fu">c</span>(</span>
<span id="cb7-2531"><a href="#cb7-2531" aria-hidden="true" tabindex="-1"></a>        <span class="st">"age"</span> <span class="ot">=</span> <span class="st">"age"</span>,</span>
<span id="cb7-2532"><a href="#cb7-2532" aria-hidden="true" tabindex="-1"></a>        names_signatures,</span>
<span id="cb7-2533"><a href="#cb7-2533" aria-hidden="true" tabindex="-1"></a>        <span class="st">"node_stageN1"</span> <span class="ot">=</span> <span class="st">"N1"</span>,</span>
<span id="cb7-2534"><a href="#cb7-2534" aria-hidden="true" tabindex="-1"></a>        <span class="st">"node_stageN2and3"</span> <span class="ot">=</span> <span class="st">"N2 and N3"</span>,</span>
<span id="cb7-2535"><a href="#cb7-2535" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tumor_stageT1"</span> <span class="ot">=</span> <span class="st">"T1"</span>,</span>
<span id="cb7-2536"><a href="#cb7-2536" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tumor_stageT2"</span> <span class="ot">=</span> <span class="st">"T2"</span>,</span>
<span id="cb7-2537"><a href="#cb7-2537" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tumor_stageT3"</span> <span class="ot">=</span> <span class="st">"T3"</span></span>
<span id="cb7-2538"><a href="#cb7-2538" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb7-2539"><a href="#cb7-2539" aria-hidden="true" tabindex="-1"></a>    <span class="at">tcga =</span> <span class="fu">c</span>(</span>
<span id="cb7-2540"><a href="#cb7-2540" aria-hidden="true" tabindex="-1"></a>        <span class="st">"age"</span> <span class="ot">=</span> <span class="st">"age"</span>,</span>
<span id="cb7-2541"><a href="#cb7-2541" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tumor_stage"</span> <span class="ot">=</span> <span class="st">"Tumor Stage"</span>,</span>
<span id="cb7-2542"><a href="#cb7-2542" aria-hidden="true" tabindex="-1"></a>        names_signatures,</span>
<span id="cb7-2543"><a href="#cb7-2543" aria-hidden="true" tabindex="-1"></a>        <span class="st">"node_stageN1"</span> <span class="ot">=</span> <span class="st">"N1"</span>,</span>
<span id="cb7-2544"><a href="#cb7-2544" aria-hidden="true" tabindex="-1"></a>        <span class="st">"node_stageN2"</span> <span class="ot">=</span> <span class="st">"N2"</span>,</span>
<span id="cb7-2545"><a href="#cb7-2545" aria-hidden="true" tabindex="-1"></a>        <span class="st">"node_stageN3"</span> <span class="ot">=</span> <span class="st">"N3"</span>,</span>
<span id="cb7-2546"><a href="#cb7-2546" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tumor_stagestage_ii"</span> <span class="ot">=</span> <span class="st">"T2"</span>,</span>
<span id="cb7-2547"><a href="#cb7-2547" aria-hidden="true" tabindex="-1"></a>        <span class="st">"tumor_stagestage_iii"</span> <span class="ot">=</span> <span class="st">"T3"</span></span>
<span id="cb7-2548"><a href="#cb7-2548" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-2549"><a href="#cb7-2549" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2550"><a href="#cb7-2550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2551"><a href="#cb7-2551" aria-hidden="true" tabindex="-1"></a>patients <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-2552"><a href="#cb7-2552" aria-hidden="true" tabindex="-1"></a>    <span class="at">tcga =</span> <span class="st">"Lum A/B, ER+ BC"</span>,</span>
<span id="cb7-2553"><a href="#cb7-2553" aria-hidden="true" tabindex="-1"></a>    <span class="at">scanb =</span> <span class="st">"Endo Only, ER+ BC"</span>,</span>
<span id="cb7-2554"><a href="#cb7-2554" aria-hidden="true" tabindex="-1"></a>    <span class="at">metabric =</span> <span class="st">"Endo Only, ER+ BC"</span></span>
<span id="cb7-2555"><a href="#cb7-2555" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2556"><a href="#cb7-2556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2557"><a href="#cb7-2557" aria-hidden="true" tabindex="-1"></a>analysis_code <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-2558"><a href="#cb7-2558" aria-hidden="true" tabindex="-1"></a>    <span class="at">os =</span> <span class="st">"Overall survival"</span>,</span>
<span id="cb7-2559"><a href="#cb7-2559" aria-hidden="true" tabindex="-1"></a>    <span class="at">rfs =</span> <span class="st">"Recurrence free survival"</span></span>
<span id="cb7-2560"><a href="#cb7-2560" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2561"><a href="#cb7-2561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2562"><a href="#cb7-2562" aria-hidden="true" tabindex="-1"></a>forest_plots <span class="ot">&lt;-</span> <span class="fu">mapply</span>(</span>
<span id="cb7-2563"><a href="#cb7-2563" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(fits, type_analysis){</span>
<span id="cb7-2564"><a href="#cb7-2564" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mapply</span>(</span>
<span id="cb7-2565"><a href="#cb7-2565" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(cohort_fits, name_cohort, type_analysis){</span>
<span id="cb7-2566"><a href="#cb7-2566" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2567"><a href="#cb7-2567" aria-hidden="true" tabindex="-1"></a>                tidy_survival <span class="ot">&lt;-</span> <span class="fu">get_df_survival</span>(</span>
<span id="cb7-2568"><a href="#cb7-2568" aria-hidden="true" tabindex="-1"></a>                    cohort_fits,</span>
<span id="cb7-2569"><a href="#cb7-2569" aria-hidden="true" tabindex="-1"></a>                    <span class="at">pathways_of_interest =</span> <span class="fu">names</span>(names_signatures)</span>
<span id="cb7-2570"><a href="#cb7-2570" aria-hidden="true" tabindex="-1"></a>                ) <span class="sc">%&gt;%</span></span>
<span id="cb7-2571"><a href="#cb7-2571" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pathway =</span> names_signatures[pathway])</span>
<span id="cb7-2572"><a href="#cb7-2572" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2573"><a href="#cb7-2573" aria-hidden="true" tabindex="-1"></a>                <span class="fu">plot_combined_scores</span>(tidy_survival, <span class="at">range_hr =</span> <span class="dv">6</span>) <span class="sc">+</span> </span>
<span id="cb7-2574"><a href="#cb7-2574" aria-hidden="true" tabindex="-1"></a>                    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-2575"><a href="#cb7-2575" aria-hidden="true" tabindex="-1"></a>                        <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb7-2576"><a href="#cb7-2576" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">toupper</span>(name_cohort), <span class="st">", PC3 &gt; 0</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb7-2577"><a href="#cb7-2577" aria-hidden="true" tabindex="-1"></a>                            patients[[name_cohort]], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb7-2578"><a href="#cb7-2578" aria-hidden="true" tabindex="-1"></a>                            analysis_code[[type_analysis]]</span>
<span id="cb7-2579"><a href="#cb7-2579" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb7-2580"><a href="#cb7-2580" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb7-2581"><a href="#cb7-2581" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb7-2582"><a href="#cb7-2582" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb7-2583"><a href="#cb7-2583" aria-hidden="true" tabindex="-1"></a>            <span class="at">cohort_fits =</span> fits,</span>
<span id="cb7-2584"><a href="#cb7-2584" aria-hidden="true" tabindex="-1"></a>            <span class="at">name_cohort =</span> <span class="fu">names</span>(fits),</span>
<span id="cb7-2585"><a href="#cb7-2585" aria-hidden="true" tabindex="-1"></a>            <span class="at">MoreArgs =</span> <span class="fu">list</span>(<span class="at">type_analysis =</span> type_analysis),</span>
<span id="cb7-2586"><a href="#cb7-2586" aria-hidden="true" tabindex="-1"></a>            <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-2587"><a href="#cb7-2587" aria-hidden="true" tabindex="-1"></a>            <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span></span>
<span id="cb7-2588"><a href="#cb7-2588" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-2589"><a href="#cb7-2589" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb7-2590"><a href="#cb7-2590" aria-hidden="true" tabindex="-1"></a>    survival_results,</span>
<span id="cb7-2591"><a href="#cb7-2591" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(survival_results),</span>
<span id="cb7-2592"><a href="#cb7-2592" aria-hidden="true" tabindex="-1"></a>    <span class="at">USE.NAMES =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-2593"><a href="#cb7-2593" aria-hidden="true" tabindex="-1"></a>    <span class="at">SIMPLIFY =</span> <span class="cn">FALSE</span></span>
<span id="cb7-2594"><a href="#cb7-2594" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2595"><a href="#cb7-2595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2596"><a href="#cb7-2596" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(</span>
<span id="cb7-2597"><a href="#cb7-2597" aria-hidden="true" tabindex="-1"></a>    forest_plots,</span>
<span id="cb7-2598"><a href="#cb7-2598" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/rds_files/pca_merging/forest_plots.rds"</span></span>
<span id="cb7-2599"><a href="#cb7-2599" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2600"><a href="#cb7-2600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2601"><a href="#cb7-2601" aria-hidden="true" tabindex="-1"></a><span class="co"># and now we fetch the tables that will be used later on including the</span></span>
<span id="cb7-2602"><a href="#cb7-2602" aria-hidden="true" tabindex="-1"></a><span class="co"># confidence intervals and other parameters from the fit</span></span>
<span id="cb7-2603"><a href="#cb7-2603" aria-hidden="true" tabindex="-1"></a>tables_survival <span class="ot">&lt;-</span> <span class="fu">lapply</span>(</span>
<span id="cb7-2604"><a href="#cb7-2604" aria-hidden="true" tabindex="-1"></a>    survival_results, </span>
<span id="cb7-2605"><a href="#cb7-2605" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(x) </span>
<span id="cb7-2606"><a href="#cb7-2606" aria-hidden="true" tabindex="-1"></a>        <span class="fu">lapply</span>(</span>
<span id="cb7-2607"><a href="#cb7-2607" aria-hidden="true" tabindex="-1"></a>            x,</span>
<span id="cb7-2608"><a href="#cb7-2608" aria-hidden="true" tabindex="-1"></a>            <span class="cf">function</span>(y)</span>
<span id="cb7-2609"><a href="#cb7-2609" aria-hidden="true" tabindex="-1"></a>                <span class="fu">lapply</span>(</span>
<span id="cb7-2610"><a href="#cb7-2610" aria-hidden="true" tabindex="-1"></a>                    y,</span>
<span id="cb7-2611"><a href="#cb7-2611" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">function</span>(z){</span>
<span id="cb7-2612"><a href="#cb7-2612" aria-hidden="true" tabindex="-1"></a>                        broom<span class="sc">::</span><span class="fu">tidy</span>(</span>
<span id="cb7-2613"><a href="#cb7-2613" aria-hidden="true" tabindex="-1"></a>                            z, </span>
<span id="cb7-2614"><a href="#cb7-2614" aria-hidden="true" tabindex="-1"></a>                            <span class="at">conf.int =</span> <span class="cn">TRUE</span>, </span>
<span id="cb7-2615"><a href="#cb7-2615" aria-hidden="true" tabindex="-1"></a>                            <span class="at">exponentiate =</span> <span class="cn">TRUE</span></span>
<span id="cb7-2616"><a href="#cb7-2616" aria-hidden="true" tabindex="-1"></a>                        )</span>
<span id="cb7-2617"><a href="#cb7-2617" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb7-2618"><a href="#cb7-2618" aria-hidden="true" tabindex="-1"></a>                ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2619"><a href="#cb7-2619" aria-hidden="true" tabindex="-1"></a>                    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"score"</span>)</span>
<span id="cb7-2620"><a href="#cb7-2620" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2621"><a href="#cb7-2621" aria-hidden="true" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"cohort"</span>)</span>
<span id="cb7-2622"><a href="#cb7-2622" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2623"><a href="#cb7-2623" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(<span class="at">.id =</span> <span class="st">"type_analysis"</span>)</span>
<span id="cb7-2624"><a href="#cb7-2624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2625"><a href="#cb7-2625" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(</span>
<span id="cb7-2626"><a href="#cb7-2626" aria-hidden="true" tabindex="-1"></a>    tables_survival,</span>
<span id="cb7-2627"><a href="#cb7-2627" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/tables/pca_merging/survival_results.csv"</span>,</span>
<span id="cb7-2628"><a href="#cb7-2628" aria-hidden="true" tabindex="-1"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span></span>
<span id="cb7-2629"><a href="#cb7-2629" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2630"><a href="#cb7-2630" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-2631"><a href="#cb7-2631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2632"><a href="#cb7-2632" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width = 4, fig.height=10}</span></span>
<span id="cb7-2633"><a href="#cb7-2633" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-mol-land-survival</span></span>
<span id="cb7-2634"><a href="#cb7-2634" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Overall survival analysis from all the three big cohorts and their</span></span>
<span id="cb7-2635"><a href="#cb7-2635" aria-hidden="true" tabindex="-1"></a><span class="co">#|     scores. The formulas used were the same as for the estrogen</span></span>
<span id="cb7-2636"><a href="#cb7-2636" aria-hidden="true" tabindex="-1"></a><span class="co">#|     signaling analysis.</span></span>
<span id="cb7-2637"><a href="#cb7-2637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2638"><a href="#cb7-2638" aria-hidden="true" tabindex="-1"></a>forest_plots <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"../../results/rds_files/pca_merging/forest_plots.rds"</span>)</span>
<span id="cb7-2639"><a href="#cb7-2639" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> <span class="fu">c</span>(</span>
<span id="cb7-2640"><a href="#cb7-2640" aria-hidden="true" tabindex="-1"></a>    forest_plots<span class="sc">$</span>os,</span>
<span id="cb7-2641"><a href="#cb7-2641" aria-hidden="true" tabindex="-1"></a>    forest_plots<span class="sc">$</span>rfs</span>
<span id="cb7-2642"><a href="#cb7-2642" aria-hidden="true" tabindex="-1"></a>), <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb7-2643"><a href="#cb7-2643" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-2644"><a href="#cb7-2644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2645"><a href="#cb7-2645" aria-hidden="true" tabindex="-1"></a>We see that G2M checkpoint has hazard ratio higher than 1.</span>
<span id="cb7-2646"><a href="#cb7-2646" aria-hidden="true" tabindex="-1"></a>The other scores are a bit more</span>
<span id="cb7-2647"><a href="#cb7-2647" aria-hidden="true" tabindex="-1"></a>variable and can change the sign (type S error). </span>
<span id="cb7-2648"><a href="#cb7-2648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2649"><a href="#cb7-2649" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=8, fig.height=4}</span></span>
<span id="cb7-2650"><a href="#cb7-2650" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-pca-mol-land-survival-scanb-metabric</span></span>
<span id="cb7-2651"><a href="#cb7-2651" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: Overall survival analysis from all the three big cohorts and their</span></span>
<span id="cb7-2652"><a href="#cb7-2652" aria-hidden="true" tabindex="-1"></a><span class="co">#|     scores. The formulas used were the same as for the estrogen</span></span>
<span id="cb7-2653"><a href="#cb7-2653" aria-hidden="true" tabindex="-1"></a><span class="co">#|     signaling analysis.</span></span>
<span id="cb7-2654"><a href="#cb7-2654" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="at">plotlist =</span> <span class="fu">c</span>(</span>
<span id="cb7-2655"><a href="#cb7-2655" aria-hidden="true" tabindex="-1"></a>    forest_plots<span class="sc">$</span>os[<span class="fu">c</span>(<span class="st">"scanb"</span>, <span class="st">"metabric"</span>)],</span>
<span id="cb7-2656"><a href="#cb7-2656" aria-hidden="true" tabindex="-1"></a>    forest_plots<span class="sc">$</span>rfs[<span class="fu">c</span>(<span class="st">"scanb"</span>, <span class="st">"metabric"</span>)]</span>
<span id="cb7-2657"><a href="#cb7-2657" aria-hidden="true" tabindex="-1"></a>), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb7-2658"><a href="#cb7-2658" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-2659"><a href="#cb7-2659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2660"><a href="#cb7-2660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2661"><a href="#cb7-2661" aria-hidden="true" tabindex="-1"></a>Below is the</span>
<span id="cb7-2662"><a href="#cb7-2662" aria-hidden="true" tabindex="-1"></a>table with the scores.</span>
<span id="cb7-2663"><a href="#cb7-2663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2666"><a href="#cb7-2666" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-2667"><a href="#cb7-2667" aria-hidden="true" tabindex="-1"></a>survival_results_pc3_above <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(</span>
<span id="cb7-2668"><a href="#cb7-2668" aria-hidden="true" tabindex="-1"></a>    <span class="st">"../../results/tables/pca_merging/survival_results.csv"</span></span>
<span id="cb7-2669"><a href="#cb7-2669" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-2670"><a href="#cb7-2670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2671"><a href="#cb7-2671" aria-hidden="true" tabindex="-1"></a>survival_results_pc3_above <span class="sc">%&gt;%</span> </span>
<span id="cb7-2672"><a href="#cb7-2672" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"HALLMARK"</span>, term)) <span class="sc">%&gt;%</span></span>
<span id="cb7-2673"><a href="#cb7-2673" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">HR =</span> estimate) <span class="sc">%&gt;%</span></span>
<span id="cb7-2674"><a href="#cb7-2674" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb7-2675"><a href="#cb7-2675" aria-hidden="true" tabindex="-1"></a>        type_analysis, </span>
<span id="cb7-2676"><a href="#cb7-2676" aria-hidden="true" tabindex="-1"></a>        cohort, term, </span>
<span id="cb7-2677"><a href="#cb7-2677" aria-hidden="true" tabindex="-1"></a>        HR, conf.low, </span>
<span id="cb7-2678"><a href="#cb7-2678" aria-hidden="true" tabindex="-1"></a>        conf.high, p.value</span>
<span id="cb7-2679"><a href="#cb7-2679" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-2680"><a href="#cb7-2680" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(term, type_analysis, cohort) <span class="sc">%&gt;%</span></span>
<span id="cb7-2681"><a href="#cb7-2681" aria-hidden="true" tabindex="-1"></a>    DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb7-2682"><a href="#cb7-2682" aria-hidden="true" tabindex="-1"></a>        <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb7-2683"><a href="#cb7-2683" aria-hidden="true" tabindex="-1"></a>            <span class="at">scrollX =</span> <span class="cn">TRUE</span>, </span>
<span id="cb7-2684"><a href="#cb7-2684" aria-hidden="true" tabindex="-1"></a>            <span class="at">pageLength =</span> <span class="dv">20</span></span>
<span id="cb7-2685"><a href="#cb7-2685" aria-hidden="true" tabindex="-1"></a>        ), </span>
<span id="cb7-2686"><a href="#cb7-2686" aria-hidden="true" tabindex="-1"></a>        <span class="at">filter =</span> <span class="st">'top'</span></span>
<span id="cb7-2687"><a href="#cb7-2687" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2688"><a href="#cb7-2688" aria-hidden="true" tabindex="-1"></a>    DT<span class="sc">::</span><span class="fu">formatRound</span>(</span>
<span id="cb7-2689"><a href="#cb7-2689" aria-hidden="true" tabindex="-1"></a>        <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"HR"</span>, <span class="st">"conf.low"</span>, <span class="st">"conf.high"</span>), </span>
<span id="cb7-2690"><a href="#cb7-2690" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb7-2691"><a href="#cb7-2691" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2692"><a href="#cb7-2692" aria-hidden="true" tabindex="-1"></a>    DT<span class="sc">::</span><span class="fu">formatSignif</span>(<span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"p.value"</span>))</span>
<span id="cb7-2693"><a href="#cb7-2693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-2694"><a href="#cb7-2694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2695"><a href="#cb7-2695" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tumor Purity</span></span>
<span id="cb7-2696"><a href="#cb7-2696" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2697"><a href="#cb7-2697" aria-hidden="true" tabindex="-1"></a>One possible problem that might arise in the analysis is the tumor</span>
<span id="cb7-2698"><a href="#cb7-2698" aria-hidden="true" tabindex="-1"></a>purity. We showed already the molecular embedder colored by tumor</span>
<span id="cb7-2699"><a href="#cb7-2699" aria-hidden="true" tabindex="-1"></a>purity but here we look more carefully at the relationship between</span>
<span id="cb7-2700"><a href="#cb7-2700" aria-hidden="true" tabindex="-1"></a>PC3 and PC4 with tumor purity as made available by METABRIC.</span>
<span id="cb7-2701"><a href="#cb7-2701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2702"><a href="#cb7-2702" aria-hidden="true" tabindex="-1"></a>We actually compare the PC3 and PC4 with tumor purity stratified by</span>
<span id="cb7-2703"><a href="#cb7-2703" aria-hidden="true" tabindex="-1"></a>molecular subtype, as it is expected that the normal-like subtype</span>
<span id="cb7-2704"><a href="#cb7-2704" aria-hidden="true" tabindex="-1"></a>is correlated with lower tumor purity.</span>
<span id="cb7-2705"><a href="#cb7-2705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2706"><a href="#cb7-2706" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=14, fig.height=6}</span></span>
<span id="cb7-2707"><a href="#cb7-2707" aria-hidden="true" tabindex="-1"></a>df_pca_coordinates <span class="sc">%&gt;%</span></span>
<span id="cb7-2708"><a href="#cb7-2708" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb7-2709"><a href="#cb7-2709" aria-hidden="true" tabindex="-1"></a>        cohort <span class="sc">==</span> <span class="st">"metabric"</span> <span class="sc">&amp;</span></span>
<span id="cb7-2710"><a href="#cb7-2710" aria-hidden="true" tabindex="-1"></a>            CELLULARITY <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>)</span>
<span id="cb7-2711"><a href="#cb7-2711" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-2712"><a href="#cb7-2712" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb7-2713"><a href="#cb7-2713" aria-hidden="true" tabindex="-1"></a>        <span class="at">tumor_purity =</span> <span class="fu">factor</span>(</span>
<span id="cb7-2714"><a href="#cb7-2714" aria-hidden="true" tabindex="-1"></a>            CELLULARITY,</span>
<span id="cb7-2715"><a href="#cb7-2715" aria-hidden="true" tabindex="-1"></a>            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>)</span>
<span id="cb7-2716"><a href="#cb7-2716" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-2717"><a href="#cb7-2717" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-2718"><a href="#cb7-2718" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb7-2719"><a href="#cb7-2719" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"PC3"</span>, <span class="st">"PC4"</span>)),</span>
<span id="cb7-2720"><a href="#cb7-2720" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"PC"</span>,</span>
<span id="cb7-2721"><a href="#cb7-2721" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb7-2722"><a href="#cb7-2722" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-2723"><a href="#cb7-2723" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb7-2724"><a href="#cb7-2724" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> tumor_purity, <span class="at">y =</span> value, <span class="at">color =</span> pam50</span>
<span id="cb7-2725"><a href="#cb7-2725" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span> </span>
<span id="cb7-2726"><a href="#cb7-2726" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb7-2727"><a href="#cb7-2727" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_violin</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb7-2728"><a href="#cb7-2728" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">45</span>)) <span class="sc">+</span> </span>
<span id="cb7-2729"><a href="#cb7-2729" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-2730"><a href="#cb7-2730" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"Molecular</span><span class="sc">\n</span><span class="st">subtype"</span>,</span>
<span id="cb7-2731"><a href="#cb7-2731" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"PC"</span>,</span>
<span id="cb7-2732"><a href="#cb7-2732" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Tumor purity"</span></span>
<span id="cb7-2733"><a href="#cb7-2733" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb7-2734"><a href="#cb7-2734" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(PC <span class="sc">~</span> pam50, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb7-2735"><a href="#cb7-2735" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span> </span>
<span id="cb7-2736"><a href="#cb7-2736" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>() <span class="sc">+</span> </span>
<span id="cb7-2737"><a href="#cb7-2737" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>()</span>
<span id="cb7-2738"><a href="#cb7-2738" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-2739"><a href="#cb7-2739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2740"><a href="#cb7-2740" aria-hidden="true" tabindex="-1"></a>And when we look at all subtypes together.</span>
<span id="cb7-2741"><a href="#cb7-2741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2742"><a href="#cb7-2742" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.width=10, fig.height=4}</span></span>
<span id="cb7-2743"><a href="#cb7-2743" aria-hidden="true" tabindex="-1"></a>df_pca_coordinates <span class="sc">%&gt;%</span></span>
<span id="cb7-2744"><a href="#cb7-2744" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb7-2745"><a href="#cb7-2745" aria-hidden="true" tabindex="-1"></a>        cohort <span class="sc">==</span> <span class="st">"metabric"</span> <span class="sc">&amp;</span></span>
<span id="cb7-2746"><a href="#cb7-2746" aria-hidden="true" tabindex="-1"></a>            CELLULARITY <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>)</span>
<span id="cb7-2747"><a href="#cb7-2747" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-2748"><a href="#cb7-2748" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb7-2749"><a href="#cb7-2749" aria-hidden="true" tabindex="-1"></a>        <span class="at">tumor_purity =</span> <span class="fu">factor</span>(</span>
<span id="cb7-2750"><a href="#cb7-2750" aria-hidden="true" tabindex="-1"></a>            CELLULARITY,</span>
<span id="cb7-2751"><a href="#cb7-2751" aria-hidden="true" tabindex="-1"></a>            <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Moderate"</span>, <span class="st">"High"</span>)</span>
<span id="cb7-2752"><a href="#cb7-2752" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-2753"><a href="#cb7-2753" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-2754"><a href="#cb7-2754" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb7-2755"><a href="#cb7-2755" aria-hidden="true" tabindex="-1"></a>        <span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"PC3"</span>, <span class="st">"PC4"</span>)),</span>
<span id="cb7-2756"><a href="#cb7-2756" aria-hidden="true" tabindex="-1"></a>        <span class="at">names_to =</span> <span class="st">"PC"</span>,</span>
<span id="cb7-2757"><a href="#cb7-2757" aria-hidden="true" tabindex="-1"></a>        <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb7-2758"><a href="#cb7-2758" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb7-2759"><a href="#cb7-2759" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="fu">aes</span>(</span>
<span id="cb7-2760"><a href="#cb7-2760" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> tumor_purity, <span class="at">y =</span> value, <span class="at">color =</span> pam50</span>
<span id="cb7-2761"><a href="#cb7-2761" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span> </span>
<span id="cb7-2762"><a href="#cb7-2762" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_jitter</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb7-2763"><a href="#cb7-2763" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_violin</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb7-2764"><a href="#cb7-2764" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">45</span>)) <span class="sc">+</span> </span>
<span id="cb7-2765"><a href="#cb7-2765" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb7-2766"><a href="#cb7-2766" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">"Molecular</span><span class="sc">\n</span><span class="st">subtype"</span>,</span>
<span id="cb7-2767"><a href="#cb7-2767" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> <span class="st">"PC"</span>,</span>
<span id="cb7-2768"><a href="#cb7-2768" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Tumor purity"</span></span>
<span id="cb7-2769"><a href="#cb7-2769" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb7-2770"><a href="#cb7-2770" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>PC, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb7-2771"><a href="#cb7-2771" aria-hidden="true" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">20</span>) <span class="sc">+</span> </span>
<span id="cb7-2772"><a href="#cb7-2772" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_guides_point</span>() <span class="sc">+</span> </span>
<span id="cb7-2773"><a href="#cb7-2773" aria-hidden="true" tabindex="-1"></a>    <span class="fu">change_plot_aes_point</span>()</span>
<span id="cb7-2774"><a href="#cb7-2774" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-2775"><a href="#cb7-2775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2776"><a href="#cb7-2776" aria-hidden="true" tabindex="-1"></a>Overall there is an absence of evidence that tumor purity is affecting </span>
<span id="cb7-2777"><a href="#cb7-2777" aria-hidden="true" tabindex="-1"></a>PC3 and PC4 in a systematic way.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/chronchi">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/chronchi">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>